(self.AMP=self.AMP||[]).push({m:0,v:"2110121450047",n:"amp-link-rewriter",ev:"0.1",l:true,f:function(AMP,_){"use strict";var f="function"==typeof Object.create?Object.create:function(a){function b(){}b.prototype=a;return new b};function l(a){for(var b=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global],c=0;c<b.length;++c){var d=b[c];if(d&&d.Math==Math)return}(function(){throw Error("Cannot find global object")})()}l(this);"function"===typeof Symbol&&Symbol("x");var m;if("function"==typeof Object.setPrototypeOf)m=Object.setPrototypeOf;else{var n;a:{var p={a:!0},q={};try{q.__proto__=p;n=q.a;break a}catch(a){}n=!1}m=n?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var t=m;var u=Object.prototype.hasOwnProperty;
/* https://mths.be/cssescape v1.5.1 by @mathias | MIT license */var v;function w(a,b){for(;a&&void 0!==a;a=a.parentElement)if(b(a))return a;return null}function x(a,b){return a.closest?a.closest(b):w(a,(function(c){var d=c.matches||c.webkitMatchesSelector||c.mozMatchesSelector||c.msMatchesSelector||c.oMatchesSelector;return d?d.call(c,b):!1}))}function y(a){function b(r){return r}var c=a.dataset;a={};var e,d=z||/^param(.+)/;for(e in c){var g=e.match(d);if(g){var h=g[1][0].toLowerCase()+g[1].substr(1);a[b(h)]=c[e]}}return a}function D(a,b){for(var c=a.length,d=0;d<c;d++)b(a[d],d)}var E=self.AMP_CONFIG||{},F=("string"==typeof E.cdnProxyRegex?new RegExp(E.cdnProxyRegex):E.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;function G(a){if(self.document&&self.document.head&&(!self.location||!F.test(self.location.origin))){var b=self.document.head.querySelector('meta[name="'+a+'"]');b&&b.getAttribute("content")}}E.cdnUrl||G("runtime-host");E.geoApiUrl||G("amp-geo-api");self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var H=self.__AMP_LOG;function I(){throw Error("failed to call initLogConstructor")}function J(a){H.user||(H.user=I());var b=H.user.win;return a&&a.ownerDocument.defaultView!=b?H.userForEmbed||(H.userForEmbed=I()):H.user}function K(a,b){var c=L(a);c=Q(c);return R(c,b)}function L(a){if(a.nodeType){var b=(a.ownerDocument||a).defaultView;b=b.__AMP_TOP||(b.__AMP_TOP=b);return R(b,"ampdoc").getAmpDoc(a)}return a}function Q(a){a=L(a);return a.isSingleDoc()?a.win:a}function R(a,b){S(a,b);var c=a.__AMP_SERVICES;c||(c=a.__AMP_SERVICES={});a=c[b];a.obj||(a.obj=new a.ctor(a.context),a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}function S(a,b){a=a.__AMP_SERVICES&&a.__AMP_SERVICES[b];return!(!a||!a.ctor)}function aa(a){var b={};Object.keys(a).forEach((function(c){b[c]="^"+a[c]+"$"}));return b}function ba(a,b){var c=a.getRootNode(),d=b.section.join(" a, "),e=c.querySelectorAll("a"),g=[];0!==b.section.length&&(d+=" a",e=c.querySelectorAll(d));D(e,(function(h){T(h,b)&&g.push(h)}));return g}function T(a,b){var c=b.attribute;return Object.keys(c).every((function(d){return new RegExp(c[d]).test(a.getAttribute(d))}))}var ca=["href","id","rel","rev"],z=/^vars(.+)/,U=/^(?:https?:)?(?:\/\/)?([^\/?]+)/i,da={SOURCE_URL:!0,DOCUMENT_REFERRER:!0,AMP_GEO:!0};function V(a,b,c){this.A=c;try{/^[\w-]+$/.test("script");if(void 0!==v)var d=v;else{try{var e=b.ownerDocument,g=e.createElement("div"),h=e.createElement("div");g.appendChild(h);var r=g.querySelector(":scope div")===h}catch(A){r=!1}d=v=r}if(d)var M=b.querySelectorAll("> script".replace(/^|,/g,"$&:scope "));else{b.classList.add("i-amphtml-scoped");var ea="> script".replace(/^|,/g,"$&.i-amphtml-scoped "),fa=b.querySelectorAll(ea);b.classList.remove("i-amphtml-scoped");M=fa}var N=M;var O=N.length;if(1!==O)throw Error("Found "+O+" <script> children. Expected 1.");var P,B=N[0];if("SCRIPT"!=B.tagName||"APPLICATION/JSON"!=(null==(P=B.getAttribute("type"))?void 0:P.toUpperCase()))throw Error('<script> child must have type="application/json"');try{var ha=JSON.parse(B.textContent)}catch(A){throw Error("Failed to parse <script> contents. Is it valid JSON?")}var C=ha}catch(A){throw J(b).createError("%s: %s","amp-link-rewriter",A)}c=C;C=c.output;J().assert(C,"amp-link-rewriter: output config property is required",void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0);var k;this.j={output:c.output.toString(),section:u.call(c,"section")?c.section:[],attribute:u.call(c,"attribute")?aa(c.attribute):{},vars:u.call(c,"vars")?c.vars:{},scopeDocument:null!=(k=c.scopeDocument)?k:!0};this.B=ba(this.A,this.j);this.o=a;this.h="";k=L(b);k=Q(k);this.F=S(k,"url-replace")?R(k,"url-replace"):null}V.prototype.handleClick=function(a){if(a){this.h=this.j.output;var b;if(b=a.href.match(U)[1]!==this.h.match(U)[1])this.j.scopeDocument?b=ia(this,a):(b=this.j,b=!!T(a,b)&&(0===b.section.length?!0:!!x(a,b.section.join(","))));if(b){var c=K(this.A,"documentInfo").get().sourceUrl.match(U)[1],d=K(this.A,"documentInfo").get().canonicalUrl.match(U)[1];ja(a,[c,d])||(this.h=this.F.expandUrlSync(this.h,{DOCUMENT_REFERRER:this.o},da),b=this.j.vars,b instanceof Object&&(a.href=ka(this,a,b)))}}};function ia(a,b){return null===a.B||0===a.B.length||0<a.B.filter((function(c){return c===b})).length?!0:!1}function ja(a,b){var c=a.href;return b.some((function(d){var e=c.match(U);return e?U.test(c)&&e[1]===d:!0}))}function ka(a,b,c){ca.forEach((function(e){b.getAttribute(e)&&(c[e]=b.getAttribute(e))}));var d=y(b);Object.assign(c,d);c.random=Math.random().toString(32).substr(2);Object.keys(c).forEach((function(e){c[e]&&(a.h=a.h.replace("${"+e+"}",encodeURIComponent(c[e])))}));a.h=a.h.replace(/\${[A-Za-z0-9]+}+/,(function(){return""}));return a.h}new Set(["c","v","a","ad"]);function W(a){a=AMP.BaseElement.call(this,a)||this;a.C=null;a.o="";return a}var X=AMP.BaseElement;W.prototype=f(X.prototype);W.prototype.constructor=W;if(t)t(W,X);else for(var Y in X)if("prototype"!=Y)if(Object.defineProperties){var Z=Object.getOwnPropertyDescriptor(X,Y);Z&&Object.defineProperty(W,Y,Z)}else W[Y]=X[Y];W.G=X.prototype;W.prototype.buildCallback=function(){var a=this,b=K(this.getAmpDoc(),"viewer");return this.getAmpDoc().whenReady().then((function(){return b.getReferrerUrl()})).then((function(c){return a.o=c})).then(this.D.bind(this))};W.prototype.D=function(){this.C=new V(this.o,this.element,this.getAmpDoc());la(this)};function la(a){K(a.getAmpDoc(),"navigation").registerAnchorMutator((function(b){a.C.handleClick(b)}),0)}W.prototype.isLayoutSupported=function(a){return"nodisplay"===a};AMP.registerElement("amp-link-rewriter",W)}});//# sourceMappingURL=amp-link-rewriter-0.1.js.map