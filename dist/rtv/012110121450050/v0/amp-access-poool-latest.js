(self.AMP=self.AMP||[]).push({m:0,v:"2110121450047",n:"amp-access-poool",ev:"0.1",l:true,f:function(AMP,_){"use strict";function l(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}function q(a){return a||{}}var r=Array.isArray;function t(a,b){try{return JSON.parse(a)}catch(c){return null==b||b(c),null}}
/* https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
var u=self.AMP_CONFIG||{},v=("string"==typeof u.cdnProxyRegex?new RegExp(u.cdnProxyRegex):u.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;function w(a){if(self.document&&self.document.head&&(!self.location||!v.test(self.location.origin))){var b=self.document.head.querySelector('meta[name="'+a+'"]');b&&b.getAttribute("content")}}u.cdnUrl||w("runtime-host");u.geoApiUrl||w("amp-geo-api");var x=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;function y(a,b){var c=b=void 0===b?"":b;try{return decodeURIComponent(a)}catch(d){return c}}function z(a){a=(a||self).location;a=a.originalHash||a.hash;var b=Object.create(null);if(a)for(var c;c=x.exec(a);){var d=y(c[1],c[1]);c=c[2]?y(c[2].replace(/\+/g," "),c[2]):"";b[d]=c}return b}var A="";function aa(){var a=self;if(a.__AMP_MODE)a=a.__AMP_MODE;else{var b=z(a)||z(a);b=["1","actions","amp","amp4ads","amp4email"].includes(b.development)||!!a.AMP_DEV_MODE;if(!A){var c;A=(null==(c=a.AMP_CONFIG)?void 0:c.v)||"012110121450047"}a=a.__AMP_MODE={localDev:!1,development:b,esm:!1,test:!1,rtvVersion:A}}return a}function ba(a){var b=null,c="";var d=arguments;var e="undefined"!=typeof Symbol&&Symbol.iterator&&d[Symbol.iterator];d=e?e.call(d):{next:l(d)};for(e=d.next();!e.done;e=d.next())if(e=e.value,e instanceof Error&&!b){var f=b=void 0;if(null==(f=Object.getOwnPropertyDescriptor(e,"message"))?0:f.writable)b=e;else{f=e.stack;var g=Error(e.message);for(b in e)g[b]=e[b];g.stack=f;b=g}}else c&&(c+=" "),c+=e;b?c&&(b.message=c+": "+b.message):b=Error(c);return b}function ca(a){var b=ba.apply(null,arguments);setTimeout((function(){var c,d;null==(d=(c=self).__AMP_REPORT_ERROR)||d.call(c,b);throw b}))}self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var B=self.__AMP_LOG;function C(){throw Error("failed to call initLogConstructor")}function D(){B.user||(B.user=C());return B.user}function E(a,b,c,d,e,f){return D().assert(a,b,c,d,e,f,void 0,void 0,void 0,void 0,void 0)}var F;function da(){var a=this;this.promise=new Promise((function(b,c){a.resolve=b;a.reject=c}))}function G(a,b){a=a.__AMP_TOP||(a.__AMP_TOP=a);return H(a,b)}function I(a,b){var c=J(a);c=K(c);return H(c,b)}function J(a){return a.nodeType?G((a.ownerDocument||a).defaultView,"ampdoc").getAmpDoc(a):a}function K(a){a=J(a);return a.isSingleDoc()?a.win:a}function H(a,b){a=L(a)[b];a.obj||(a.obj=new a.ctor(a.context),a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}function M(a){var b=L(a).access;if(b){if(b.promise)return b.promise;H(a,"access");return b.promise=Promise.resolve(b.obj)}return null}function L(a){var b=a.__AMP_SERVICES;b||(b=a.__AMP_SERVICES={});return b}function ea(){var a=new da,b=a.promise,c=a.reject;a=a.resolve;b.catch((function(){}));return{obj:null,promise:b,resolve:a,reject:c,context:null,ctor:null}}function fa(a){return ha(a).then((function(b){return E(b,"Service %s was requested to be provided through %s, but %s is not loaded in the current page. To fix this problem load the JavaScript file for %s in this page.","access","amp-access","amp-access","amp-access")}))}function ha(a){var b=M(K(a));if(b)return b;var c=J(a);return c.whenExtensionsKnown().then((function(){var d=c.getExtensionVersion("amp-access");return d?G(c.win,"extensions").waitForExtension("amp-access",d):null})).then((function(d){if(d){var e=K(a);var f=M(e);f?e=f:(e=L(e),e.access=ea(),e=e.access.promise)}else e=null;return e}))}var N,O="Webkit webkit Moz moz ms O o".split(" ");function P(a,b,c){var d=a.style;if(!b.startsWith("--")){N||(N=Object.create(null));var e=N[b];if(!e){e=b;if(void 0===d[b]){var f=b.charAt(0).toUpperCase()+b.slice(1);b:{for(var g=0;g<O.length;g++){var m=O[g]+f;if(void 0!==d[m]){f=m;break b}}f=""}void 0!==d[f]&&(e=f)}N[b]=e}b=e}b&&(b.startsWith("--")?a.style.setProperty(b,c):a.style[b]=c)}function ia(a){for(var b=["transform"],c=0;c<b.length;c++)P(a,b[c],null)}function ja(a){if(!Q(a))return null;var b=a.indexOf("{");return t(a.substr(b),(function(c){ca(Error("MESSAGING: Failed to parse message: "+a+"\n"+c.message))}))}function Q(a){return"string"==typeof a&&a.startsWith("amp-")&&-1!=a.indexOf("{")}function R(){this.I=100;this.B=this.C=0;this.A=Object.create(null)}R.prototype.has=function(a){return!!this.A[a]};R.prototype.get=function(a){var b=this.A[a];if(b)return b.access=++this.B,b.payload};R.prototype.put=function(a,b){this.has(a)||this.C++;this.A[a]={payload:b,access:this.B};if(!(this.C<=this.I)){a=this.A;var d,c=this.B+1;for(d in a){var e=a[d].access;if(e<c){c=e;var f=d}}void 0!==f&&(delete a[f],this.C--)}};new Set(["c","v","a","ad"]);var S,T;function ka(a){S||(S=self.document.createElement("a"),T=self.__AMP_URL_CACHE||(self.__AMP_URL_CACHE=new R));var b=S,c=T;if(c&&c.has(a))a=c.get(a);else{b.href=a;b.protocol||(b.href=b.href);var d={href:b.href,protocol:b.protocol,host:b.host,hostname:b.hostname,port:"0"==b.port?"":b.port,pathname:b.pathname,search:b.search,hash:b.hash,origin:null};"/"!==d.pathname[0]&&(d.pathname="/"+d.pathname);if("http:"==d.protocol&&80==d.port||"https:"==d.protocol&&443==d.port)d.port="",d.host=d.hostname;d.origin=b.origin&&"null"!=b.origin?b.origin:"data:"!=d.protocol&&d.host?d.protocol+"//"+d.host:d.href;c&&c.put(a,d);a=d}return a}function U(a,b,c){if(!b)return a;var d=a.split("#",2),e=d[0].split("?",2),f=e[0]+(e[1]?c?"?"+b+"&"+e[1]:"?"+e[1]+"&"+b:"?"+b);return f+=d[1]?"#"+d[1]:""}function V(a,b){return encodeURIComponent(a)+"="+encodeURIComponent(b)}function la(a,b){var d,c=[];for(d in b){var e=b[d];if(null!=e){e=r(e)?e:[e];for(var f=0;f<e.length;f++)c.push(V(d,e[f]))}}b=c.join("&");return U(a,b)}function W(a,b,c){var d=a.listeningFors;!d&&c&&(d=a.listeningFors=Object.create(null));a=d||null;if(!a)return a;var e=a[b];!e&&c&&(e=a[b]=[]);return e||null}function ma(a,b){a=W(a,"amp",!0);for(var c,d=0;d<a.length;d++){var e=a[d];if(e.frame===b){c=e;break}}c||(c={frame:b,events:Object.create(null)},a.push(c));return c.events}function na(a){for(var b=q({sentinel:"unlisten"}),c=a.length-1;0<=c;c--){var d=a[c];if(!d.frame.contentWindow){a.splice(c,1);var f,e=d.events;for(f in e)e[f].splice(0,1/0).forEach((function(g){g(b)}))}}}function oa(a){a.listeningFors||a.addEventListener("message",(function(b){if(b.data){var c=pa(b.data);if(c&&c.sentinel){var d=b.source;var e=W(a,c.sentinel);if(e){for(var f,g=0;g<e.length;g++){var m=e[g],k=m.frame.contentWindow;if(k){var h;if(!(h=d==k))b:{for(h=d;h&&h!=h.parent;h=h.parent)if(h==k){h=!0;break b}h=!1}if(h){f=m;break}}else setTimeout(na,0,e)}d=f?f.events:null}else d=e;var p=d;if(p){var n=p[c.type];if(n)for(n=n.slice(),d=0;d<n.length;d++)(0,n[d])(c,b.source,b.origin,b)}}}}))}function X(a,b,c){function d(k,h,p,n){if("amp"==k.sentinel){if(h!=a.contentWindow)return;var qa="null"==p&&void 0;if(f!=p&&!qa)return}h==a.contentWindow&&("unlisten"==k.sentinel?m():c(k,h,p,n))}var e=a.ownerDocument.defaultView;oa(e);e=ma(e,a);var f=ka(a.src).origin,g=e[b]||(e[b]=[]);g.push(d);var m=function(){if(d){var k=g.indexOf(d);-1<k&&g.splice(k,1);c=g=d=null}}}function pa(a){"string"==typeof a&&(a="{"==a.charAt(0)?t(a,(function(b){(B.dev||(B.dev=C())).warn("IFRAME-HELPER","Postmessage could not be parsed. Is it in a valid JSON format?",b)}))||null:Q(a)?ja(a):null);return a}var Y={authorization:"https://api.poool.fr/api/v3/amp/access?rid=READER_ID",iframe:"https://assets.poool.fr/amp.html?rid=READER_ID&c=CANONICAL_URL&o=AMPDOC_URL&r=DOCUMENT_REFERRER"};function Z(a,b){this.ampdoc=a.ampdoc;this.o=b;this.F=I(this.ampdoc,"mutator");this.G=Y.authorization;this.J=Y.iframe;this.O=H(this.ampdoc.win,"timer");this.P=G(this.ampdoc.win,"xhr");this.K=I(this.ampdoc,"navigation");this.j=this.o.getAdapterConfig();this.H=this.j.bundleID||"";this.R="";this.D=this.j.itemID||"";this.h=this.ampdoc.win.document.createElement("iframe");this.h.setAttribute("id","poool-iframe");this.h.setAttribute("scrolling","no");this.h.setAttribute("frameborder","0");P(this.h,"width","100%");if("unlock"==this.j.forceWidget){var c=this.h,d={height:"250px",position:"fixed",bottom:"0"};for(e in d)P(c,e,d[e])}else{var e=this.h;d={height:"500px",transform:"translateY(-70px)"};for(c in d)P(e,c,d[c])}E(this.H,"BundleID is incorrect or not provided.");E(this.D,"ItemID is not provided.")}Z.prototype.authorize=function(){var a=this;return ra(this).then((function(b){return{access:b.access}}),(function(b){if(!b||!b.response)throw b;if(402!==b.response.status)throw b;sa(a);return{access:!1}}))};function ra(a){var b=U(a.G,V("iid",a.D),void 0);return a.o.buildUrl(b,!1).then((function(c){return a.o.getLoginUrl(c)})).then((function(c){(B.dev||(B.dev=C())).info("amp-access-poool","Authorization URL: ",c);return a.O.timeoutPromise(3e3,a.P.fetchJson(c)).then((function(d){return d.json()}))}))}function ta(a){var b=a.ampdoc.getElementById("poool");return D().assertElement(b,"No element with id #poool found to render paywall into, got")}function sa(a){var b=ta(a);a.o.buildUrl(la(a.J,q({bi:a.j.bundleID,iid:a.j.itemID,ce:a.j.cookiesEnabled,d:"undefined"!==typeof a.j.debug&&null!==a.j.debug?a.j.debug:aa().development||!1,fw:a.j.forceWidget,cs:a.j.customSegment,lo:a.j.locale,co:a.j.context})),!1).then((function(c){a.h.src=c;X(a.h,"release",a.M.bind(a));X(a.h,"resize",a.N.bind(a));X(a.h,"click",a.L.bind(a));b.appendChild(a.h)}))}Z.prototype.M=function(){var a=this.ampdoc.getRootNode().querySelector("[poool-access-preview]");a&&this.F.mutateElement(a,(function(){a.setAttribute("amp-access-hide","")}));var b=this.ampdoc.getRootNode().querySelector("[poool-access-content]");b&&this.F.mutateElement(b,(function(){b.removeAttribute("amp-access-hide")}));ia(this.h)};Z.prototype.N=function(a){P(this.h,"height",a.height)};Z.prototype.L=function(a){a.url&&this.K.navigateTo(this.ampdoc.win,a.url)};Z.prototype.pingback=function(){F||(F=Promise.resolve(void 0));var a=F;return a};AMP.registerServiceForDoc("poool",(function(a){a=a.getHeadNode();return fa(a).then((function(b){var c=b.getVendorSource("poool"),d=new Z(b,c);c.getAdapter().registerVendor(d);return d}))}))}});//# sourceMappingURL=amp-access-poool-0.1.js.map