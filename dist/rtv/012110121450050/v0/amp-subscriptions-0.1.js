(self.AMP=self.AMP||[]).push({m:0,v:"2110121450047",n:"amp-subscriptions",ev:"0.1",l:true,f:function(AMP,_){"use strict";var g;function aa(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}function ba(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):{next:aa(a)}}var ca="function"==typeof Object.create?Object.create:function(a){function b(){}b.prototype=a;return new b};function da(a){for(var b=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global],c=0;c<b.length;++c){var d=b[c];if(d&&d.Math==Math)return}(function(){throw Error("Cannot find global object")})()}da(this);"function"===typeof Symbol&&Symbol("x");var fa;if("function"==typeof Object.setPrototypeOf)fa=Object.setPrototypeOf;else{var ha;a:{var ia={a:!0},ja={};try{ja.__proto__=ia;ha=ja.a;break a}catch(a){}ha=!1}fa=ha?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var ka=fa;function la(a,b){a.prototype=ca(b.prototype);a.prototype.constructor=a;if(ka)ka(a,b);else for(var c in b)if("prototype"!=c)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c];a.Nb=b.prototype}var ma;function w(){return ma?ma:ma=Promise.resolve(void 0)}function x(){var a=this;this.promise=new Promise((function(b,c){a.resolve=b;a.reject=c}))}var na=Object.prototype.hasOwnProperty;function A(a){return a||{}}function oa(a,b){if("."==b)return a;var c=b.split(".");b=ba(c);for(var d=b.next();!d.done;d=b.next()){var e=d.value;if(e&&a&&void 0!==a[e]&&"object"==typeof a&&na.call(a,e))a=a[e];else{a=void 0;break}}return a}function pa(a){return a?Array.prototype.slice.call(a):[]}var qa=Array.isArray;function ra(a,b){try{return JSON.parse(a)}catch(c){return null==b||b(c),null}}
/* https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
var sa;function ta(a,b){for(;a&&void 0!==a;a=a.parentElement)if(b(a))return a;return null}function ua(a){return a.closest?a.closest("[subscriptions-action]"):ta(a,(function(b){var c=b.matches||b.webkitMatchesSelector||b.mozMatchesSelector||b.msMatchesSelector||b.oMatchesSelector;return c?c.call(b,"[subscriptions-action]"):!1}))}function va(a,b,c){if(b(a))c();else{var d=(a.ownerDocument||a).defaultView;if(d.MutationObserver){var e=new d.MutationObserver((function(){b(a)&&(e.disconnect(),c())}));e.observe(a,{childList:!0})}else var f=d.setInterval((function(){b(a)&&(d.clearInterval(f),c())}),5)}}function Aa(a,b){return new Promise((function(c){va(a,b,c)}))}function Ba(a,b,c){a=a.createElement(b);for(var d in c)a.setAttribute(d,c[d]);return a}function Ca(a,b){for(var c=a.length,d=0;d<c;d++)b(a[d],d)}var D=self.AMP_CONFIG||{},Da=("string"==typeof D.cdnProxyRegex?new RegExp(D.cdnProxyRegex):D.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;function Ea(a){if(!self.document||!self.document.head||self.location&&Da.test(self.location.origin))return null;var b=self.document.head.querySelector('meta[name="'+a+'"]');return b&&b.getAttribute("content")||null}var Fa={thirdParty:D.thirdPartyUrl||"https://3p.ampproject.net",thirdPartyFrameHost:D.thirdPartyFrameHost||"ampproject.net",thirdPartyFrameRegex:("string"==typeof D.thirdPartyFrameRegex?new RegExp(D.thirdPartyFrameRegex):D.thirdPartyFrameRegex)||/^d-\d+\.ampproject\.net$/,cdn:D.cdnUrl||Ea("runtime-host")||"https://cdn.ampproject.org",cdnProxyRegex:Da,localhostRegex:/^https?:\/\/localhost(:\d+)?$/,errorReporting:D.errorReportingUrl||"https://us-central1-amp-error-reporting.cloudfunctions.net/r",betaErrorReporting:D.betaErrorReportingUrl||"https://us-central1-amp-error-reporting.cloudfunctions.net/r-beta",localDev:D.localDev||!1,trustedViewerHosts:[/(^|\.)google\.(com?|[a-z]{2}|com?\.[a-z]{2}|cat)$/,/(^|\.)gmail\.(com|dev)$/],geoApi:D.geoApiUrl||Ea("amp-geo-api")};var Ga=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;function Ha(a,b){var c=b=void 0===b?"":b;try{return decodeURIComponent(a)}catch(d){return c}}function Ia(a){var b=Object.create(null);if(!a)return b;for(var c;c=Ga.exec(a);){var d=Ha(c[1],c[1]);c=c[2]?Ha(c[2].replace(/\+/g," "),c[2]):"";b[d]=c}return b}function Ja(a){a=(a||self).location;return Ia(a.originalHash||a.hash)}var Ka="";function La(){var a=self;if(a.__AMP_MODE)a=a.__AMP_MODE;else{var b=Ja(a)||Ja(a);b=["1","actions","amp","amp4ads","amp4email"].includes(b.development)||!!a.AMP_DEV_MODE;if(!Ka){var c;Ka=(null==(c=a.AMP_CONFIG)?void 0:c.v)||"012110121450047"}a=a.__AMP_MODE={localDev:!1,development:b,esm:!1,test:!1,rtvVersion:Ka}}return a}self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var F=self.__AMP_LOG;function Ma(){throw Error("failed to call initLogConstructor")}function H(){F.user||(F.user=Ma());return F.user}function I(){return F.dev||(F.dev=Ma())}function K(a,b,c,d,e){return H().assert(a,b,c,d,e,void 0,void 0,void 0,void 0,void 0,void 0)}function Na(a,b){a=a.__AMP_TOP||(a.__AMP_TOP=a);return N(a,b)}function O(a){return N(a,"timer")}function P(a,b){var c=Oa(a);c=R(c);return N(c,b)}function Oa(a){return a.nodeType?Na((a.ownerDocument||a).defaultView,"ampdoc").getAmpDoc(a):a}function R(a){a=Oa(a);return a.isSingleDoc()?a.win:a}function N(a,b){Pa(a,b);a=Qa(a)[b];a.obj||(a.obj=new a.ctor(a.context),a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}function Ra(a,b){var c=Sa(a,b);if(c)return c;a=Qa(a);a[b]=Ta();return a[b].promise}function Sa(a,b){var c=Qa(a)[b];if(c){if(c.promise)return c.promise;N(a,b);return c.promise=Promise.resolve(c.obj)}return null}function Qa(a){var b=a.__AMP_SERVICES;b||(b=a.__AMP_SERVICES={});return b}function Pa(a,b){a=a.__AMP_SERVICES&&a.__AMP_SERVICES[b];return!(!a||!a.ctor)}function Ta(){var a=new x,b=a.promise,c=a.reject;a=a.resolve;b.catch((function(){}));return{obj:null,promise:b,resolve:a,reject:c,context:null,ctor:null}}function Ua(a){var b=Sa(R(a),"amp-analytics-instrumentation");if(b)return b;var c=Oa(a);return c.whenExtensionsKnown().then((function(){var d=c.getExtensionVersion("amp-analytics");return d?Na(c.win,"extensions").waitForExtension("amp-analytics",d):null})).then((function(d){return d?Ra(R(a),"amp-analytics-instrumentation"):null}))}function Va(a,b,c){var d=!1;c=void 0===c?{}:c;d=void 0===d?!0:d;var e=c,f=d;Ua(a).then((function(h){h&&h.triggerEventForTarget(a,b,e,f)}))}function S(a){this.wb=a;this.Sa=[]}S.prototype.registerEventListener=function(a){this.Sa.push(a)};S.prototype.serviceEvent=function(a,b,c,d){this.event(a,Object.assign(A({serviceId:b}),c),d)};S.prototype.event=function(a,b,c){c=c||A({});var d="subscriptions-action"!==a?a:a+"-"+c.action+"-"+c.status;H().info("amp-subscriptions",d,b||"");b=b||A({});Va(this.wb,d,b);for(var e=0;e<this.Sa.length;e++)this.Sa[e](a,b,c)};S.prototype.actionEvent=function(a,b,c,d){this.serviceEvent("subscriptions-action",a,d,A({action:b,status:c}))};function Wa(a,b,c){var d=!!self.msCrypto;return Xa((d?self.msCrypto.subtle:self.crypto.subtle).decrypt({name:"AES-GCM",iv:b,tag:d?c.slice(c.byteLength-16):void 0,tagLength:128},a,d?c.slice(0,c.byteLength-16):c)).then((function(e){e=new Uint8Array(e);if("undefined"!==typeof TextDecoder)e=new TextDecoder("utf-8").decode(e);else{e=new Uint8Array(e.buffer||e);for(var f=Array(e.length),h=0;h<e.length;h++)f[h]=String.fromCharCode(e[h]);e=f.join("");e=decodeURIComponent(escape(e))}return e}))}function Xa(a){return"function"==typeof a.then?a:new Promise((function(b,c){a.oncomplete=function(){b(a.result)};a.onerror=c}))}function Ya(a){a=atob(a);for(var b=a.length,c=new Uint8Array(b),d=0;d<b;d++)c[d]=a.charCodeAt(d);return c}function Za(a){if("undefined"!==typeof TextDecoder)return new TextDecoder("utf-8").decode(a);a=new Uint8Array(a.buffer||a);for(var b=Array(a.length),c=0;c<a.length;c++)b[c]=String.fromCharCode(a[c]);a=b.join("");return decodeURIComponent(escape(a))}function $a(a){return"undefined"!==typeof TextEncoder?new TextEncoder("utf-8").encode(a):ab(unescape(encodeURIComponent(a)))}function ab(a){for(var b=new Uint8Array(a.length),c=0;c<a.length;c++){var d=a.charCodeAt(c);b[c]=d}return b}function U(a){this.h=a;this.ua=null;var b=this.h.getRootNode().querySelector("script[cryptokeys]");this.Xa=null;b&&b.hasAttribute("sha-256-hash")&&(this.Xa=b.getAttribute("sha-256-hash"));this.Na=b&&ra(b.textContent)||null}U.prototype.isDocumentEncrypted=function(){return!!this.Na&&0<Object.keys(this.Na).length};U.prototype.getEncryptedKeys=function(){return this.Na};U.prototype.getEncryptedDocumentKey=function(a){var b=this.getEncryptedKeys();return b?b[a]||null:null};U.prototype.tryToDecryptDocument=function(a){var b=this;if(!this.Xa)return eb(this,a);var c=$a(a);return crypto.subtle.digest("SHA-256",c).then((function(d){return pa(new Uint8Array(d)).map((function(e){e=e.toString(16);var f=2;if(!(e.length>=f)){f-=e.length;for(var h="0";f>h.length;)h+="0";e=h.slice(0,f)+e}return e})).join("")!=b.Xa?Promise.reject(Error("Invalid Document Key")):eb(b,a)}))};function eb(a,b){if(a.ua)return a.ua;a.ua=a.h.whenReady().then((function(){var c=Ya(b);return Xa((self.msCrypto?self.msCrypto.subtle:self.crypto.subtle).importKey("raw",c.buffer,"AES-GCM",!0,["decrypt"])).then((function(d){var e=a.h.getRootNode().querySelectorAll("script[ciphertext]"),f=[];Ca(e,(function(h){var l=h.textContent.replace(/\s+/g,""),n=Ya(l).buffer;l=n.slice(0,12);n=n.slice(12);f.push(Wa(d,l,n).then((function(r){h.outerHTML=r})))}));return Promise.all(f)}))}));return a.ua}var fb,gb="Webkit webkit Moz moz ms O o".split(" ");function hb(a,b){a=a.style;for(var c in b){var d=a,e=d.setProperty;var f=c;if(!f.startsWith("--")){fb||(fb=Object.create(null));var h=fb[f];if(!h){h=f;if(void 0===a[f]){var l=f;l=l.charAt(0).toUpperCase()+l.slice(1);b:{for(var n=0;n<gb.length;n++){var r=gb[n]+l;if(void 0!==a[r]){l=r;break b}}l=""}void 0!==a[l]&&(h=l)}fb[f]=h}f=h}e.call(d,f,String(b[c]),"important")}}function ib(a,b){void 0===b&&(b=a.hasAttribute("hidden"));b?a.removeAttribute("hidden"):a.setAttribute("hidden","")}function jb(a){var b=this;this.h=a;this.na=Na(a.win,"vsync");this.R=O(a.win);this.aa=P(a,"viewport");this.ma=!1;this.Ja=null;this.jb=w();a=this.h.win.document;this.H=Ba(a,"amp-subscriptions-dialog",{role:"dialog"});ib(this.H,!1);this.Ha=Ba(a,"button",{"class":"i-amphtml-subs-dialog-close-button"});this.showCloseAction(!1);this.H.appendChild(this.Ha);this.Ha.addEventListener("click",(function(){b.close()}));this.h.getBody().appendChild(this.H);hb(this.H,{transform:"translateY(100%)"})}g=jb.prototype;g.getRoot=function(){return this.H};g.isVisible=function(){return this.ma};g.open=function(a,b){var c=this,d=b=void 0===b?!0:b;return kb(this,(function(){return lb(c,a,d)}))};g.close=function(){var a=this;return kb(this,(function(){return mb(a)}))};function kb(a,b){return a.jb=a.jb.then(b)}function lb(a,b,c){var d=void 0===c?!0:c;a.Ja?a.H.replaceChild(b,a.Ja):a.H.appendChild(b);a.Ja=b;if(a.ma)return w();a.ma=!0;return a.na.mutatePromise((function(){ib(a.H,!0);a.showCloseAction(d)})).then((function(){return a.na.mutatePromise((function(){hb(a.H,{transform:"translateY(0)"})})).then((function(){return a.R.promise(300)}))})).then((function(){var e;return a.na.runPromise({measure:function(){e=a.H.offsetHeight},mutate:function(){a.aa.updatePaddingBottom(e);a.aa.addToFixedLayer(a.H,!0)}})}))}function mb(a){return a.ma?a.na.mutatePromise((function(){hb(a.H,{transform:"translateY(100%)"})})).then((function(){return a.R.promise(300)})).then((function(){return a.na.mutatePromise((function(){ib(a.H,!1);a.aa.updatePaddingBottom(0);a.ma=!1}))})):w()}g.showCloseAction=function(a){ib(this.Ha,a)};function nb(a){var b=a.readyState;return"loading"!=b&&"uninitialized"!=b}function ob(a,b){if(nb(a))b(a);else{var c=!1,d=function(){nb(a)&&!c&&(b(a),c=!0,a.removeEventListener("readystatechange",d))};a.addEventListener("readystatechange",d)}}function pb(a){return new Promise((function(b){ob(a,b)}))}function qb(a){var b=!!a.document;this.Ea=b?a:a.defaultView;this.o=b?a.document:a}g=qb.prototype;g.getWin=function(){return this.Ea};g.getRootNode=function(){return this.o};g.getRootElement=function(){return this.o.documentElement};g.getHead=function(){return this.o.head};g.getBody=function(){return this.o.body};g.isReady=function(){return nb(this.o)};g.whenReady=function(){return pb(this.o)};g.addToFixedLayer=function(){return Promise.resolve()};function rb(a){return 9===a.nodeType?new qb(a):a.document?new qb(a):a}function V(a,b){var c=a.indexOf(":");if(-1!=c){var d=a;var e=d.substring(0,c);var f=d.substring(c+1)}else e=a,f=d=null;this.Va=e;this.ea=d;this.zb=f;this.Bb=b}V.prototype.getPublicationId=function(){return this.Va};V.prototype.getProductId=function(){return this.ea};V.prototype.getLabel=function(){return this.zb};V.prototype.isLocked=function(){return this.Bb};function sb(a){if(/swg.debug=1/.test(self.location.hash)){var b=Array.prototype.slice.call(arguments,0);b.unshift("[Subscriptions]");tb.apply(tb,b)}}function tb(a){console.log.apply(console,arguments)}function ub(a){for(var b=null,c="",d=0;d<arguments.length;d++){var e=arguments[d];if(e instanceof Error&&!b){b=void 0;var f=Object.getOwnPropertyDescriptor(e,"message");if(f&&f.writable)b=e;else{f=e.stack;var h=Error(e.message);for(b in e)h[b]=e[b];h.stack=f;b=h}}else c&&(c+=" "),c+=e}b?c&&(b.message=c+": "+b.message):b=Error(c);return b}function W(a){this.Da=void 0===a?"":a}function vb(a,b){a.Da&&(b.message?-1===b.message.indexOf(a.Da)&&(b.message=a.Da):b.message=a.Da)}W.prototype.createError=function(a){var b=ub.apply(null,Array.prototype.slice.call(arguments));vb(this,b);return b};W.prototype.createExpectedError=function(a){var b=ub.apply(null,Array.prototype.slice.call(arguments));vb(this,b);b.expected=!0;return b};W.prototype.error=function(a){throw this.createError.apply(this,arguments)};W.prototype.expectedError=function(a){throw this.createExpectedError.apply(this,arguments)};var wb=new W(self.__AMP_TOP?"​​​":"");new W;var xb="CreativeWork Article NewsArticle Blog Comment Course HowTo Message Review WebPage".split(" "),yb=new RegExp(xb.join("|"));function zb(a){var b=this;this.o=rb(a);this.ba=null;this.sa=new Promise((function(c){b.ba=c}));this.Cb=new Ab(this.o);this.Ab=new Bb(this.o);this.Db=new Cb(this.o)}zb.prototype.resolveConfig=function(){Promise.resolve().then(this.check.bind(this));this.o.whenReady().then(this.check.bind(this));return this.sa};zb.prototype.check=function(){if(!this.ba)return null;var a=this.Cb.check();a||(a=this.Ab.check());a||(a=this.Db.check());a?(this.ba(a),this.ba=null):this.o.isReady()&&(this.ba(Promise.reject(wb.createError("No config could be discovered in the page"))),this.ba=null);sb(a);return a};function Db(){}Db.prototype.checkValue=function(a,b){if(a){var c=this.checkArray;a=Array.isArray(a)?a:[a];c=c.call(this,a,b)}else c=!1;return c};Db.prototype.checkString=function(a,b){return a?this.checkArray(a.split(/\s+/),b):!1};Db.prototype.checkArray=function(a,b){var c=!1;a.forEach((function(d){c=c||b.includes(d.replace(/^http:\/\/schema.org\//i,""))}));return c};function Ab(a){this.o=a}Ab.prototype.check=function(){if(!this.o.getBody())return null;var a=Eb(this.o.getRootNode(),"subscriptions-product-id");if(!a)return null;var b=Eb(this.o.getRootNode(),"subscriptions-accessible-for-free"),c=!(!b||"false"!==b.toLowerCase());return new V(a,c)};function Bb(a){this.o=a;this.ha=new Db}Bb.prototype.check=function(){if(!this.o.getBody())return null;for(var a=this.o.isReady(),b=this.o.getRootNode().querySelectorAll('script[type="application/ld+json"]'),c=0;c<b.length;c++){var e,d=b[c];if((e=!d["__SWG-SEEN__"]&&d.textContent)&&!(e=a))a:{e=d;do{if(e.nextSibling){e=!0;break a}}while((e=e.parentNode)&&void 0!=e);e=!1}if(e&&(d["__SWG-SEEN__"]=!0,yb.test(d.textContent))){var f=this.ab(d);if(f)return f}}return null};Bb.prototype.ab=function(a){a:{try{var b=JSON.parse(a.textContent);break a}catch(l){}b=void 0}if(!b)return null;Array.isArray(b)||(b=[b]);for(var c=b,d=0;d<c.length;d++){var e=c[d];e["@graph"]&&Array.isArray(e["@graph"])&&(c=c.concat(e["@graph"]));if(this.ha.checkValue(e["@type"],xb)){a=null;var f=Fb(e,"isPartOf");if(f)for(var h=0;h<f.length&&!(a=this.La(f[h]));h++);if(a)return d=Gb(e,"isAccessibleForFree"),d=null==d||""===d?!0:"boolean"==typeof d?d:"string"==typeof d&&"false"==d.toLowerCase()?!1:!0,new V(a,!d)}}return null};Bb.prototype.La=function(a){return this.ha.checkValue(a["@type"],["Product"])?Gb(a,"productID"):null};function Fb(a,b){a=a[b];return null==a||""===a?null:Array.isArray(a)?a:[a]}function Gb(a,b){var c=Fb(a,b);a=c&&c[0];return null==a||""===a?null:a}function Cb(a){this.o=a;this.ea=this.S=null;this.ha=new Db}function Hb(a,b){var c=b.querySelectorAll("[itemprop='isAccessibleForFree']");for(b=0;c[b];b++){var d=c[b],e=d.getAttribute("content")||d.textContent;if(e&&Ib(a,d,"alreadySeenForAccessInfo")){var f=null;"true"==e.toLowerCase()?f=!0:"false"==e.toLowerCase()&&(f=!1);return f}}return null}function Ib(a,b,c){for(var d=b;d&&!d[c];d=d.parentNode)if(d[c]=!0,d.hasAttribute&&d.hasAttribute("itemscope"))return d=d.getAttribute("itemtype"),a.ha.checkString(d,xb);return!1}Cb.prototype.La=function(a){a=a.querySelectorAll('[itemprop="productID"]');for(var b=0;a[b];b++){var c=a[b],d=c.getAttribute("content")||c.textContent;c=c.closest("[itemtype][itemscope]");if(!(-1>=c.getAttribute("itemtype").indexOf("http://schema.org/Product"))&&Ib(this,c.parentElement,"alreadySeenForProductInfo"))return d}return null};function Jb(a){var b=null;null!=a.S?b=!a.S:a.o.isReady()&&(b=!1);return null!=a.ea&&null!=b?new V(a.ea,b):null}Cb.prototype.ab=function(){var a=this,b=Jb(this);if(b)return b;for(var c=Array.prototype.slice.call(this.o.getRootNode().querySelectorAll("[itemscope][itemtype]")).filter((function(e){return a.ha.checkString(e.getAttribute("itemtype"),xb)})),d=0;c[d]&&null==b;d++)b=c[d],null==this.S&&(this.S=Hb(this,b)),this.ea||(this.ea=this.La(b)),b=Jb(this);return b};Cb.prototype.check=function(){return this.o.getBody()?this.ab():null};function Eb(a,b){return(a=a.querySelector('meta[name="'+b+'"]'))?a.getAttribute("content"):null}function Kb(a){this.h=a;this.aa=P(this.h,"viewport")}g=Kb.prototype;g.getWin=function(){return this.h.win};g.getRootNode=function(){return this.h.getRootNode()};g.getRootElement=function(){var a=this.h.getRootNode();return a.documentElement||a.body||a};g.getHead=function(){return this.h.getHeadNode()};g.getBody=function(){return this.h.isBodyAvailable()?this.h.getBody():null};g.isReady=function(){return this.h.isReady()};g.whenReady=function(){return this.h.whenReady()};g.addToFixedLayer=function(a){return this.aa.addToFixedLayer(a,!0)};var Lb={IS_READY_TO_PAY:"isReadyToPay",SUPPORTS_VIEWER:"supportsViewer"},Mb={};function X(a){var b=a.dataObject,c=a.decryptedDocumentKey,d=void 0===a.grantReason?"":a.grantReason,e=void 0===a.granted?!1:a.granted,f=a.service,h=a.source;this.raw=void 0===a.raw?"":a.raw;this.source=h;this.service=f;this.granted=e;this.grantReason=d;this.data=b;this.decryptedDocumentKey=c}function Y(a){return new X({source:"",raw:"",service:a,granted:!1})}X.prototype.json=function(){return A({source:this.source,service:this.service,granted:this.granted,grantReason:this.grantReason,data:this.data})};X.prototype.jsonForPingback=function(){return Object.assign({},{raw:this.raw},this.json())};function Nb(a){var b=void 0===b?null:b;a||(a={});var c=b||JSON.stringify(a);return new X({source:a.source||"",raw:c,service:"",granted:a.granted||!1,grantReason:a.grantReason,dataObject:a.data||null,decryptedDocumentKey:a.decryptedDocumentKey||null})}X.prototype.isSubscriber=function(){return this.granted&&"SUBSCRIBER"===this.grantReason};X.prototype.isFree=function(){return this.granted&&"UNLOCKED"===this.grantReason};function Ob(a){a=a.platformKey;this.entitlementsWereFetchedWithCurrentMeteringState=!1;this.platformKey=a;this.Aa=""}Ob.prototype.saveMeteringState=function(a){var b=this,c=JSON.stringify(a);return Promise.resolve(this.Aa).then((function(d){var e=c!==d;d&&e&&H().info("amp-subscriptions","Meter state changed from "+d+" to "+c);return e})).then((function(d){d&&(b.Aa=c,b.entitlementsWereFetchedWithCurrentMeteringState=!1)}))};Ob.prototype.loadMeteringState=function(){return this.Aa?Promise.resolve(JSON.parse(this.Aa)):Promise.resolve(null)};function Pb(){this.M=null}g=Pb.prototype;g.add=function(a){var b=this;this.M||(this.M=[]);this.M.push(a);return function(){b.remove(a)}};g.remove=function(a){if(this.M){var b=this.M;a=b.indexOf(a);-1!=a&&b.splice(a,1)}};g.removeAll=function(){this.M&&(this.M.length=0)};g.fire=function(a){if(this.M)for(var b=ba(this.M),c=b.next();!c.done;c=b.next())c=c.value,c(a)};g.getHandlerCount=function(){var a,b;return null!=(b=null==(a=this.M)?void 0:a.length)?b:0};function Qb(a,b,c,d){var e=this;this.N=d||{};this.Ua=a;this.O={};this.va={};a.forEach((function(f){e.va[f]=new x}));this.Ta=new Pb;this.lb=new Pb;this.W=this.X=this.K=this.L=null;this.ja=[];this.Oa=c;this.Ba=Object.assign(Mb,b)}g=Qb.prototype;g.resolvePlatform=function(a,b){this.N[a]=b;this.lb.fire({platformKey:a})};g.resetPlatformStore=function(){for(var a in this.N)this.N[a].reset();return new Qb(this.Ua,this.Ba,this.Oa,this.N)};g.resetPlatform=function(a){delete this.O[a];this.va[a]=new x;this.N[a].reset();this.W=this.X=this.K=this.L=null};g.onPlatformResolves=function(a,b){var c=this,d=this.N[a];d?b(d):this.lb.add((function(e){e.platformKey===a&&b(c.getPlatform(a))}))};g.getPlatform=function(a){return this.N[a]};g.getAvailablePlatforms=function(){var b,a=[];for(b in this.N)a.push(this.N[b]);return a};g.onChange=function(a){this.Ta.add(a)};g.resolveEntitlement=function(a,b){b&&(b.service=a);this.O[a]=b;var c=this.va[a];c&&c.resolve(b);-1!==this.ja.indexOf(a)&&this.ja.splice(this.ja.indexOf(a),1);b.granted&&Rb(this,b);this.Ta.fire({platformKey:a,entitlement:b})};g.getResolvedEntitlementFor=function(a){return this.O[a]};g.getEntitlementPromiseFor=function(a){return this.va[a].promise};g.getScoreFactorStates=function(){var a=this,b=A({});return Promise.all(this.Ua.map((function(c){b[c]={};return Promise.all(Object.values(Lb).map((function(d){return Sb(a,c,d).then((function(e){b[c][d]=e}))})))}))).then((function(){return b}))};function Sb(a,b,c){return a.getEntitlementPromiseFor(b).then((function(){return a.N[b].getSupportedScoreFactor(c)}))}g.getGrantStatus=function(){var a=this;if(null!==this.L)return this.L.promise;this.L=new x;for(var b in this.O){var c=this.O[b];c.granted&&(Rb(this,c),this.L.resolve(!0))}if(Z(this))this.L.resolve(!1);else this.onChange((function(d){d.entitlement.granted?a.L.resolve(!0):Z(a)&&a.L.resolve(!1)}));return this.L.promise};function Rb(a,b){if(!a.K&&b.granted||a.K&&!a.K.isSubscriber()&&b.isSubscriber())a.K=b}g.getGrantEntitlement=function(){function a(){return b()||Z(c)}function b(){return c.K&&(c.K.isSubscriber()||c.K.isFree())}var c=this;if(this.X)return this.X.promise;this.X=new x;a()?this.X.resolve(this.K):this.Ta.add((function(){a()&&c.X.resolve(c.K)}));return this.X.promise};g.reset=function(){this.L=null};g.getAllPlatformsEntitlements=function(){var a=this;if(this.W)return this.W.promise;this.W=new x;if(Z(this))this.W.resolve(Tb(this));else this.onChange((function(){Z(a)&&a.W.resolve(Tb(a))}));return this.W.promise};function Tb(a){var c,b=[];for(c in a.O)na.call(a.O,c)&&b.push(a.O[c]);return b}g.selectPlatform=function(){var a=this;return this.getAllPlatformsEntitlements().then((function(){var b;a:{Z(a);for(b=a.getAvailablePlatforms();b.length;){var c=b.pop(),d=a.getResolvedEntitlementFor(c.getPlatformKey());if(d.isSubscriber()||d.isFree()){b=c;break a}}b=Ub(a,Vb(a))}return b}))};function Z(a){return Object.keys(a.O).length===a.Ua.length}function Wb(a,b,c){c=c.getSupportedScoreFactor(b);return"number"!==typeof c?0:a.Ba[b]*Math.min(1,Math.max(-1,c))}function Vb(a){return a.getAvailablePlatforms().map((function(b){return{platform:b,weight:Xb(a,b)}}))}function Xb(a,b){var e,c=[0],d=b.getBaseScore();for(e in a.Ba)na.call(a.Ba,e)&&c.push(Wb(a,e,b));return d+c.reduce((function(f,h){return f+h}))}function Ub(a,b){var c=a.getPlatform("local");b.sort((function(d,e){return e.weight===d.weight&&d.platform===c?-1:e.weight-d.weight}));return b[0].platform}function Yb(a){var b=a.getAvailablePlatforms().map((function(c){var d=c.getSupportedScoreFactor("supportsViewer");return{platform:c,weight:"number"===typeof d?d:0}}));return Ub(a,b)}g.reportPlatformFailureAndFallback=function(a){if(a===this.getPlatform("local").getPlatformKey()&&this.Oa)this.resolveEntitlement(this.getPlatform("local").getPlatformKey(),this.Oa),H().warn("amp-subscriptions","Local platform has failed to resolve,  using fallback entitlement.");else if(-1===this.ja.indexOf(a)){var b=Y(a);this.resolveEntitlement(a,b);this.ja.push(a)}};g.selectPlatformForLogin=function(){return Yb(this)};function Zb(a){this.h=a;this.kb=P(a,"mutator");this.setGrantState(null);this.h.getBody().classList.add("i-amphtml-subs-ready");this.addLoadingBar()}function $b(a,b){a.kb.mutateElement(a.h.getBody(),(function(){a.h.getBody().classList.toggle("i-amphtml-subs-grant-unk",null===b);a.h.getBody().classList.toggle("i-amphtml-subs-grant-yes",!0===b);a.h.getBody().classList.toggle("i-amphtml-subs-grant-no",!1===b)}))}Zb.prototype.addLoadingBar=function(){var a=this;return this.h.whenReady().then((function(){var b=a.h.getBody();if(!b.querySelector("[subscriptions-section=loading]")){var c=Ba(a.h.win.document,"div",A({"class":"i-amphtml-subs-progress","subscriptions-section":"loading"})),d=b.insertBefore;/^[\w-]+$/.test("footer");if(void 0!==sa)var e=sa;else{try{var f=b.ownerDocument,h=f.createElement("div"),l=f.createElement("div");h.appendChild(l);e=h.querySelector(":scope div")===l}catch(n){e=!1}e=sa=e}e?e=b.querySelector("> footer".replace(/^|,/g,"$&:scope ")):(b.classList.add("i-amphtml-scoped"),e="> footer".replace(/^|,/g,"$&.i-amphtml-scoped "),e=b.querySelectorAll(e),b.classList.remove("i-amphtml-scoped"),e=void 0===e[0]?null:e[0]);d.call(b,c,e)}}))};function fc(a,b){a.kb.mutateElement(a.h.getBody(),(function(){a.h.getBody().classList.toggle("i-amphtml-subs-loading",b)}))}Zb.prototype.setGrantState=function(a){$b(this,a)};Zb.prototype.toggleLoading=function(a){fc(this,a)};function gc(a){this.D=a}g=gc.prototype;g.getAnalytics=function(){return this.D.getAnalytics()};g.getDialog=function(){return this.D.getDialog()};g.getEncryptedDocumentKey=function(a){return this.D.getEncryptedDocumentKey(a)};g.getPageConfig=function(){return this.D.getPageConfig()};g.getReaderId=function(a){return this.D.getReaderId(a)};g.getScoreFactorStates=function(){return this.D.getScoreFactorStates()};g.delegateActionToLocal=function(a,b){return this.delegateActionToService(a,"local",b)};g.delegateActionToService=function(a,b,c){return this.D.delegateActionToService(a,b,c)};g.decorateServiceAction=function(a,b,c,d){this.D.decorateServiceAction(a,b,c,d)};g.resetPlatforms=function(){this.D.resetPlatforms()};g.selectPlatformForLogin=function(){return this.D.selectPlatformForLogin()};g.loadMeteringState=function(){return this.D.F?this.D.F.loadMeteringState():Promise.resolve(null)};g.saveMeteringState=function(a){return this.D.F?this.D.F.saveMeteringState(a):w()};g.rememberMeteringEntitlementsWereFetched=function(){this.D.F&&(this.D.F.entitlementsWereFetchedWithCurrentMeteringState=!0)};var hc={"-":"+",_:"/",".":"="};function ic(a){var b=atob(a.replace(/[-_.]/g,(function(c){return hc[c]})));return ab(b)}function jc(a){this.win=a;this.Ca=a.crypto&&(a.crypto.subtle||a.crypto.webkitSubtle)||null}jc.prototype.decode=function(a){return kc(a).payload};jc.prototype.isVerificationSupported=function(){return!!this.Ca};jc.prototype.decodeAndVerify=function(a,b){var c=this;if(!this.Ca)throw Error("Crypto is not supported on this platform");return new Promise((function(d){return d(kc(a))})).then((function(d){var e=d.header.alg;if(!e||"RS256"!=e)throw Error("Only alg=RS256 is supported");return lc(c,b).then((function(f){var h=ic(d.sig);return c.Ca.verify({name:"RSASSA-PKCS1-v1_5"},f,h,ab(d.verifiable))})).then((function(f){if(f)return d.payload;throw Error("Signature verification failed")}))}))};function kc(a){function b(){throw Error('Invalid token: "'+a+'"')}var c=a.split(".");3!=c.length&&b();var d=ic(c[0]),e=ic(c[1]);return{header:ra(Za(d),b),payload:ra(Za(e),b),verifiable:c[0]+"."+c[1],sig:c[2]}}function lc(a,b){return b.then((function(c){var d=a.Ca,e=d.importKey;c=c.trim().replace(/^-+BEGIN[^-]*-+/,"").replace(/-+END[^-]*-+$/,"").replace(/[\r\n]/g,"").trim();c=ab(atob(c));return e.call(d,"spki",c,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"])}))}function mc(){this.sb=100;this.S=this.Ya=0;this.ra=Object.create(null)}mc.prototype.has=function(a){return!!this.ra[a]};mc.prototype.get=function(a){var b=this.ra[a];if(b)return b.access=++this.S,b.payload};mc.prototype.put=function(a,b){this.has(a)||this.Ya++;this.ra[a]={payload:b,access:this.S};if(!(this.Ya<=this.sb)){a=this.ra;var d,c=this.S+1;for(d in a){var e=a[d].access;if(e<c){c=e;var f=d}}void 0!==f&&(delete a[f],this.Ya--)}};var oc,pc,nc=new Set(["c","v","a","ad"]);function qc(a){return"string"==typeof a?rc(a):a}function sc(a){return a.origin||rc(a.location.href).origin}function rc(a){oc||(oc=self.document.createElement("a"),pc=self.__AMP_URL_CACHE||(self.__AMP_URL_CACHE=new mc));var b=oc,c=pc;if(c&&c.has(a))a=c.get(a);else{b.href=a;b.protocol||(b.href=b.href);var d={href:b.href,protocol:b.protocol,host:b.host,hostname:b.hostname,port:"0"==b.port?"":b.port,pathname:b.pathname,search:b.search,hash:b.hash,origin:null};"/"!==d.pathname[0]&&(d.pathname="/"+d.pathname);if("http:"==d.protocol&&80==d.port||"https:"==d.protocol&&443==d.port)d.port="",d.host=d.hostname;d.origin=b.origin&&"null"!=b.origin?b.origin:"data:"!=d.protocol&&d.host?d.protocol+"//"+d.host:d.href;c&&c.put(a,d);a=d}return a}function tc(a,b,c){b=encodeURIComponent(b)+"="+encodeURIComponent(c);b&&(a=a.split("#",2),c=a[0].split("?",2),b=c[0]+(c[1]?"?"+c[1]+"&"+b:"?"+b),a=b+=a[1]?"#"+a[1]:"");return a}function uc(a,b){var c=void 0===c?"source":c;K(null!=a,"%s %s must be available",b,c);var d=qc(a);var e;(e="https:"==d.protocol||"localhost"==d.hostname||"127.0.0.1"==d.hostname)||(d=d.hostname,e=d.length-10,e=0<=e&&d.indexOf(".localhost",e)==e);K(e||/^\/\//.test(a),'%s %s must start with "https://" or "//" or be relative and served from either https or from localhost. Invalid value: %s',b,c,a);return a}var vc;function wc(a,b,c){function d(l){try{return f(l)}catch(E){var n,r;null==(r=(n=self).__AMP_REPORT_ERROR)||r.call(n,E);throw E}}var e=a,f=c,h=xc();e.addEventListener(b,d,h?void 0:!1);return function(){var l;null==(l=e)||l.removeEventListener(b,d,h?void 0:!1);d=e=f=null}}function xc(){if(void 0!==vc)return vc;vc=!1;try{var a={get capture(){vc=!0}};self.addEventListener("test-options",null,a);self.removeEventListener("test-options",null,a)}catch(b){}return vc}function yc(a,b){return wc(a,"message",b)}function zc(a,b){var c=b,d=wc(a,"click",(function(e){try{c(e)}finally{c=null,d()}}));return d}function Ac(a,b,c){try{var d=a.open(b,"_blank",c)}catch(h){I().error("DOM","Failed to open url on target: ","_blank",h)}var e;if(!(e=d||!1)){e=c||"";var f;"number"!==typeof f&&(f=0);e=f+8>e.length?!1:-1!==e.indexOf("noopener",f)}e||(d=a.open(b,"_top"));return d}var Bc=/RETURN_URL/;function Cc(a,b){var c=P(a,"viewer");return(parseInt(a.getParam("dialog"),10)?new Dc(c,b):new Ec(a.win,c,b)).open()}function Dc(a,b){this.viewer=a;this.urlOrPromise=b}Dc.prototype.getLoginUrl=function(){return("string"==typeof this.urlOrPromise?Promise.resolve(this.urlOrPromise):this.urlOrPromise).then((function(a){return Fc(a,"RETURN_URL")}))};Dc.prototype.open=function(){var a=this;return this.getLoginUrl().then((function(b){I().fine("amp-access-login","Open viewer dialog: ",b);return a.viewer.sendMessageAwaitResponse("openDialog",A({url:b}))}))};function Ec(a,b,c){this.win=a;this.viewer=b;this.urlOrPromise=c;this.ya=this.ca=this.ia=this.C=this.Wa=this.ka=null}Ec.prototype.open=function(){var a=this;K(!this.ka,"Dialog already opened");return new Promise((function(b,c){a.ka=b;a.Wa=c;Gc(a)})).then((function(b){Hc(a);return b}),(function(b){Hc(a);throw b}))};function Hc(a){a.ka=null;a.Wa=null;if(a.C){try{a.C.close()}catch(b){}a.C=null}a.ca&&(a.win.clearInterval(a.ca),a.ca=null);a.ya&&(a.ya(),a.ya=null)}Ec.prototype.getLoginUrl=function(){var a=this;return("string"==typeof this.urlOrPromise?Promise.resolve(this.urlOrPromise):this.urlOrPromise).then((function(b){return Fc(b,Ic(a))}))};function Gc(a){var b=a.win.screen,c=Math.floor(Math.min(700,.9*b.width)),d=Math.floor(Math.min(450,.9*b.height)),e=Math.floor((b.width-c)/2);b=Math.floor((b.height-d)/2);var f="height="+d+",width="+c+",left="+e+",top="+b+",resizable=yes,scrollbars=yes",h=Ic(a);a.ia=null;if("string"==typeof a.urlOrPromise){var l=Fc(a.urlOrPromise,h);I().fine("amp-access-login","Open dialog: ",l,h,c,d,e,b);a.C=Ac(a.win,l,f);a.C&&(a.ia=w())}else I().fine("amp-access-login","Open dialog: ","about:blank",h,c,d,e,b),a.C=Ac(a.win,"",f),a.C&&(a.ia=a.urlOrPromise.then((function(n){n=Fc(n,h);I().fine("amp-access-login","Set dialog url: ",n);a.C.location.replace(n)}),(function(n){throw Error("failed to resolve url: "+n)})));a.ia?a.ia.then((function(){Jc(a,h)}),(function(n){Kc(a,null,n)})):Kc(a,null,Error("failed to open dialog"))}function Jc(a,b){var c=rc(b).origin;a.ca=a.win.setInterval((function(){a.C.closed&&(a.win.clearInterval(a.ca),a.ca=null,a.win.setTimeout((function(){Kc(a,"")}),3e3))}),500);a.ya=yc(a.win,(function(d){I().fine("amp-access-login","MESSAGE:",d);d.origin==c&&d.data&&"amp"==d.data.sentinel&&(I().fine("amp-access-login","Received message from dialog: ",d.data),"result"==d.data.type&&(a.C&&a.C.postMessage(A({sentinel:"amp",type:"result-ack"}),c),Kc(a,d.data.result)))}))}function Kc(a,b,c){a.ka&&(I().fine("amp-access-login","Login done: ",b,c),c?a.Wa(c):a.ka(b),Hc(a))}function Ic(a){var b=a.viewer.getResolvedViewerUrl();return Fa.cdn+"/v0/amp-login-done-0.1.html?url="+encodeURIComponent(b)}function Fc(a,b){return Bc.test(a)?a.replace(Bc,encodeURIComponent(b)):a+(-1==a.indexOf("?")?"?":"&")+"return="+encodeURIComponent(b)}function Lc(a,b,c,d){for(var e in d)uc(d[e],"action "+e);this.pa=d;this.Ga={};this.Z=b;this.qa=c;this.V=null;this.fb=0;this.Eb=Cc.bind(null,a);this.build()}Lc.prototype.build=function(){var a=this;if(0==Object.keys(this.pa).length)return null;var d,b=[],c={};for(d in this.pa)c.oa=d,b.push(this.Z.buildUrl(this.pa[c.oa],!0).then(function(e){return function(f){a.Ga[e.oa]=f}}(c))),c={oa:c.oa};return Promise.all(b).then((function(){return a.Ga}))};Lc.prototype.execute=function(a){K(this.pa[a],"Action URL is not configured: %s",a);var b=K(this.Ga[a],"Action URL is not ready: %s",a);return Mc(this,b,a)};function Mc(a,b,c){var d=Date.now();if(a.V&&1e3>d-a.fb)return a.V;I().fine("amp-subscriptions","Start action: ",b,c);a.qa.actionEvent("local",c,"started");var e=a.Eb(b).then((function(f){I().fine("amp-subscriptions","Action completed: ",c,f);a.V=null;f=Ia(f).success;var h="true"==f||"yes"==f||"1"==f;h?a.qa.actionEvent("local",c,"success"):a.qa.actionEvent("local",c,"rejected");return h||!f})).catch((function(f){I().fine("amp-subscriptions","Action failed: ",c,f);a.qa.actionEvent("local",c,"failed");a.V==e&&(a.V=null);throw f}));a.V=e;a.fb=d;return a.V}var Nc=function(){function a(k,u,t,q){t=t||{};for(q=k.length;q--;t[k[q]]=u);return t}function b(){this.yy={}}var c=[1,3],d=[1,4],e=[1,18],f=[1,19],h=[1,14],l=[1,15],n=[1,16],r=[1,17],E=[1,21],L=[1,22],B=[5,6,7,10],M=[5,6,7,10,15,16,17,18,19,20,21],wa=[5,6,7,10,15,16,17,18,19,20,21,25,27],db={trace:function(){},yy:{},Kb:{error:2,result:3,search_condition:4,EOF:5,OR:6,AND:7,NOT:8,"(":9,")":10,predicate:11,comparison_predicate:12,truthy_predicate:13,scalar_exp:14,EQ:15,DEQ:16,NEQ:17,LT:18,LTE:19,GT:20,GTE:21,atom:22,field_ref:23,literal:24,DOT:25,field_name:26,"[":27,string:28,"]":29,NAME:30,STRING:31,NUMERIC:32,TRUE:33,FALSE:34,NULL:35,$accept:0,$end:1},la:{2:"error",5:"EOF",6:"OR",7:"AND",8:"NOT",9:"(",10:")",15:"EQ",16:"DEQ",17:"NEQ",18:"LT",19:"LTE",20:"GT",21:"GTE",25:"DOT",27:"[",29:"]",30:"NAME",31:"STRING",32:"NUMERIC",33:"TRUE",34:"FALSE",35:"NULL"},ob:[0,[3,2],[4,3],[4,3],[4,2],[4,3],[4,1],[11,1],[11,1],[12,3],[12,3],[12,3],[12,3],[12,3],[12,3],[12,3],[13,1],[14,1],[14,1],[22,1],[23,3],[23,4],[23,1],[26,1],[28,1],[24,1],[24,1],[24,1],[24,1],[24,1]],performAction:function(k,u,t,q,C,m){var p=m.length-1;switch(C){case 1:return m[p-1];case 2:this.A=m[p-2]||m[p];break;case 3:this.A=m[p-2]&&m[p];break;case 4:this.A=!m[p];break;case 5:this.A=m[p-1];break;case 6:case 7:case 8:case 17:case 18:case 19:this.A=m[p];break;case 9:this.A=m[p-2]===m[p];break;case 10:throw Error('"==" is not allowed, use "="');case 11:this.A=m[p-2]!==m[p];break;case 12:this.A=typeof m[p-2]==typeof m[p]&&m[p-2]<m[p];break;case 13:this.A=typeof m[p-2]==typeof m[p]&&m[p-2]<=m[p];break;case 14:this.A=typeof m[p-2]==typeof m[p]&&m[p-2]>m[p];break;case 15:this.A=typeof m[p-2]==typeof m[p]&&m[p-2]>=m[p];break;case 16:this.A=void 0!==m[p]&&null!==m[p]&&""!==m[p]&&0!==m[p]&&!1!==m[p];break;case 20:this.A="[object Object]"==Object.prototype.toString.call(m[p-2])&&m[p-2].hasOwnProperty(m[p])?m[p-2][m[p]]:null;break;case 21:this.A="[object Object]"==Object.prototype.toString.call(m[p-3])&&m[p-3].hasOwnProperty(m[p-1])?m[p-3][m[p-1]]:null;break;case 22:this.A=void 0!==q[m[p]]?q[m[p]]:null;break;case 23:this.A=k;break;case 24:this.A=k.substring(1,k.length-1);break;case 26:this.A=Number(k);break;case 27:this.A=!0;break;case 28:this.A=!1;break;case 29:this.A=null}},table:[{3:1,4:2,8:c,9:d,11:5,12:6,13:7,14:8,22:9,23:10,24:11,26:12,28:13,30:e,31:f,32:h,33:l,34:n,35:r},{1:[3]},{5:[1,20],6:E,7:L},{4:23,8:c,9:d,11:5,12:6,13:7,14:8,22:9,23:10,24:11,26:12,28:13,30:e,31:f,32:h,33:l,34:n,35:r},{4:24,8:c,9:d,11:5,12:6,13:7,14:8,22:9,23:10,24:11,26:12,28:13,30:e,31:f,32:h,33:l,34:n,35:r},a(B,[2,6]),a(B,[2,7]),a(B,[2,8]),a(B,[2,16],{15:[1,25],16:[1,26],17:[1,27],18:[1,28],19:[1,29],20:[1,30],21:[1,31]}),a(M,[2,17]),a(M,[2,18],{25:[1,32],27:[1,33]}),a(M,[2,19]),a(wa,[2,22]),a(M,[2,25]),a(M,[2,26]),a(M,[2,27]),a(M,[2,28]),a(M,[2,29]),a(wa,[2,23]),a([5,6,7,10,15,16,17,18,19,20,21,29],[2,24]),{1:[2,1]},{4:34,8:c,9:d,11:5,12:6,13:7,14:8,22:9,23:10,24:11,26:12,28:13,30:e,31:f,32:h,33:l,34:n,35:r},{4:35,8:c,9:d,11:5,12:6,13:7,14:8,22:9,23:10,24:11,26:12,28:13,30:e,31:f,32:h,33:l,34:n,35:r},a(B,[2,4]),{6:E,7:L,10:[1,36]},{14:37,22:9,23:10,24:11,26:12,28:13,30:e,31:f,32:h,33:l,34:n,35:r},{14:38,22:9,23:10,24:11,26:12,28:13,30:e,31:f,32:h,33:l,34:n,35:r},{14:39,22:9,23:10,24:11,26:12,28:13,30:e,31:f,32:h,33:l,34:n,35:r},{14:40,22:9,23:10,24:11,26:12,28:13,30:e,31:f,32:h,33:l,34:n,35:r},{14:41,22:9,23:10,24:11,26:12,28:13,30:e,31:f,32:h,33:l,34:n,35:r},{14:42,22:9,23:10,24:11,26:12,28:13,30:e,31:f,32:h,33:l,34:n,35:r},{14:43,22:9,23:10,24:11,26:12,28:13,30:e,31:f,32:h,33:l,34:n,35:r},{26:44,30:e},{28:45,31:f},a([5,6,10],[2,2],{7:L}),a(B,[2,3]),a(B,[2,5]),a(B,[2,9]),a(B,[2,10]),a(B,[2,11]),a(B,[2,12]),a(B,[2,13]),a(B,[2,14]),a(B,[2,15]),a(wa,[2,20]),{29:[1,46]},a(wa,[2,21])],defaultActions:{20:[2,1]},parseError:function(k,u){if(u.recoverable)this.trace(k);else throw k=Error(k),k.hash=u,k},parse:function(k){function u(){var ea=v.lex()||1;"number"!==typeof ea&&(ea=t.Kb[ea]||ea);return ea}var t=this,q=[0],C=[null],m=[],p=this.table,ac="",xa=0,bc=0,cc=0,od=m.slice.call(arguments,1),v=Object.create(this.lexer),Q={yy:{}};for(y in this.yy)Object.prototype.hasOwnProperty.call(this.yy,y)&&(Q.yy[y]=this.yy[y]);v.setInput(k,Q.yy);Q.yy.lexer=v;Q.yy.parser=this;"undefined"==typeof v.yylloc&&(v.yylloc={});var bb=v.yylloc;m.push(bb);var pd=v.options&&v.options.ranges;this.parseError="function"===typeof Q.yy.parseError?Q.yy.parseError:Object.getPrototypeOf(this).parseError;for(var z,cb,G,ya,J,dc,za,T={};;){G=q[q.length-1];if(this.defaultActions[G])var y=this.defaultActions[G];else{if(null===z||"undefined"==typeof z)z=u();y=p[G]&&p[G][z]}if("undefined"===typeof y||!y.length||!y[0]){var ec="";za=[];for(ya in p[G])this.la[ya]&&2<ya&&za.push("'"+this.la[ya]+"'");ec=v.showPosition?"Parse error on line "+(xa+1)+":\n"+v.showPosition()+"\nExpecting "+za.join(", ")+", got '"+(this.la[z]||z)+"'":"Parse error on line "+(xa+1)+": Unexpected "+(1==z?"end of input":"'"+(this.la[z]||z)+"'");this.parseError(ec,{text:v.match,token:this.la[z]||z,line:v.yylineno,loc:bb,expected:za})}if(y[0]instanceof Array&&1<y.length)throw Error("Parse Error: multiple actions possible at state: "+G+", token: "+z);switch(y[0]){case 1:q.push(z);C.push(v.yytext);m.push(v.yylloc);q.push(y[1]);z=null;cb?(z=cb,cb=null):(bc=v.yyleng,ac=v.yytext,xa=v.yylineno,bb=v.yylloc,0<cc&&cc--);break;case 2:J=this.ob[y[1]][1];T.A=C[C.length-J];T.eb={first_line:m[m.length-(J||1)].first_line,last_line:m[m.length-1].last_line,first_column:m[m.length-(J||1)].first_column,last_column:m[m.length-1].last_column};pd&&(T.eb.range=[m[m.length-(J||1)].range[0],m[m.length-1].range[1]]);G=this.performAction.apply(T,[ac,bc,xa,Q.yy,y[1],C,m].concat(od));if("undefined"!==typeof G)return G;J&&(q=q.slice(0,-2*J),C=C.slice(0,-1*J),m=m.slice(0,-1*J));q.push(this.ob[y[1]][0]);C.push(T.A);m.push(T.eb);dc=p[q[q.length-2]][q[q.length-1]];q.push(dc);break;case 3:return!0}}}},qd=function(){return{EOF:1,parseError:function(k,u){if(this.yy.parser)this.yy.parser.parseError(k,u);else throw Error(k)},setInput:function(k,u){this.yy=u||this.yy||{};this._input=k;this._more=this._backtrack=this.done=!1;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};this.options.ranges&&(this.yylloc.range=[0,0]);this.offset=0;return this},input:function(){var k=this._input[0];this.yytext+=k;this.yyleng++;this.offset++;this.match+=k;this.matched+=k;k.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++;this.options.ranges&&this.yylloc.range[1]++;this._input=this._input.slice(1);return k},unput:function(k){var u=k.length,t=k.split(/(?:\r\n?|\n)/g);this._input=k+this._input;this.yytext=this.yytext.substr(0,this.yytext.length-u);this.offset-=u;var q=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1);this.matched=this.matched.substr(0,this.matched.length-1);t.length-1&&(this.yylineno-=t.length-1);k=this.yylloc.range;this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:t?(t.length===q.length?this.yylloc.first_column:0)+q[q.length-t.length].length-t[0].length:this.yylloc.first_column-u};this.options.ranges&&(this.yylloc.range=[k[0],k[0]+this.yyleng-u]);this.yyleng=this.yytext.length;return this},more:function(){this._more=!0;return this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},less:function(k){this.unput(this.match.slice(k))},pastInput:function(){var k=this.matched.substr(0,this.matched.length-this.match.length);return(20<k.length?"...":"")+k.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var k=this.match;20>k.length&&(k+=this._input.substr(0,20-k.length));return(k.substr(0,20)+(20<k.length?"...":"")).replace(/\n/g,"")},showPosition:function(){var k=this.pastInput(),u=Array(k.length+1).join("-");return k+this.upcomingInput()+"\n"+u+"^"},test_match:function(k,u){var t;if(this.options.backtrack_lexer){var q={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done};this.options.ranges&&(q.yylloc.range=this.yylloc.range.slice(0))}if(t=k[0].match(/(?:\r\n?|\n).*/g))this.yylineno+=t.length;this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:t?t[t.length-1].length-t[t.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+k[0].length};this.yytext+=k[0];this.match+=k[0];this.matches=k;this.yyleng=this.yytext.length;this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]);this._backtrack=this._more=!1;this._input=this._input.slice(k[0].length);this.matched+=k[0];k=this.performAction.call(this,this.yy,this,u,this.conditionStack[this.conditionStack.length-1]);this.done&&this._input&&(this.done=!1);if(k)return k;if(this._backtrack)for(var C in q)this[C]=q[C];return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var k;this._more||(this.match=this.yytext="");for(var u=this._currentRules(),t=0;t<u.length;t++)if((k=this._input.match(this.rules[u[t]]))&&(!q||k[0].length>q[0].length)){var q=k;var C=t;if(this.options.backtrack_lexer){q=this.test_match(k,u[t]);if(!1!==q)return q;if(this._backtrack)q=!1;else return!1}else if(!this.options.flex)break}return q?(q=this.test_match(q,u[C]),!1!==q?q:!1):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var k=this.next();return k?k:this.lex()},begin:function(k){this.conditionStack.push(k)},popState:function(){return 0<this.conditionStack.length-1?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(k){k=this.conditionStack.length-1-Math.abs(k||0);return 0<=k?this.conditionStack[k]:"INITIAL"},pushState:function(k){this.begin(k)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(k,u,t){switch(t){case 1:return 7;case 2:return 6;case 3:return 8;case 4:return 35;case 5:return 33;case 6:return 33;case 7:return 34;case 8:return 34;case 9:return 9;case 10:return 10;case 11:return 27;case 12:return 29;case 13:return"|";case 14:return 19;case 15:return 18;case 16:return 21;case 17:return 20;case 18:return 17;case 19:return 16;case 20:return 15;case 21:return 32;case 22:return 30;case 23:return 31;case 24:return 31;case 25:return 25;case 26:return"INVALID";case 27:return 5}},rules:[/^(?:\s+)/,/^(?:AND\b)/,/^(?:OR\b)/,/^(?:NOT\b)/,/^(?:NULL\b)/,/^(?:TRUE\b)/,/^(?:true\b)/,/^(?:FALSE\b)/,/^(?:false\b)/,/^(?:\()/,/^(?:\))/,/^(?:\[)/,/^(?:\])/,/^(?:\|)/,/^(?:<=)/,/^(?:<)/,/^(?:>=)/,/^(?:>)/,/^(?:!=)/,/^(?:==)/,/^(?:=)/,/^(?:-?[0-9]+(\.[0-9]+)?\b)/,/^(?:[a-zA-Z_][a-zA-Z0-9_]*)/,/^(?:'[^']*')/,/^(?:"[^"]*")/,/^(?:\.)/,/^(?:.)/,/^(?:$)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27],inclusive:!0}}}}();db.lexer=qd;b.prototype=db;db.Parser=b;return new b}();function Oc(a,b){try{return Nc.yy=b,!!Nc.parse(a)}finally{Nc.yy=null}}function Pc(a,b){return Oc(a,b)}function Qc(a,b,c){this.h=a;this.ga=a.getRootNode();this.C=b;this.Lb=P(a,"templates");this.B=c}Qc.prototype.render=function(a){var b=Promise,c=b.all;Rc(this,a,this.ga,Pc);return c.call(b,[void 0,Sc(this,a)])};Qc.prototype.reset=function(){this.C.close();return Rc(this,{},this.ga,(function(){return!1}))};function Sc(a,b){return a.h.whenReady().then((function(){for(var c=a.h.getRootNode().querySelectorAll("[subscriptions-dialog][subscriptions-display]"),d=0;d<c.length;d++){var e=c[d],f=e.getAttribute("subscriptions-display");if(f&&Oc(f,b))return e}})).then((function(c){if(c){if("TEMPLATE"==c.tagName)return a.Lb.renderTemplate(c,b).then((function(e){return Rc(a,b,e,Pc)}));var d=c.cloneNode(!0);d.removeAttribute("subscriptions-dialog");d.removeAttribute("subscriptions-display");return d}})).then((function(c){if(c)return a.C.open(c,!0)}))}function Rc(a,b,c,d){return a.h.whenReady().then((function(){for(var e=c.querySelectorAll('[subscriptions-action], [subscriptions-section="actions"], [subscriptions-actions]'),f=0;f<e.length;f++){var h=e[f],l=h.getAttribute("subscriptions-display");l&&d(l,b)?(h.classList.add("i-amphtml-subs-display"),h.getAttribute("subscriptions-service")&&h.getAttribute("subscriptions-action")&&"false"!==h.getAttribute("subscriptions-decorate")&&!h.hasAttribute("i-amphtml-subs-decorated")&&(a.B.decorateServiceAction(h,h.getAttribute("subscriptions-service"),h.getAttribute("subscriptions-action"),null),h.setAttribute("i-amphtml-subs-decorated",!0))):h.classList.remove("i-amphtml-subs-display")}return c}))}function Tc(a,b){var c=a.getHeadNode();a=Oa(c);a=R(a);this.pb=Pa(a,"url-replace")?N(a,"url-replace"):null;this.Hb=b;this.Fa=null}Tc.prototype.setAuthResponse=function(a){this.Fa=a};Tc.prototype.buildUrl=function(a,b){var c=this;return Uc(this,b).then((function(d){return c.pb.expandUrlAsync(a,d)}))};Tc.prototype.collectUrlVars=function(a,b){var c=this;return Uc(this,b).then((function(d){return c.pb.collectVars(a,d)}))};function Uc(a,b){return a.Hb.then((function(c){var d={READER_ID:c,ACCESS_READER_ID:c};b&&(d.AUTHDATA=function(e){if(a.Fa)return oa(a.Fa,e)});return d}))}function Vc(a,b,c){this.h=a;this.ga=a.getRootNode();this.P=b;this.Gb=!!this.P.pingbackAllEntitlements;this.B=c;this.Z=new Tc(this.h,this.B.getReaderId("local"));this.G=c.getAnalytics();K(this.P.actions,"Actions have not been defined in the service config");this.gb=new Lc(this.h,this.Z,this.G,this.validateActionMap(this.P.actions));this.U=new Qc(this.h,c.getDialog(),this.B)}g=Vc.prototype;g.getPlatformKey=function(){return"local"};g.validateActionMap=function(a){K(a.login,'Action "login" is not present in action map');K(a.subscribe,'Action "subscribe" is not present in action map');return a};function Wc(a){function b(c){if(!c._AMP_SUBSCRIPTIONS_CLICK_HANDLED&&(c._AMP_SUBSCRIPTIONS_CLICK_HANDLED=!0,c=ua(c.target))){var d=c.getAttribute("subscriptions-action"),e=c.getAttribute("subscriptions-service");"local"==e?a.executeAction(d,c.id):"auto"==(e||"auto")?"login"==d?(e=a.B.selectPlatformForLogin(),a.B.delegateActionToService(d,e.getPlatformKey(),c.id)):a.executeAction(d,c.id):e&&a.B.delegateActionToService(d,e,c.id)}}a.ga.addEventListener("click",b);a.ga.body&&a.ga.body.addEventListener("click",b)}g.activate=function(a){var b=this;Xc(this,a).then((function(c){b.U.render(c)}))};function Xc(a,b){var c=b.json();return a.B.getScoreFactorStates().then((function(d){c.factors=d;return a.Z.setAuthResponse(c)})).then((function(){return a.gb.build()})).then((function(){return c}))}g.reset=function(){this.U.reset()};g.executeAction=function(a){var b=this;return this.gb.execute(a).then((function(c){c&&b.B.resetPlatforms();return!!c}))};g.isPrerenderSafe=function(){return!1};g.getSupportedScoreFactor=function(){return 0};g.getBaseScore=function(){return this.P.baseScore||0};g.getEntitlements=function(){};g.pingback=function(){};g.pingbackReturnsAllEntitlements=function(){return this.Gb};g.isPingbackEnabled=function(){return!1};g.decorateUI=function(){};function Yc(a,b,c){this.Ea=a;this.Za=b;this.I=c;this.da=this.$a=null;this.hb=this.xb.bind(this);this.Ib=0;this.cb={}}g=Yc.prototype;g.connect=function(a){if(this.da)throw Error("already connected");this.da=a;this.Ea.addEventListener("message",this.hb)};g.disconnect=function(){this.da&&(this.da=null,this.Ea.removeEventListener("message",this.hb))};g.isConnected=function(){return null!=this.I};g.getTarget=function(){var a=Zc(this);if(!a)throw Error("not connected");return a};function Zc(a){a.da&&!a.$a&&(a.$a="function"==typeof a.Za?a.Za():a.Za);return a.$a}g.getTargetOrigin=function(){if(null==this.I)throw Error("not connected");return this.I};g.sendCommand=function(a,b){$c(this,void 0,a,b)};g.sendCommandRsvp=function(a,b){var c=String(++this.Ib),d=null,e=new Promise((function(f){d=f}));this.cb[c]={promise:e,resolver:d};$c(this,c,a,b);return e};function $c(a,b,c,d){var e=a.getTarget();a="connect"==c?null!=a.I?a.I:"*":a.getTargetOrigin();e.postMessage({sentinel:"__AMP__",_rsvp:b,cmd:c,payload:d||null},a)}g.xb=function(a){var b=this,c=a.data;if(c&&"__AMP__"==c.sentinel){var d=a.origin,e=c.cmd,f=c.payload||null;null==this.I&&"start"==e&&(this.I=d);null==this.I&&a.source&&Zc(this)==a.source&&(this.I=d);if(d==this.I){var h=c._rsvp,l=!!h&&"rsvp"!=e;a=this.Pa(h,e,f);l&&Promise.resolve(a).then((function(n){$c(b,h,"rsvp",{result:n})}),(function(n){$c(b,h,"rsvp",{error:String(n)})}))}}};g.Pa=function(a,b,c){if("rsvp"==b){var d=a&&this.cb[a];d&&("error"in c?d.resolver(Promise.reject(Error(c.error))):d.resolver(c.result),delete this.cb[a])}else return this.da(b,c)};function ad(a,b,c){Vc.call(this,a,b,c);var d=this;this.Qa=K(this.P.iframeSrc,'"iframeSrc" URL must be specified');uc(this.Qa,"iframe Url");(this.wa=this.P.iframeVars||null)&&K(qa(this.wa),'"iframeVars" must be an array');this.I=rc(this.Qa).origin;this.Ia=this.ta=null;this.xa=a.win.document.createElement("iframe");ib(this.xa,!1);this.za=new Yc(this.h.win,(function(){return d.xa.contentWindow}),this.I);this.sa=null;Wc(this)}la(ad,Vc);g=ad.prototype;g.getEntitlements=function(){var a=this;return this.connect().then((function(){return a.za.sendCommandRsvp("authorize",{}).then((function(b){b.source="local-iframe";return b})).then((function(b){return Nb(b)}))}))};g.isPingbackEnabled=function(){return!0};g.pingback=function(a){var b=this;return this.connect().then((function(){return b.za.sendCommandRsvp("pingback",{entitlement:a})}))};g.connect=function(){if(!this.Ia){var a=new x;this.Ia=a.promise;this.ta=a.resolve;this.sa=bd(this);this.za.connect(this.Pa.bind(this));this.h.getBody().appendChild(this.xa);this.xa.src=this.Qa}return this.Ia};function bd(a){return new Promise((function(b){var c=JSON.parse(JSON.stringify(a.P)),d=a.B.getPageConfig();c.pageConfig={publicationId:d.getPublicationId(),productId:d.getProductId(),encryptedDocumentKey:a.B.getEncryptedDocumentKey("local")||null};if(a.wa){var e=a.wa.join("&");a.Z.collectUrlVars(e,!1).then((function(f){c.iframeVars=f;b(c)}))}else b(c)}))}g.Pa=function(a){var b=this;"connect"===a&&this.sa.then((function(c){b.za.sendCommandRsvp("start",{protocol:"amp-subscriptions",config:c}).then((function(){b.ta&&(b.ta(),b.ta=null)}))}))};function cd(a,b,c){Vc.call(this,a,b,c);this.rb=uc(K(this.P.authorizationUrl,"Service config does not have authorization Url"),"Authorization Url");this.qb=Na(this.h.win,"xhr");this.mb=this.P.pingbackUrl||null;Wc(this)}la(cd,Vc);cd.prototype.getEntitlements=function(){var a=this,b=this.Z.buildUrl(this.rb,!1),c=this.B.loadMeteringState();return Promise.all([b,c]).then((function(d){var e=d[0],f=d[1];f&&(e=tc(e,"meteringState",btoa(JSON.stringify(f))));var h=a.B.getEncryptedDocumentKey("local");h&&(e=tc(e,"crypt",h));return a.qb.fetchJson(e,{credentials:"include"}).then((function(l){return l.json()})).then((function(l){var n=[];l.metering&&l.metering.state&&n.push(a.B.saveMeteringState(l.metering.state));return Promise.all(n).then((function(){return Nb(l)}))}))}))};cd.prototype.isPingbackEnabled=function(){return!!this.mb};function dd(a){if(qa(a)){var b=[];a.forEach((function(c){b.push(c.jsonForPingback())}));return JSON.stringify(b)}return JSON.stringify(a.jsonForPingback())}cd.prototype.pingback=function(a){var b=this;if(this.isPingbackEnabled)return this.Z.buildUrl(this.mb,!0).then((function(c){return b.qb.sendSignal(c,{method:"POST",credentials:"include",headers:A({"Content-Type":"text/plain"}),body:dd(a)})}))};function ed(a,b,c){return"iframe"===b.type?new ad(a,b,c):new cd(a,b,c)}function fd(a,b,c,d){this.h=a;this.B=c;this.T=c.getPageConfig();this.Y=ed(a,b,c);this.$=P(this.h,"viewer");this.$.onMessage("subscriptionchange",this.Jb.bind(this));this.yb=new jc(a.win);this.Va=this.T.getPublicationId();this.ub=this.T.getProductId();this.Fb=d;this.R=O(a.win)}g=fd.prototype;g.isPrerenderSafe=function(){return!0};g.getEntitlements=function(){for(var c,a=this,b=A({publicationId:this.Va,productId:this.ub,origin:this.Fb}),d=(this.$.getParam("cryptokeys")||"google.com").split(","),e=0;e!=d.length&&!(c=this.B.getEncryptedDocumentKey(d[e]));e++);c&&(b.encryptedDocumentKey=c);return this.R.timeoutPromise(3e3,this.$.sendMessageAwaitResponse("auth",b)).then((function(f){f=f||{};var h=f.error,l=f.authorization,n=f.decryptedDocumentKey;if(h)throw Error(h.message);return l?gd(a,l,n).catch((function(r){a.$.sendMessage("auth-rejected",A({reason:r.message}));throw r})):Y("local")}))};function gd(a,b,c){return new Promise((function(d){var e=sc(a.h.win);var f=a.h.win.location;f=qc(f);if(Fa.cdnProxyRegex.test(qc(f).origin)){var h=f.pathname.split("/");K(nc.has(h[1]),"Unknown path prefix in url %s",f.href);var l=h[2],n="s"==l?"https://"+decodeURIComponent(h[3]):"http://"+decodeURIComponent(l);K(0<n.indexOf("."),"Expected a . in origin %s",n);h.splice(1,"s"==l?3:2);h=n+h.join("/");l=(l=f.search)&&"?"!=l?(l=l.replace(/[?&](amp_(js[^&=]*|gsa|r|kit)|usqp)\b[^&]*/g,"").replace(/^[?&]/,""))?"?"+l:"":"";f=h+l+(f.hash||"")}else f=f.href;f=rc(f).origin;var r=a.yb.decode(b),E=K(a.T.getProductId(),"Product id is null");if(r.aud!=e&&r.aud!=f)throw H().createError('The mismatching "aud" field: '+r.aud);if(r.exp<Math.floor(Date.now()/1e3))throw H().createError("Payload is expired");e=r.entitlements;f=Y("local");if(e){if(Array.isArray(e)){for(h=0;h<e.length;h++)if(-1!==e[h].products.indexOf(E)){var L=e[h];break}}else-1!==e.products.indexOf(E)&&(L=e);L&&(f=new X({source:"viewer",raw:b,granted:!0,grantReason:L.subscriptionToken?"SUBSCRIBER":"",dataObject:L,decryptedDocumentKey:c}))}r.metering&&!f.granted&&(f=new X({source:r.iss||"",raw:b,granted:!0,grantReason:"METERING",dataObject:r.metering,decryptedDocumentKey:c}));f.service="local";d(f)}))}g.getPlatformKey=function(){return this.Y.getPlatformKey()};g.activate=function(){};g.reset=function(){};g.isPingbackEnabled=function(){return this.Y.isPingbackEnabled()};g.pingbackReturnsAllEntitlements=function(){return this.Y.pingbackReturnsAllEntitlements()};g.pingback=function(a){this.Y.pingback(a)};g.getSupportedScoreFactor=function(a){return this.Y.getSupportedScoreFactor(a)};g.getBaseScore=function(){return 0};g.executeAction=function(a,b){return this.Y.executeAction(a,b)};g.decorateUI=function(a,b,c){return this.Y.decorateUI(a,b,c)};g.Jb=function(){this.B.resetPlatforms()};function hd(a,b){var c=a.getHeadNode(),d=id(c,jd(c));if(b){var e=a.getRootNode();if(kd(e,d))b(d);else var f=setInterval((function(){kd(e,d)&&(clearInterval(f),b(d))}),4)}}function id(a,b){var c=a.__AMP_CSS_SM;c||(c=a.__AMP_CSS_SM=Object.create(null));var d=ld(a,c,"amp-extension=amp-subscriptions");if(d)return d.textContent!==b&&(d.textContent=b),d;var e=(a.ownerDocument||a).createElement("style");e.textContent=b;e.setAttribute("amp-extension","amp-subscriptions");b=ld(a,c,"amp-runtime");(b=void 0===b?null:b)?a.insertBefore(e,b.nextSibling):a.insertBefore(e,a.firstChild);return c["amp-extension=amp-subscriptions"]=e}function ld(a,b,c){return b[c]?b[c]:(a=a.querySelector("style["+c+"]"))?b[c]=a:null}function jd(a){return(a=a.__AMP_CSS_TR)?a("[subscriptions-action]:not(.i-amphtml-subs-display),[subscriptions-actions]:not(.i-amphtml-subs-display),[subscriptions-section=actions]:not(.i-amphtml-subs-display),body.i-amphtml-subs-delegated [subscriptions-section=actions],body.i-amphtml-subs-grant-unk [subscriptions-action],body.i-amphtml-subs-grant-unk [subscriptions-section=actions],body:not(.i-amphtml-subs-grant-no) [subscriptions-section=content-not-granted],body:not(.i-amphtml-subs-grant-yes) [subscriptions-section=content],body:not(.i-amphtml-subs-loading) [subscriptions-section=loading]{display:none!important}amp-subscriptions-dialog{display:block!important;position:fixed!important;bottom:0!important;left:0!important;margin-left:0!important;width:100%!important;z-index:2147483641!important;max-height:90vh;box-sizing:border-box;opacity:1;background-image:none;background-color:#fff;box-shadow:0 0 5px 0 rgba(0,0,0,0.2);margin-bottom:0;transition:transform 0.3s ease-in}.i-amphtml-subs-dialog-close-button{position:absolute;width:28px;height:28px;top:-28px;right:0;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='13' height='13' viewBox='341 8 13 13' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='%234F4F4F' d='M354 9.31 352.69 8l-5.19 5.19L342.31 8 341 9.31l5.19 5.19-5.19 5.19 1.31 1.31 5.19-5.19 5.19 5.19 1.31-1.31-5.19-5.19z' fill-rule='evenodd'/%3E%3C/svg%3E\");background-size:13px 13px;background-position:9px;background-color:#fff;background-repeat:no-repeat;box-shadow:0 -1px 1px 0 rgba(0,0,0,0.2);border:none;border-radius:12px 0 0 0;cursor:pointer}body:not(.i-amphtml-subs-grant-yes) .i-amphtml-subs-dialog-close-button{display:none}.i-amphtml-subs-progress{height:2px;background-color:#ccc;position:relative;margin:8px;overflow:hidden}.i-amphtml-subs-progress:after{content:\"\";background-color:#2196f3;height:2px;position:absolute;left:0;top:0;width:20%;animation:i-amphtml-subs-loading-progress 1500ms ease-in-out infinite}@keyframes i-amphtml-subs-loading-progress{0%{transform:translateX(-100%)}to{transform:translateX(500%)}}@media (min-width:480px){amp-subscriptions-dialog{width:480px!important;left:-240px!important;margin-left:50vw!important}}\n/*# sourceURL=/extensions/amp-subscriptions/0.1/amp-subscriptions.css*/"):"[subscriptions-action]:not(.i-amphtml-subs-display),[subscriptions-actions]:not(.i-amphtml-subs-display),[subscriptions-section=actions]:not(.i-amphtml-subs-display),body.i-amphtml-subs-delegated [subscriptions-section=actions],body.i-amphtml-subs-grant-unk [subscriptions-action],body.i-amphtml-subs-grant-unk [subscriptions-section=actions],body:not(.i-amphtml-subs-grant-no) [subscriptions-section=content-not-granted],body:not(.i-amphtml-subs-grant-yes) [subscriptions-section=content],body:not(.i-amphtml-subs-loading) [subscriptions-section=loading]{display:none!important}amp-subscriptions-dialog{display:block!important;position:fixed!important;bottom:0!important;left:0!important;margin-left:0!important;width:100%!important;z-index:2147483641!important;max-height:90vh;box-sizing:border-box;opacity:1;background-image:none;background-color:#fff;box-shadow:0 0 5px 0 rgba(0,0,0,0.2);margin-bottom:0;transition:transform 0.3s ease-in}.i-amphtml-subs-dialog-close-button{position:absolute;width:28px;height:28px;top:-28px;right:0;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='13' height='13' viewBox='341 8 13 13' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='%234F4F4F' d='M354 9.31 352.69 8l-5.19 5.19L342.31 8 341 9.31l5.19 5.19-5.19 5.19 1.31 1.31 5.19-5.19 5.19 5.19 1.31-1.31-5.19-5.19z' fill-rule='evenodd'/%3E%3C/svg%3E\");background-size:13px 13px;background-position:9px;background-color:#fff;background-repeat:no-repeat;box-shadow:0 -1px 1px 0 rgba(0,0,0,0.2);border:none;border-radius:12px 0 0 0;cursor:pointer}body:not(.i-amphtml-subs-grant-yes) .i-amphtml-subs-dialog-close-button{display:none}.i-amphtml-subs-progress{height:2px;background-color:#ccc;position:relative;margin:8px;overflow:hidden}.i-amphtml-subs-progress:after{content:\"\";background-color:#2196f3;height:2px;position:absolute;left:0;top:0;width:20%;animation:i-amphtml-subs-loading-progress 1500ms ease-in-out infinite}@keyframes i-amphtml-subs-loading-progress{0%{transform:translateX(-100%)}to{transform:translateX(500%)}}@media (min-width:480px){amp-subscriptions-dialog{width:480px!important;left:-240px!important;margin-left:50vw!important}}\n/*# sourceURL=/extensions/amp-subscriptions/0.1/amp-subscriptions.css*/"}function kd(a,b){var c=a.styleSheets;for(a=0;a<c.length;a++)if(c[a].ownerNode==b)return!0;return!1}self.__AMP_ERRORS=self.__AMP_ERRORS||[];function md(a){this.h=a;this.fa=null;this.R=O(a.win);this.aa=P(a,"viewport")}md.prototype.scheduleView=function(a){var b=this;this.fa=null;return this.h.whenReady().then((function(){return new Promise((function(c){b.h.isVisible()&&c();b.h.onVisibilityChanged((function(){b.h.isVisible()&&c()}))})).then((function(){return nd(b,a)}))}))};function nd(a,b){if(a.fa)return a.fa;I().fine("local-viewer","start view monitoring");a.fa=rd(a,b).catch((function(c){I().fine("local-viewer","view cancelled:",c);a.fa=null;throw c}));return a.fa}function rd(a,b){if(0==b)return w();var c=[];return new Promise((function(d,e){c.push(a.h.onVisibilityChanged((function(){a.h.isVisible()||e(Error("CANCELLED"))})));var f=a.R.delay(d,b);c.push((function(){return a.R.cancel(f)}));c.push(a.aa.onScroll(d));c.push(zc(a.h.getRootNode(),d))})).then((function(){c.forEach((function(d){return d()}))}),(function(d){c.forEach((function(e){return e()}));throw d}))}function sd(a){return a.waitForBodyOpen().then((function(){var b=a.getBody(),c=Aa(b,(function(){return!!b.firstElementChild}));return O(a.win).timeoutPromise(2e3,c).then((function(){return"AMP-STORY"===b.firstElementChild.tagName}),(function(){return!1}))}))}function td(a){var b=a.getElementById("amp-subscriptions");this.h=a;hd(a,(function(){}));this.Ra=null;this.U=new Zb(a);this.j=this.J=this.T=null;this.ib=H().assertElement(b);this.G=new S(this.ib);this.B=new gc(this);this.C=new jb(a);this.Mb=new md(a);this.$=P(a,"viewer");this.bb=null;this.R=O(a.win);this.vb=(this.Ma=this.$.hasCapability("auth"))&&this.$.hasCapability("paywall");this.tb=Ra(R(a),"cid");this.nb={};this.Ka=new U(a);this.F=null}g=td.prototype;g.start=function(){var a=this;ud(this).then((function(){a.G.event("subscriptions-started");a.U.toggleLoading(!0);K(a.T,"Page config is null");if(a.Ma)vd(a),wd(a,!1);else{K(a.J.services,"Services not configured in service config");var b=a.J.services.map((function(c){return c.serviceId||"local"}));xd(a,b);a.J.services.forEach((function(c){"local"==(c.serviceId||"local")&&a.j.resolvePlatform("local",ed(a.h,c,a.B))}));a.j.getAvailablePlatforms().forEach((function(c){yd(a,c)}));sd(a.h).then((function(c){wd(a,!c)}))}}));return this};g.getAccessReaderId=function(){var a=this;return ud(this).then((function(){return a.getReaderId("local")}))};g.getAnalytics=function(){return this.G};g.getAuthdataField=function(a){var b=this;return ud(this).then((function(){return b.j.getEntitlementPromiseFor("local")})).then((function(c){return oa(c.json(),a)}))};g.getDialog=function(){return this.C};g.getEncryptedDocumentKey=function(a){return this.Ka.getEncryptedDocumentKey(a)};g.getPageConfig=function(){return this.T};g.getReaderId=function(a){var b=this.nb[a];if(!b){var c=w(),d="amp-access"+("local"==a?"":"-"+a);b=this.tb.then((function(e){return e.get({scope:d,createCookieIfNotPresent:!0},c)}));this.nb[a]=b}return b};g.getScoreFactorStates=function(){return this.j.getScoreFactorStates()};g.registerPlatform=function(a,b){var c=this;return ud(this).then((function(){if(!c.Ma){var d=c.J.services.filter((function(h){return(h.serviceId||"local")===a})),e=K(d[0],"No matching services for the ID found"),f=b(e,c.B);c.j.resolvePlatform(f.getPlatformKey(),f);c.G.serviceEvent("subscriptions-service-registered",f.getPlatformKey());c.G.serviceEvent("subscriptions-platform-registered",f.getPlatformKey());yd(c,f)}}))};g.selectPlatformForLogin=function(){return this.j.selectPlatformForLogin()};function ud(a){if(!a.Ra){var b=new Kb(a.h),c=new zb(b);a.Ra=Promise.all([zd(a),c.resolveConfig()]).then((function(d){a.J=d[0];a.T=d[1]})).then((function(){Ad(a)}))}return a.Ra}function zd(a){return new Promise((function(b){var c=ra(a.ib.textContent,(function(d){throw H().createError('Failed to parse "amp-subscriptions" JSON: ',d)}));b(c)}))}function Bd(a,b,c){a.j.resolveEntitlement(b,c);c.decryptedDocumentKey&&a.Ka.tryToDecryptDocument(c.decryptedDocumentKey);a.G.serviceEvent("subscriptions-entitlement-resolved",b)}function Cd(a,b){return b.getEntitlements().then((function(c){return c&&c.granted&&a.Ka.isDocumentEncrypted()&&!c.decryptedDocumentKey?(("local"==b.getPlatformKey()?H():I()).error("amp-subscriptions",b.getPlatformKey()+": Subscription granted and encryption enabled, but no decrypted document key returned."),null):c}))}function yd(a,b){if(Dd(a))w();else{var c=3e3;La().development&&(c=6e3);(b.isPrerenderSafe()?w():a.h.whenFirstVisible()).then((function(){return a.R.timeoutPromise(c,Cd(a,b)).then((function(d){d=d||Y(b.getPlatformKey());Bd(a,b.getPlatformKey(),d);return d})).catch((function(d){var e=b.getPlatformKey();a.j.reportPlatformFailureAndFallback(e);throw H().createError("fetch entitlements failed for "+e,d)}))}))}}function xd(a,b){var c=a.J.fallbackEntitlement?Nb(a.J.fallbackEntitlement):Y("local");a.j=new Qb(b,a.J.score,c);b=a.j;Dd(a)&&b.resolveEntitlement("local",new X({source:"",raw:"",granted:!0,grantReason:"UNLOCKED",dataObject:{}}))}function vd(a){var b=sc(a.h.win);xd(a,["local"]);a.J.services.forEach((function(c){if("local"==(c.serviceId||"local")){var d=new fd(a.h,c,a.B,b);a.j.resolvePlatform("local",d);Cd(a,d).then((function(e){Bd(a,"local",e)})).catch((function(e){a.j.reportPlatformFailureAndFallback("local");I().error("amp-subscriptions","Viewer auth failed:",e)}))}}))}function wd(a,b){var c=b=void 0===b?!0:b,d=a.j.getGrantStatus(),e=a.j.getGrantEntitlement();return Promise.all([d,e]).then((function(f){function h(){return Ed(a,{granted:l,shouldActivatePlatform:c})}var l=f[0];f=f[1];if(a.F){var n=a.j.getPlatform(a.F.platformKey);l?f&&"METERING"===f.grantReason&&f.service===a.F.platformKey?n.activate(f,f,(function(){Ed(a,{granted:!0,shouldActivatePlatform:!1})})):h():a.F.entitlementsWereFetchedWithCurrentMeteringState?h():a.F.loadMeteringState().then((function(r){if(r)a.resetPlatform(a.F.platformKey);else{var E=Y("local");n.activate(E,E,(function(){return wd(a)}))}}))}else h()}))}function Ed(a,b){var c=b.shouldActivatePlatform;b=b.granted;a.U.toggleLoading(!1);a.bb=a.Mb.scheduleView(2e3);a.vb&&!b||a.U.setGrantState(b);Fd(a);c&&Gd(a)}function Gd(a){Promise.all([a.j.getGrantStatus(),a.j.selectPlatform(),a.j.getGrantEntitlement()]).then((function(b){var c=b[1],d=b[2],e=a.j.getResolvedEntitlementFor(c.getPlatformKey()),f=d||e;c.activate(e,d);a.G.serviceEvent("subscriptions-service-activated",c.getPlatformKey());a.G.serviceEvent("subscriptions-platform-activated",c.getPlatformKey());f.granted?a.G.serviceEvent("subscriptions-access-granted",f.service):(a.G.serviceEvent("subscriptions-paywall-activated",c.getPlatformKey()),a.G.serviceEvent("subscriptions-access-denied",c.getPlatformKey()))}))}function Fd(a){a.bb&&a.bb.then((function(){a.j.getAvailablePlatforms().forEach((function(b){b.isPingbackEnabled()&&(b.pingbackReturnsAllEntitlements()?a.j.getAllPlatformsEntitlements().then((function(c){return b.pingback(c)})):a.j.getGrantEntitlement().then((function(c){return b.pingback(c||Y("local"))})))}))}))}g.resetPlatforms=function(){var a=this;this.j=this.j.resetPlatformStore();this.U.toggleLoading(!0);this.F&&(this.F.entitlementsWereFetchedWithCurrentMeteringState=!1);this.j.getAvailablePlatforms().forEach((function(b){yd(a,b)}));this.G.serviceEvent("subscriptions-service-re-authorized","");this.G.serviceEvent("subscriptions-platform-re-authorized","");wd(this)};g.resetPlatform=function(a){this.U.toggleLoading(!0);this.j.resetPlatform(a);a=this.j.getPlatform(a);yd(this,a);wd(this)};g.delegateActionToLocal=function(a,b){return this.delegateActionToService(a,"local",b)};g.delegateActionToService=function(a,b,c){var d=this,e=void 0===c?null:c;return new Promise((function(f){d.j.onPlatformResolves(b,(function(h){d.G.event("subscriptions-action-delegated",A({action:a,serviceId:b}),A({action:a,status:"started"}));f(h.executeAction(a,e))}))}))};g.decorateServiceAction=function(a,b,c,d){this.j.onPlatformResolves(b,(function(e){e.decorateUI(a,c,d)}))};function Dd(a){return!a.T.isLocked()||a.J.alwaysGrant}function Ad(a){var b=a.J.services.find((function(c){return c.enableMetering}));b&&(a.F=new Ob({platformKey:b.serviceId}))}AMP.registerServiceForDoc("subscriptions",(function(a){return new td(a).start()}))}});//# sourceMappingURL=amp-subscriptions-0.1.js.map