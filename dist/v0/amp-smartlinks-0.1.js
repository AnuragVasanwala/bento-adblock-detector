(self.AMP=self.AMP||[]).push({m:0,v:"2110121450047",n:"amp-smartlinks",ev:"0.1",l:true,f:function(AMP,_){"use strict";function aa(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}function l(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):{next:aa(a)}}var ba="function"==typeof Object.create?Object.create:function(a){function b(){}b.prototype=a;return new b};function ca(a){for(var b=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global],c=0;c<b.length;++c){var d=b[c];if(d&&d.Math==Math)return d}return function(){throw Error("Cannot find global object")}()}var da=ca(this);"function"===typeof Symbol&&Symbol("x");var m;if("function"==typeof Object.setPrototypeOf)m=Object.setPrototypeOf;else{var n;a:{var ea={a:!0},p={};try{p.__proto__=ea;n=p.a;break a}catch(a){}n=!1}m=n?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var q=m;function r(a,b){a.prototype=ba(b.prototype);a.prototype.constructor=a;if(q)q(a,b);else for(var c in b)if("prototype"!=c)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c];a.na=b.prototype}function t(a){return a||{}}var u=Array.isArray;function ha(a,b){if(!isFinite(5))throw Error("Invalid depth: 5");if(a===b)return!0;for(a=[{a:a,b:b,depth:5}];0<a.length;){var c=a.shift();b=c.a;var d=c.b;c=c.depth;if(0<c){if(typeof b!==typeof d)return!1;if(u(b)&&u(d)){if(b.length!==d.length)return!1;for(var e=0;e<b.length;e++)a.push({a:b[e],b:d[e],depth:c-1});continue}else if(b&&d&&"object"===typeof b&&"object"===typeof d){var f=Object.keys(b),g=Object.keys(d);if(f.length!==g.length)return!1;e=l(f);for(var h=e.next();!h.done;h=e.next())h=h.value,a.push({a:b[h],b:d[h],depth:c-1});continue}}if(b!==d)return!1}return!0}
/* https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
function v(a,b,c){a=a.createElement(b);for(var d in c)a.setAttribute(d,c[d]);return a}var w=self.AMP_CONFIG||{},ia=("string"==typeof w.cdnProxyRegex?new RegExp(w.cdnProxyRegex):w.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;function x(a){if(self.document&&self.document.head&&(!self.location||!ia.test(self.location.origin))){var b=self.document.head.querySelector('meta[name="'+a+'"]');b&&b.getAttribute("content")}}w.cdnUrl||x("runtime-host");w.geoApiUrl||x("amp-geo-api");self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var y=self.__AMP_LOG;function z(){throw Error("failed to call initLogConstructor")}function A(){return y.dev||(y.dev=z())}function ja(a){y.user||(y.user=z());y.user.assert(a,'Invalid response from provided "resolveUnknownLinks" function."resolveUnknownLinks" should return an instance of TwoStepsResponse',void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0)}var B;function C(){return B?B:B=Promise.resolve(void 0)}function ka(){var a=this;this.promise=new Promise((function(b,c){a.resolve=b;a.reject=c}))}function D(a,b){a=a.__AMP_TOP||(a.__AMP_TOP=a);return E(a,b)}function F(a,b){var c=G(a);c=H(c);return E(c,b)}function G(a){return a.nodeType?D((a.ownerDocument||a).defaultView,"ampdoc").getAmpDoc(a):a}function H(a){a=G(a);return a.isSingleDoc()?a.win:a}function E(a,b){a=I(a)[b];a.obj||(a.obj=new a.ctor(a.context),a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}function J(a,b){var c=la(a,b);if(c)return c;a=I(a);a[b]=ma();return a[b].promise}function la(a,b){var c=I(a)[b];if(c){if(c.promise)return c.promise;E(a,b);return c.promise=Promise.resolve(c.obj)}return null}function I(a){var b=a.__AMP_SERVICES;b||(b=a.__AMP_SERVICES={});return b}function ma(){var a=new ka,b=a.promise,c=a.reject;a=a.resolve;b.catch((function(){}));return{obj:null,promise:b,resolve:a,reject:c,context:null,ctor:null}}function na(a){var b=la(H(a),"amp-analytics-instrumentation");if(b)return b;var c=G(a);return c.whenExtensionsKnown().then((function(){var d=c.getExtensionVersion("amp-analytics");return d?D(c.win,"extensions").waitForExtension("amp-analytics",d):null})).then((function(d){return d?J(H(a),"amp-analytics-instrumentation"):null}))}function K(a,b){this.syncResponse=a;this.asyncResponse=b}function L(a,b,c){this.K=a;this.ja=b.exclusiveLinks;this.ia=b.publisherID;this.L=b.linkAttribute;this.M=this.j=null;this.h=c}L.prototype.runLinkmate=function(a){var b=this,c=null,d=this.j&&!ha(this.j,a);this.M&&d&&(c=oa(this));if(!this.M||d){var e=pa(this,a).then((function(f){b.M=f.data[0].smart_links;b.j=a;return oa(b)}));return new K(c,e)}this.j=a;return new K(c,null)};function pa(a,b){var c=qa(a,b),d=ra(a),e=t({article:d,links:c}),f="https://api.narrativ.com/api/v1/publishers/.pub_id./linkmate/smart_links/".replace(".pub_id.",a.ia.toString()),g={method:"POST",ampCors:!1,headers:t({"Content-Type":"application/json"}),body:e};return a.K.fetchJson(f,g).then((function(h){return h.json()}))}function qa(a,b){var c=[];b.forEach((function(d){var e=d.getAttribute(a.L);if(/shop-links.co/.test(e))/\?amp=true$/.test(e)||(d[a.L]+="?amp=true");else if(!/#donotlink$/.test(e)){var f=a.ja||/#locklink$/.test(e);c.push({raw_url:e,exclusive_match_requested:f,link_source:"linkmate"})}}));return c}function ra(a){var b=null;0<a.h.document.getElementsByTagName("title").length&&(b=a.h.document.getElementsByTagName("title")[0].text);return t({name:b,url:a.P()})}L.prototype.P=function(){return this.h.location.href};function oa(a){var b=[];a.j.forEach((function(c){a.M.forEach((function(d){c.getAttribute(a.L)===d.url&&d.auction_id&&b.push({anchor:c,replacementUrl:"https://shop-links.co/"+d.auction_id+"/?amp=true"})}))}));return b}function sa(a){var b=a.getAttribute("nrtv-account-name").toLowerCase(),c=!!a.hasAttribute("linkmate"),d=!!a.hasAttribute("exclusive-links");var e=(e=a.getAttribute("link-attribute"))?e.toLowerCase():"href";a=(a=a.getAttribute("link-selector"))?a.toLowerCase():"a";return{nrtvSlug:b,linkmateEnabled:c,exclusiveLinks:d,linkAttribute:e,linkSelector:a}}function ta(a,b,c){var d=!1;c=void 0===c?{}:c;d=void 0===d?!0:d;var e=c,f=d;na(a).then((function(g){g&&g.triggerEventForTarget(a,b,e,f)}))}function ua(a,b){var c=this;this.X=a.getResourceId();this.J=a;this.D=b;for(var d in b.triggers)b.triggers[d].on="sandbox-"+this.X+"-"+b.triggers[d].on;this.J.signals().whenSignal("load-start").then((function(){var e=c.J,f=e.ownerDocument;var g=v(f,"amp-analytics",t({sandbox:"true",trigger:(void 0===g?0:g)?"":"immediate"}));f=v(f,"script",t({type:"application/json"}));f.textContent=JSON.stringify(b);g.appendChild(f);g.CONFIG=b;f=D((e.ownerDocument||e).defaultView,"extensions");var h=G(e);f.installExtensionForDoc(h,"amp-analytics");e.appendChild(g)}))}ua.prototype.trigger=function(a,b){ta(this.J,"sandbox-"+this.X+"-"+a,b)};function M(a){this.J=a;this.D={requests:{},triggers:{}}}M.prototype.setTransportConfig=function(a){this.D.transport=a};M.prototype.setExtraUrlParams=function(a){this.D.extraUrlParams=a};M.prototype.track=function(a,b){b=u(b)?b:[b];for(var c=[],d=0;d<b.length;d++){var e=a+"-request-"+d;this.D.requests[e]=b[d];c.push(e)}this.D.triggers[a]={on:a,request:c};return this};M.prototype.build=function(){var a=new ua(this.J,this.D);this.D=null;return a};function N(){this.F=[]}N.prototype.peek=function(){var a=this.length;return a?this.F[a-1].item:null};N.prototype.enqueue=function(a,b){if(isNaN(b))throw Error("Priority must not be NaN.");for(var c=-1,d=0,e=this.length;d<=e;){c=Math.floor((d+e)/2);if(c===this.length)break;if(this.F[c].priority<b)d=c+1;else if(0<c&&this.F[c-1].priority>=b)e=c-1;else break}this.F.splice(c,0,{item:a,priority:b})};N.prototype.forEach=function(a){for(var b=this.length;b--;)a(this.F[b].item)};N.prototype.dequeue=function(){return this.length?this.F.pop().item:null};da.Object.defineProperties(N.prototype,{length:{configurable:!0,enumerable:!0,get:function(){return this.F.length}}});new Set(["c","v","a","ad"]);function O(){this.o=null}O.prototype.add=function(a){var b=this;this.o||(this.o=[]);this.o.push(a);return function(){b.remove(a)}};O.prototype.remove=function(a){if(this.o){var b=this.o;a=b.indexOf(a);-1!=a&&b.splice(a,1)}};O.prototype.removeAll=function(){this.o&&(this.o.length=0)};O.prototype.fire=function(a){if(this.o)for(var b=l(this.o),c=b.next();!c.done;c=b.next())c=c.value,c(a)};O.prototype.getHandlerCount=function(){var a,b;return null!=(b=null==(a=this.o)?void 0:a.length)?b:0};function P(){this.j=[];this.S=[]}P.prototype.updateLinkList=function(a){this.S=a.map(this.getReplacementUrlForAnchor.bind(this));this.j=a};P.prototype.updateReplacementUrls=function(a){var b=this;a.forEach((function(c){var d=c.replacementUrl,e=b.j.indexOf(c.anchor);-1!==e&&(b.S[e]=d)}))};P.prototype.getReplacementUrlForAnchor=function(a){a=this.j.indexOf(a);return-1!==a?this.S[a]:null};P.prototype.isInCache=function(a){return-1!==this.j.indexOf(a)};P.prototype.getAnchorReplacementList=function(){var a=this;return this.j.map((function(b){return{anchor:b,replacementUrl:a.getReplacementUrlForAnchor(b)}}))};var Q,va="Webkit webkit Moz moz ms O o".split(" ");var wa=!1;var xa=/nochunking=1/.test(self.location.hash),S=C();function ya(a,b){if(xa)S.then(b);else{var c=T,d=G(a),e=H(d),f=I(e),g=f.chunk;g||(g=f.chunk={obj:null,promise:null,resolve:null,reject:null,context:null,ctor:null,sharedInstance:!1});g.ctor||(g.ctor=c,g.context=d,g.sharedInstance=!1,g.resolve&&E(e,"chunk"));F(a,"chunk").run(b,10)}}function U(a){this.state="not_run";this.O=a}function za(a,b){if("run"!=a.state){a.state="run";try{a.O(b)}catch(c){throw a.aa(),c}}}U.prototype.aa=function(){};U.prototype.Y=function(){return!1};U.prototype.da=function(){return!1};function V(a,b,c){U.call(this,a);this.U=c}r(V,U);V.prototype.aa=function(){var a=self.document;if(!wa){wa=!0;a=a.body;var c,b={opacity:1,visibility:"visible",animation:"none"};for(c in b){var d=a,e=b[c];var f=d.style;var g=c;if(g.startsWith("--"))f=g;else{Q||(Q=Object.create(null));var h=Q[g];if(!h){h=g;if(void 0===f[g]){var k=g;k=k.charAt(0).toUpperCase()+k.slice(1);b:{for(var R=0;R<va.length;R++){var fa=va[R]+k;if(void 0!==f[fa]){k=fa;break b}}k=""}void 0!==f[k]&&(h=k)}Q[g]=h}f=h}f&&(f.startsWith("--")?d.style.setProperty(f,e):d.style[f]=e)}}};V.prototype.Y=function(){return this.U.ampdoc.isVisible()};V.prototype.da=function(){return this.U.V};function T(a){var b=this;this.ampdoc=a;this.h=a.win;this.I=new N;this.T=this.W.bind(this);this.H=0;this.ma=!(!this.h.navigator.scheduling||!this.h.navigator.scheduling.isInputPending);this.N=!1;this.ea=this.h.document.documentElement.hasAttribute("i-amphtml-no-boilerplate");this.h.addEventListener("message",(function(c){"amp-macro-task"==c.data&&b.W(null)}));this.V=!1;J(H(a),"viewer").then((function(){b.V=!0}));a.onVisibilityChanged((function(){a.isVisible()&&W(b)}))}T.prototype.run=function(a,b){a=new U(a);this.I.enqueue(a,b);W(this)};T.prototype.runForStartup=function(a){a=new V(a,this.h,this);this.I.enqueue(a,Number.POSITIVE_INFINITY);W(this)};function Aa(a,b){for(var c=a.I.peek();c&&"not_run"!==c.state;)a.I.dequeue(),c=a.I.peek();c&&b&&a.I.dequeue();return c}T.prototype.W=function(a){var b=this,c=Aa(this,!0);if(!c)return this.N=!1,this.H=0,!1;try{var d=Date.now();za(c,a)}finally{S.then().then().then().then().then().then().then().then().then((function(){b.N=!1;b.H+=Date.now()-d;A().fine("CHUNK",c.O.displayName||c.O.name,"Chunk duration",Date.now()-d,b.H);W(b)}))}return!0};function Ba(a){a.ea&&(a.ma?a.h.navigator.scheduling.isInputPending():5<a.H)?(a.H=0,Ca(a)):S.then((function(){a.T(null)}))}function W(a){if(!a.N){var b=Aa(a);b&&(b.Y()?(a.N=!0,Ba(a)):b.da()&&a.h.requestIdleCallback?Da(a.h,a.T):Ca(a))}}function Ca(a){a.h.postMessage("amp-macro-task","*")}function Da(a,b){function c(e){if(15>e.timeRemaining()){var f=2e3-(Date.now()-d);0>=f||e.didTimeout?(A().fine("CHUNK","Timed out",2e3,e.didTimeout),b(e)):(A().fine("CHUNK","Rescheduling with",f,e.timeRemaining()),a.requestIdleCallback(c,{timeout:f}))}else A().fine("CHUNK","Running idle callback with ",15),b(e)}var d=Date.now();a.requestIdleCallback(c,{timeout:2e3})}function X(a,b,c,d){this.events=new O;this.id=b;this.G=a;this.ka=c;this.fa=d.linkSelector||"a";this.la=300;this.C=new P}X.prototype.getReplacementUrl=function(a){return this.isWatchingLink(a)?this.C.getReplacementUrlForAnchor(a):null};X.prototype.getAnchorReplacementList=function(){return this.C.getAnchorReplacementList()};X.prototype.isWatchingLink=function(a){return this.C.isInCache(a)};X.prototype.rewriteAnchorUrl=function(a){var b=this.getReplacementUrl(a);if(!b||b===a.href)return!1;a.setAttribute("data-link-rewriter-original-url",a.href);a.href=b;setTimeout((function(){a.href=a.getAttribute("data-link-rewriter-original-url");a.removeAttribute("data-link-rewriter-original-url")}),this.la);return!0};X.prototype.onDomUpdated=function(){var a=this;return new Promise((function(b){ya(a.G.nodeType==Node.DOCUMENT_NODE?a.G.documentElement:a.G,(function(){return Ea(a).then((function(){a.events.fire({type:"PAGE_SCANNED"});b()}))}))}))};function Ea(a){var b=Fa(a),c=Ga(a,b);a.C.updateLinkList(b);if(!c.length)return C();a.C.updateReplacementUrls(c.map((function(e){return{anchor:e,replacementUrl:null}})));var d=a.ka(c);ja(d instanceof K);d.syncResponse&&a.C.updateReplacementUrls(d.syncResponse);return d.asyncResponse?d.asyncResponse.then((function(e){a.C.updateReplacementUrls(e)})):C()}function Ga(a,b){var c=[];b.forEach((function(d){a.isWatchingLink(d)||c.push(d)}));return c}function Fa(a){var b=a.G.querySelectorAll(a.fa);return[].slice.call(b)}function Y(a){this.G=a.getRootNode();var b=a.getMetaByName("amp-link-rewriter-priorities");this.ha=b?b.trim().split(/\s+/):[];this.R=[];this.G.addEventListener("amp:dom-update",this.ga.bind(this));F(a,"navigation").registerAnchorMutator(this.maybeRewriteLink.bind(this),0)}Y.prototype.registerLinkRewriter=function(a,b,c){var d=new X(this.G,a,b,c);Ha(this.R,d,this.ha);d.onDomUpdated();return d};Y.prototype.maybeRewriteLink=function(a,b){var c=Ia(this,a);if(c.length){for(var d=null,e=0;e<c.length;e++)if(c[e].rewriteAnchorUrl(a)){d=c[e];break}var f={linkRewriterId:d?d.id:null,anchor:a,clickType:b.type};c.forEach((function(g){g.events.fire({type:"CLICK",eventData:f})}))}};Y.prototype.ga=function(){this.R.forEach((function(a){a.onDomUpdated()}))};function Ja(a){var b=a.hasAttribute("data-link-rewriters")?a.getAttribute("data-link-rewriters").trim():null;return b?b.split(/\s+/):[]}function Ha(a,b,c){a.push(b);a.sort((function(d,e){var f=c.indexOf(d.id),g=c.indexOf(e.id);return-1===f&&-1===g?0:-1===f?1:-1===g?-1:f>g?1:-1}))}function Ia(a,b){var c=Ja(b);return a.R.reduce((function(d,e){e.isWatchingLink(b)&&Ha(d,e,c);return d}),[])}function Z(a){a=AMP.BaseElement.call(this,a)||this;a.K=null;a.B=null;a.Z=null;a.ca=null;a.A=null;a.$=null;a.ba=null;return a}r(Z,AMP.BaseElement);Z.prototype.buildCallback=function(){var a=this;this.B=this.getAmpDoc();this.K=D(this.B.win,"xhr");var b=F(this.B,"viewer");this.A=sa(this.element);this.Z=new Y(this.B);return this.B.whenReady().then((function(){return b.getReferrerUrl()})).then((function(c){a.ba=c;a.B.whenFirstVisible().then((function(){Ka(a)}))}))};function Ka(a){La(a).then((function(b){if(b){a.A.linkmateExpected=b.linkmate_enabled;a.A.publisherID=b.publisher_id;a.signals().signal("load-start");b=t({events:[{is_amp:!0}],organization_id:a.A.publisherID,organization_type:"publisher",user:{page_session_uuid:Ma(),source_url:a.P(),previous_url:a.ba,user_agent:a.B.win.navigator.userAgent}});var c=new M(a.element);c.track("page-impression","https://api.narrativ.com/api/v1/events/impressions/page_impression/");c.setTransportConfig(t({beacon:!0,image:!1,xhrpost:!0,useBody:!0}));c.setExtraUrlParams(b);c.build().trigger("page-impression");a.$=new L(a.K,a.A,a.win);a.ca=Na(a);a.A.linkmateEnabled&&a.A.linkmateExpected&&a.ca.getAnchorReplacementList()}}))}function La(a){var b="https://api.narrativ.com/api/v0/publishers/.nrtv_slug./amp_config/".replace(".nrtv_slug.",a.A.nrtvSlug);try{return a.K.fetchJson(b,{method:"GET",ampCors:!1}).then((function(c){return c.json()})).then((function(c){return c.data[0].amp_config}))}catch(c){return null}}function Na(a){return a.Z.registerLinkRewriter("amp-smartlinks",(function(b){return a.$.runLinkmate(b)}),{linkSelector:a.A.linkSelector})}Z.prototype.P=function(){return this.win.location.href};function Ma(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,(function(a){return(a^crypto.getRandomValues(new Uint8Array(1))[0]&15>>a/4).toString(16)}))}AMP.registerElement("amp-smartlinks",Z)}});//# sourceMappingURL=amp-smartlinks-0.1.js.map