(self.AMP=self.AMP||[]).push({m:0,v:"2110121450047",n:"amp-story-360",ev:"0.1",l:true,f:function(AMP,_){"use strict";var p,aa="function"==typeof Object.create?Object.create:function(a){function b(){}b.prototype=a;return new b};function ba(a){for(var b=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global],c=0;c<b.length;++c){var d=b[c];if(d&&d.Math==Math)return d}return function(){throw Error("Cannot find global object")}()}var q=ba(this);"function"===typeof Symbol&&Symbol("x");var t;if("function"==typeof Object.setPrototypeOf)t=Object.setPrototypeOf;else{var u;a:{var ca={a:!0},v={};try{v.__proto__=ca;u=v.a;break a}catch(a){}u=!1}t=u?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var x,w=t;function y(){var a=this;this.promise=new Promise((function(b,c){a.resolve=b;a.reject=c}))}function z(a){a.tagName.startsWith("AMP-");if(a.createdCallback)return Promise.resolve(a);if(!a.__AMP_UPG_PRM){var b=new y;a.__AMP_UPG_PRM=b.promise;a.__AMP_UPG_RES=b.resolve}return a.__AMP_UPG_PRM}
/* https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
function da(a,b){for(;a&&void 0!==a;a=a.parentElement)if(b(a))return a;return null}var A;function B(a){var b=a.ownerDocument||a;A&&A.ownerDocument===b||(A=b.createElement("div"));return fa}function fa(a){var b=A;b.innerHTML=a[0];a=b.firstElementChild;b.removeChild(a);return a}function ha(a,b,c){if(b(a))c();else{var d=(a.ownerDocument||a).defaultView;if(d.MutationObserver){var e=new d.MutationObserver((function(){b(a)&&(e.disconnect(),c())}));e.observe(a,{childList:!0})}else var f=d.setInterval((function(){b(a)&&(d.clearInterval(f),c())}),5)}}function ia(a,b){ha(a.documentElement,(function(){return!!a.body}),b)}function ja(a){return new Promise((function(b){return ia(a,b)}))}var C=self.AMP_CONFIG||{},ka=("string"==typeof C.cdnProxyRegex?new RegExp(C.cdnProxyRegex):C.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;function E(a){if(self.document&&self.document.head&&(!self.location||!ka.test(self.location.origin))){var b=self.document.head.querySelector('meta[name="'+a+'"]');b&&b.getAttribute("content")}}C.cdnUrl||E("runtime-host");C.geoApiUrl||E("amp-geo-api");function la(a){if(!a)return[];for(var b=a.querySelectorAll("script[custom-element],script[custom-template]"),c=[],d=0;d<b.length;d++){var g,e=b[d],f=e.getAttribute("custom-element")||e.getAttribute("custom-template");if(g=e.src){var h=g.match(/^(.*)\/(.*)-([0-9.]+|latest)(\.max)?\.(?:js|mjs)$/i);g=h?h[2]:void 0;h=h?h[3]:void 0;g=g&&h?{extensionId:g,extensionVersion:h}:null}else g=null;f&&g&&c.push({script:e,extensionId:f,extensionVersion:g.extensionVersion})}return c}function ma(a){return la(a.document.head).some((function(b){var c=b.extensionVersion;return"amp-story"==b.extensionId&&"1.0"==c}))}self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var F=self.__AMP_LOG;function G(){throw Error("failed to call initLogConstructor")}function H(){F.user||(F.user=G());return F.user}function I(a,b){H().assert(a,b,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0)}function J(a,b){a=a.__AMP_TOP||(a.__AMP_TOP=a);return K(a,b)}function na(a){var b=L(a);b=oa(b);return K(b,"owners")}function L(a){return a.nodeType?J((a.ownerDocument||a).defaultView,"ampdoc").getAmpDoc(a):a}function oa(a){a=L(a);return a.isSingleDoc()?a.win:a}function K(a,b){a=M(a)[b];a.obj||(a.obj=new a.ctor(a.context),a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}function pa(a,b){var c=qa(a,b);if(c)return c;a=M(a);a[b]=ra();return a[b].promise}function qa(a,b){var c=M(a)[b];if(c){if(c.promise)return c.promise;K(a,b);return c.promise=Promise.resolve(c.obj)}return null}function M(a){var b=a.__AMP_SERVICES;b||(b=a.__AMP_SERVICES={});return b}function ra(){var a=new y,b=a.promise,c=a.reject;a=a.resolve;b.catch((function(){}));return{obj:null,promise:b,resolve:a,reject:c,context:null,ctor:null}}function sa(a){var b=qa(a,"story-store");return b?b:ta(a)}function ta(a){return ja(a.document).then((function(){var b=J(a,"extensions");return ma(b.win)?b.waitForExtension("amp-story","1.0"):null})).then((function(b){return b?pa(a,"story-store"):null}))}var N;function ua(a,b,c){function d(h){try{return f(h)}catch(r){var m,k;null==(k=(m=self).__AMP_REPORT_ERROR)||k.call(m,r);throw r}}var e=a,f=c,g=va();e.addEventListener(b,d,g?void 0:!1);return function(){var h;null==(h=e)||h.removeEventListener(b,d,g?void 0:!1);d=e=f=null}}function va(){if(void 0!==N)return N;N=!1;try{var a={get capture(){N=!0}};self.addEventListener("test-options",null,a);self.removeEventListener("test-options",null,a)}catch(b){}return N}function wa(a,b,c){var d=c,e=ua(a,b,(function(f){try{d(f)}finally{d=null,e()}}));return e}function xa(a,b){var c,d=new Promise((function(e){c=wa(a,b,e)}));d.then(c,c);return d}function O(a,b){console.assert(9==a.length&&9==b.length);for(var c=new Float32Array(9),d=0;3>d;++d)for(var e=0;3>e;++e){for(var f=0,g=0;3>g;++g)f+=a[3*d+g]*b[3*g+e];c[3*d+e]=f}return c}function P(){var a=new Float32Array(9);a.fill(0);for(var b=0;3>b;++b)a[3*b+b]=1;return a}function Q(a,b,c){console.assert(3>a&&3>b);var d=P(),e=Math.cos(c),f=Math.sin(c);d[3*a+a]=+e;d[3*a+b]=-f;d[3*b+a]=+f;d[3*b+b]=+e;return d}function R(a){var b={alpha:!0,depth:!1,stencil:!1,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:window.__AMP_TEST||!1};this.gl=a.getContext("webgl",b)||a.getContext("experimental-webgl",b);this.canvas=a;this.rotation=null;this.scale=1;this.tex=this.vbo=this.progSlow=this.progFast=this.fragShaderSlow=this.fragShaderFast=this.vertShader=this.orientation=null}p=R.prototype;p.init=function(){var a=this.gl;this.vertShader=a.createShader(a.VERTEX_SHADER);this.fragShaderFast=a.createShader(a.FRAGMENT_SHADER);this.fragShaderSlow=a.createShader(a.FRAGMENT_SHADER);this.progFast=a.createProgram();this.progSlow=a.createProgram();S(this,this.vertShader,"\n    uniform   vec2 uScale;\n    attribute vec2 aPos;\n    varying   vec2 vPos;\n\n    void main() {\n      gl_Position = vec4(aPos, 0.0, 1.0);\n      vPos = uScale * aPos;\n    }\n  ");a.attachShader(this.progFast,this.vertShader);a.attachShader(this.progFast,this.fragShaderFast);a.attachShader(this.progSlow,this.vertShader);a.attachShader(this.progSlow,this.fragShaderSlow);this.setMapping();this.setCamera(P(),1);this.vbo=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.vbo);var b=new Float32Array([-1,-1,1,-1,-1,1,1,1]);a.bufferData(a.ARRAY_BUFFER,b,a.STATIC_DRAW);this.tex=a.createTexture();a.bindTexture(a.TEXTURE_2D,this.tex);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);a.bindTexture(a.TEXTURE_2D,null);a.bindBuffer(a.ARRAY_BUFFER,null);this.resize()};p.setImage=function(a){var b=this.gl;b.bindTexture(b.TEXTURE_2D,this.tex);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,a);b.bindTexture(b.TEXTURE_2D,null)};p.setImageOrientation=function(a,b,c){a=void 0===a?0:a;b=void 0===b?0:b;c=void 0===c?0:c;var d=Math.PI/180,e=d*a,f=d*b,g=d*c,h=P();g=-g;var m=-f,k=-e;e=Math.cos(g);g=Math.sin(g);f=Math.cos(m);m=Math.sin(m);var r=Math.cos(k);k=Math.sin(k);var l=e*r,n=e*k,D=g*r,ea=g*k;h[0]=f*r;h[3]=-f*k;h[6]=m;h[1]=n+D*m;h[4]=l-ea*m;h[7]=-g*f;h[2]=ea-l*m;h[5]=D+n*m;h[8]=e*f;this.orientation=h};p.setMapping=function(a){a=void 0===a?"":a;S(this,this.fragShaderFast,"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp   float;\n    #else\n      precision mediump float;\n    #endif\n\n    const   float     pi = 3.14159265359;\n    uniform float     uPxSize;\n    uniform mat3      uRot;\n    uniform sampler2D uTex;\n    varying vec2      vPos;\n\n    vec4 sample(float dx, float dy) {\n      vec3 q = vec3(vPos + uPxSize * vec2(dx, dy), -1.0);\n      vec3 dir = normalize(uRot * q);\n      float u = (-0.5 / pi) * atan(dir[1], dir[0]) + 0.5;\n      float v = (1.0 / pi) * acos(dir[2]);\n      return texture2D(uTex, vec2(u, v));\n    }\n  \n    void main() {\n      gl_FragColor = sample(0.0, 0.0);\n    }\n  "+a);S(this,this.fragShaderSlow,"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp   float;\n    #else\n      precision mediump float;\n    #endif\n\n    const   float     pi = 3.14159265359;\n    uniform float     uPxSize;\n    uniform mat3      uRot;\n    uniform sampler2D uTex;\n    varying vec2      vPos;\n\n    vec4 sample(float dx, float dy) {\n      vec3 q = vec3(vPos + uPxSize * vec2(dx, dy), -1.0);\n      vec3 dir = normalize(uRot * q);\n      float u = (-0.5 / pi) * atan(dir[1], dir[0]) + 0.5;\n      float v = (1.0 / pi) * acos(dir[2]);\n      return texture2D(uTex, vec2(u, v));\n    }\n  \n    vec4 sampleSq(float dx, float dy) {\n      vec4 s = sample(dx, dy);\n      return vec4(s.xyz * s.xyz, s.w);\n    }\n\n    void main() {\n      // (2, 3) halton vector sequences.\n      vec4 acc = (1.0 / 16.0) * (\n        (((sampleSq(1.0 / 2.0 - 0.5,  1.0 / 3.0 - 0.5) +\n           sampleSq(1.0 / 4.0 - 0.5,  2.0 / 3.0 - 0.5)) +\n          (sampleSq(3.0 / 4.0 - 0.5,  1.0 / 9.0 - 0.5) +\n           sampleSq(1.0 / 8.0 - 0.5,  4.0 / 9.0 - 0.5))) +\n         ((sampleSq(5.0 / 8.0 - 0.5,  7.0 / 9.0 - 0.5) +\n           sampleSq(3.0 / 8.0 - 0.5,  2.0 / 9.0 - 0.5)) +\n          (sampleSq(7.0 / 8.0 - 0.5,  5.0 / 9.0 - 0.5) +\n           sampleSq(1.0 / 16.0 - 0.5,  8.0 / 9.0 - 0.5)))) +\n        (((sampleSq(9.0 / 16.0 - 0.5,  1.0 / 27.0 - 0.5) +\n           sampleSq(5.0 / 16.0 - 0.5, 10.0 / 27.0 - 0.5)) +\n          (sampleSq(13.0 / 16.0 - 0.5, 19.0 / 27.0 - 0.5) +\n           sampleSq(3.0 / 16.0 - 0.5,  4.0 / 27.0 - 0.5))) +\n         ((sampleSq(11.0 / 16.0 - 0.5, 13.0 / 27.0 - 0.5) +\n           sampleSq(7.0 / 16.0 - 0.5, 22.0 / 27.0 - 0.5)) +\n          (sampleSq(15.0 / 16.0 - 0.5,  7.0 / 27.0 - 0.5) +\n           sampleSq(1.0 / 32.0 - 0.5, 16.0 / 27.0 - 0.5))))\n     );\n      gl_FragColor = vec4(sqrt(acc.xyz), acc.w);\n    }\n  "+a);ya(this,this.progFast);ya(this,this.progSlow)};p.setCamera=function(a,b){this.rotation=a;this.scale=b};p.resize=function(){var a=this.canvas.getBoundingClientRect();this.canvas.width=a.width*devicePixelRatio;this.canvas.height=a.height*devicePixelRatio;this.gl.viewport(0,0,this.canvas.width,this.canvas.height)};p.render=function(a){var b=this.gl;b.disable(b.BLEND);var c=a?this.progFast:this.progSlow;b.useProgram(c);var d=this.scale/Math.sqrt(b.drawingBufferWidth*b.drawingBufferHeight),e=d*b.drawingBufferWidth,f=d*b.drawingBufferHeight;b.uniformMatrix3fv(b.getUniformLocation(c,"uRot"),!1,this.rotation);b.uniform2f(b.getUniformLocation(c,"uScale"),e,f);b.uniform1f(b.getUniformLocation(c,"uPxSize"),2*d);this.orientation||(this.orientation=P());b.uniformMatrix3fv(b.getUniformLocation(c,"uRot"),!1,O(this.rotation,this.orientation));b.enableVertexAttribArray(0);b.bindBuffer(b.ARRAY_BUFFER,this.vbo);b.vertexAttribPointer(0,2,b.FLOAT,!1,0,0);b.activeTexture(b.TEXTURE0);b.bindTexture(b.TEXTURE_2D,this.tex);b.uniform1i(b.getUniformLocation(c,"uTex"),0);b.drawArrays(b.TRIANGLE_STRIP,0,4);b.bindTexture(b.TEXTURE_2D,null);b.bindBuffer(b.ARRAY_BUFFER,null);b.useProgram(null)};function S(a,b,c){a=a.gl;a.shaderSource(b,c);a.compileShader(b);var d=a.getShaderInfoLog(b);0<d.length&&console.log(d)}function ya(a,b){a=a.gl;a.linkProgram(b);b=a.getProgramInfoLog(b);0<b.length&&console.log(b)}new Set(["c","v","a","ad"]);
/* Copyright (c) 2014 The Polymer Project Authors. All rights reserved. Use of this source code is governed by a BSD-style license that can be found in the LICENSE file or at https://developers.google.com/open-source/licenses/bsd */function za(a){var b=void 0===b?NaN:b;var c=(a=a.toLowerCase().match(/^([0-9\.]+)\s*(s|ms)$/))?a[2]:void 0;return!a||3!==a.length||"s"!==c&&"ms"!==c?b:Math.round(("s"==c?1e3:1)*parseFloat(a?a[1]:void 0))}var Aa=['<button class=i-amphtml-story-360-activate-button role=button><span class=i-amphtml-story-360-activate-text></span> <span class=i-amphtml-story-360-activate-button-icon>360Â° <svg class=i-amphtml-story-360-activate-button-icon-svg xmlns=http://www.w3.org/2000/svg width=24 height=24 viewBox="0 0 24 24" fill=none><defs><linearGradient id=i-amphtml-story-360-activate-gradient><stop stop-color=white stop-opacity=.3></stop><stop offset=1 stop-color=white></stop></linearGradient><ellipse id=i-amphtml-story-360-activate-ellipse ry=11.5 rx=7.5 cy=12 cx=12 stroke=url(#i-amphtml-story-360-activate-gradient)></ellipse></defs><use xlink:href=#i-amphtml-story-360-activate-ellipse></use><use xlink:href=#i-amphtml-story-360-activate-ellipse transform="rotate(90, 12, 12)"></use></svg></span></button>'],Ba=["<div class=i-amphtml-story-360-discovery aria-live=polite><div class=i-amphtml-story-360-discovery-animation></div><span class=i-amphtml-story-360-discovery-text></span></div>"];function T(a,b,c){this.theta=a;this.phi=b;this.scale=c}q.Object.defineProperties(T.prototype,{rotation:{configurable:!0,enumerable:!0,get:function(){return O(Q(1,2,this.theta),Q(0,1,this.phi))}}});function Ca(a,b){this.maxFrame=.06*a;this.orientations=b;this.currentFrame=this.currentHeadingIndex=0;this.framesPerSection=this.maxFrame/(b.length-1)}Ca.prototype.getNextOrientation=function(){if(0>this.currentHeadingIndex||this.currentFrame==this.maxFrame-1)return null;this.currentFrame++;if(this.currentFrame>=(this.currentHeadingIndex+1)*this.framesPerSection)return this.currentHeadingIndex++,this.currentHeadingIndex==this.orientations.length?(this.currentHeadingIndex=-1,null):this.orientations[this.currentHeadingIndex];var a=this.orientations[this.currentHeadingIndex+1],b=this.orientations[this.currentHeadingIndex];if(!a)return this.currentHeadingIndex=-1,null;var c=this.currentFrame%this.framesPerSection/this.framesPerSection;c=.5>c?2*c*c:1-Math.pow(-2*c+2,2)/2;return new T(b.theta+(a.theta-b.theta)*c,b.phi+(a.phi-b.phi)*c,b.scale+(a.scale-b.scale)*c)};function U(a){a=AMP.BaseElement.call(this,a)||this;a.N=null;a.B=[];a.L=0;a.C=null;a.h=null;a.D=null;a.o=!1;a.H=!1;a.F=!1;a.A=null;a.J=null;a.P=null;a.G=!1;a.K=null;a.S=0;a.T=0;a.U=0;a.j=null;a.M=null;a.R=0;a.O=null;a.I=null;return a}var V=AMP.BaseElement;U.prototype=aa(V.prototype);U.prototype.constructor=U;if(w)w(U,V);else for(var W in V)if("prototype"!=W)if(Object.defineProperties){var Da=Object.getOwnPropertyDescriptor(V,W);Da&&Object.defineProperty(U,W,Da)}else U[W]=V[W];U.V=V.prototype;U.prototype.buildCallback=function(){function a(l,n){var D=n=void 0===n?0:n;return parseFloat(b(l)||D)}function b(l){return c.element.getAttribute(l)}var c=this;b("duration")&&(this.L=za(b("duration"))||0);var d=a("heading-start"),e=a("pitch-start"),f=a("zoom-start",1);this.B.push(new T((-e-90)*Math.PI/180,(90+d)*Math.PI/180,1/f));if(void 0!==b("heading-end")||void 0!==b("pitch-end")||void 0!==b("zoom-end")){var g=a("heading-end",d),h=a("pitch-end",e),m=a("zoom-end",f);this.B.push(new T((-h-90)*Math.PI/180,(90+g)*Math.PI/180,1/m))}if(void 0!==b("scene-heading")||void 0!==b("scene-pitch")||void 0!==b("scene-roll"))this.S=a("scene-heading"),this.T=a("scene-pitch"),this.U=a("scene-roll");var k=this.element.ownerDocument.createElement("div");this.C=this.element.ownerDocument.createElement("canvas");this.element.appendChild(k);k.appendChild(this.C);k.classList.add("i-amphtml-fill-content");k.classList.add("i-amphtml-replaced-content");k={attributes:!0,attributeFilter:["distance"]};var r=new MutationObserver((function(l){c.K=parseInt(l[0].target.getAttribute("distance"),10);c.h&&(2>c.K?c.h.gl.isContextLost()&&c.O.restoreContext():c.h.gl.isContextLost()||c.O.loseContext())}));X(this)&&r.observe(X(this),k);return Promise.all([sa(this.win).then((function(l){c.J=l;l.subscribe("pageSize",(function(){return Ea(c)}));"gyroscope"===b("controls")&&(l.subscribe("gyroscopePermissionState",(function(n){return Fa(c,n)})),Ga(c));l.subscribe("currentPageId",(function(n){null==c.P&&(c.P=X(c).getAttribute("id"));c.G=n===c.P;c.G?Ha(c):(c.o=!1,Ia(c));Ja(c)}));c.J.subscribe("pausedState",(function(n){c.G&&(n?c.o=!1:Ha(c))}))})),pa(oa(this.element),"localization").then((function(l){c.N=l}))])};function X(a){return da(a.element,(function(b){return"amp-story-page"===b.tagName.toLowerCase()}))}function Fa(a,b){a.A&&a.mutateElement((function(){X(a).removeChild(a.A);a.A=null}));"granted"===b?Ka(a):"denied"===b&&(a.F=!1)}function Ga(a){"undefined"!==typeof a.win.DeviceOrientationEvent&&("undefined"===typeof a.win.DeviceOrientationEvent.requestPermission&&Ka(a),"function"===typeof a.win.DeviceOrientationEvent.requestPermission&&a.win.DeviceOrientationEvent.requestPermission().catch((function(){La(a)})).then((function(b){b&&Ma(a,b)})))}function Ka(a){xa(a.win,"deviceorientation").then((function(b){a.F=!0;Na(a,b.alpha);var c;a.win.addEventListener("deviceorientation",(function(d){a.H&&2>a.K&&(c&&a.win.cancelAnimationFrame(c),c=a.win.requestAnimationFrame((function(){a.G||Na(a,d.alpha);Oa(a,d)})))}));Ja(a)}))}function Na(a,b){a.R=parseFloat(a.element.getAttribute("heading-end")||a.element.getAttribute("heading-start")||0)+90+b}function Ja(a){if(a.G&&a.F&&!a.element.ownerDocument.querySelector(".i-amphtml-story-360-discovery")){var b=X(a),c=b&&B(b)(Ba);a.mutateElement((function(){c.querySelector(".i-amphtml-story-360-discovery-text").textContent=a.N.getLocalizedString("96")}));a.mutateElement((function(){return b.appendChild(c)}))}}function Oa(a,b){var c=P();c=O(Q(1,0,(b.alpha-a.R)*Math.PI/180),c);c=O(Q(2,1,b.beta*Math.PI/180),c);c=O(Q(0,2,b.gamma*Math.PI/180),c);a.I=a.I?c.map((function(d,e){return(d+a.I[e])/2})):c;a.h.setCamera(a.I,1);a.h.render(!0)}function La(a){var b=X(a);a.A=b&&B(b)(Aa);a.A.querySelector(".i-amphtml-story-360-activate-text").textContent=a.N.getLocalizedString("83");a.A.addEventListener("click",(function(){return Pa(a)}));a.mutateElement((function(){return b.appendChild(a.A)}))}function Pa(a){a.win.DeviceOrientationEvent.requestPermission&&a.win.DeviceOrientationEvent.requestPermission().then((function(b){Ma(a,b)})).catch((function(b){(F.dev||(F.dev=G())).error("AMP_STORY_360","Gyroscope permission error: "+b.message)}))}function Ma(a,b){"granted"===b?a.J.dispatch("setGyroscopePermission","granted"):"denied"===b&&a.J.dispatch("setGyroscopePermission","denied")}U.prototype.isLayoutSupported=function(a){return"fixed"==a||"fixed-height"==a||"responsive"==a||"fill"==a||"flex-item"==a||"fluid"==a||"intrinsic"==a};U.prototype.layoutCallback=function(){var a=this.element.querySelector("amp-img");this.j=this.element.querySelector("amp-video");var b=a||this.j;I(b,"amp-story-360 must contain an amp-img or amp-video element.");b&&Qa(this,b);if(a)return Ra(this,a);if(this.j)return Sa(this)};function Qa(a,b){var c=["alt","title","aria-label"].find((function(e){return b.getAttribute(e)}));if(c){var d=b.getAttribute(c);a.C.setAttribute("role","img");a.C.setAttribute("aria-label",d)}}function Ra(a,b){var c=na(a.element);c.setOwner(b,a.element);c.scheduleLayout(a.element,b);return z(b).then((function(){return b.signals().whenSignal("load-end")})).then((function(){a.h=new R(a.C);Ta(a);var d=a.element.querySelector("img");var e=a.h.gl.getParameter(a.h.gl.MAX_TEXTURE_SIZE);if(d.naturalWidth>e||d.naturalHeight>e){var f=document.createElement("canvas"),g=f.getContext("2d");f.width=Math.min(d.naturalWidth,e);f.height=Math.min(d.naturalHeight,e);g.drawImage(d,0,0,f.width,f.height);d=f}a.M=d;Y(a)}),(function(){H().error("AMP_STORY_360","Failed to load the amp-img.")}))}function Sa(a){return z(a.j).then((function(){return a.j.signals().whenSignal("load-end")})).then((function(){if(2<=a.j.querySelector("video").readyState){x||(x=Promise.resolve(void 0));var b=x}else b=xa(a.j,"loadeddata");return b})).then((function(){a.h=new R(a.C);Ta(a);Y(a)}),(function(){H().error("AMP_STORY_360","Failed to load the amp-video.")}))}function Ta(a){a.O=a.h.gl.getExtension("WEBGL_lose_context");a.h.canvas.addEventListener("webglcontextlost",(function(b){b.preventDefault();a.H=!1}));a.h.canvas.addEventListener("webglcontextrestored",(function(){return Y(a)}))}function Y(a){a.h.init();a.h.setImageOrientation(a.S,a.T,a.U);a.h.setImage(a.M?a.M:a.j.querySelector("video"));a.h.resize();1>a.B.length||(Ua(a),a.H=!0,a.o&&Z(a),Va(a))}function Va(a){a.mutateElement((function(){a.element.classList.add("i-amphtml-story-360-loaded")}))}function Ea(a){a.mutateElement((function(){a.h&&(a.h.resize(),a.o||a.h.render(!1))}))}function Ua(a){a.F||a.mutateElement((function(){a.h.setCamera(a.B[0].rotation,a.B[0].scale);a.h.render(!1)}))}function Z(a){function b(){if(a.o&&a.D){var c=a.D.getNextOrientation();a.win.requestAnimationFrame((function(){if(c||a.j){c&&!a.F&&a.h.setCamera(c.rotation,c.scale);if(a.j){var d=a.j.querySelector("video");2<=d.readyState&&a.h.setImage(d)}a.h.render(!0);b()}else a.o=!1,a.h.render(!1)}))}else a.h.render(!1)}a.D||(a.D=new Ca(a.L,a.B));a.mutateElement((function(){return b()}))}function Ha(a){a.canAnimate&&(I(a.canAnimate,"amp-story-360 is either not configured to play an animation or still loading content."),a.o=!0,a.H&&Z(a))}function Ia(a){a.canAnimate&&(a.D=null,a.H&&a.win.requestAnimationFrame((function(){Ua(a);a.o&&Z(a)})))}q.Object.defineProperties(U.prototype,{canAnimate:{configurable:!0,enumerable:!0,get:function(){return 0<this.L&&1<this.B.length}}});AMP.registerElement("amp-story-360",U,'amp-story-360 canvas{position:absolute;width:100%!important;height:100%!important}amp-story-360 amp-img{opacity:0!important}.i-amphtml-story-360-activate-button{position:absolute!important;bottom:12px!important;right:12px!important;background:rgba(0,0,0,.8)!important;color:#fff!important;outline:none!important;border:none!important;padding:6px 6px 6px 10px!important;border-radius:18px!important;font-size:12px!important;font-family:Roboto,sans-serif!important;z-index:100000!important}.i-amphtml-story-360-activate-button,.i-amphtml-story-360-activate-button-icon{display:-ms-flexbox!important;display:flex!important;-ms-flex-align:center!important;align-items:center!important}.i-amphtml-story-360-activate-button-icon{box-sizing:border-box!important;margin-left:5px!important;font-size:6px!important;width:24px!important;height:24px!important;border:1px solid #fff!important;border-radius:100%!important;-ms-flex-pack:center!important;justify-content:center!important;font-weight:700!important;position:relative!important}.i-amphtml-story-360-activate-button-icon-svg{position:absolute!important;width:calc(100% + 2px)!important;height:calc(100% + 2px)!important;left:-1px!important;top:-1px!important}[active] .i-amphtml-story-360-activate-button-icon-svg{animation:rotate 1s 1s!important}@keyframes rotate{to{transform:rotate(360deg)}}.i-amphtml-story-360-discovery{pointer-events:none!important;position:absolute!important;bottom:0!important;left:0!important;width:100%!important;height:66%!important;perspective:550px!important;perspective-origin:center calc(100% - 145px)!important;background:linear-gradient(transparent,rgba(0,0,0,.9))!important;animation:fadeOut 1s ease-in-out 4s forwards!important;z-index:100000!important}@keyframes fadeOut{0%{opacity:1}to{opacity:0}}.i-amphtml-story-360-discovery-animation{position:absolute!important;bottom:95px!important;left:calc(50% - 30px)!important;width:55px!important;height:100px!important;border:1px solid #fff!important;border-radius:10px!important;animation:lookAround 4s!important}.i-amphtml-story-360-discovery-animation:before{content:""!important;position:absolute!important;border-top:1px solid #fff!important;width:10px!important;top:5px!important;left:calc(50% - 5px)!important}@keyframes lookAround{0%{animation-timing-function:ease-in-out;transform:rotate3d(0,0,0,0) translateZ(0)}25%{animation-timing-function:ease-in-out;transform:rotateY(45deg) rotateX(20deg) translate3d(-100px,10px,0)}50%{animation-timing-function:ease-in-out;transform:rotateX(-40deg) translate3d(0,-50px,0)}75%{animation-timing-function:ease-in-out;transform:rotateY(-45deg) rotateX(20deg) translate3d(100px,10px,0)}to{animation-timing-function:ease-in-out;transform:rotate3d(0,0,0,0) translateZ(0)}}.i-amphtml-story-360-discovery-text{font-family:Roboto,sans-serif!important;position:absolute!important;bottom:40px!important;width:100%!important;font-size:16px!important;text-align:center!important;color:#fff!important}\n/*# sourceURL=/extensions/amp-story-360/0.1/amp-story-360.css*/')}});//# sourceMappingURL=amp-story-360-0.1.js.map