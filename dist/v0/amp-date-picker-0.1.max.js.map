{
  "version": 3,
  "sources": ["../../node_modules/rrule/dist/es5/rrule.js", "../../src/core/data-structures/promise.js", "../../src/core/mode/prod.js", "../../src/core/mode/test.js", "../../src/core/mode/minified.js", "../../src/core/mode/esm.js", "../../src/core/types/array.js", "../../src/core/types/string/index.js", "../../src/core/types/object/index.js", "../../src/core/types/index.js", "../../src/core/error/message-helpers.js", "../../src/core/assert/base.js", "../../src/core/assert/dev.js", "../../src/core/constants/action-constants.js", "../../src/core/constants/amp-events.js", "../../src/core/constants/key-codes.js", "../../src/core/data-structures/finite-state-machine.js", "../../src/core/window/index.js", "../../third_party/css-escape/css-escape.js", "../../src/core/dom/css-selectors.js", "../../src/core/dom/query.js", "../../src/core/dom/index.js", "../../src/core/dom/layout/index.js", "../../src/core/dom/style.js", "../../src/core/types/function/index.js", "../../src/config.js", "../../src/service/extension-script.js", "../../src/utils/log.js", "../../src/service-helpers.js", "../../src/element-service.js", "../../src/service/index.js", "../../src/core/dom/event-helper-listen.js", "../../src/utils/event-helper.js", "../../extensions/amp-date-picker/0.1/constants.js", "../../src/module.js", "../../extensions/amp-date-picker/0.1/date-picker-common.js", "../../extensions/amp-date-picker/0.1/defaultPhrases.js", "../../extensions/amp-date-picker/0.1/wrappers/maximum-nights.js", "../../extensions/amp-date-picker/0.1/date-range-picker.js", "../../extensions/amp-date-picker/0.1/dates-list.js", "../../extensions/amp-date-picker/0.1/react-utils.js", "../../extensions/amp-date-picker/0.1/single-date-picker.js", "../../build/amp-date-picker-0.1.css.js", "../../src/core/data-structures/lru-cache.js", "../../src/url.js", "../../src/batched-json.js", "../../extensions/amp-date-picker/0.1/amp-date-picker.js"],
  "sourcesContent": ["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"rrule\"] = factory();\n\telse\n\t\troot[\"rrule\"] = factory();\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// define __esModule on exports\n/******/ \t__webpack_require__.r = function(exports) {\n/******/ \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n/******/ \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n/******/ \t\t}\n/******/ \t\tObject.defineProperty(exports, '__esModule', { value: true });\n/******/ \t};\n/******/\n/******/ \t// create a fake namespace object\n/******/ \t// mode & 1: value is a module id, require it\n/******/ \t// mode & 2: merge all properties of value into the ns\n/******/ \t// mode & 4: return value when already ns object\n/******/ \t// mode & 8|1: behave like require\n/******/ \t__webpack_require__.t = function(value, mode) {\n/******/ \t\tif(mode & 1) value = __webpack_require__(value);\n/******/ \t\tif(mode & 8) return value;\n/******/ \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n/******/ \t\tvar ns = Object.create(null);\n/******/ \t\t__webpack_require__.r(ns);\n/******/ \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n/******/ \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n/******/ \t\treturn ns;\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n__webpack_require__.r(__webpack_exports__);\n\n// CONCATENATED MODULE: ./src/weekday.ts\n// =============================================================================\n// Weekday\n// =============================================================================\nvar ALL_WEEKDAYS = ['MO', 'TU', 'WE', 'TH', 'FR', 'SA', 'SU'];\nvar Weekday = /** @class */ (function () {\n    function Weekday(weekday, n) {\n        if (n === 0)\n            throw new Error(\"Can't create weekday with n == 0\");\n        this.weekday = weekday;\n        this.n = n;\n    }\n    Weekday.fromStr = function (str) {\n        return new Weekday(ALL_WEEKDAYS.indexOf(str));\n    };\n    // __call__ - Cannot call the object directly, do it through\n    // e.g. RRule.TH.nth(-1) instead,\n    Weekday.prototype.nth = function (n) {\n        return this.n === n ? this : new Weekday(this.weekday, n);\n    };\n    // __eq__\n    Weekday.prototype.equals = function (other) {\n        return this.weekday === other.weekday && this.n === other.n;\n    };\n    // __repr__\n    Weekday.prototype.toString = function () {\n        var s = ALL_WEEKDAYS[this.weekday];\n        if (this.n)\n            s = (this.n > 0 ? '+' : '') + String(this.n) + s;\n        return s;\n    };\n    Weekday.prototype.getJsWeekday = function () {\n        return this.weekday === 6 ? 0 : this.weekday + 1;\n    };\n    return Weekday;\n}());\n\n\n// CONCATENATED MODULE: ./src/helpers.ts\n// =============================================================================\n// Helper functions\n// =============================================================================\n\nvar isPresent = function (value) {\n    return value !== null && value !== undefined;\n};\nvar isNumber = function (value) {\n    return typeof value === 'number';\n};\nvar isWeekdayStr = function (value) {\n    return ALL_WEEKDAYS.indexOf(value) >= 0;\n};\nvar isArray = Array.isArray;\n/**\n * Simplified version of python's range()\n */\nvar range = function (start, end) {\n    if (end === void 0) { end = start; }\n    if (arguments.length === 1) {\n        end = start;\n        start = 0;\n    }\n    var rang = [];\n    for (var i = start; i < end; i++)\n        rang.push(i);\n    return rang;\n};\nvar clone = function (array) {\n    return [].concat(array);\n};\nvar repeat = function (value, times) {\n    var i = 0;\n    var array = [];\n    if (isArray(value)) {\n        for (; i < times; i++)\n            array[i] = [].concat(value);\n    }\n    else {\n        for (; i < times; i++)\n            array[i] = value;\n    }\n    return array;\n};\nvar toArray = function (item) {\n    if (isArray(item)) {\n        return item;\n    }\n    return [item];\n};\nfunction padStart(item, targetLength, padString) {\n    if (padString === void 0) { padString = ' '; }\n    var str = String(item);\n    targetLength = targetLength >> 0;\n    if (str.length > targetLength) {\n        return String(str);\n    }\n    targetLength = targetLength - str.length;\n    if (targetLength > padString.length) {\n        padString += repeat(padString, targetLength / padString.length);\n    }\n    return padString.slice(0, targetLength) + String(str);\n}\n/**\n * Python like split\n */\nvar split = function (str, sep, num) {\n    var splits = str.split(sep);\n    return num\n        ? splits.slice(0, num).concat([splits.slice(num).join(sep)])\n        : splits;\n};\n/**\n * closure/goog/math/math.js:modulo\n * Copyright 2006 The Closure Library Authors.\n * The % operator in JavaScript returns the remainder of a / b, but differs from\n * some other languages in that the result will have the same sign as the\n * dividend. For example, -1 % 8 == -1, whereas in some other languages\n * (such as Python) the result would be 7. This function emulates the more\n * correct modulo behavior, which is useful for certain applications such as\n * calculating an offset index in a circular list.\n *\n * @param {number} a The dividend.\n * @param {number} b The divisor.\n * @return {number} a % b where the result is between 0 and b (either 0 <= x < b\n *     or b < x <= 0, depending on the sign of b).\n */\nvar pymod = function (a, b) {\n    var r = a % b;\n    // If r and b differ in sign, add b to wrap the result to the correct sign.\n    return r * b < 0 ? r + b : r;\n};\n/**\n * @see: <http://docs.python.org/library/functions.html#divmod>\n */\nvar divmod = function (a, b) {\n    return { div: Math.floor(a / b), mod: pymod(a, b) };\n};\nvar empty = function (obj) {\n    return !isPresent(obj) || obj.length === 0;\n};\n/**\n * Python-like boolean\n * @return {Boolean} value of an object/primitive, taking into account\n * the fact that in Python an empty list's/tuple's\n * boolean value is False, whereas in JS it's true\n */\nvar notEmpty = function (obj) {\n    return !empty(obj);\n};\n/**\n * Return true if a value is in an array\n */\nvar includes = function (arr, val) {\n    return notEmpty(arr) && arr.indexOf(val) !== -1;\n};\n\n// CONCATENATED MODULE: ./src/dateutil.ts\n\n/**\n * General date-related utilities.\n * Also handles several incompatibilities between JavaScript and Python\n *\n */\nvar dateutil_dateutil;\n(function (dateutil) {\n    dateutil.MONTH_DAYS = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];\n    /**\n     * Number of milliseconds of one day\n     */\n    dateutil.ONE_DAY = 1000 * 60 * 60 * 24;\n    /**\n     * @see: <http://docs.python.org/library/datetime.html#datetime.MAXYEAR>\n     */\n    dateutil.MAXYEAR = 9999;\n    /**\n     * Python uses 1-Jan-1 as the base for calculating ordinals but we don't\n     * want to confuse the JS engine with milliseconds > Number.MAX_NUMBER,\n     * therefore we use 1-Jan-1970 instead\n     */\n    dateutil.ORDINAL_BASE = new Date(Date.UTC(1970, 0, 1));\n    /**\n     * Python: MO-SU: 0 - 6\n     * JS: SU-SAT 0 - 6\n     */\n    dateutil.PY_WEEKDAYS = [6, 0, 1, 2, 3, 4, 5];\n    /**\n     * py_date.timetuple()[7]\n     */\n    dateutil.getYearDay = function (date) {\n        var dateNoTime = new Date(date.getUTCFullYear(), date.getUTCMonth(), date.getUTCDate());\n        return (Math.ceil((dateNoTime.valueOf() -\n            new Date(date.getUTCFullYear(), 0, 1).valueOf()) /\n            dateutil.ONE_DAY) + 1);\n    };\n    dateutil.isLeapYear = function (year) {\n        return (year % 4 === 0 && year % 100 !== 0) || year % 400 === 0;\n    };\n    dateutil.isDate = function (value) {\n        return value instanceof Date;\n    };\n    dateutil.isValidDate = function (value) {\n        return dateutil.isDate(value) && !isNaN(value.getTime());\n    };\n    /**\n     * @return {Number} the date's timezone offset in ms\n     */\n    dateutil.tzOffset = function (date) {\n        return date.getTimezoneOffset() * 60 * 1000;\n    };\n    /**\n     * @see: <http://www.mcfedries.com/JavaScript/DaysBetween.asp>\n     */\n    dateutil.daysBetween = function (date1, date2) {\n        // The number of milliseconds in one day\n        // Convert both dates to milliseconds\n        var date1ms = date1.getTime() - dateutil.tzOffset(date1);\n        var date2ms = date2.getTime() - dateutil.tzOffset(date2);\n        // Calculate the difference in milliseconds\n        var differencems = date1ms - date2ms;\n        // Convert back to days and return\n        return Math.round(differencems / dateutil.ONE_DAY);\n    };\n    /**\n     * @see: <http://docs.python.org/library/datetime.html#datetime.date.toordinal>\n     */\n    dateutil.toOrdinal = function (date) {\n        return dateutil.daysBetween(date, dateutil.ORDINAL_BASE);\n    };\n    /**\n     * @see - <http://docs.python.org/library/datetime.html#datetime.date.fromordinal>\n     */\n    dateutil.fromOrdinal = function (ordinal) {\n        return new Date(dateutil.ORDINAL_BASE.getTime() + ordinal * dateutil.ONE_DAY);\n    };\n    dateutil.getMonthDays = function (date) {\n        var month = date.getUTCMonth();\n        return month === 1 && dateutil.isLeapYear(date.getUTCFullYear())\n            ? 29\n            : dateutil.MONTH_DAYS[month];\n    };\n    /**\n     * @return {Number} python-like weekday\n     */\n    dateutil.getWeekday = function (date) {\n        return dateutil.PY_WEEKDAYS[date.getUTCDay()];\n    };\n    /**\n     * @see: <http://docs.python.org/library/calendar.html#calendar.monthrange>\n     */\n    dateutil.monthRange = function (year, month) {\n        var date = new Date(Date.UTC(year, month, 1));\n        return [dateutil.getWeekday(date), dateutil.getMonthDays(date)];\n    };\n    /**\n     * @see: <http://docs.python.org/library/datetime.html#datetime.datetime.combine>\n     */\n    dateutil.combine = function (date, time) {\n        time = time || date;\n        return new Date(Date.UTC(date.getUTCFullYear(), date.getUTCMonth(), date.getUTCDate(), time.getHours(), time.getMinutes(), time.getSeconds(), time.getMilliseconds()));\n    };\n    dateutil.clone = function (date) {\n        var dolly = new Date(date.getTime());\n        return dolly;\n    };\n    dateutil.cloneDates = function (dates) {\n        var clones = [];\n        for (var i = 0; i < dates.length; i++) {\n            clones.push(dateutil.clone(dates[i]));\n        }\n        return clones;\n    };\n    /**\n     * Sorts an array of Date or dateutil.Time objects\n     */\n    dateutil.sort = function (dates) {\n        dates.sort(function (a, b) {\n            return a.getTime() - b.getTime();\n        });\n    };\n    dateutil.timeToUntilString = function (time, utc) {\n        if (utc === void 0) { utc = true; }\n        var date = new Date(time);\n        return [\n            padStart(date.getUTCFullYear().toString(), 4, '0'),\n            padStart(date.getUTCMonth() + 1, 2, '0'),\n            padStart(date.getUTCDate(), 2, '0'),\n            'T',\n            padStart(date.getUTCHours(), 2, '0'),\n            padStart(date.getUTCMinutes(), 2, '0'),\n            padStart(date.getUTCSeconds(), 2, '0'),\n            utc ? 'Z' : ''\n        ].join('');\n    };\n    dateutil.untilStringToDate = function (until) {\n        var re = /^(\\d{4})(\\d{2})(\\d{2})(T(\\d{2})(\\d{2})(\\d{2})Z?)?$/;\n        var bits = re.exec(until);\n        if (!bits)\n            throw new Error(\"Invalid UNTIL value: \" + until);\n        return new Date(Date.UTC(parseInt(bits[1], 10), parseInt(bits[2], 10) - 1, parseInt(bits[3], 10), parseInt(bits[5], 10) || 0, parseInt(bits[6], 10) || 0, parseInt(bits[7], 10) || 0));\n    };\n})(dateutil_dateutil || (dateutil_dateutil = {}));\n/* harmony default export */ var src_dateutil = (dateutil_dateutil);\n\n// CONCATENATED MODULE: ./src/iterresult.ts\n/**\n * This class helps us to emulate python's generators, sorta.\n */\nvar IterResult = /** @class */ (function () {\n    function IterResult(method, args) {\n        this.minDate = null;\n        this.maxDate = null;\n        this._result = [];\n        this.total = 0;\n        this.method = method;\n        this.args = args;\n        if (method === 'between') {\n            this.maxDate = args.inc\n                ? args.before\n                : new Date(args.before.getTime() - 1);\n            this.minDate = args.inc ? args.after : new Date(args.after.getTime() + 1);\n        }\n        else if (method === 'before') {\n            this.maxDate = args.inc ? args.dt : new Date(args.dt.getTime() - 1);\n        }\n        else if (method === 'after') {\n            this.minDate = args.inc ? args.dt : new Date(args.dt.getTime() + 1);\n        }\n    }\n    /**\n     * Possibly adds a date into the result.\n     *\n     * @param {Date} date - the date isn't necessarly added to the result\n     *                      list (if it is too late/too early)\n     * @return {Boolean} true if it makes sense to continue the iteration\n     *                   false if we're done.\n     */\n    IterResult.prototype.accept = function (date) {\n        ++this.total;\n        var tooEarly = this.minDate && date < this.minDate;\n        var tooLate = this.maxDate && date > this.maxDate;\n        if (this.method === 'between') {\n            if (tooEarly)\n                return true;\n            if (tooLate)\n                return false;\n        }\n        else if (this.method === 'before') {\n            if (tooLate)\n                return false;\n        }\n        else if (this.method === 'after') {\n            if (tooEarly)\n                return true;\n            this.add(date);\n            return false;\n        }\n        return this.add(date);\n    };\n    /**\n     *\n     * @param {Date} date that is part of the result.\n     * @return {Boolean} whether we are interested in more values.\n     */\n    IterResult.prototype.add = function (date) {\n        this._result.push(date);\n        return true;\n    };\n    /**\n     * 'before' and 'after' return only one date, whereas 'all'\n     * and 'between' an array.\n     * @return {Date,Array?}\n     */\n    IterResult.prototype.getValue = function () {\n        var res = this._result;\n        switch (this.method) {\n            case 'all':\n            case 'between':\n                return res;\n            case 'before':\n            case 'after':\n            default:\n                return (res.length ? res[res.length - 1] : null);\n        }\n    };\n    IterResult.prototype.clone = function () {\n        return new IterResult(this.method, this.args);\n    };\n    return IterResult;\n}());\n/* harmony default export */ var iterresult = (IterResult);\n\n// CONCATENATED MODULE: ./node_modules/tslib/tslib.es6.js\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nfunction __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nvar __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nfunction __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nfunction __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nfunction __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nfunction __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nfunction __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nfunction __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nfunction __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nfunction __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nfunction __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nfunction __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nfunction __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nfunction __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nfunction __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nfunction __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nfunction __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nfunction __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nfunction __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nfunction __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\n// CONCATENATED MODULE: ./src/callbackiterresult.ts\n\n\n/**\n * IterResult subclass that calls a callback function on each add,\n * and stops iterating when the callback returns false.\n */\nvar callbackiterresult_CallbackIterResult = /** @class */ (function (_super) {\n    __extends(CallbackIterResult, _super);\n    function CallbackIterResult(method, args, iterator) {\n        var _this = _super.call(this, method, args) || this;\n        _this.iterator = iterator;\n        return _this;\n    }\n    CallbackIterResult.prototype.add = function (date) {\n        if (this.iterator(date, this._result.length)) {\n            this._result.push(date);\n            return true;\n        }\n        return false;\n    };\n    return CallbackIterResult;\n}(iterresult));\n/* harmony default export */ var callbackiterresult = (callbackiterresult_CallbackIterResult);\n\n// CONCATENATED MODULE: ./src/nlp/i18n.ts\n// =============================================================================\n// i18n\n// =============================================================================\nvar ENGLISH = {\n    dayNames: [\n        'Sunday', 'Monday', 'Tuesday', 'Wednesday',\n        'Thursday', 'Friday', 'Saturday'\n    ],\n    monthNames: [\n        'January', 'February', 'March', 'April', 'May',\n        'June', 'July', 'August', 'September', 'October',\n        'November', 'December'\n    ],\n    tokens: {\n        'SKIP': /^[ \\r\\n\\t]+|^\\.$/,\n        'number': /^[1-9][0-9]*/,\n        'numberAsText': /^(one|two|three)/i,\n        'every': /^every/i,\n        'day(s)': /^days?/i,\n        'weekday(s)': /^weekdays?/i,\n        'week(s)': /^weeks?/i,\n        'hour(s)': /^hours?/i,\n        'minute(s)': /^minutes?/i,\n        'month(s)': /^months?/i,\n        'year(s)': /^years?/i,\n        'on': /^(on|in)/i,\n        'at': /^(at)/i,\n        'the': /^the/i,\n        'first': /^first/i,\n        'second': /^second/i,\n        'third': /^third/i,\n        'nth': /^([1-9][0-9]*)(\\.|th|nd|rd|st)/i,\n        'last': /^last/i,\n        'for': /^for/i,\n        'time(s)': /^times?/i,\n        'until': /^(un)?til/i,\n        'monday': /^mo(n(day)?)?/i,\n        'tuesday': /^tu(e(s(day)?)?)?/i,\n        'wednesday': /^we(d(n(esday)?)?)?/i,\n        'thursday': /^th(u(r(sday)?)?)?/i,\n        'friday': /^fr(i(day)?)?/i,\n        'saturday': /^sa(t(urday)?)?/i,\n        'sunday': /^su(n(day)?)?/i,\n        'january': /^jan(uary)?/i,\n        'february': /^feb(ruary)?/i,\n        'march': /^mar(ch)?/i,\n        'april': /^apr(il)?/i,\n        'may': /^may/i,\n        'june': /^june?/i,\n        'july': /^july?/i,\n        'august': /^aug(ust)?/i,\n        'september': /^sep(t(ember)?)?/i,\n        'october': /^oct(ober)?/i,\n        'november': /^nov(ember)?/i,\n        'december': /^dec(ember)?/i,\n        'comma': /^(,\\s*|(and|or)\\s*)+/i\n    }\n};\n/* harmony default export */ var i18n = (ENGLISH);\n\n// CONCATENATED MODULE: ./src/nlp/totext.ts\n\n\n\n// =============================================================================\n// Helper functions\n// =============================================================================\n/**\n * Return true if a value is in an array\n */\nvar contains = function (arr, val) {\n    return arr.indexOf(val) !== -1;\n};\nvar defaultGetText = function (id) { return id.toString(); };\nvar defaultDateFormatter = function (year, month, day) { return month + \" \" + day + \", \" + year; };\n/**\n *\n * @param {RRule} rrule\n * Optional:\n * @param {Function} gettext function\n * @param {Object} language definition\n * @constructor\n */\nvar totext_ToText = /** @class */ (function () {\n    function ToText(rrule, gettext, language, dateFormatter) {\n        if (gettext === void 0) { gettext = defaultGetText; }\n        if (language === void 0) { language = i18n; }\n        if (dateFormatter === void 0) { dateFormatter = defaultDateFormatter; }\n        this.text = [];\n        this.language = language || i18n;\n        this.gettext = gettext;\n        this.dateFormatter = dateFormatter;\n        this.rrule = rrule;\n        this.options = rrule.options;\n        this.origOptions = rrule.origOptions;\n        if (this.origOptions.bymonthday) {\n            var bymonthday = [].concat(this.options.bymonthday);\n            var bynmonthday = [].concat(this.options.bynmonthday);\n            bymonthday.sort(function (a, b) { return a - b; });\n            bynmonthday.sort(function (a, b) { return b - a; });\n            // 1, 2, 3, .., -5, -4, -3, ..\n            this.bymonthday = bymonthday.concat(bynmonthday);\n            if (!this.bymonthday.length)\n                this.bymonthday = null;\n        }\n        if (isPresent(this.origOptions.byweekday)) {\n            var byweekday = !isArray(this.origOptions.byweekday)\n                ? [this.origOptions.byweekday]\n                : this.origOptions.byweekday;\n            var days = String(byweekday);\n            this.byweekday = {\n                allWeeks: byweekday.filter(function (weekday) {\n                    return !weekday.n;\n                }),\n                someWeeks: byweekday.filter(function (weekday) {\n                    return Boolean(weekday.n);\n                }),\n                isWeekdays: days.indexOf('MO') !== -1 &&\n                    days.indexOf('TU') !== -1 &&\n                    days.indexOf('WE') !== -1 &&\n                    days.indexOf('TH') !== -1 &&\n                    days.indexOf('FR') !== -1 &&\n                    days.indexOf('SA') === -1 &&\n                    days.indexOf('SU') === -1,\n                isEveryDay: days.indexOf('MO') !== -1 &&\n                    days.indexOf('TU') !== -1 &&\n                    days.indexOf('WE') !== -1 &&\n                    days.indexOf('TH') !== -1 &&\n                    days.indexOf('FR') !== -1 &&\n                    days.indexOf('SA') !== -1 &&\n                    days.indexOf('SU') !== -1\n            };\n            var sortWeekDays = function (a, b) {\n                return a.weekday - b.weekday;\n            };\n            this.byweekday.allWeeks.sort(sortWeekDays);\n            this.byweekday.someWeeks.sort(sortWeekDays);\n            if (!this.byweekday.allWeeks.length)\n                this.byweekday.allWeeks = null;\n            if (!this.byweekday.someWeeks.length)\n                this.byweekday.someWeeks = null;\n        }\n        else {\n            this.byweekday = null;\n        }\n    }\n    /**\n     * Test whether the rrule can be fully converted to text.\n     * @param {RRule} rrule\n     * @return {Boolean}\n     */\n    ToText.isFullyConvertible = function (rrule) {\n        var canConvert = true;\n        if (!(rrule.options.freq in ToText.IMPLEMENTED))\n            return false;\n        if (rrule.origOptions.until && rrule.origOptions.count)\n            return false;\n        for (var key in rrule.origOptions) {\n            if (contains(['dtstart', 'wkst', 'freq'], key))\n                return true;\n            if (!contains(ToText.IMPLEMENTED[rrule.options.freq], key))\n                return false;\n        }\n        return canConvert;\n    };\n    ToText.prototype.isFullyConvertible = function () {\n        return ToText.isFullyConvertible(this.rrule);\n    };\n    /**\n     * Perform the conversion. Only some of the frequencies are supported.\n     * If some of the rrule's options aren't supported, they'll\n     * be omitted from the output an \"(~ approximate)\" will be appended.\n     * @return {*}\n     */\n    ToText.prototype.toString = function () {\n        var gettext = this.gettext;\n        if (!(this.options.freq in ToText.IMPLEMENTED)) {\n            return gettext('RRule error: Unable to fully convert this rrule to text');\n        }\n        this.text = [gettext('every')];\n        // @ts-ignore\n        this[src.FREQUENCIES[this.options.freq]]();\n        if (this.options.until) {\n            this.add(gettext('until'));\n            var until = this.options.until;\n            this.add(this.dateFormatter(until.getUTCFullYear(), this.language.monthNames[until.getUTCMonth()], until.getUTCDate()));\n        }\n        else if (this.options.count) {\n            this.add(gettext('for'))\n                .add(this.options.count.toString())\n                .add(this.plural(this.options.count) ? gettext('times') : gettext('time'));\n        }\n        if (!this.isFullyConvertible())\n            this.add(gettext('(~ approximate)'));\n        return this.text.join('');\n    };\n    ToText.prototype.HOURLY = function () {\n        var gettext = this.gettext;\n        if (this.options.interval !== 1)\n            this.add(this.options.interval.toString());\n        this.add(this.plural(this.options.interval) ? gettext('hours') : gettext('hour'));\n    };\n    ToText.prototype.MINUTELY = function () {\n        var gettext = this.gettext;\n        if (this.options.interval !== 1)\n            this.add(this.options.interval.toString());\n        this.add(this.plural(this.options.interval)\n            ? gettext('minutes')\n            : gettext('minute'));\n    };\n    ToText.prototype.DAILY = function () {\n        var gettext = this.gettext;\n        if (this.options.interval !== 1)\n            this.add(this.options.interval.toString());\n        if (this.byweekday && this.byweekday.isWeekdays) {\n            this.add(this.plural(this.options.interval)\n                ? gettext('weekdays')\n                : gettext('weekday'));\n        }\n        else {\n            this.add(this.plural(this.options.interval) ? gettext('days') : gettext('day'));\n        }\n        if (this.origOptions.bymonth) {\n            this.add(gettext('in'));\n            this._bymonth();\n        }\n        if (this.bymonthday) {\n            this._bymonthday();\n        }\n        else if (this.byweekday) {\n            this._byweekday();\n        }\n        else if (this.origOptions.byhour) {\n            this._byhour();\n        }\n    };\n    ToText.prototype.WEEKLY = function () {\n        var gettext = this.gettext;\n        if (this.options.interval !== 1) {\n            this.add(this.options.interval.toString()).add(this.plural(this.options.interval) ? gettext('weeks') : gettext('week'));\n        }\n        if (this.byweekday && this.byweekday.isWeekdays) {\n            if (this.options.interval === 1) {\n                this.add(this.plural(this.options.interval)\n                    ? gettext('weekdays')\n                    : gettext('weekday'));\n            }\n            else {\n                this.add(gettext('on')).add(gettext('weekdays'));\n            }\n        }\n        else if (this.byweekday && this.byweekday.isEveryDay) {\n            this.add(this.plural(this.options.interval) ? gettext('days') : gettext('day'));\n        }\n        else {\n            if (this.options.interval === 1)\n                this.add(gettext('week'));\n            if (this.origOptions.bymonth) {\n                this.add(gettext('in'));\n                this._bymonth();\n            }\n            if (this.bymonthday) {\n                this._bymonthday();\n            }\n            else if (this.byweekday) {\n                this._byweekday();\n            }\n        }\n    };\n    ToText.prototype.MONTHLY = function () {\n        var gettext = this.gettext;\n        if (this.origOptions.bymonth) {\n            if (this.options.interval !== 1) {\n                this.add(this.options.interval.toString()).add(gettext('months'));\n                if (this.plural(this.options.interval))\n                    this.add(gettext('in'));\n            }\n            else {\n                // this.add(gettext('MONTH'))\n            }\n            this._bymonth();\n        }\n        else {\n            if (this.options.interval !== 1)\n                this.add(this.options.interval.toString());\n            this.add(this.plural(this.options.interval)\n                ? gettext('months')\n                : gettext('month'));\n        }\n        if (this.bymonthday) {\n            this._bymonthday();\n        }\n        else if (this.byweekday && this.byweekday.isWeekdays) {\n            this.add(gettext('on')).add(gettext('weekdays'));\n        }\n        else if (this.byweekday) {\n            this._byweekday();\n        }\n    };\n    ToText.prototype.YEARLY = function () {\n        var gettext = this.gettext;\n        if (this.origOptions.bymonth) {\n            if (this.options.interval !== 1) {\n                this.add(this.options.interval.toString());\n                this.add(gettext('years'));\n            }\n            else {\n                // this.add(gettext('YEAR'))\n            }\n            this._bymonth();\n        }\n        else {\n            if (this.options.interval !== 1)\n                this.add(this.options.interval.toString());\n            this.add(this.plural(this.options.interval) ? gettext('years') : gettext('year'));\n        }\n        if (this.bymonthday) {\n            this._bymonthday();\n        }\n        else if (this.byweekday) {\n            this._byweekday();\n        }\n        if (this.options.byyearday) {\n            this.add(gettext('on the'))\n                .add(this.list(this.options.byyearday, this.nth, gettext('and')))\n                .add(gettext('day'));\n        }\n        if (this.options.byweekno) {\n            this.add(gettext('in'))\n                .add(this.plural(this.options.byweekno.length)\n                ? gettext('weeks')\n                : gettext('week'))\n                .add(this.list(this.options.byweekno, undefined, gettext('and')));\n        }\n    };\n    ToText.prototype._bymonthday = function () {\n        var gettext = this.gettext;\n        if (this.byweekday && this.byweekday.allWeeks) {\n            this.add(gettext('on'))\n                .add(this.list(this.byweekday.allWeeks, this.weekdaytext, gettext('or')))\n                .add(gettext('the'))\n                .add(this.list(this.bymonthday, this.nth, gettext('or')));\n        }\n        else {\n            this.add(gettext('on the')).add(this.list(this.bymonthday, this.nth, gettext('and')));\n        }\n        // this.add(gettext('DAY'))\n    };\n    ToText.prototype._byweekday = function () {\n        var gettext = this.gettext;\n        if (this.byweekday.allWeeks && !this.byweekday.isWeekdays) {\n            this.add(gettext('on')).add(this.list(this.byweekday.allWeeks, this.weekdaytext));\n        }\n        if (this.byweekday.someWeeks) {\n            if (this.byweekday.allWeeks)\n                this.add(gettext('and'));\n            this.add(gettext('on the')).add(this.list(this.byweekday.someWeeks, this.weekdaytext, gettext('and')));\n        }\n    };\n    ToText.prototype._byhour = function () {\n        var gettext = this.gettext;\n        this.add(gettext('at')).add(this.list(this.origOptions.byhour, undefined, gettext('and')));\n    };\n    ToText.prototype._bymonth = function () {\n        this.add(this.list(this.options.bymonth, this.monthtext, this.gettext('and')));\n    };\n    ToText.prototype.nth = function (n) {\n        n = parseInt(n.toString(), 10);\n        var nth;\n        var npos;\n        var gettext = this.gettext;\n        if (n === -1)\n            return gettext('last');\n        npos = Math.abs(n);\n        switch (npos) {\n            case 1:\n            case 21:\n            case 31:\n                nth = npos + gettext('st');\n                break;\n            case 2:\n            case 22:\n                nth = npos + gettext('nd');\n                break;\n            case 3:\n            case 23:\n                nth = npos + gettext('rd');\n                break;\n            default:\n                nth = npos + gettext('th');\n        }\n        return n < 0 ? nth + ' ' + gettext('last') : nth;\n    };\n    ToText.prototype.monthtext = function (m) {\n        return this.language.monthNames[m - 1];\n    };\n    ToText.prototype.weekdaytext = function (wday) {\n        var weekday = isNumber(wday) ? (wday + 1) % 7 : wday.getJsWeekday();\n        return ((wday.n ? this.nth(wday.n) + ' ' : '') + this.language.dayNames[weekday]);\n    };\n    ToText.prototype.plural = function (n) {\n        return n % 100 !== 1;\n    };\n    ToText.prototype.add = function (s) {\n        this.text.push(' ');\n        this.text.push(s);\n        return this;\n    };\n    ToText.prototype.list = function (arr, callback, finalDelim, delim) {\n        if (delim === void 0) { delim = ','; }\n        if (!isArray(arr)) {\n            arr = [arr];\n        }\n        var delimJoin = function (array, delimiter, finalDelimiter) {\n            var list = '';\n            for (var i = 0; i < array.length; i++) {\n                if (i !== 0) {\n                    if (i === array.length - 1) {\n                        list += ' ' + finalDelimiter + ' ';\n                    }\n                    else {\n                        list += delimiter + ' ';\n                    }\n                }\n                list += array[i];\n            }\n            return list;\n        };\n        callback =\n            callback ||\n                function (o) {\n                    return o.toString();\n                };\n        var self = this;\n        var realCallback = function (arg) {\n            return callback && callback.call(self, arg);\n        };\n        if (finalDelim) {\n            return delimJoin(arr.map(realCallback), delim, finalDelim);\n        }\n        else {\n            return arr.map(realCallback).join(delim + ' ');\n        }\n    };\n    return ToText;\n}());\n/* harmony default export */ var totext = (totext_ToText);\n\n// CONCATENATED MODULE: ./src/nlp/parsetext.ts\n\n\n// =============================================================================\n// Parser\n// =============================================================================\nvar Parser = /** @class */ (function () {\n    function Parser(rules) {\n        this.done = true;\n        this.rules = rules;\n    }\n    Parser.prototype.start = function (text) {\n        this.text = text;\n        this.done = false;\n        return this.nextSymbol();\n    };\n    Parser.prototype.isDone = function () {\n        return this.done && this.symbol === null;\n    };\n    Parser.prototype.nextSymbol = function () {\n        var best;\n        var bestSymbol;\n        var p = this;\n        this.symbol = null;\n        this.value = null;\n        do {\n            if (this.done)\n                return false;\n            var rule = void 0;\n            best = null;\n            for (var name_1 in this.rules) {\n                rule = this.rules[name_1];\n                var match = rule.exec(p.text);\n                if (match) {\n                    if (best === null || match[0].length > best[0].length) {\n                        best = match;\n                        bestSymbol = name_1;\n                    }\n                }\n            }\n            if (best != null) {\n                this.text = this.text.substr(best[0].length);\n                if (this.text === '')\n                    this.done = true;\n            }\n            if (best == null) {\n                this.done = true;\n                this.symbol = null;\n                this.value = null;\n                return;\n            }\n            // @ts-ignore\n        } while (bestSymbol === 'SKIP');\n        // @ts-ignore\n        this.symbol = bestSymbol;\n        this.value = best;\n        return true;\n    };\n    Parser.prototype.accept = function (name) {\n        if (this.symbol === name) {\n            if (this.value) {\n                var v = this.value;\n                this.nextSymbol();\n                return v;\n            }\n            this.nextSymbol();\n            return true;\n        }\n        return false;\n    };\n    Parser.prototype.acceptNumber = function () {\n        return this.accept('number');\n    };\n    Parser.prototype.expect = function (name) {\n        if (this.accept(name))\n            return true;\n        throw new Error('expected ' + name + ' but found ' + this.symbol);\n    };\n    return Parser;\n}());\nfunction parseText(text, language) {\n    if (language === void 0) { language = i18n; }\n    var options = {};\n    var ttr = new Parser(language.tokens);\n    if (!ttr.start(text))\n        return null;\n    S();\n    return options;\n    function S() {\n        // every [n]\n        ttr.expect('every');\n        var n = ttr.acceptNumber();\n        if (n)\n            options.interval = parseInt(n[0], 10);\n        if (ttr.isDone())\n            throw new Error('Unexpected end');\n        switch (ttr.symbol) {\n            case 'day(s)':\n                options.freq = src.DAILY;\n                if (ttr.nextSymbol()) {\n                    AT();\n                    F();\n                }\n                break;\n            // FIXME Note: every 2 weekdays != every two weeks on weekdays.\n            // DAILY on weekdays is not a valid rule\n            case 'weekday(s)':\n                options.freq = src.WEEKLY;\n                options.byweekday = [\n                    src.MO,\n                    src.TU,\n                    src.WE,\n                    src.TH,\n                    src.FR\n                ];\n                ttr.nextSymbol();\n                F();\n                break;\n            case 'week(s)':\n                options.freq = src.WEEKLY;\n                if (ttr.nextSymbol()) {\n                    ON();\n                    F();\n                }\n                break;\n            case 'hour(s)':\n                options.freq = src.HOURLY;\n                if (ttr.nextSymbol()) {\n                    ON();\n                    F();\n                }\n                break;\n            case 'minute(s)':\n                options.freq = src.MINUTELY;\n                if (ttr.nextSymbol()) {\n                    ON();\n                    F();\n                }\n                break;\n            case 'month(s)':\n                options.freq = src.MONTHLY;\n                if (ttr.nextSymbol()) {\n                    ON();\n                    F();\n                }\n                break;\n            case 'year(s)':\n                options.freq = src.YEARLY;\n                if (ttr.nextSymbol()) {\n                    ON();\n                    F();\n                }\n                break;\n            case 'monday':\n            case 'tuesday':\n            case 'wednesday':\n            case 'thursday':\n            case 'friday':\n            case 'saturday':\n            case 'sunday':\n                options.freq = src.WEEKLY;\n                var key = ttr.symbol.substr(0, 2).toUpperCase();\n                options.byweekday = [src[key]];\n                if (!ttr.nextSymbol())\n                    return;\n                // TODO check for duplicates\n                while (ttr.accept('comma')) {\n                    if (ttr.isDone())\n                        throw new Error('Unexpected end');\n                    var wkd = decodeWKD();\n                    if (!wkd) {\n                        throw new Error('Unexpected symbol ' + ttr.symbol + ', expected weekday');\n                    }\n                    // @ts-ignore\n                    options.byweekday.push(src[wkd]);\n                    ttr.nextSymbol();\n                }\n                MDAYs();\n                F();\n                break;\n            case 'january':\n            case 'february':\n            case 'march':\n            case 'april':\n            case 'may':\n            case 'june':\n            case 'july':\n            case 'august':\n            case 'september':\n            case 'october':\n            case 'november':\n            case 'december':\n                options.freq = src.YEARLY;\n                options.bymonth = [decodeM()];\n                if (!ttr.nextSymbol())\n                    return;\n                // TODO check for duplicates\n                while (ttr.accept('comma')) {\n                    if (ttr.isDone())\n                        throw new Error('Unexpected end');\n                    var m = decodeM();\n                    if (!m) {\n                        throw new Error('Unexpected symbol ' + ttr.symbol + ', expected month');\n                    }\n                    options.bymonth.push(m);\n                    ttr.nextSymbol();\n                }\n                ON();\n                F();\n                break;\n            default:\n                throw new Error('Unknown symbol');\n        }\n    }\n    function ON() {\n        var on = ttr.accept('on');\n        var the = ttr.accept('the');\n        if (!(on || the))\n            return;\n        do {\n            var nth = decodeNTH();\n            var wkd = decodeWKD();\n            var m = decodeM();\n            // nth <weekday> | <weekday>\n            if (nth) {\n                // ttr.nextSymbol()\n                if (wkd) {\n                    ttr.nextSymbol();\n                    if (!options.byweekday)\n                        options.byweekday = [];\n                    // @ts-ignore\n                    options.byweekday.push(src[wkd].nth(nth));\n                }\n                else {\n                    if (!options.bymonthday)\n                        options.bymonthday = [];\n                    // @ts-ignore\n                    options.bymonthday.push(nth);\n                    ttr.accept('day(s)');\n                }\n                // <weekday>\n            }\n            else if (wkd) {\n                ttr.nextSymbol();\n                if (!options.byweekday)\n                    options.byweekday = [];\n                // @ts-ignore\n                options.byweekday.push(src[wkd]);\n            }\n            else if (ttr.symbol === 'weekday(s)') {\n                ttr.nextSymbol();\n                if (!options.byweekday) {\n                    options.byweekday = [\n                        src.MO,\n                        src.TU,\n                        src.WE,\n                        src.TH,\n                        src.FR\n                    ];\n                }\n            }\n            else if (ttr.symbol === 'week(s)') {\n                ttr.nextSymbol();\n                var n = ttr.acceptNumber();\n                if (!n) {\n                    throw new Error('Unexpected symbol ' + ttr.symbol + ', expected week number');\n                }\n                options.byweekno = [parseInt(n[0], 10)];\n                while (ttr.accept('comma')) {\n                    n = ttr.acceptNumber();\n                    if (!n) {\n                        throw new Error('Unexpected symbol ' + ttr.symbol + '; expected monthday');\n                    }\n                    options.byweekno.push(parseInt(n[0], 10));\n                }\n            }\n            else if (m) {\n                ttr.nextSymbol();\n                if (!options.bymonth)\n                    options.bymonth = [];\n                // @ts-ignore\n                options.bymonth.push(m);\n            }\n            else {\n                return;\n            }\n        } while (ttr.accept('comma') || ttr.accept('the') || ttr.accept('on'));\n    }\n    function AT() {\n        var at = ttr.accept('at');\n        if (!at)\n            return;\n        do {\n            var n = ttr.acceptNumber();\n            if (!n) {\n                throw new Error('Unexpected symbol ' + ttr.symbol + ', expected hour');\n            }\n            options.byhour = [parseInt(n[0], 10)];\n            while (ttr.accept('comma')) {\n                n = ttr.acceptNumber();\n                if (!n) {\n                    throw new Error('Unexpected symbol ' + ttr.symbol + '; expected hour');\n                }\n                options.byhour.push(parseInt(n[0], 10));\n            }\n        } while (ttr.accept('comma') || ttr.accept('at'));\n    }\n    function decodeM() {\n        switch (ttr.symbol) {\n            case 'january':\n                return 1;\n            case 'february':\n                return 2;\n            case 'march':\n                return 3;\n            case 'april':\n                return 4;\n            case 'may':\n                return 5;\n            case 'june':\n                return 6;\n            case 'july':\n                return 7;\n            case 'august':\n                return 8;\n            case 'september':\n                return 9;\n            case 'october':\n                return 10;\n            case 'november':\n                return 11;\n            case 'december':\n                return 12;\n            default:\n                return false;\n        }\n    }\n    function decodeWKD() {\n        switch (ttr.symbol) {\n            case 'monday':\n            case 'tuesday':\n            case 'wednesday':\n            case 'thursday':\n            case 'friday':\n            case 'saturday':\n            case 'sunday':\n                return ttr.symbol.substr(0, 2).toUpperCase();\n            default:\n                return false;\n        }\n    }\n    function decodeNTH() {\n        switch (ttr.symbol) {\n            case 'last':\n                ttr.nextSymbol();\n                return -1;\n            case 'first':\n                ttr.nextSymbol();\n                return 1;\n            case 'second':\n                ttr.nextSymbol();\n                return ttr.accept('last') ? -2 : 2;\n            case 'third':\n                ttr.nextSymbol();\n                return ttr.accept('last') ? -3 : 3;\n            case 'nth':\n                var v = parseInt(ttr.value[1], 10);\n                if (v < -366 || v > 366)\n                    throw new Error('Nth out of range: ' + v);\n                ttr.nextSymbol();\n                return ttr.accept('last') ? -v : v;\n            default:\n                return false;\n        }\n    }\n    function MDAYs() {\n        ttr.accept('on');\n        ttr.accept('the');\n        var nth = decodeNTH();\n        if (!nth)\n            return;\n        options.bymonthday = [nth];\n        ttr.nextSymbol();\n        while (ttr.accept('comma')) {\n            nth = decodeNTH();\n            if (!nth) {\n                throw new Error('Unexpected symbol ' + ttr.symbol + '; expected monthday');\n            }\n            options.bymonthday.push(nth);\n            ttr.nextSymbol();\n        }\n    }\n    function F() {\n        if (ttr.symbol === 'until') {\n            var date = Date.parse(ttr.text);\n            if (!date)\n                throw new Error('Cannot parse until date:' + ttr.text);\n            options.until = new Date(date);\n        }\n        else if (ttr.accept('for')) {\n            options.count = parseInt(ttr.value[0], 10);\n            ttr.expect('number');\n            // ttr.expect('times')\n        }\n    }\n}\n\n// CONCATENATED MODULE: ./src/types.ts\nvar Frequency;\n(function (Frequency) {\n    Frequency[Frequency[\"YEARLY\"] = 0] = \"YEARLY\";\n    Frequency[Frequency[\"MONTHLY\"] = 1] = \"MONTHLY\";\n    Frequency[Frequency[\"WEEKLY\"] = 2] = \"WEEKLY\";\n    Frequency[Frequency[\"DAILY\"] = 3] = \"DAILY\";\n    Frequency[Frequency[\"HOURLY\"] = 4] = \"HOURLY\";\n    Frequency[Frequency[\"MINUTELY\"] = 5] = \"MINUTELY\";\n    Frequency[Frequency[\"SECONDLY\"] = 6] = \"SECONDLY\";\n})(Frequency || (Frequency = {}));\nfunction freqIsDailyOrGreater(freq) {\n    return freq < Frequency.HOURLY;\n}\n\n// CONCATENATED MODULE: ./src/nlp/index.ts\n\n\n\n\n\n/*!\n* rrule.js - Library for working with recurrence rules for calendar dates.\n* https://github.com/jakubroztocil/rrule\n*\n* Copyright 2010, Jakub Roztocil and Lars Schoning\n* Licenced under the BSD licence.\n* https://github.com/jakubroztocil/rrule/blob/master/LICENCE\n*\n*/\n/**\n *\n * Implementation of RRule.fromText() and RRule::toText().\n *\n *\n * On the client side, this file needs to be included\n * when those functions are used.\n *\n */\n// =============================================================================\n// fromText\n// =============================================================================\n/**\n * Will be able to convert some of the below described rules from\n * text format to a rule object.\n *\n *\n * RULES\n *\n * Every ([n])\n *       day(s)\n *     | [weekday], ..., (and) [weekday]\n *     | weekday(s)\n *     | week(s)\n *     | month(s)\n *     | [month], ..., (and) [month]\n *     | year(s)\n *\n *\n * Plus 0, 1, or multiple of these:\n *\n * on [weekday], ..., (or) [weekday] the [monthday], [monthday], ... (or) [monthday]\n *\n * on [weekday], ..., (and) [weekday]\n *\n * on the [monthday], [monthday], ... (and) [monthday] (day of the month)\n *\n * on the [nth-weekday], ..., (and) [nth-weekday] (of the month/year)\n *\n *\n * Plus 0 or 1 of these:\n *\n * for [n] time(s)\n *\n * until [date]\n *\n * Plus (.)\n *\n *\n * Definitely no supported for parsing:\n *\n * (for year):\n *     in week(s) [n], ..., (and) [n]\n *\n *     on the [yearday], ..., (and) [n] day of the year\n *     on day [yearday], ..., (and) [n]\n *\n *\n * NON-TERMINALS\n *\n * [n]: 1, 2 ..., one, two, three ..\n * [month]: January, February, March, April, May, ... December\n * [weekday]: Monday, ... Sunday\n * [nth-weekday]: first [weekday], 2nd [weekday], ... last [weekday], ...\n * [monthday]: first, 1., 2., 1st, 2nd, second, ... 31st, last day, 2nd last day, ..\n * [date]:\n *     [month] (0-31(,) ([year])),\n *     (the) 0-31.(1-12.([year])),\n *     (the) 0-31/(1-12/([year])),\n *     [weekday]\n *\n * [year]: 0000, 0001, ... 01, 02, ..\n *\n * Definitely not supported for parsing:\n *\n * [yearday]: first, 1., 2., 1st, 2nd, second, ... 366th, last day, 2nd last day, ..\n *\n * @param {String} text\n * @return {Object, Boolean} the rule, or null.\n */\nvar fromText = function (text, language) {\n    if (language === void 0) { language = i18n; }\n    return new src(parseText(text, language) || undefined);\n};\nvar common = [\n    'count',\n    'until',\n    'interval',\n    'byweekday',\n    'bymonthday',\n    'bymonth'\n];\ntotext.IMPLEMENTED = [];\ntotext.IMPLEMENTED[Frequency.HOURLY] = common;\ntotext.IMPLEMENTED[Frequency.MINUTELY] = common;\ntotext.IMPLEMENTED[Frequency.DAILY] = ['byhour'].concat(common);\ntotext.IMPLEMENTED[Frequency.WEEKLY] = common;\ntotext.IMPLEMENTED[Frequency.MONTHLY] = common;\ntotext.IMPLEMENTED[Frequency.YEARLY] = ['byweekno', 'byyearday'].concat(common);\n// =============================================================================\n// Export\n// =============================================================================\nvar toText = function (rrule, gettext, language, dateFormatter) {\n    return new totext(rrule, gettext, language, dateFormatter).toString();\n};\nvar isFullyConvertible = totext.isFullyConvertible;\n\n\n// CONCATENATED MODULE: ./src/datetime.ts\n\n\n\n\nvar Time = /** @class */ (function () {\n    function Time(hour, minute, second, millisecond) {\n        this.hour = hour;\n        this.minute = minute;\n        this.second = second;\n        this.millisecond = millisecond || 0;\n    }\n    Time.prototype.getHours = function () {\n        return this.hour;\n    };\n    Time.prototype.getMinutes = function () {\n        return this.minute;\n    };\n    Time.prototype.getSeconds = function () {\n        return this.second;\n    };\n    Time.prototype.getMilliseconds = function () {\n        return this.millisecond;\n    };\n    Time.prototype.getTime = function () {\n        return ((this.hour * 60 * 60 + this.minute * 60 + this.second) * 1000 +\n            this.millisecond);\n    };\n    return Time;\n}());\n\nvar datetime_DateTime = /** @class */ (function (_super) {\n    __extends(DateTime, _super);\n    function DateTime(year, month, day, hour, minute, second, millisecond) {\n        var _this = _super.call(this, hour, minute, second, millisecond) || this;\n        _this.year = year;\n        _this.month = month;\n        _this.day = day;\n        return _this;\n    }\n    DateTime.fromDate = function (date) {\n        return new this(date.getUTCFullYear(), date.getUTCMonth() + 1, date.getUTCDate(), date.getUTCHours(), date.getUTCMinutes(), date.getUTCSeconds(), date.valueOf() % 1000);\n    };\n    DateTime.prototype.getWeekday = function () {\n        return dateutil_dateutil.getWeekday(new Date(this.getTime()));\n    };\n    DateTime.prototype.getTime = function () {\n        return new Date(Date.UTC(this.year, this.month - 1, this.day, this.hour, this.minute, this.second, this.millisecond)).getTime();\n    };\n    DateTime.prototype.getDay = function () {\n        return this.day;\n    };\n    DateTime.prototype.getMonth = function () {\n        return this.month;\n    };\n    DateTime.prototype.getYear = function () {\n        return this.year;\n    };\n    DateTime.prototype.addYears = function (years) {\n        this.year += years;\n    };\n    DateTime.prototype.addMonths = function (months) {\n        this.month += months;\n        if (this.month > 12) {\n            var yearDiv = Math.floor(this.month / 12);\n            var monthMod = pymod(this.month, 12);\n            this.month = monthMod;\n            this.year += yearDiv;\n            if (this.month === 0) {\n                this.month = 12;\n                --this.year;\n            }\n        }\n    };\n    DateTime.prototype.addWeekly = function (days, wkst) {\n        if (wkst > this.getWeekday()) {\n            this.day += -(this.getWeekday() + 1 + (6 - wkst)) + days * 7;\n        }\n        else {\n            this.day += -(this.getWeekday() - wkst) + days * 7;\n        }\n        this.fixDay();\n    };\n    DateTime.prototype.addDaily = function (days) {\n        this.day += days;\n        this.fixDay();\n    };\n    DateTime.prototype.addHours = function (hours, filtered, byhour) {\n        if (filtered) {\n            // Jump to one iteration before next day\n            this.hour += Math.floor((23 - this.hour) / hours) * hours;\n        }\n        while (true) {\n            this.hour += hours;\n            var _a = divmod(this.hour, 24), dayDiv = _a.div, hourMod = _a.mod;\n            if (dayDiv) {\n                this.hour = hourMod;\n                this.addDaily(dayDiv);\n            }\n            if (empty(byhour) || includes(byhour, this.hour))\n                break;\n        }\n    };\n    DateTime.prototype.addMinutes = function (minutes, filtered, byhour, byminute) {\n        if (filtered) {\n            // Jump to one iteration before next day\n            this.minute +=\n                Math.floor((1439 - (this.hour * 60 + this.minute)) / minutes) * minutes;\n        }\n        while (true) {\n            this.minute += minutes;\n            var _a = divmod(this.minute, 60), hourDiv = _a.div, minuteMod = _a.mod;\n            if (hourDiv) {\n                this.minute = minuteMod;\n                this.addHours(hourDiv, false, byhour);\n            }\n            if ((empty(byhour) || includes(byhour, this.hour)) &&\n                (empty(byminute) || includes(byminute, this.minute))) {\n                break;\n            }\n        }\n    };\n    DateTime.prototype.addSeconds = function (seconds, filtered, byhour, byminute, bysecond) {\n        if (filtered) {\n            // Jump to one iteration before next day\n            this.second +=\n                Math.floor((86399 - (this.hour * 3600 + this.minute * 60 + this.second)) / seconds) * seconds;\n        }\n        while (true) {\n            this.second += seconds;\n            var _a = divmod(this.second, 60), minuteDiv = _a.div, secondMod = _a.mod;\n            if (minuteDiv) {\n                this.second = secondMod;\n                this.addMinutes(minuteDiv, false, byhour, byminute);\n            }\n            if ((empty(byhour) || includes(byhour, this.hour)) &&\n                (empty(byminute) || includes(byminute, this.minute)) &&\n                (empty(bysecond) || includes(bysecond, this.second))) {\n                break;\n            }\n        }\n    };\n    DateTime.prototype.fixDay = function () {\n        if (this.day <= 28) {\n            return;\n        }\n        var daysinmonth = dateutil_dateutil.monthRange(this.year, this.month - 1)[1];\n        if (this.day <= daysinmonth) {\n            return;\n        }\n        while (this.day > daysinmonth) {\n            this.day -= daysinmonth;\n            ++this.month;\n            if (this.month === 13) {\n                this.month = 1;\n                ++this.year;\n                if (this.year > dateutil_dateutil.MAXYEAR) {\n                    return;\n                }\n            }\n            daysinmonth = dateutil_dateutil.monthRange(this.year, this.month - 1)[1];\n        }\n    };\n    DateTime.prototype.add = function (options, filtered) {\n        var freq = options.freq, interval = options.interval, wkst = options.wkst, byhour = options.byhour, byminute = options.byminute, bysecond = options.bysecond;\n        switch (freq) {\n            case Frequency.YEARLY: return this.addYears(interval);\n            case Frequency.MONTHLY: return this.addMonths(interval);\n            case Frequency.WEEKLY: return this.addWeekly(interval, wkst);\n            case Frequency.DAILY: return this.addDaily(interval);\n            case Frequency.HOURLY: return this.addHours(interval, filtered, byhour);\n            case Frequency.MINUTELY: return this.addMinutes(interval, filtered, byhour, byminute);\n            case Frequency.SECONDLY: return this.addSeconds(interval, filtered, byhour, byminute, bysecond);\n        }\n    };\n    return DateTime;\n}(Time));\n\n\n// CONCATENATED MODULE: ./src/parseoptions.ts\n\n\n\n\n\n\n\nfunction initializeOptions(options) {\n    var invalid = [];\n    var keys = Object.keys(options);\n    // Shallow copy for options and origOptions and check for invalid\n    for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\n        var key = keys_1[_i];\n        if (!includes(rrule_defaultKeys, key))\n            invalid.push(key);\n        if (src_dateutil.isDate(options[key]) && !src_dateutil.isValidDate(options[key]))\n            invalid.push(key);\n    }\n    if (invalid.length) {\n        throw new Error('Invalid options: ' + invalid.join(', '));\n    }\n    return __assign({}, options);\n}\nfunction parseOptions(options) {\n    var opts = __assign(__assign({}, DEFAULT_OPTIONS), initializeOptions(options));\n    if (isPresent(opts.byeaster))\n        opts.freq = src_rrule.YEARLY;\n    if (!(isPresent(opts.freq) && src_rrule.FREQUENCIES[opts.freq])) {\n        throw new Error(\"Invalid frequency: \" + opts.freq + \" \" + options.freq);\n    }\n    if (!opts.dtstart)\n        opts.dtstart = new Date(new Date().setMilliseconds(0));\n    if (!isPresent(opts.wkst)) {\n        opts.wkst = src_rrule.MO.weekday;\n    }\n    else if (isNumber(opts.wkst)) {\n        // cool, just keep it like that\n    }\n    else {\n        opts.wkst = opts.wkst.weekday;\n    }\n    if (isPresent(opts.bysetpos)) {\n        if (isNumber(opts.bysetpos))\n            opts.bysetpos = [opts.bysetpos];\n        for (var i = 0; i < opts.bysetpos.length; i++) {\n            var v = opts.bysetpos[i];\n            if (v === 0 || !(v >= -366 && v <= 366)) {\n                throw new Error('bysetpos must be between 1 and 366,' + ' or between -366 and -1');\n            }\n        }\n    }\n    if (!(Boolean(opts.byweekno) ||\n        notEmpty(opts.byweekno) ||\n        notEmpty(opts.byyearday) ||\n        Boolean(opts.bymonthday) ||\n        notEmpty(opts.bymonthday) ||\n        isPresent(opts.byweekday) ||\n        isPresent(opts.byeaster))) {\n        switch (opts.freq) {\n            case src_rrule.YEARLY:\n                if (!opts.bymonth)\n                    opts.bymonth = opts.dtstart.getUTCMonth() + 1;\n                opts.bymonthday = opts.dtstart.getUTCDate();\n                break;\n            case src_rrule.MONTHLY:\n                opts.bymonthday = opts.dtstart.getUTCDate();\n                break;\n            case src_rrule.WEEKLY:\n                opts.byweekday = [src_dateutil.getWeekday(opts.dtstart)];\n                break;\n        }\n    }\n    // bymonth\n    if (isPresent(opts.bymonth) && !isArray(opts.bymonth)) {\n        opts.bymonth = [opts.bymonth];\n    }\n    // byyearday\n    if (isPresent(opts.byyearday) &&\n        !isArray(opts.byyearday) &&\n        isNumber(opts.byyearday)) {\n        opts.byyearday = [opts.byyearday];\n    }\n    // bymonthday\n    if (!isPresent(opts.bymonthday)) {\n        opts.bymonthday = [];\n        opts.bynmonthday = [];\n    }\n    else if (isArray(opts.bymonthday)) {\n        var bymonthday = [];\n        var bynmonthday = [];\n        for (var i = 0; i < opts.bymonthday.length; i++) {\n            var v = opts.bymonthday[i];\n            if (v > 0) {\n                bymonthday.push(v);\n            }\n            else if (v < 0) {\n                bynmonthday.push(v);\n            }\n        }\n        opts.bymonthday = bymonthday;\n        opts.bynmonthday = bynmonthday;\n    }\n    else if (opts.bymonthday < 0) {\n        opts.bynmonthday = [opts.bymonthday];\n        opts.bymonthday = [];\n    }\n    else {\n        opts.bynmonthday = [];\n        opts.bymonthday = [opts.bymonthday];\n    }\n    // byweekno\n    if (isPresent(opts.byweekno) && !isArray(opts.byweekno)) {\n        opts.byweekno = [opts.byweekno];\n    }\n    // byweekday / bynweekday\n    if (!isPresent(opts.byweekday)) {\n        opts.bynweekday = null;\n    }\n    else if (isNumber(opts.byweekday)) {\n        opts.byweekday = [opts.byweekday];\n        opts.bynweekday = null;\n    }\n    else if (isWeekdayStr(opts.byweekday)) {\n        opts.byweekday = [Weekday.fromStr(opts.byweekday).weekday];\n        opts.bynweekday = null;\n    }\n    else if (opts.byweekday instanceof Weekday) {\n        if (!opts.byweekday.n || opts.freq > src_rrule.MONTHLY) {\n            opts.byweekday = [opts.byweekday.weekday];\n            opts.bynweekday = null;\n        }\n        else {\n            opts.bynweekday = [[opts.byweekday.weekday, opts.byweekday.n]];\n            opts.byweekday = null;\n        }\n    }\n    else {\n        var byweekday = [];\n        var bynweekday = [];\n        for (var i = 0; i < opts.byweekday.length; i++) {\n            var wday = opts.byweekday[i];\n            if (isNumber(wday)) {\n                byweekday.push(wday);\n                continue;\n            }\n            else if (isWeekdayStr(wday)) {\n                byweekday.push(Weekday.fromStr(wday).weekday);\n                continue;\n            }\n            if (!wday.n || opts.freq > src_rrule.MONTHLY) {\n                byweekday.push(wday.weekday);\n            }\n            else {\n                bynweekday.push([wday.weekday, wday.n]);\n            }\n        }\n        opts.byweekday = notEmpty(byweekday) ? byweekday : null;\n        opts.bynweekday = notEmpty(bynweekday) ? bynweekday : null;\n    }\n    // byhour\n    if (!isPresent(opts.byhour)) {\n        opts.byhour =\n            opts.freq < src_rrule.HOURLY ? [opts.dtstart.getUTCHours()] : null;\n    }\n    else if (isNumber(opts.byhour)) {\n        opts.byhour = [opts.byhour];\n    }\n    // byminute\n    if (!isPresent(opts.byminute)) {\n        opts.byminute =\n            opts.freq < src_rrule.MINUTELY ? [opts.dtstart.getUTCMinutes()] : null;\n    }\n    else if (isNumber(opts.byminute)) {\n        opts.byminute = [opts.byminute];\n    }\n    // bysecond\n    if (!isPresent(opts.bysecond)) {\n        opts.bysecond =\n            opts.freq < src_rrule.SECONDLY ? [opts.dtstart.getUTCSeconds()] : null;\n    }\n    else if (isNumber(opts.bysecond)) {\n        opts.bysecond = [opts.bysecond];\n    }\n    return { parsedOptions: opts };\n}\nfunction buildTimeset(opts) {\n    var millisecondModulo = opts.dtstart.getTime() % 1000;\n    if (!freqIsDailyOrGreater(opts.freq)) {\n        return [];\n    }\n    var timeset = [];\n    opts.byhour.forEach(function (hour) {\n        opts.byminute.forEach(function (minute) {\n            opts.bysecond.forEach(function (second) {\n                timeset.push(new Time(hour, minute, second, millisecondModulo));\n            });\n        });\n    });\n    return timeset;\n}\n\n// CONCATENATED MODULE: ./src/parsestring.ts\n\n\n\n\n\nfunction parseString(rfcString) {\n    var options = rfcString.split('\\n').map(parseLine).filter(function (x) { return x !== null; });\n    return __assign(__assign({}, options[0]), options[1]);\n}\nfunction parseDtstart(line) {\n    var options = {};\n    var dtstartWithZone = /DTSTART(?:;TZID=([^:=]+?))?(?::|=)([^;\\s]+)/i.exec(line);\n    if (!dtstartWithZone) {\n        return options;\n    }\n    var _ = dtstartWithZone[0], tzid = dtstartWithZone[1], dtstart = dtstartWithZone[2];\n    if (tzid) {\n        options.tzid = tzid;\n    }\n    options.dtstart = src_dateutil.untilStringToDate(dtstart);\n    return options;\n}\nfunction parseLine(rfcString) {\n    rfcString = rfcString.replace(/^\\s+|\\s+$/, '');\n    if (!rfcString.length)\n        return null;\n    var header = /^([A-Z]+?)[:;]/.exec(rfcString.toUpperCase());\n    if (!header) {\n        return parseRrule(rfcString);\n    }\n    var _ = header[0], key = header[1];\n    switch (key.toUpperCase()) {\n        case 'RRULE':\n        case 'EXRULE':\n            return parseRrule(rfcString);\n        case 'DTSTART':\n            return parseDtstart(rfcString);\n        default:\n            throw new Error(\"Unsupported RFC prop \" + key + \" in \" + rfcString);\n    }\n}\nfunction parseRrule(line) {\n    var strippedLine = line.replace(/^RRULE:/i, '');\n    var options = parseDtstart(strippedLine);\n    var attrs = line.replace(/^(?:RRULE|EXRULE):/i, '').split(';');\n    attrs.forEach(function (attr) {\n        var _a = attr.split('='), key = _a[0], value = _a[1];\n        switch (key.toUpperCase()) {\n            case 'FREQ':\n                options.freq = Frequency[value.toUpperCase()];\n                break;\n            case 'WKST':\n                options.wkst = Days[value.toUpperCase()];\n                break;\n            case 'COUNT':\n            case 'INTERVAL':\n            case 'BYSETPOS':\n            case 'BYMONTH':\n            case 'BYMONTHDAY':\n            case 'BYYEARDAY':\n            case 'BYWEEKNO':\n            case 'BYHOUR':\n            case 'BYMINUTE':\n            case 'BYSECOND':\n                var num = parseNumber(value);\n                var optionKey = key.toLowerCase();\n                // @ts-ignore\n                options[optionKey] = num;\n                break;\n            case 'BYWEEKDAY':\n            case 'BYDAY':\n                options.byweekday = parseWeekday(value);\n                break;\n            case 'DTSTART':\n            case 'TZID':\n                // for backwards compatibility\n                var dtstart = parseDtstart(line);\n                options.tzid = dtstart.tzid;\n                options.dtstart = dtstart.dtstart;\n                break;\n            case 'UNTIL':\n                options.until = src_dateutil.untilStringToDate(value);\n                break;\n            case 'BYEASTER':\n                options.byeaster = Number(value);\n                break;\n            default:\n                throw new Error(\"Unknown RRULE property '\" + key + \"'\");\n        }\n    });\n    return options;\n}\nfunction parseNumber(value) {\n    if (value.indexOf(',') !== -1) {\n        var values = value.split(',');\n        return values.map(parseIndividualNumber);\n    }\n    return parseIndividualNumber(value);\n}\nfunction parseIndividualNumber(value) {\n    if (/^[+-]?\\d+$/.test(value)) {\n        return Number(value);\n    }\n    return value;\n}\nfunction parseWeekday(value) {\n    var days = value.split(',');\n    return days.map(function (day) {\n        if (day.length === 2) {\n            // MO, TU, ...\n            return Days[day]; // wday instanceof Weekday\n        }\n        // -1MO, +3FR, 1SO, 13TU ...\n        var parts = day.match(/^([+-]?\\d{1,2})([A-Z]{2})$/);\n        var n = Number(parts[1]);\n        var wdaypart = parts[2];\n        var wday = Days[wdaypart].weekday;\n        return new Weekday(wday, n);\n    });\n}\n\n// CONCATENATED MODULE: ./src/fake-luxon.ts\nvar fake_luxon_DateTime = {\n    fromJSDate: function () {\n        throw new TypeError();\n    }\n};\n\n// CONCATENATED MODULE: ./src/datewithzone.ts\n\n\nvar datewithzone_DateWithZone = /** @class */ (function () {\n    function DateWithZone(date, tzid) {\n        this.date = date;\n        this.tzid = tzid;\n    }\n    Object.defineProperty(DateWithZone.prototype, \"isUTC\", {\n        get: function () {\n            return !this.tzid || this.tzid.toUpperCase() === 'UTC';\n        },\n        enumerable: true,\n        configurable: true\n    });\n    DateWithZone.prototype.toString = function () {\n        var datestr = src_dateutil.timeToUntilString(this.date.getTime(), this.isUTC);\n        if (!this.isUTC) {\n            return \";TZID=\" + this.tzid + \":\" + datestr;\n        }\n        return \":\" + datestr;\n    };\n    DateWithZone.prototype.getTime = function () {\n        return this.date.getTime();\n    };\n    DateWithZone.prototype.rezonedDate = function () {\n        if (this.isUTC) {\n            return this.date;\n        }\n        try {\n            var datetime = fake_luxon_DateTime\n                .fromJSDate(this.date);\n            var rezoned = datetime.setZone(this.tzid, { keepLocalTime: true });\n            return rezoned.toJSDate();\n        }\n        catch (e) {\n            if (e instanceof TypeError) {\n                console.error('Using TZID without Luxon available is unsupported. Returned times are in UTC, not the requested time zone');\n            }\n            return this.date;\n        }\n    };\n    return DateWithZone;\n}());\n\n\n// CONCATENATED MODULE: ./src/optionstostring.ts\n\n\n\n\n\nfunction optionsToString(options) {\n    var rrule = [];\n    var dtstart = '';\n    var keys = Object.keys(options);\n    var defaultKeys = Object.keys(DEFAULT_OPTIONS);\n    for (var i = 0; i < keys.length; i++) {\n        if (keys[i] === 'tzid')\n            continue;\n        if (!includes(defaultKeys, keys[i]))\n            continue;\n        var key = keys[i].toUpperCase();\n        var value = options[keys[i]];\n        var outValue = '';\n        if (!isPresent(value) || (isArray(value) && !value.length))\n            continue;\n        switch (key) {\n            case 'FREQ':\n                outValue = src_rrule.FREQUENCIES[options.freq];\n                break;\n            case 'WKST':\n                if (isNumber(value)) {\n                    outValue = new Weekday(value).toString();\n                }\n                else {\n                    outValue = value.toString();\n                }\n                break;\n            case 'BYWEEKDAY':\n                /*\n                NOTE: BYWEEKDAY is a special case.\n                RRule() deconstructs the rule.options.byweekday array\n                into an array of Weekday arguments.\n                On the other hand, rule.origOptions is an array of Weekdays.\n                We need to handle both cases here.\n                It might be worth change RRule to keep the Weekdays.\n      \n                Also, BYWEEKDAY (used by RRule) vs. BYDAY (RFC)\n      \n                */\n                key = 'BYDAY';\n                outValue = toArray(value).map(function (wday) {\n                    if (wday instanceof Weekday) {\n                        return wday;\n                    }\n                    if (isArray(wday)) {\n                        return new Weekday(wday[0], wday[1]);\n                    }\n                    return new Weekday(wday);\n                }).toString();\n                break;\n            case 'DTSTART':\n                dtstart = buildDtstart(value, options.tzid);\n                break;\n            case 'UNTIL':\n                outValue = src_dateutil.timeToUntilString(value, !options.tzid);\n                break;\n            default:\n                if (isArray(value)) {\n                    var strValues = [];\n                    for (var j = 0; j < value.length; j++) {\n                        strValues[j] = String(value[j]);\n                    }\n                    outValue = strValues.toString();\n                }\n                else {\n                    outValue = String(value);\n                }\n        }\n        if (outValue) {\n            rrule.push([key, outValue]);\n        }\n    }\n    var rules = rrule.map(function (_a) {\n        var key = _a[0], value = _a[1];\n        return key + \"=\" + value.toString();\n    }).join(';');\n    var ruleString = '';\n    if (rules !== '') {\n        ruleString = \"RRULE:\" + rules;\n    }\n    return [dtstart, ruleString].filter(function (x) { return !!x; }).join('\\n');\n}\nfunction buildDtstart(dtstart, tzid) {\n    if (!dtstart) {\n        return '';\n    }\n    return 'DTSTART' + new datewithzone_DateWithZone(new Date(dtstart), tzid).toString();\n}\n\n// CONCATENATED MODULE: ./src/cache.ts\n\n\n\nvar cache_Cache = /** @class */ (function () {\n    function Cache() {\n        this.all = false;\n        this.before = [];\n        this.after = [];\n        this.between = [];\n    }\n    /**\n     * @param {String} what - all/before/after/between\n     * @param {Array,Date} value - an array of dates, one date, or null\n     * @param {Object?} args - _iter arguments\n     */\n    Cache.prototype._cacheAdd = function (what, value, args) {\n        if (value) {\n            value =\n                value instanceof Date\n                    ? src_dateutil.clone(value)\n                    : src_dateutil.cloneDates(value);\n        }\n        if (what === 'all') {\n            this.all = value;\n        }\n        else {\n            args._value = value;\n            this[what].push(args);\n        }\n    };\n    /**\n     * @return false - not in the cache\n     *         null  - cached, but zero occurrences (before/after)\n     *         Date  - cached (before/after)\n     *         []    - cached, but zero occurrences (all/between)\n     *         [Date1, DateN] - cached (all/between)\n     */\n    Cache.prototype._cacheGet = function (what, args) {\n        var cached = false;\n        var argsKeys = args ? Object.keys(args) : [];\n        var findCacheDiff = function (item) {\n            for (var i = 0; i < argsKeys.length; i++) {\n                var key = argsKeys[i];\n                if (String(args[key]) !== String(item[key])) {\n                    return true;\n                }\n            }\n            return false;\n        };\n        var cachedObject = this[what];\n        if (what === 'all') {\n            cached = this.all;\n        }\n        else if (isArray(cachedObject)) {\n            // Let's see whether we've already called the\n            // 'what' method with the same 'args'\n            for (var i = 0; i < cachedObject.length; i++) {\n                var item = cachedObject[i];\n                if (argsKeys.length && findCacheDiff(item))\n                    continue;\n                cached = item._value;\n                break;\n            }\n        }\n        if (!cached && this.all) {\n            // Not in the cache, but we already know all the occurrences,\n            // so we can find the correct dates from the cached ones.\n            var iterResult = new iterresult(what, args);\n            for (var i = 0; i < this.all.length; i++) {\n                if (!iterResult.accept(this.all[i]))\n                    break;\n            }\n            cached = iterResult.getValue();\n            this._cacheAdd(what, cached, args);\n        }\n        return isArray(cached)\n            ? src_dateutil.cloneDates(cached)\n            : cached instanceof Date\n                ? src_dateutil.clone(cached)\n                : cached;\n    };\n    return Cache;\n}());\n\n\n// CONCATENATED MODULE: ./src/masks.ts\n\n\n// =============================================================================\n// Date masks\n// =============================================================================\n// Every mask is 7 days longer to handle cross-year weekly periods.\nvar M365MASK = __spreadArrays(repeat(1, 31), repeat(2, 28), repeat(3, 31), repeat(4, 30), repeat(5, 31), repeat(6, 30), repeat(7, 31), repeat(8, 31), repeat(9, 30), repeat(10, 31), repeat(11, 30), repeat(12, 31), repeat(1, 7));\nvar M366MASK = __spreadArrays(repeat(1, 31), repeat(2, 29), repeat(3, 31), repeat(4, 30), repeat(5, 31), repeat(6, 30), repeat(7, 31), repeat(8, 31), repeat(9, 30), repeat(10, 31), repeat(11, 30), repeat(12, 31), repeat(1, 7));\nvar M28 = range(1, 29);\nvar M29 = range(1, 30);\nvar M30 = range(1, 31);\nvar M31 = range(1, 32);\nvar MDAY366MASK = __spreadArrays(M31, M29, M31, M30, M31, M30, M31, M31, M30, M31, M30, M31, M31.slice(0, 7));\nvar MDAY365MASK = __spreadArrays(M31, M28, M31, M30, M31, M30, M31, M31, M30, M31, M30, M31, M31.slice(0, 7));\nvar NM28 = range(-28, 0);\nvar NM29 = range(-29, 0);\nvar NM30 = range(-30, 0);\nvar NM31 = range(-31, 0);\nvar NMDAY366MASK = __spreadArrays(NM31, NM29, NM31, NM30, NM31, NM30, NM31, NM31, NM30, NM31, NM30, NM31, NM31.slice(0, 7));\nvar NMDAY365MASK = __spreadArrays(NM31, NM28, NM31, NM30, NM31, NM30, NM31, NM31, NM30, NM31, NM30, NM31, NM31.slice(0, 7));\nvar M366RANGE = [0, 31, 60, 91, 121, 152, 182, 213, 244, 274, 305, 335, 366];\nvar M365RANGE = [0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334, 365];\nvar WDAYMASK = (function () {\n    var wdaymask = [];\n    for (var i = 0; i < 55; i++)\n        wdaymask = wdaymask.concat(range(7));\n    return wdaymask;\n})();\n\n\n// CONCATENATED MODULE: ./src/iterinfo/yearinfo.ts\n\n\n\n\nfunction rebuildYear(year, options) {\n    var firstyday = new Date(Date.UTC(year, 0, 1));\n    var yearlen = src_dateutil.isLeapYear(year) ? 366 : 365;\n    var nextyearlen = src_dateutil.isLeapYear(year + 1) ? 366 : 365;\n    var yearordinal = src_dateutil.toOrdinal(firstyday);\n    var yearweekday = src_dateutil.getWeekday(firstyday);\n    var result = __assign(__assign({ yearlen: yearlen,\n        nextyearlen: nextyearlen,\n        yearordinal: yearordinal,\n        yearweekday: yearweekday }, baseYearMasks(year)), { wnomask: null });\n    if (empty(options.byweekno)) {\n        return result;\n    }\n    result.wnomask = repeat(0, yearlen + 7);\n    var firstwkst;\n    var wyearlen;\n    var no1wkst = firstwkst = pymod(7 - yearweekday + options.wkst, 7);\n    if (no1wkst >= 4) {\n        no1wkst = 0;\n        // Number of days in the year, plus the days we got\n        // from last year.\n        wyearlen =\n            result.yearlen + pymod(yearweekday - options.wkst, 7);\n    }\n    else {\n        // Number of days in the year, minus the days we\n        // left in last year.\n        wyearlen = yearlen - no1wkst;\n    }\n    var div = Math.floor(wyearlen / 7);\n    var mod = pymod(wyearlen, 7);\n    var numweeks = Math.floor(div + mod / 4);\n    for (var j = 0; j < options.byweekno.length; j++) {\n        var n = options.byweekno[j];\n        if (n < 0) {\n            n += numweeks + 1;\n        }\n        if (!(n > 0 && n <= numweeks)) {\n            continue;\n        }\n        var i = void 0;\n        if (n > 1) {\n            i = no1wkst + (n - 1) * 7;\n            if (no1wkst !== firstwkst) {\n                i -= 7 - firstwkst;\n            }\n        }\n        else {\n            i = no1wkst;\n        }\n        for (var k = 0; k < 7; k++) {\n            result.wnomask[i] = 1;\n            i++;\n            if (result.wdaymask[i] === options.wkst)\n                break;\n        }\n    }\n    if (includes(options.byweekno, 1)) {\n        // Check week number 1 of next year as well\n        // orig-TODO : Check -numweeks for next year.\n        var i = no1wkst + numweeks * 7;\n        if (no1wkst !== firstwkst)\n            i -= 7 - firstwkst;\n        if (i < yearlen) {\n            // If week starts in next year, we\n            // don't care about it.\n            for (var j = 0; j < 7; j++) {\n                result.wnomask[i] = 1;\n                i += 1;\n                if (result.wdaymask[i] === options.wkst)\n                    break;\n            }\n        }\n    }\n    if (no1wkst) {\n        // Check last week number of last year as\n        // well. If no1wkst is 0, either the year\n        // started on week start, or week number 1\n        // got days from last year, so there are no\n        // days from last year's last week number in\n        // this year.\n        var lnumweeks = void 0;\n        if (!includes(options.byweekno, -1)) {\n            var lyearweekday = src_dateutil.getWeekday(new Date(Date.UTC(year - 1, 0, 1)));\n            var lno1wkst = pymod(7 - lyearweekday.valueOf() + options.wkst, 7);\n            var lyearlen = src_dateutil.isLeapYear(year - 1) ? 366 : 365;\n            var weekst = void 0;\n            if (lno1wkst >= 4) {\n                lno1wkst = 0;\n                weekst = lyearlen + pymod(lyearweekday - options.wkst, 7);\n            }\n            else {\n                weekst = yearlen - no1wkst;\n            }\n            lnumweeks = Math.floor(52 + pymod(weekst, 7) / 4);\n        }\n        else {\n            lnumweeks = -1;\n        }\n        if (includes(options.byweekno, lnumweeks)) {\n            for (var i = 0; i < no1wkst; i++)\n                result.wnomask[i] = 1;\n        }\n    }\n    return result;\n}\nfunction baseYearMasks(year) {\n    var yearlen = src_dateutil.isLeapYear(year) ? 366 : 365;\n    var firstyday = new Date(Date.UTC(year, 0, 1));\n    var wday = src_dateutil.getWeekday(firstyday);\n    if (yearlen === 365) {\n        return {\n            mmask: M365MASK,\n            mdaymask: MDAY365MASK,\n            nmdaymask: NMDAY365MASK,\n            wdaymask: WDAYMASK.slice(wday),\n            mrange: M365RANGE\n        };\n    }\n    return {\n        mmask: M366MASK,\n        mdaymask: MDAY366MASK,\n        nmdaymask: NMDAY366MASK,\n        wdaymask: WDAYMASK.slice(wday),\n        mrange: M366RANGE\n    };\n}\n\n// CONCATENATED MODULE: ./src/iterinfo/monthinfo.ts\n\n\nfunction rebuildMonth(year, month, yearlen, mrange, wdaymask, options) {\n    var result = {\n        lastyear: year,\n        lastmonth: month,\n        nwdaymask: []\n    };\n    var ranges = [];\n    if (options.freq === src_rrule.YEARLY) {\n        if (empty(options.bymonth)) {\n            ranges = [[0, yearlen]];\n        }\n        else {\n            for (var j = 0; j < options.bymonth.length; j++) {\n                month = options.bymonth[j];\n                ranges.push(mrange.slice(month - 1, month + 1));\n            }\n        }\n    }\n    else if (options.freq === src_rrule.MONTHLY) {\n        ranges = [mrange.slice(month - 1, month + 1)];\n    }\n    if (empty(ranges)) {\n        return result;\n    }\n    // Weekly frequency won't get here, so we may not\n    // care about cross-year weekly periods.\n    result.nwdaymask = repeat(0, yearlen);\n    for (var j = 0; j < ranges.length; j++) {\n        var rang = ranges[j];\n        var first = rang[0];\n        var last = rang[1] - 1;\n        for (var k = 0; k < options.bynweekday.length; k++) {\n            var i = void 0;\n            var _a = options.bynweekday[k], wday = _a[0], n = _a[1];\n            if (n < 0) {\n                i = last + (n + 1) * 7;\n                i -= pymod(wdaymask[i] - wday, 7);\n            }\n            else {\n                i = first + (n - 1) * 7;\n                i += pymod(7 - wdaymask[i] + wday, 7);\n            }\n            if (first <= i && i <= last)\n                result.nwdaymask[i] = 1;\n        }\n    }\n    return result;\n}\n\n// CONCATENATED MODULE: ./src/iterinfo/easter.ts\nfunction easter(y, offset) {\n    if (offset === void 0) { offset = 0; }\n    var a = y % 19;\n    var b = Math.floor(y / 100);\n    var c = y % 100;\n    var d = Math.floor(b / 4);\n    var e = b % 4;\n    var f = Math.floor((b + 8) / 25);\n    var g = Math.floor((b - f + 1) / 3);\n    var h = Math.floor(19 * a + b - d - g + 15) % 30;\n    var i = Math.floor(c / 4);\n    var k = c % 4;\n    var l = Math.floor(32 + 2 * e + 2 * i - h - k) % 7;\n    var m = Math.floor((a + 11 * h + 22 * l) / 451);\n    var month = Math.floor((h + l - 7 * m + 114) / 31);\n    var day = ((h + l - 7 * m + 114) % 31) + 1;\n    var date = Date.UTC(y, month - 1, day + offset);\n    var yearStart = Date.UTC(y, 0, 1);\n    return [Math.ceil((date - yearStart) / (1000 * 60 * 60 * 24))];\n}\n\n// CONCATENATED MODULE: ./src/iterinfo/index.ts\n\n\n\n\n\n\n\n// =============================================================================\n// Iterinfo\n// =============================================================================\nvar iterinfo_Iterinfo = /** @class */ (function () {\n    function Iterinfo(options) {\n        this.options = options;\n    }\n    Iterinfo.prototype.rebuild = function (year, month) {\n        var options = this.options;\n        if (year !== this.lastyear) {\n            this.yearinfo = rebuildYear(year, options);\n        }\n        if (notEmpty(options.bynweekday) &&\n            (month !== this.lastmonth || year !== this.lastyear)) {\n            var _a = this.yearinfo, yearlen = _a.yearlen, mrange = _a.mrange, wdaymask = _a.wdaymask;\n            this.monthinfo = rebuildMonth(year, month, yearlen, mrange, wdaymask, options);\n        }\n        if (isPresent(options.byeaster)) {\n            this.eastermask = easter(year, options.byeaster);\n        }\n    };\n    Object.defineProperty(Iterinfo.prototype, \"lastyear\", {\n        get: function () {\n            return this.monthinfo ? this.monthinfo.lastyear : null;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Iterinfo.prototype, \"lastmonth\", {\n        get: function () {\n            return this.monthinfo ? this.monthinfo.lastmonth : null;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Iterinfo.prototype, \"yearlen\", {\n        get: function () {\n            return this.yearinfo.yearlen;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Iterinfo.prototype, \"yearordinal\", {\n        get: function () {\n            return this.yearinfo.yearordinal;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Iterinfo.prototype, \"mrange\", {\n        get: function () {\n            return this.yearinfo.mrange;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Iterinfo.prototype, \"wdaymask\", {\n        get: function () {\n            return this.yearinfo.wdaymask;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Iterinfo.prototype, \"mmask\", {\n        get: function () {\n            return this.yearinfo.mmask;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Iterinfo.prototype, \"wnomask\", {\n        get: function () {\n            return this.yearinfo.wnomask;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Iterinfo.prototype, \"nwdaymask\", {\n        get: function () {\n            return this.monthinfo ? this.monthinfo.nwdaymask : [];\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Iterinfo.prototype, \"nextyearlen\", {\n        get: function () {\n            return this.yearinfo.nextyearlen;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Iterinfo.prototype, \"mdaymask\", {\n        get: function () {\n            return this.yearinfo.mdaymask;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Iterinfo.prototype, \"nmdaymask\", {\n        get: function () {\n            return this.yearinfo.nmdaymask;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Iterinfo.prototype.ydayset = function () {\n        return [range(this.yearlen), 0, this.yearlen];\n    };\n    Iterinfo.prototype.mdayset = function (_, month, __) {\n        var start = this.mrange[month - 1];\n        var end = this.mrange[month];\n        var set = repeat(null, this.yearlen);\n        for (var i = start; i < end; i++)\n            set[i] = i;\n        return [set, start, end];\n    };\n    Iterinfo.prototype.wdayset = function (year, month, day) {\n        // We need to handle cross-year weeks here.\n        var set = repeat(null, this.yearlen + 7);\n        var i = src_dateutil.toOrdinal(new Date(Date.UTC(year, month - 1, day))) -\n            this.yearordinal;\n        var start = i;\n        for (var j = 0; j < 7; j++) {\n            set[i] = i;\n            ++i;\n            if (this.wdaymask[i] === this.options.wkst)\n                break;\n        }\n        return [set, start, i];\n    };\n    Iterinfo.prototype.ddayset = function (year, month, day) {\n        var set = repeat(null, this.yearlen);\n        var i = src_dateutil.toOrdinal(new Date(Date.UTC(year, month - 1, day))) -\n            this.yearordinal;\n        set[i] = i;\n        return [set, i, i + 1];\n    };\n    Iterinfo.prototype.htimeset = function (hour, _, second, millisecond) {\n        var _this = this;\n        var set = [];\n        this.options.byminute.forEach(function (minute) {\n            set = set.concat(_this.mtimeset(hour, minute, second, millisecond));\n        });\n        src_dateutil.sort(set);\n        return set;\n    };\n    Iterinfo.prototype.mtimeset = function (hour, minute, _, millisecond) {\n        var set = this.options.bysecond.map(function (second) {\n            return new Time(hour, minute, second, millisecond);\n        });\n        src_dateutil.sort(set);\n        return set;\n    };\n    Iterinfo.prototype.stimeset = function (hour, minute, second, millisecond) {\n        return [new Time(hour, minute, second, millisecond)];\n    };\n    Iterinfo.prototype.getdayset = function (freq) {\n        switch (freq) {\n            case Frequency.YEARLY: return this.ydayset.bind(this);\n            case Frequency.MONTHLY: return this.mdayset.bind(this);\n            case Frequency.WEEKLY: return this.wdayset.bind(this);\n            case Frequency.DAILY: return this.ddayset.bind(this);\n            default: return this.ddayset.bind(this);\n        }\n    };\n    Iterinfo.prototype.gettimeset = function (freq) {\n        switch (freq) {\n            case Frequency.HOURLY: return this.htimeset.bind(this);\n            case Frequency.MINUTELY: return this.mtimeset.bind(this);\n            case Frequency.SECONDLY: return this.stimeset.bind(this);\n        }\n    };\n    return Iterinfo;\n}());\n/* harmony default export */ var iterinfo = (iterinfo_Iterinfo);\n\n// CONCATENATED MODULE: ./src/iter/poslist.ts\n\n\nfunction buildPoslist(bysetpos, timeset, start, end, ii, dayset) {\n    var poslist = [];\n    for (var j = 0; j < bysetpos.length; j++) {\n        var daypos = void 0;\n        var timepos = void 0;\n        var pos = bysetpos[j];\n        if (pos < 0) {\n            daypos = Math.floor(pos / timeset.length);\n            timepos = pymod(pos, timeset.length);\n        }\n        else {\n            daypos = Math.floor((pos - 1) / timeset.length);\n            timepos = pymod(pos - 1, timeset.length);\n        }\n        var tmp = [];\n        for (var k = start; k < end; k++) {\n            var val = dayset[k];\n            if (!isPresent(val))\n                continue;\n            tmp.push(val);\n        }\n        var i = void 0;\n        if (daypos < 0) {\n            i = tmp.slice(daypos)[0];\n        }\n        else {\n            i = tmp[daypos];\n        }\n        var time = timeset[timepos];\n        var date = src_dateutil.fromOrdinal(ii.yearordinal + i);\n        var res = src_dateutil.combine(date, time);\n        // XXX: can this ever be in the array?\n        // - compare the actual date instead?\n        if (!includes(poslist, res))\n            poslist.push(res);\n    }\n    src_dateutil.sort(poslist);\n    return poslist;\n}\n\n// CONCATENATED MODULE: ./src/iter/index.ts\n\n\n\n\n\n\n\n\n\nfunction iter(iterResult, options) {\n    var dtstart = options.dtstart, freq = options.freq, interval = options.interval, until = options.until, bysetpos = options.bysetpos;\n    var count = options.count;\n    if (count === 0 || interval === 0) {\n        return emitResult(iterResult);\n    }\n    var counterDate = datetime_DateTime.fromDate(dtstart);\n    var ii = new iterinfo(options);\n    ii.rebuild(counterDate.year, counterDate.month);\n    var timeset = makeTimeset(ii, counterDate, options);\n    while (true) {\n        var _a = ii.getdayset(freq)(counterDate.year, counterDate.month, counterDate.day), dayset = _a[0], start = _a[1], end = _a[2];\n        var filtered = removeFilteredDays(dayset, start, end, ii, options);\n        if (notEmpty(bysetpos)) {\n            var poslist = buildPoslist(bysetpos, timeset, start, end, ii, dayset);\n            for (var j = 0; j < poslist.length; j++) {\n                var res = poslist[j];\n                if (until && res > until) {\n                    return emitResult(iterResult);\n                }\n                if (res >= dtstart) {\n                    var rezonedDate = rezoneIfNeeded(res, options);\n                    if (!iterResult.accept(rezonedDate)) {\n                        return emitResult(iterResult);\n                    }\n                    if (count) {\n                        --count;\n                        if (!count) {\n                            return emitResult(iterResult);\n                        }\n                    }\n                }\n            }\n        }\n        else {\n            for (var j = start; j < end; j++) {\n                var currentDay = dayset[j];\n                if (!isPresent(currentDay)) {\n                    continue;\n                }\n                var date = src_dateutil.fromOrdinal(ii.yearordinal + currentDay);\n                for (var k = 0; k < timeset.length; k++) {\n                    var time = timeset[k];\n                    var res = src_dateutil.combine(date, time);\n                    if (until && res > until) {\n                        return emitResult(iterResult);\n                    }\n                    if (res >= dtstart) {\n                        var rezonedDate = rezoneIfNeeded(res, options);\n                        if (!iterResult.accept(rezonedDate)) {\n                            return emitResult(iterResult);\n                        }\n                        if (count) {\n                            --count;\n                            if (!count) {\n                                return emitResult(iterResult);\n                            }\n                        }\n                    }\n                }\n            }\n        }\n        if (options.interval === 0) {\n            return emitResult(iterResult);\n        }\n        // Handle frequency and interval\n        counterDate.add(options, filtered);\n        if (counterDate.year > src_dateutil.MAXYEAR) {\n            return emitResult(iterResult);\n        }\n        if (!freqIsDailyOrGreater(freq)) {\n            timeset = ii.gettimeset(freq)(counterDate.hour, counterDate.minute, counterDate.second, 0);\n        }\n        ii.rebuild(counterDate.year, counterDate.month);\n    }\n}\nfunction isFiltered(ii, currentDay, options) {\n    var bymonth = options.bymonth, byweekno = options.byweekno, byweekday = options.byweekday, byeaster = options.byeaster, bymonthday = options.bymonthday, bynmonthday = options.bynmonthday, byyearday = options.byyearday;\n    return ((notEmpty(bymonth) && !includes(bymonth, ii.mmask[currentDay])) ||\n        (notEmpty(byweekno) && !ii.wnomask[currentDay]) ||\n        (notEmpty(byweekday) && !includes(byweekday, ii.wdaymask[currentDay])) ||\n        (notEmpty(ii.nwdaymask) && !ii.nwdaymask[currentDay]) ||\n        (byeaster !== null && !includes(ii.eastermask, currentDay)) ||\n        ((notEmpty(bymonthday) || notEmpty(bynmonthday)) &&\n            !includes(bymonthday, ii.mdaymask[currentDay]) &&\n            !includes(bynmonthday, ii.nmdaymask[currentDay])) ||\n        (notEmpty(byyearday) &&\n            ((currentDay < ii.yearlen &&\n                !includes(byyearday, currentDay + 1) &&\n                !includes(byyearday, -ii.yearlen + currentDay)) ||\n                (currentDay >= ii.yearlen &&\n                    !includes(byyearday, currentDay + 1 - ii.yearlen) &&\n                    !includes(byyearday, -ii.nextyearlen + currentDay - ii.yearlen)))));\n}\nfunction rezoneIfNeeded(date, options) {\n    return new datewithzone_DateWithZone(date, options.tzid).rezonedDate();\n}\nfunction emitResult(iterResult) {\n    return iterResult.getValue();\n}\nfunction removeFilteredDays(dayset, start, end, ii, options) {\n    var filtered = false;\n    for (var dayCounter = start; dayCounter < end; dayCounter++) {\n        var currentDay = dayset[dayCounter];\n        filtered = isFiltered(ii, currentDay, options);\n        if (filtered)\n            dayset[currentDay] = null;\n    }\n    return filtered;\n}\nfunction makeTimeset(ii, counterDate, options) {\n    var freq = options.freq, byhour = options.byhour, byminute = options.byminute, bysecond = options.bysecond;\n    if (freqIsDailyOrGreater(freq)) {\n        return buildTimeset(options);\n    }\n    if ((freq >= src_rrule.HOURLY &&\n        notEmpty(byhour) &&\n        !includes(byhour, counterDate.hour)) ||\n        (freq >= src_rrule.MINUTELY &&\n            notEmpty(byminute) &&\n            !includes(byminute, counterDate.minute)) ||\n        (freq >= src_rrule.SECONDLY &&\n            notEmpty(bysecond) &&\n            !includes(bysecond, counterDate.second))) {\n        return [];\n    }\n    return ii.gettimeset(freq)(counterDate.hour, counterDate.minute, counterDate.second, counterDate.millisecond);\n}\n\n// CONCATENATED MODULE: ./src/rrule.ts\n\n\n\n\n\n\n\n\n\n\n\n// =============================================================================\n// RRule\n// =============================================================================\nvar Days = {\n    MO: new Weekday(0),\n    TU: new Weekday(1),\n    WE: new Weekday(2),\n    TH: new Weekday(3),\n    FR: new Weekday(4),\n    SA: new Weekday(5),\n    SU: new Weekday(6)\n};\nvar DEFAULT_OPTIONS = {\n    freq: Frequency.YEARLY,\n    dtstart: null,\n    interval: 1,\n    wkst: Days.MO,\n    count: null,\n    until: null,\n    tzid: null,\n    bysetpos: null,\n    bymonth: null,\n    bymonthday: null,\n    bynmonthday: null,\n    byyearday: null,\n    byweekno: null,\n    byweekday: null,\n    bynweekday: null,\n    byhour: null,\n    byminute: null,\n    bysecond: null,\n    byeaster: null\n};\nvar rrule_defaultKeys = Object.keys(DEFAULT_OPTIONS);\n/**\n *\n * @param {Options?} options - see <http://labix.org/python-dateutil/#head-cf004ee9a75592797e076752b2a889c10f445418>\n *        The only required option is `freq`, one of RRule.YEARLY, RRule.MONTHLY, ...\n * @constructor\n */\nvar rrule_RRule = /** @class */ (function () {\n    function RRule(options, noCache) {\n        if (options === void 0) { options = {}; }\n        if (noCache === void 0) { noCache = false; }\n        // RFC string\n        this._cache = noCache ? null : new cache_Cache();\n        // used by toString()\n        this.origOptions = initializeOptions(options);\n        var parsedOptions = parseOptions(options).parsedOptions;\n        this.options = parsedOptions;\n    }\n    RRule.parseText = function (text, language) {\n        return parseText(text, language);\n    };\n    RRule.fromText = function (text, language) {\n        return fromText(text, language);\n    };\n    RRule.fromString = function (str) {\n        return new RRule(RRule.parseString(str) || undefined);\n    };\n    RRule.prototype._iter = function (iterResult) {\n        return iter(iterResult, this.options);\n    };\n    RRule.prototype._cacheGet = function (what, args) {\n        if (!this._cache)\n            return false;\n        return this._cache._cacheGet(what, args);\n    };\n    RRule.prototype._cacheAdd = function (what, value, args) {\n        if (!this._cache)\n            return;\n        return this._cache._cacheAdd(what, value, args);\n    };\n    /**\n     * @param {Function} iterator - optional function that will be called\n     *                   on each date that is added. It can return false\n     *                   to stop the iteration.\n     * @return Array containing all recurrences.\n     */\n    RRule.prototype.all = function (iterator) {\n        if (iterator) {\n            return this._iter(new callbackiterresult('all', {}, iterator));\n        }\n        var result = this._cacheGet('all');\n        if (result === false) {\n            result = this._iter(new iterresult('all', {}));\n            this._cacheAdd('all', result);\n        }\n        return result;\n    };\n    /**\n     * Returns all the occurrences of the rrule between after and before.\n     * The inc keyword defines what happens if after and/or before are\n     * themselves occurrences. With inc == True, they will be included in the\n     * list, if they are found in the recurrence set.\n     * @return Array\n     */\n    RRule.prototype.between = function (after, before, inc, iterator) {\n        if (inc === void 0) { inc = false; }\n        if (!src_dateutil.isValidDate(after) || !src_dateutil.isValidDate(before))\n            throw new Error('Invalid date passed in to RRule.between');\n        var args = {\n            before: before,\n            after: after,\n            inc: inc\n        };\n        if (iterator) {\n            return this._iter(new callbackiterresult('between', args, iterator));\n        }\n        var result = this._cacheGet('between', args);\n        if (result === false) {\n            result = this._iter(new iterresult('between', args));\n            this._cacheAdd('between', result, args);\n        }\n        return result;\n    };\n    /**\n     * Returns the last recurrence before the given datetime instance.\n     * The inc keyword defines what happens if dt is an occurrence.\n     * With inc == True, if dt itself is an occurrence, it will be returned.\n     * @return Date or null\n     */\n    RRule.prototype.before = function (dt, inc) {\n        if (inc === void 0) { inc = false; }\n        if (!src_dateutil.isValidDate(dt))\n            throw new Error('Invalid date passed in to RRule.before');\n        var args = { dt: dt, inc: inc };\n        var result = this._cacheGet('before', args);\n        if (result === false) {\n            result = this._iter(new iterresult('before', args));\n            this._cacheAdd('before', result, args);\n        }\n        return result;\n    };\n    /**\n     * Returns the first recurrence after the given datetime instance.\n     * The inc keyword defines what happens if dt is an occurrence.\n     * With inc == True, if dt itself is an occurrence, it will be returned.\n     * @return Date or null\n     */\n    RRule.prototype.after = function (dt, inc) {\n        if (inc === void 0) { inc = false; }\n        if (!src_dateutil.isValidDate(dt))\n            throw new Error('Invalid date passed in to RRule.after');\n        var args = { dt: dt, inc: inc };\n        var result = this._cacheGet('after', args);\n        if (result === false) {\n            result = this._iter(new iterresult('after', args));\n            this._cacheAdd('after', result, args);\n        }\n        return result;\n    };\n    /**\n     * Returns the number of recurrences in this set. It will have go trough\n     * the whole recurrence, if this hasn't been done before.\n     */\n    RRule.prototype.count = function () {\n        return this.all().length;\n    };\n    /**\n     * Converts the rrule into its string representation\n     * @see <http://www.ietf.org/rfc/rfc2445.txt>\n     * @return String\n     */\n    RRule.prototype.toString = function () {\n        return optionsToString(this.origOptions);\n    };\n    /**\n     * Will convert all rules described in nlp:ToText\n     * to text.\n     */\n    RRule.prototype.toText = function (gettext, language, dateFormatter) {\n        return toText(this, gettext, language, dateFormatter);\n    };\n    RRule.prototype.isFullyConvertibleToText = function () {\n        return isFullyConvertible(this);\n    };\n    /**\n     * @return a RRule instance with the same freq and options\n     *          as this one (cache is not cloned)\n     */\n    RRule.prototype.clone = function () {\n        return new RRule(this.origOptions);\n    };\n    // RRule class 'constants'\n    RRule.FREQUENCIES = [\n        'YEARLY',\n        'MONTHLY',\n        'WEEKLY',\n        'DAILY',\n        'HOURLY',\n        'MINUTELY',\n        'SECONDLY'\n    ];\n    RRule.YEARLY = Frequency.YEARLY;\n    RRule.MONTHLY = Frequency.MONTHLY;\n    RRule.WEEKLY = Frequency.WEEKLY;\n    RRule.DAILY = Frequency.DAILY;\n    RRule.HOURLY = Frequency.HOURLY;\n    RRule.MINUTELY = Frequency.MINUTELY;\n    RRule.SECONDLY = Frequency.SECONDLY;\n    RRule.MO = Days.MO;\n    RRule.TU = Days.TU;\n    RRule.WE = Days.WE;\n    RRule.TH = Days.TH;\n    RRule.FR = Days.FR;\n    RRule.SA = Days.SA;\n    RRule.SU = Days.SU;\n    RRule.parseString = parseString;\n    RRule.optionsToString = optionsToString;\n    return RRule;\n}());\n/* harmony default export */ var src_rrule = (rrule_RRule);\n\n// CONCATENATED MODULE: ./src/iterset.ts\n\n\n\nfunction iterSet(iterResult, _rrule, _exrule, _rdate, _exdate, tzid) {\n    var _exdateHash = {};\n    var _accept = iterResult.accept;\n    function evalExdate(after, before) {\n        _exrule.forEach(function (rrule) {\n            rrule.between(after, before, true).forEach(function (date) {\n                _exdateHash[Number(date)] = true;\n            });\n        });\n    }\n    _exdate.forEach(function (date) {\n        var zonedDate = new datewithzone_DateWithZone(date, tzid).rezonedDate();\n        _exdateHash[Number(zonedDate)] = true;\n    });\n    iterResult.accept = function (date) {\n        var dt = Number(date);\n        if (isNaN(dt))\n            return _accept.call(this, date);\n        if (!_exdateHash[dt]) {\n            evalExdate(new Date(dt - 1), new Date(dt + 1));\n            if (!_exdateHash[dt]) {\n                _exdateHash[dt] = true;\n                return _accept.call(this, date);\n            }\n        }\n        return true;\n    };\n    if (iterResult.method === 'between') {\n        evalExdate(iterResult.args.after, iterResult.args.before);\n        iterResult.accept = function (date) {\n            var dt = Number(date);\n            if (!_exdateHash[dt]) {\n                _exdateHash[dt] = true;\n                return _accept.call(this, date);\n            }\n            return true;\n        };\n    }\n    for (var i = 0; i < _rdate.length; i++) {\n        var zonedDate = new datewithzone_DateWithZone(_rdate[i], tzid).rezonedDate();\n        if (!iterResult.accept(new Date(zonedDate.getTime())))\n            break;\n    }\n    _rrule.forEach(function (rrule) {\n        iter(iterResult, rrule.options);\n    });\n    var res = iterResult._result;\n    src_dateutil.sort(res);\n    switch (iterResult.method) {\n        case 'all':\n        case 'between':\n            return res;\n        case 'before':\n            return ((res.length && res[res.length - 1]) || null);\n        case 'after':\n        default:\n            return ((res.length && res[0]) || null);\n    }\n}\n\n// CONCATENATED MODULE: ./src/rrulestr.ts\n\n\n\n\n\n\n/**\n * RRuleStr\n *  To parse a set of rrule strings\n */\nvar rrulestr_DEFAULT_OPTIONS = {\n    dtstart: null,\n    cache: false,\n    unfold: false,\n    forceset: false,\n    compatible: false,\n    tzid: null\n};\nfunction parseInput(s, options) {\n    var rrulevals = [];\n    var rdatevals = [];\n    var exrulevals = [];\n    var exdatevals = [];\n    var _a = parseDtstart(s), dtstart = _a.dtstart, tzid = _a.tzid;\n    var lines = splitIntoLines(s, options.unfold);\n    lines.forEach(function (line) {\n        if (!line)\n            return;\n        var _a = breakDownLine(line), name = _a.name, parms = _a.parms, value = _a.value;\n        switch (name.toUpperCase()) {\n            case 'RRULE':\n                if (parms.length) {\n                    throw new Error(\"unsupported RRULE parm: \" + parms.join(','));\n                }\n                rrulevals.push(parseString(line));\n                break;\n            case 'RDATE':\n                var _b = /RDATE(?:;TZID=([^:=]+))?/i.exec(line), _ = _b[0], rdateTzid = _b[1];\n                if (rdateTzid && !tzid) {\n                    tzid = rdateTzid;\n                }\n                rdatevals = rdatevals.concat(parseRDate(value, parms));\n                break;\n            case 'EXRULE':\n                if (parms.length) {\n                    throw new Error(\"unsupported EXRULE parm: \" + parms.join(','));\n                }\n                exrulevals.push(parseString(value));\n                break;\n            case 'EXDATE':\n                exdatevals = exdatevals.concat(parseRDate(value, parms));\n                break;\n            case 'DTSTART':\n                break;\n            default:\n                throw new Error('unsupported property: ' + name);\n        }\n    });\n    return {\n        dtstart: dtstart,\n        tzid: tzid,\n        rrulevals: rrulevals,\n        rdatevals: rdatevals,\n        exrulevals: exrulevals,\n        exdatevals: exdatevals\n    };\n}\nfunction buildRule(s, options) {\n    var _a = parseInput(s, options), rrulevals = _a.rrulevals, rdatevals = _a.rdatevals, exrulevals = _a.exrulevals, exdatevals = _a.exdatevals, dtstart = _a.dtstart, tzid = _a.tzid;\n    var noCache = options.cache === false;\n    if (options.compatible) {\n        options.forceset = true;\n        options.unfold = true;\n    }\n    if (options.forceset ||\n        rrulevals.length > 1 ||\n        rdatevals.length ||\n        exrulevals.length ||\n        exdatevals.length) {\n        var rset_1 = new rruleset(noCache);\n        rset_1.dtstart(dtstart);\n        rset_1.tzid(tzid || undefined);\n        rrulevals.forEach(function (val) {\n            rset_1.rrule(new src_rrule(groomRruleOptions(val, dtstart, tzid), noCache));\n        });\n        rdatevals.forEach(function (date) {\n            rset_1.rdate(date);\n        });\n        exrulevals.forEach(function (val) {\n            rset_1.exrule(new src_rrule(groomRruleOptions(val, dtstart, tzid), noCache));\n        });\n        exdatevals.forEach(function (date) {\n            rset_1.exdate(date);\n        });\n        if (options.compatible && options.dtstart)\n            rset_1.rdate(dtstart);\n        return rset_1;\n    }\n    var val = rrulevals[0] || {};\n    return new src_rrule(groomRruleOptions(val, val.dtstart || options.dtstart || dtstart, val.tzid || options.tzid || tzid), noCache);\n}\nfunction rrulestr(s, options) {\n    if (options === void 0) { options = {}; }\n    return buildRule(s, rrulestr_initializeOptions(options));\n}\nfunction groomRruleOptions(val, dtstart, tzid) {\n    return __assign(__assign({}, val), { dtstart: dtstart,\n        tzid: tzid });\n}\nfunction rrulestr_initializeOptions(options) {\n    var invalid = [];\n    var keys = Object.keys(options);\n    var defaultKeys = Object.keys(rrulestr_DEFAULT_OPTIONS);\n    keys.forEach(function (key) {\n        if (!includes(defaultKeys, key))\n            invalid.push(key);\n    });\n    if (invalid.length) {\n        throw new Error('Invalid options: ' + invalid.join(', '));\n    }\n    return __assign(__assign({}, rrulestr_DEFAULT_OPTIONS), options);\n}\nfunction extractName(line) {\n    if (line.indexOf(':') === -1) {\n        return {\n            name: 'RRULE',\n            value: line\n        };\n    }\n    var _a = split(line, ':', 1), name = _a[0], value = _a[1];\n    return {\n        name: name,\n        value: value\n    };\n}\nfunction breakDownLine(line) {\n    var _a = extractName(line), name = _a.name, value = _a.value;\n    var parms = name.split(';');\n    if (!parms)\n        throw new Error('empty property name');\n    return {\n        name: parms[0].toUpperCase(),\n        parms: parms.slice(1),\n        value: value\n    };\n}\nfunction splitIntoLines(s, unfold) {\n    if (unfold === void 0) { unfold = false; }\n    s = s && s.trim();\n    if (!s)\n        throw new Error('Invalid empty string');\n    // More info about 'unfold' option\n    // Go head to http://www.ietf.org/rfc/rfc2445.txt\n    if (!unfold) {\n        return s.split(/\\s/);\n    }\n    var lines = s.split('\\n');\n    var i = 0;\n    while (i < lines.length) {\n        // TODO\n        var line = (lines[i] = lines[i].replace(/\\s+$/g, ''));\n        if (!line) {\n            lines.splice(i, 1);\n        }\n        else if (i > 0 && line[0] === ' ') {\n            lines[i - 1] += line.slice(1);\n            lines.splice(i, 1);\n        }\n        else {\n            i += 1;\n        }\n    }\n    return lines;\n}\nfunction validateDateParm(parms) {\n    parms.forEach(function (parm) {\n        if (!/(VALUE=DATE(-TIME)?)|(TZID=)/.test(parm)) {\n            throw new Error('unsupported RDATE/EXDATE parm: ' + parm);\n        }\n    });\n}\nfunction parseRDate(rdateval, parms) {\n    validateDateParm(parms);\n    return rdateval\n        .split(',')\n        .map(function (datestr) { return src_dateutil.untilStringToDate(datestr); });\n}\n\n// CONCATENATED MODULE: ./src/rruleset.ts\n\n\n\n\n\n\n\nfunction createGetterSetter(fieldName) {\n    var _this = this;\n    return function (field) {\n        if (field !== undefined) {\n            _this[\"_\" + fieldName] = field;\n        }\n        if (_this[\"_\" + fieldName] !== undefined) {\n            return _this[\"_\" + fieldName];\n        }\n        for (var i = 0; i < _this._rrule.length; i++) {\n            var field_1 = _this._rrule[i].origOptions[fieldName];\n            if (field_1) {\n                return field_1;\n            }\n        }\n    };\n}\nvar rruleset_RRuleSet = /** @class */ (function (_super) {\n    __extends(RRuleSet, _super);\n    /**\n     *\n     * @param {Boolean?} noCache\n     *  The same stratagy as RRule on cache, default to false\n     * @constructor\n     */\n    function RRuleSet(noCache) {\n        if (noCache === void 0) { noCache = false; }\n        var _this = _super.call(this, {}, noCache) || this;\n        _this.dtstart = createGetterSetter.apply(_this, ['dtstart']);\n        _this.tzid = createGetterSetter.apply(_this, ['tzid']);\n        _this._rrule = [];\n        _this._rdate = [];\n        _this._exrule = [];\n        _this._exdate = [];\n        return _this;\n    }\n    RRuleSet.prototype._iter = function (iterResult) {\n        return iterSet(iterResult, this._rrule, this._exrule, this._rdate, this._exdate, this.tzid());\n    };\n    /**\n     * Adds an RRule to the set\n     *\n     * @param {RRule}\n     */\n    RRuleSet.prototype.rrule = function (rrule) {\n        _addRule(rrule, this._rrule);\n    };\n    /**\n     * Adds an EXRULE to the set\n     *\n     * @param {RRule}\n     */\n    RRuleSet.prototype.exrule = function (rrule) {\n        _addRule(rrule, this._exrule);\n    };\n    /**\n     * Adds an RDate to the set\n     *\n     * @param {Date}\n     */\n    RRuleSet.prototype.rdate = function (date) {\n        _addDate(date, this._rdate);\n    };\n    /**\n     * Adds an EXDATE to the set\n     *\n     * @param {Date}\n     */\n    RRuleSet.prototype.exdate = function (date) {\n        _addDate(date, this._exdate);\n    };\n    /**\n     * Get list of included rrules in this recurrence set.\n     *\n     * @return List of rrules\n     */\n    RRuleSet.prototype.rrules = function () {\n        return this._rrule.map(function (e) { return rrulestr(e.toString()); });\n    };\n    /**\n     * Get list of excluded rrules in this recurrence set.\n     *\n     * @return List of exrules\n     */\n    RRuleSet.prototype.exrules = function () {\n        return this._exrule.map(function (e) { return rrulestr(e.toString()); });\n    };\n    /**\n     * Get list of included datetimes in this recurrence set.\n     *\n     * @return List of rdates\n     */\n    RRuleSet.prototype.rdates = function () {\n        return this._rdate.map(function (e) { return new Date(e.getTime()); });\n    };\n    /**\n     * Get list of included datetimes in this recurrence set.\n     *\n     * @return List of exdates\n     */\n    RRuleSet.prototype.exdates = function () {\n        return this._exdate.map(function (e) { return new Date(e.getTime()); });\n    };\n    RRuleSet.prototype.valueOf = function () {\n        var result = [];\n        if (!this._rrule.length && this._dtstart) {\n            result = result.concat(optionsToString({ dtstart: this._dtstart }));\n        }\n        this._rrule.forEach(function (rrule) {\n            result = result.concat(rrule.toString().split('\\n'));\n        });\n        this._exrule.forEach(function (exrule) {\n            result = result.concat(exrule.toString().split('\\n')\n                .map(function (line) { return line.replace(/^RRULE:/, 'EXRULE:'); })\n                .filter(function (line) { return !/^DTSTART/.test(line); }));\n        });\n        if (this._rdate.length) {\n            result.push(rdatesToString('RDATE', this._rdate, this.tzid()));\n        }\n        if (this._exdate.length) {\n            result.push(rdatesToString('EXDATE', this._exdate, this.tzid()));\n        }\n        return result;\n    };\n    /**\n     * to generate recurrence field such as:\n     *   DTSTART:19970902T010000Z\n     *   RRULE:FREQ=YEARLY;COUNT=2;BYDAY=TU\n     *   RRULE:FREQ=YEARLY;COUNT=1;BYDAY=TH\n     */\n    RRuleSet.prototype.toString = function () {\n        return this.valueOf().join('\\n');\n    };\n    /**\n     * Create a new RRuleSet Object completely base on current instance\n     */\n    RRuleSet.prototype.clone = function () {\n        var rrs = new RRuleSet(!!this._cache);\n        this._rrule.forEach(function (rule) { return rrs.rrule(rule.clone()); });\n        this._exrule.forEach(function (rule) { return rrs.exrule(rule.clone()); });\n        this._rdate.forEach(function (date) { return rrs.rdate(new Date(date.getTime())); });\n        this._exdate.forEach(function (date) { return rrs.exdate(new Date(date.getTime())); });\n        return rrs;\n    };\n    return RRuleSet;\n}(src_rrule));\n/* harmony default export */ var rruleset = (rruleset_RRuleSet);\nfunction _addRule(rrule, collection) {\n    if (!(rrule instanceof src_rrule)) {\n        throw new TypeError(String(rrule) + ' is not RRule instance');\n    }\n    if (!includes(collection.map(String), String(rrule))) {\n        collection.push(rrule);\n    }\n}\nfunction _addDate(date, collection) {\n    if (!(date instanceof Date)) {\n        throw new TypeError(String(date) + ' is not Date instance');\n    }\n    if (!includes(collection.map(Number), Number(date))) {\n        collection.push(date);\n        src_dateutil.sort(collection);\n    }\n}\nfunction rdatesToString(param, rdates, tzid) {\n    var isUTC = !tzid || tzid.toUpperCase() === 'UTC';\n    var header = isUTC ? param + \":\" : param + \";TZID=\" + tzid + \":\";\n    var dateString = rdates\n        .map(function (rdate) { return src_dateutil.timeToUntilString(rdate.valueOf(), isUTC); })\n        .join(',');\n    return \"\" + header + dateString;\n}\n\n// CONCATENATED MODULE: ./src/index.ts\n/* concated harmony reexport rrulestr */__webpack_require__.d(__webpack_exports__, \"rrulestr\", function() { return rrulestr; });\n/* concated harmony reexport Frequency */__webpack_require__.d(__webpack_exports__, \"Frequency\", function() { return Frequency; });\n/* concated harmony reexport Weekday */__webpack_require__.d(__webpack_exports__, \"Weekday\", function() { return Weekday; });\n/* concated harmony reexport RRule */__webpack_require__.d(__webpack_exports__, \"RRule\", function() { return src_rrule; });\n/* concated harmony reexport RRuleSet */__webpack_require__.d(__webpack_exports__, \"RRuleSet\", function() { return rruleset; });\n/*!\n * rrule.js - Library for working with recurrence rules for calendar dates.\n * https://github.com/jakubroztocil/rrule\n *\n * Copyright 2010, Jakub Roztocil and Lars Schoning\n * Licenced under the BSD licence.\n * https://github.com/jakubroztocil/rrule/blob/master/LICENCE\n *\n * Based on:\n * python-dateutil - Extensions to the standard Python datetime module.\n * Copyright (c) 2003-2011 - Gustavo Niemeyer <gustavo@niemeyer.net>\n * Copyright (c) 2012 - Tomi Pievil\u00E4inen <tomi.pievilainen@iki.fi>\n * https://github.com/jakubroztocil/rrule/blob/master/LICENCE\n *\n */\n\n\n\n\n\n\n/* harmony default export */ var src = __webpack_exports__[\"default\"] = (src_rrule);\n\n\n/***/ })\n/******/ ]);\n});\n//# sourceMappingURL=rrule.js.map", "let resolved;\n\n/**\n * Returns a cached resolved promise.\n * Babel converts direct calls to Promise.resolve() (with no arguments) into\n * calls to this.\n *\n * @return {!Promise<undefined>}\n */\nexport function resolvedPromise() {\n  if (resolved) {\n    return resolved;\n  }\n\n  // It's important that we call with `undefined` here, to prevent a transform\n  // recursion. If we didn't pass an arg, then the transformer would replace\n  // this callsite with a call to `resolvedPromise()`.\n  resolved = Promise.resolve(undefined);\n  return resolved;\n}\n\n/**\n * Returns a Deferred struct, which holds a pending promise and its associated\n * resolve and reject functions.\n *\n * This is preferred instead of creating a Promise instance to extract the\n * resolve/reject functions yourself:\n *\n * ```\n * // Avoid doing\n * let resolve;\n * const promise = new Promise(res => {\n *   resolve = res;\n * });\n *\n * // Good\n * const deferred = new Deferred();\n * const { promise, resolve } = deferred;\n * ```\n *\n * @template T\n */\nexport class Deferred {\n  /** Constructor. */\n  constructor() {\n    /** @const {!Promise<T>} */\n    this.promise = new /*OK*/ Promise((res, rej) => {\n      /** @const {function(T=)} */\n      this.resolve = res;\n      /** @const {function(*=)} */\n      this.reject = rej;\n    });\n  }\n}\n\n/**\n * Creates a promise resolved to the return value of fn.\n * If fn sync throws, it will cause the promise to reject.\n *\n * @param {function():T} fn\n * @return {!Promise<T>}\n * @template T\n */\nexport function tryResolve(fn) {\n  return new Promise((resolve) => {\n    resolve(fn());\n  });\n}\n\n/**\n * Resolves with the result of the last promise added.\n * @implements {IThenable}\n */\nexport class LastAddedResolver {\n  /**\n   * @param {!Array<!IThenable>=} opt_promises\n   */\n  constructor(opt_promises) {\n    /** @private @const {!Deferred} */\n    this.deferred_ = new Deferred();\n\n    /** @private */\n    this.count_ = 0;\n\n    if (opt_promises) {\n      for (const promise of opt_promises) {\n        this.add(promise);\n      }\n    }\n  }\n\n  /**\n   * Add a promise to possibly be resolved.\n   * @param {!IThenable} promise\n   * @return {!Promise}\n   */\n  add(promise) {\n    const countAtAdd = ++this.count_;\n    promise.then(\n      (result) => {\n        if (this.count_ === countAtAdd) {\n          this.deferred_.resolve(result);\n        }\n      },\n      (error) => {\n        // Don't follow behavior of Promise.all and Promise.race error so that\n        // this will only reject when most recently added promise fails.\n        if (this.count_ === countAtAdd) {\n          this.deferred_.reject(error);\n        }\n      }\n    );\n    return this.deferred_.promise;\n  }\n\n  /** @override */\n  then(opt_resolve, opt_reject) {\n    return this.deferred_.promise.then(opt_resolve, opt_reject);\n  }\n}\n", "/**\n * Returns true when the build is meant for distribution.\n * This means `amp dist` was called _without_ the --fortesting flag.\n *\n * This is a magic constant replaced by babel.\n *\n * Calls are DCE'd when compiled.\n * @return {boolean}\n */\nexport function isProd() {\n  return IS_PROD;\n}\n", "import {isProd} from './prod';\n\n/**\n * Returns true if executing in a testing environment. Calls may be DCE'd when\n * compiled based on isForDistribution.\n * @param {!Window=} opt_win\n * @return {boolean}\n */\nexport function isTest(opt_win) {\n  if (isProd()) {\n    return false;\n  }\n  const win = opt_win || self;\n  return !!(win.AMP_CONFIG?.test || win.__AMP_TEST || win['__karma__']);\n}\n", "/**\n * Returns true whenever closure compiler is used.\n * This is a magic constant that is replaced by babel.\n *\n * @return {boolean}\n */\nexport function isMinified() {\n  return IS_MINIFIED;\n}\n", "/**\n * Copyright 2021 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {isProd} from './prod';\n\n/**\n * Returns true when compiling an esm binary.\n * This is a magic constant that is replaced by babel.\n *\n * @return {boolean}\n */\nexport function isEsm() {\n  if (isProd()) {\n    return IS_ESM;\n  }\n\n  return self?.__AMP_MODE?.esm ?? IS_ESM;\n}\n", "/**\n * Converts an array-like object to an array.\n * @param {?IArrayLike<T>|string} arrayLike\n * @return {!Array<T>}\n * @template T\n */\nexport function toArray(arrayLike) {\n  return arrayLike ? Array.prototype.slice.call(arrayLike) : [];\n}\n\n/**\n * Determines if value is actually an Array.\n * @param {*} value\n * @return {boolean}\n */\nexport const {isArray} = Array;\n\n/**\n * If the specified argument is an array, it's returned as is. If it's a\n * single item, the array containing this item is created and returned.\n *\n * The double-template pattern here solves a bug where CC can be passed a value\n * with declared type {string|!Array<string>} and return a value with a type of\n * {!Array<string|Array<string>>}.\n *\n * @param {!Array<T>|S} arrayOrSingleItem\n * @return {!Array<T>|!Array<S>}\n * @template S\n * @template T\n */\nexport function arrayOrSingleItemToArray(arrayOrSingleItem) {\n  return isArray(arrayOrSingleItem)\n    ? /** @type {!Array<T>} */ (arrayOrSingleItem)\n    : [/** @type {!S} */ (arrayOrSingleItem)];\n}\n\n/**\n * Compares if two arrays contains exactly same elements of same number\n * of same order. Note that it does NOT handle NaN case as expected.\n *\n * @param {!Array<T>} arr1\n * @param {!Array<T>} arr2\n * @return {boolean}\n * @template T\n */\nexport function areEqualOrdered(arr1, arr2) {\n  if (arr1.length !== arr2.length) {\n    return false;\n  }\n  for (let i = 0; i < arr1.length; i++) {\n    if (arr1[i] !== arr2[i]) {\n      return false;\n    }\n  }\n  return true;\n}\n\n/**\n * Removes elements that shouldRemove returns true for from the array.\n *\n * @param {!Array<T>} array\n * @param {function(T, number, !Array<T>):boolean} shouldRemove\n * @return {!Array<T>}\n * @template T\n */\nexport function remove(array, shouldRemove) {\n  const removed = [];\n  let index = 0;\n  for (let i = 0; i < array.length; i++) {\n    const item = array[i];\n    if (shouldRemove(item, i, array)) {\n      removed.push(item);\n    } else {\n      if (index < i) {\n        array[index] = item;\n      }\n      index++;\n    }\n  }\n  if (index < array.length) {\n    array.length = index;\n  }\n  return removed;\n}\n\n/**\n * Returns the index of the first element matching the predicate.\n * Like Array#findIndex.\n *\n * @param {!Array<T>} array\n * @param {function(T, number, !Array<T>):boolean} predicate\n * @return {number}\n * @template T\n */\nexport function findIndex(array, predicate) {\n  for (let i = 0; i < array.length; i++) {\n    if (predicate(array[i], i, array)) {\n      return i;\n    }\n  }\n  return -1;\n}\n\n/**\n * Converts the given iterator to an array.\n *\n * @param {!Iterator<T>} iterator\n * @return {Array<T>}\n * @template T\n */\nexport function fromIterator(iterator) {\n  const array = [];\n  for (let e = iterator.next(); !e.done; e = iterator.next()) {\n    array.push(e.value);\n  }\n  return array;\n}\n\n/**\n * Adds item to array if it is not already present.\n *\n * @param {Array<T>} array\n * @param {T} item\n * @return {boolean}\n * @template T\n */\nexport function pushIfNotExist(array, item) {\n  if (array.indexOf(item) < 0) {\n    array.push(item);\n    return true;\n  }\n  return false;\n}\n\n/**\n * Removes the first matching item in the array. Returns `true` if the array\n * has changed.\n *\n * @param {!Array<T>} array\n * @param {T} item\n * @return {boolean}\n * @template T\n */\nexport function removeItem(array, item) {\n  const index = array.indexOf(item);\n  if (index == -1) {\n    return false;\n  }\n  array.splice(index, 1);\n  return true;\n}\n\n/**\n * Returns the last item in an array.\n *\n * @param {Array<T>} array\n * @template T\n * @return {?T}\n */\nexport function lastItem(array) {\n  return array[array.length - 1];\n}\n", "/**\n * @param {string} _match\n * @param {string} character\n * @return {string}\n */\nfunction toUpperCase(_match, character) {\n  return character.toUpperCase();\n}\n\n/**\n * @param {string} match\n * @return {string}\n */\nfunction prependDashAndToLowerCase(match) {\n  return '-' + match.toLowerCase();\n}\n\n/**\n * @param {string} name Attribute name containing dashes.\n * @return {string} Dashes removed and successive character sent to upper case.\n * visibleForTesting\n */\nexport function dashToCamelCase(name) {\n  return name.replace(/-([a-z])/g, toUpperCase);\n}\n\n/**\n * Converts a string that is in camelCase to one that is in dash-case.\n *\n * @param {string} string The string to convert.\n * @return {string} The string in dash-case.\n */\nexport function camelCaseToDash(string) {\n  return string.replace(/(?!^)[A-Z]/g, prependDashAndToLowerCase);\n}\n\n/**\n * @param {string} name Attribute name with dashes\n * @return {string} Dashes replaced by underlines.\n */\nexport function dashToUnderline(name) {\n  return name.replace('-', '_');\n}\n\n/**\n * Polyfill for String.prototype.endsWith.\n * @param {string} string\n * @param {string} suffix\n * @return {boolean}\n */\nexport function endsWith(string, suffix) {\n  const index = string.length - suffix.length;\n  return index >= 0 && string.indexOf(suffix, index) == index;\n}\n\n/**\n * Polyfill for String.prototype.includes.\n * @param {string} string\n * @param {string} substring\n * @param {number=} start\n * @return {boolean}\n */\nexport function includes(string, substring, start) {\n  if (typeof start !== 'number') {\n    start = 0;\n  }\n  if (start + substring.length > string.length) {\n    return false;\n  }\n  return string.indexOf(substring, start) !== -1;\n}\n\n/**\n * Expands placeholders in a given template string with values.\n *\n * Placeholders use ${key-name} syntax and are replaced with the value\n * returned from the given getter function.\n *\n * @param {string} template The template string to expand.\n * @param {function(string):*} getter Function used to retrieve a value for a\n *   placeholder. Returns values will be coerced into strings.\n * @param {number=} opt_maxIterations Number of times to expand the template.\n *   Defaults to 1, but should be set to a larger value your placeholder tokens\n *   can be expanded to other placeholder tokens. Take caution with large values\n *   as recursively expanding a string can be exponentially expensive.\n * @return {string}\n */\nexport function expandTemplate(template, getter, opt_maxIterations) {\n  const maxIterations = opt_maxIterations || 1;\n  for (let i = 0; i < maxIterations; i++) {\n    let matches = 0;\n    template = template.replace(/\\${([^}]*)}/g, (_a, b) => {\n      matches++;\n      return getter(b);\n    });\n    if (!matches) {\n      break;\n    }\n  }\n  return template;\n}\n\n/**\n * Hash function djb2a\n * This is intended to be a simple, fast hashing function using minimal code.\n * It does *not* have good cryptographic properties.\n * @param {string} str\n * @return {string} 32-bit unsigned hash of the string\n */\nexport function stringHash32(str) {\n  const {length} = str;\n  let hash = 5381;\n  for (let i = 0; i < length; i++) {\n    hash = (hash * 33) ^ str.charCodeAt(i);\n  }\n  // Convert from 32-bit signed to unsigned.\n  return String(hash >>> 0);\n}\n\n/**\n * Trims a string on the end, removing whitespace characters.\n * @param {string} str  A string to trim.\n * @return {string} The string, with trailing whitespace removed.\n */\nexport function trimEnd(str) {\n  // TODO(sparhami) Does this get inlined for an ES2019 build?\n  if (str.trimEnd) {\n    return str.trimEnd();\n  }\n\n  return ('_' + str).trim().slice(1);\n}\n\n/**\n * Trims any leading whitespace from a string.\n * @param {string} str  A string to trim.\n * @return {string} The string, with leading whitespace removed.\n */\nexport function trimStart(str) {\n  if (str.trimStart) {\n    return str.trimStart();\n  }\n\n  return (str + '_').trim().slice(0, -1);\n}\n\n/**\n * Wrapper around String.replace that handles asynchronous resolution.\n * @param {string} str\n * @param {RegExp} regex\n * @param {Function|string} replacer\n * @return {!Promise<string>}\n */\nexport function asyncStringReplace(str, regex, replacer) {\n  if (isString(replacer)) {\n    return Promise.resolve(str.replace(regex, replacer));\n  }\n  const stringBuilder = [];\n  let lastIndex = 0;\n\n  str.replace(regex, function (match) {\n    // String.prototype.replace will pass 3 to n number of arguments to the\n    // callback function based on how many capture groups the regex may or may\n    // not contain. We know that the match will always be first, and the\n    // index will always be second to last.\n    const matchIndex = arguments[arguments.length - 2];\n    stringBuilder.push(str.slice(lastIndex, matchIndex));\n    lastIndex = matchIndex + match.length;\n\n    // Store the promise in it's eventual string position.\n    const replacementPromise = replacer.apply(null, arguments);\n    stringBuilder.push(replacementPromise);\n  });\n  stringBuilder.push(str.slice(lastIndex));\n\n  return Promise.all(stringBuilder).then((resolved) => resolved.join(''));\n}\n\n/**\n * Pads the beginning of a string with a substring to a target length.\n * @param {string} s\n * @param {number} targetLength\n * @param {string} padString\n * @return {string}\n */\nexport function padStart(s, targetLength, padString) {\n  if (s.length >= targetLength) {\n    return s;\n  }\n  targetLength = targetLength - s.length;\n  let padding = padString;\n  while (targetLength > padding.length) {\n    padding += padString;\n  }\n  return padding.slice(0, targetLength) + s;\n}\n\n/**\n * Tests if a value is a string.\n * @param {?} s\n * @return {boolean}\n */\nexport function isString(s) {\n  return typeof s == 'string';\n}\n", "/* @const */\nconst {hasOwnProperty: hasOwn_, toString: toString_} = Object.prototype;\n\n/**\n * Determines if value is actually an Object.\n * @param {*} value\n * @return {boolean}\n */\nexport function isObject(value) {\n  return toString_.call(value) === '[object Object]';\n}\n\n/**\n * Returns a map-like object.\n * If opt_initial is provided, copies its own properties into the\n * newly created object.\n * @param {T=} opt_initial This should typically be an object literal.\n * @return {T}\n * @template T\n */\nexport function map(opt_initial) {\n  const obj = Object.create(null);\n  if (opt_initial) {\n    Object.assign(obj, opt_initial);\n  }\n  return obj;\n}\n\n/**\n * Return an empty JsonObject or makes the passed in object literal\n * an JsonObject.\n * The JsonObject type is just a simple object that is at-dict.\n * See\n * https://github.com/google/closure-compiler/wiki/@struct-and-@dict-Annotations\n * for what a dict is type-wise.\n * The linter enforces that the argument is, in fact, at-dict like.\n * @param {!Object=} opt_initial\n * @return {!JsonObject}\n */\nexport function dict(opt_initial) {\n  // We do not copy. The linter enforces that the passed in object is a literal\n  // and thus the caller cannot have a reference to it.\n  return /** @type {!JsonObject} */ (opt_initial || {});\n}\n\n/**\n * Checks if the given key is a property in the map.\n *\n * @param {T}  obj a map like property.\n * @param {string}  key\n * @return {boolean}\n * @template T\n */\nexport function hasOwn(obj, key) {\n  return hasOwn_.call(obj, key);\n}\n\n/**\n * Returns obj[key] iff key is obj's own property (is not inherited).\n * Otherwise, returns undefined.\n *\n * @param {Object} obj\n * @param {string} key\n * @return {*}\n */\nexport function ownProperty(obj, key) {\n  if (hasOwn(obj, key)) {\n    return obj[key];\n  } else {\n    return undefined;\n  }\n}\n\n/**\n * Deep merges source into target.\n *\n * @param {!Object} target\n * @param {!Object} source\n * @param {number} depth The maximum merge depth. If exceeded, Object.assign\n *                       will be used instead.\n * @return {!Object}\n * @throws {Error} If source contains a circular reference.\n * Note: Only nested objects are deep-merged, primitives and arrays are not.\n */\nexport function deepMerge(target, source, depth = 10) {\n  // Keep track of seen objects to detect recursive references.\n  const seen = [];\n\n  /** @type {!Array<{t: !Object, s: !Object, d: number}>} */\n  const queue = [];\n  queue.push({t: target, s: source, d: 0});\n\n  // BFS to ensure objects don't have recursive references at shallower depths.\n  while (queue.length > 0) {\n    const {d, s, t} = queue.shift();\n    if (seen.includes(s)) {\n      throw new Error('Source object has a circular reference.');\n    }\n    seen.push(s);\n    if (t === s) {\n      continue;\n    }\n    if (d > depth) {\n      Object.assign(t, s);\n      continue;\n    }\n    for (const key of Object.keys(s)) {\n      const newValue = s[key];\n      // Perform a deep merge IFF both target and source have the same key\n      // whose corresponding values are objects.\n      if (hasOwn(t, key)) {\n        const oldValue = t[key];\n        if (isObject(newValue) && isObject(oldValue)) {\n          queue.push({t: oldValue, s: newValue, d: d + 1});\n          continue;\n        }\n      }\n      t[key] = newValue;\n    }\n  }\n  return target;\n}\n\n/**\n * @param {!Object} o An object to remove properties from\n * @param {!Array<string>} props A list of properties to remove from the Object\n * @return {!Object} An object with the given properties removed\n */\nexport function omit(o, props) {\n  return Object.keys(o).reduce((acc, key) => {\n    if (!props.includes(key)) {\n      acc[key] = o[key];\n    }\n    return acc;\n  }, {});\n}\n\n/**\n * @param {!Object|null|undefined} o1\n * @param {!Object|null|undefined} o2\n * @return {boolean}\n */\nexport function objectsEqualShallow(o1, o2) {\n  if (o1 == null || o2 == null) {\n    // Null is only equal to null, and undefined to undefined.\n    return o1 === o2;\n  }\n\n  for (const k in o1) {\n    if (o1[k] !== o2[k]) {\n      return false;\n    }\n  }\n  for (const k in o2) {\n    if (o2[k] !== o1[k]) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\n/**\n * @param {T} obj\n * @param {string} prop\n * @param {function(T, string):R} factory\n * @return {R}\n * @template T,R\n */\nexport function memo(obj, prop, factory) {\n  let result = /** @type {?R} */ (obj[prop]);\n  if (result === undefined) {\n    result = factory(obj, prop);\n    obj[prop] = result;\n  }\n  return result;\n}\n\n/**\n * Recreates objects with prototype-less copies.\n * @param {!JsonObject} obj\n * @return {!JsonObject}\n */\nexport function recreateNonProtoObject(obj) {\n  const copy = map();\n  for (const k in obj) {\n    if (!hasOwn(obj, k)) {\n      continue;\n    }\n    const v = obj[k];\n    copy[k] = isObject(v) ? recreateNonProtoObject(v) : v;\n  }\n  return /** @type {!JsonObject} */ (copy);\n}\n\n/**\n * Returns a value from an object for a field-based expression. The expression\n * is a simple nested dot-notation of fields, such as `field1.field2`. If any\n * field in a chain does not exist or is not an object or array, the returned\n * value will be `undefined`.\n *\n * @param {!JsonObject} obj\n * @param {string} expr\n * @return {*}\n */\nexport function getValueForExpr(obj, expr) {\n  // The `.` indicates \"the object itself\".\n  if (expr == '.') {\n    return obj;\n  }\n  // Otherwise, navigate via properties.\n  const parts = expr.split('.');\n  let value = obj;\n  for (const part of parts) {\n    if (\n      part &&\n      value &&\n      value[part] !== undefined &&\n      typeof value == 'object' &&\n      hasOwn(value, part)\n    ) {\n      value = value[part];\n      continue;\n    }\n    value = undefined;\n    break;\n  }\n  return value;\n}\n", "// Export all type-checking helpers for convenience\nexport {isArray} from './array';\nexport {isEnumValue} from './enum';\nexport {isString} from './string';\nexport {isObject} from './object';\n\n/**\n * Determines if value is an ELement\n * @param {*} value\n * @return {boolean}\n */\nexport function isElement(value) {\n  return value?.nodeType == /* Node.ELEMENT_NODE */ 1;\n}\n\n/**\n * Determines if value is of number type and finite.\n * NaN and Infinity are not considered a finite number.\n * String numbers are not considered numbers.\n * @param {*} value\n * @return {boolean}\n */\nexport function isFiniteNumber(value) {\n  return typeof value === 'number' && isFinite(value);\n}\n", "import {isElement} from '#core/types';\n\n/**\n * Triple zero width space.\n *\n * This is added to user error messages, so that we can later identify\n * them, when the only thing that we have is the message. This is the\n * case in many browsers when the global exception handler is invoked.\n *\n * @const {string}\n */\nexport const USER_ERROR_SENTINEL = '\\u200B\\u200B\\u200B';\n/**\n * Four zero width space.\n *\n * @const {string}\n */\nexport const USER_ERROR_EMBED_SENTINEL = '\\u200B\\u200B\\u200B\\u200B';\n\n/**\n * Converts an element to a readable string; all other types are unchanged.\n * TODO(rcebulko): Unify with log.js\n * @param {*} val\n * @return {*}\n */\nexport function elementStringOrPassThru(val) {\n  // Do check equivalent to `val instanceof Element` without cross-window bug\n  if (isElement(val)) {\n    val = /** @type {Element} */ (val);\n    return val.tagName.toLowerCase() + (val.id ? `#${val.id}` : '');\n  }\n  return val;\n}\n\n/**\n * Tests if an error message contains the user sentinel.\n * @param {string} message\n * @return {boolean} Whether this message was a user error.\n */\nexport function isUserErrorMessage(message) {\n  return message.indexOf(USER_ERROR_SENTINEL) >= 0;\n}\n\n/**\n * @param {string} message\n * @return {boolean} Whether this message was a a user error from an iframe embed.\n */\nexport function isUserErrorEmbedMessage(message) {\n  return message.indexOf(USER_ERROR_EMBED_SENTINEL) >= 0;\n}\n\n/**\n * Strips the user error sentinel from an error message.\n * @param {string} message\n * @return {string} The new message without USER_ERROR_SENTINEL\n */\nexport function stripUserError(message) {\n  return message.replace(USER_ERROR_SENTINEL, '');\n}\n", "import {elementStringOrPassThru} from '#core/error/message-helpers';\nimport {isArray, isElement, isString} from '#core/types';\nimport {remove} from '#core/types/array';\n\n/**\n * @fileoverview This file provides the base implementation for assertion\n * functions. Most files should never import from this; instead, import from\n * `dev` or `user`. It is also used by the Log class for its assertions.\n */\n\n/**\n * A base assertion function, provided to various assertion helpers.\n * @typedef {function(?, string=, ...*):?|function(?, !Array<*>)}\n */\nexport let AssertionFunctionDef;\n\n/**\n * Throws an error if the second argument isn't trueish.\n *\n * Supports argument substitution into the message via %s placeholders.\n *\n * Throws an error object that has two extra properties:\n * - messageArray: The elements of the substituted message as non-stringified\n *   elements in an array. When e.g. passed to console.error this yields\n *   native displays of things like HTML elements.\n * @param {?string} sentinel\n * @param {T} shouldBeTruthy\n * @param {string} opt_message\n * @param {...*} var_args Arguments substituted into %s in the message\n * @return {T}\n * @template T\n * @throws {Error} when shouldBeTruthy is not truthy.\n */\nexport function assert(\n  sentinel,\n  shouldBeTruthy,\n  opt_message = 'Assertion failed',\n  var_args\n) {\n  if (shouldBeTruthy) {\n    return shouldBeTruthy;\n  }\n\n  // Include the sentinel string if provided and not already present\n  if (sentinel && opt_message.indexOf(sentinel) == -1) {\n    opt_message += sentinel;\n  }\n\n  // Skip the first 3 arguments to isolate format params\n  // const messageArgs = Array.prototype.slice.call(arguments, 3);\n  // Index at which message args start\n  let i = 3;\n\n  // Substitute provided values into format string in message\n  const splitMessage = opt_message.split('%s');\n  let message = splitMessage.shift();\n  const messageArray = [message];\n\n  while (splitMessage.length) {\n    const subValue = arguments[i++];\n    const nextConstant = splitMessage.shift();\n\n    message += elementStringOrPassThru(subValue) + nextConstant;\n    messageArray.push(subValue, nextConstant.trim());\n  }\n\n  const error = new Error(message);\n  error.messageArray = remove(messageArray, (x) => x !== '');\n  // __AMP_REPORT_ERROR is installed globally per window in the entry point in\n  // AMP documents. It may not be present for Bento/Preact elements on non-AMP\n  // pages.\n  self.__AMP_REPORT_ERROR?.(error);\n  throw error;\n}\n\n/**\n * Asserts types, backbone of `assertNumber`, `assertString`, etc.\n *\n * It understands array-based \"id\"-contracted messages.\n *\n * Otherwise creates a sprintf syntax string containing the optional message or the\n * default. The `subject` of the assertion is added at the end.\n *\n * @param {!AssertionFunctionDef} assertFn underlying assertion function to call\n * @param {T} subject\n * @param {*} shouldBeTruthy\n * @param {string} defaultMessage\n * @param {!Array<*>|string=} opt_message\n * @return {T}\n * @template T\n * @private\n */\nfunction assertType_(\n  assertFn,\n  subject,\n  shouldBeTruthy,\n  defaultMessage,\n  opt_message\n) {\n  if (isArray(opt_message)) {\n    assertFn(\n      shouldBeTruthy,\n      /** @type {!Array} */ (opt_message).concat([subject])\n    );\n  } else {\n    assertFn(shouldBeTruthy, `${opt_message || defaultMessage}: %s`, subject);\n  }\n\n  return subject;\n}\n\n/**\n * Throws an error if the first argument isn't an Element.\n *\n * For more details see `assert`.\n *\n * @param {!AssertionFunctionDef} assertFn underlying assertion function to call\n * @param {*} shouldBeElement\n * @param {!Array<*>|string=} opt_message The assertion message\n * @return {!Element} The value of shouldBeTrueish.\n * @throws {Error} when shouldBeElement is not an Element\n * @closurePrimitive {asserts.matchesReturn}\n */\nexport function assertElement(assertFn, shouldBeElement, opt_message) {\n  return /** @type {!Element} */ (\n    assertType_(\n      assertFn,\n      shouldBeElement,\n      isElement(shouldBeElement),\n      'Element expected',\n      opt_message\n    )\n  );\n}\n\n/**\n * Throws an error if the first argument isn't a string. The string can\n * be empty.\n *\n * For more details see `assert`.\n *\n * @param {!AssertionFunctionDef} assertFn underlying assertion function to call\n * @param {*} shouldBeString\n * @param {!Array<*>|string=} opt_message The assertion message\n * @return {string} The string value. Can be an empty string.\n * @throws {Error} when shouldBeString is not an String\n * @closurePrimitive {asserts.matchesReturn}\n */\nexport function assertString(assertFn, shouldBeString, opt_message) {\n  return /** @type {string} */ (\n    assertType_(\n      assertFn,\n      shouldBeString,\n      isString(shouldBeString),\n      'String expected',\n      opt_message\n    )\n  );\n}\n\n/**\n * Throws an error if the first argument isn't a number. The allowed values\n * include `0` and `NaN`.\n *\n * For more details see `assert`.\n *\n * @param {!AssertionFunctionDef} assertFn underlying assertion function to call\n * @param {*} shouldBeNumber\n * @param {!Array<*>|string=} opt_message The assertion message\n * @return {number} The number value. The allowed values include `0`\n *   and `NaN`.\n * @throws {Error} when shouldBeNumber is not an Number\n * @closurePrimitive {asserts.matchesReturn}\n */\nexport function assertNumber(assertFn, shouldBeNumber, opt_message) {\n  return /** @type {number} */ (\n    assertType_(\n      assertFn,\n      shouldBeNumber,\n      typeof shouldBeNumber == 'number',\n      'Number expected',\n      opt_message\n    )\n  );\n}\n\n/**\n * Throws an error if the first argument is not an array.\n * The array can be empty.\n *\n * For more details see `assert`.\n *\n * @param {!AssertionFunctionDef} assertFn underlying assertion function to call\n * @param {*} shouldBeArray\n * @param {!Array<*>|string=} opt_message The assertion message\n * @return {!Array} The array value\n * @throws {Error} when shouldBeArray is not an Array\n * @closurePrimitive {asserts.matchesReturn}\n */\nexport function assertArray(assertFn, shouldBeArray, opt_message) {\n  return /** @type {!Array} */ (\n    assertType_(\n      assertFn,\n      shouldBeArray,\n      isArray(shouldBeArray),\n      'Array expected',\n      opt_message\n    )\n  );\n}\n\n/**\n * Throws an error if the first argument isn't a boolean.\n *\n * For more details see `assert`.\n *\n * @param {!AssertionFunctionDef} assertFn underlying assertion function to call\n * @param {*} shouldBeBoolean\n * @param {!Array<*>|string=} opt_message The assertion message\n * @return {boolean} The boolean value.\n * @throws {Error} when shouldBeBoolean is not an Boolean\n * @closurePrimitive {asserts.matchesReturn}\n */\nexport function assertBoolean(assertFn, shouldBeBoolean, opt_message) {\n  return /** @type {boolean} */ (\n    assertType_(\n      assertFn,\n      shouldBeBoolean,\n      !!shouldBeBoolean === shouldBeBoolean,\n      'Boolean expected',\n      opt_message\n    )\n  );\n}\n", "import * as mode from '#core/mode';\n\nimport * as assertions from './base';\n\n/**\n * @fileoverview This file provides the entrypoint for dev assertions. It's\n * designed so all functions are pure function calls to improve inlining. All\n * functions in this file get DCE'd away during compilation.\n */\n\n/**\n * This will never execute regardless, but will be included on unminified builds\n * builds. It will be DCE'd away from minified builds, and so can be used to\n * validate that Babel is properly removing dev assertions in minified builds.\n */\nfunction devAssertDceCheck() {\n  if (self.__AMP_ASSERTION_CHECK) {\n    console /*OK*/\n      .log('__devAssert_sentinel__');\n  }\n}\n\n/**\n * Throws an error if the first argument isn't trueish. Mirrors devAssert in\n * src/log.js.\n * @param {T} shouldBeTruthy\n * @param {string=} opt_message\n * @param {*=} opt_1 Optional argument (var arg as individual params for better\n * @param {*=} opt_2 Optional argument inlining)\n * @param {*=} opt_3 Optional argument\n * @param {*=} opt_4 Optional argument\n * @param {*=} opt_5 Optional argument\n * @param {*=} opt_6 Optional argument\n * @param {*=} opt_7 Optional argument\n * @param {*=} opt_8 Optional argument\n * @param {*=} opt_9 Optional argument\n * @return {T}\n * @template T\n * @throws {Error} when shouldBeTruthy is not truthy.\n * @closurePrimitive {asserts.truthy}\n */\nexport function devAssert(\n  shouldBeTruthy,\n  opt_message,\n  opt_1,\n  opt_2,\n  opt_3,\n  opt_4,\n  opt_5,\n  opt_6,\n  opt_7,\n  opt_8,\n  opt_9\n) {\n  if (mode.isMinified()) {\n    return shouldBeTruthy;\n  }\n  devAssertDceCheck();\n\n  return assertions.assert(\n    '',\n    shouldBeTruthy,\n    opt_message,\n    opt_1,\n    opt_2,\n    opt_3,\n    opt_4,\n    opt_5,\n    opt_6,\n    opt_7,\n    opt_8,\n    opt_9\n  );\n}\n\n/**\n * Throws an error if the first argument isn't an Element.\n *\n * For more details see `assert`.\n *\n * @param {*} shouldBeElement\n * @param {!Array<*>|string=} opt_message The assertion message\n * @return {!Element} The value of shouldBeTrueish.\n * @throws {Error} when shouldBeElement is not an Element\n * @closurePrimitive {asserts.matchesReturn}\n */\nexport function devAssertElement(shouldBeElement, opt_message) {\n  if (mode.isMinified()) {\n    return /** @type {!Element} */ (shouldBeElement);\n  }\n  devAssertDceCheck();\n\n  return assertions.assertElement(\n    /** @type {!assertions.AssertionFunctionDef} */ (devAssert),\n    shouldBeElement,\n    opt_message\n  );\n}\n\n/**\n * Throws an error if the first argument isn't a string. The string can\n * be empty.\n *\n * For more details see `assert`.\n *\n * @param {*} shouldBeString\n * @param {!Array<*>|string=} opt_message The assertion message\n * @return {string} The string value. Can be an empty string.\n * @throws {Error} when shouldBeString is not an String\n * @closurePrimitive {asserts.matchesReturn}\n */\nexport function devAssertString(shouldBeString, opt_message) {\n  if (mode.isMinified()) {\n    return /** @type {string} */ (shouldBeString);\n  }\n  devAssertDceCheck();\n\n  return assertions.assertString(\n    /** @type {!assertions.AssertionFunctionDef} */ (devAssert),\n    shouldBeString,\n    opt_message\n  );\n}\n\n/**\n * Throws an error if the first argument isn't a number. The allowed values\n * include `0` and `NaN`.\n *\n * For more details see `assert`.\n *\n * @param {*} shouldBeNumber\n * @param {!Array<*>|string=} opt_message The assertion message\n * @return {number} The number value. The allowed values include `0`\n *   and `NaN`.\n * @throws {Error} when shouldBeNumber is not an Number\n * @closurePrimitive {asserts.matchesReturn}\n */\nexport function devAssertNumber(shouldBeNumber, opt_message) {\n  if (mode.isMinified()) {\n    return /** @type {number} */ (shouldBeNumber);\n  }\n  devAssertDceCheck();\n\n  return assertions.assertNumber(\n    /** @type {!assertions.AssertionFunctionDef} */ (devAssert),\n    shouldBeNumber,\n    opt_message\n  );\n}\n\n/**\n * Throws an error if the first argument is not an array.\n * The array can be empty.\n *\n * For more details see `assert`.\n *\n * @param {*} shouldBeArray\n * @param {!Array<*>|string=} opt_message The assertion message\n * @return {!Array} The array value\n * @throws {Error} when shouldBeArray is not an Array\n * @closurePrimitive {asserts.matchesReturn}\n */\nexport function devAssertArray(shouldBeArray, opt_message) {\n  if (mode.isMinified()) {\n    return /** @type {!Array} */ (shouldBeArray);\n  }\n  devAssertDceCheck();\n\n  return assertions.assertArray(\n    /** @type {!assertions.AssertionFunctionDef} */ (devAssert),\n    shouldBeArray,\n    opt_message\n  );\n}\n\n/**\n * Throws an error if the first argument isn't a boolean.\n *\n * For more details see `assert`.\n *\n * @param {*} shouldBeBoolean\n * @param {!Array<*>|string=} opt_message The assertion message\n * @return {boolean} The boolean value.\n * @throws {Error} when shouldBeBoolean is not an Boolean\n * @closurePrimitive {asserts.matchesReturn}\n */\nexport function devAssertBoolean(shouldBeBoolean, opt_message) {\n  if (mode.isMinified()) {\n    return /** @type {boolean} */ (shouldBeBoolean);\n  }\n  devAssertDceCheck();\n\n  return assertions.assertBoolean(\n    /** @type {!assertions.AssertionFunctionDef} */ (devAssert),\n    shouldBeBoolean,\n    opt_message\n  );\n}\n", "import {devAssert} from '#core/assert';\n\n/**\n * Key string in an action arguments map for an unparsed object literal string.\n *\n * E.g. for the action in <p on=\"tap:AMP.setState({foo: 'bar'})\",\n * then `args[RAW_OBJECT_ARGS_KEY]` is the string \"{foo: 'bar'}\".\n *\n * The action service delegates parsing of object literals to the corresponding\n * extension (in the example above, amp-bind).\n *\n * @see ./service/action-impl.ActionInfoDef\n * @const {string}\n */\nexport const RAW_OBJECT_ARGS_KEY = '__AMP_OBJECT_STRING__';\n\n/**\n * Identifier for an element's default action.\n *\n * @const {string}\n */\nexport const DEFAULT_ACTION = 'activate';\n\n/**\n * Corresponds to degree of user intent, i.e. events triggered with strong\n * user intent have high trust.\n *\n * @enum {number}\n */\nexport const ActionTrust = {\n  /**\n   * Events that are triggered without a user gesture, or triggered by a user\n   * gesture with weak intent (e.g. scroll) are \"low trust\".\n   *\n   * Actions that have low impact on the page's visual state should require\n   * \"low trust\" (e.g. pausing a video).\n   */\n  LOW: 1,\n  /**\n   * Events that are triggered nearly immediately (up to a few seconds) after\n   * a user gesture with strong intent (e.g. tap or swipe) are \"default trust\".\n   *\n   * Actions that can modify the page's visual state (e.g. content jumping)\n   * should require \"default trust\". This is the default required trust level\n   * for actions.\n   */\n  DEFAULT: 2,\n  /**\n   * Events that are triggered immediately after a user gesture with\n   * strong intent (e.g. tap or swipe) are \"high trust\".\n   *\n   * There are no actions yet that require high trust.\n   */\n  HIGH: 3,\n};\n\n/**\n * @param {!ActionTrust} actionTrust\n * @return {string}\n */\nexport function actionTrustToString(actionTrust) {\n  switch (actionTrust) {\n    case ActionTrust.LOW:\n      return 'low';\n    case ActionTrust.HIGH:\n      return 'high';\n    default:\n      devAssert(actionTrust === ActionTrust.DEFAULT);\n      return 'default';\n  }\n}\n", "/**\n * Common AMP events.\n * @enum {string}\n */\nexport const AmpEvents = {\n  DOM_UPDATE: 'amp:dom-update',\n  FORM_DIRTINESS_CHANGE: 'amp:form-dirtiness-change',\n  FORM_VALUE_CHANGE: 'amp:form-value-change',\n  VISIBILITY_CHANGE: 'amp:visibilitychange', // https://github.com/ampproject/amphtml/blob/main/ads/README.md#page-visibility\n  // The following codes are only used for testing.\n  // TODO(choumx): Move these to a separate enum so they can be DCE'd.\n  ATTACHED: 'amp:attached',\n  STUBBED: 'amp:stubbed',\n  LOAD_START: 'amp:load-start',\n  LOAD_END: 'amp:load-end',\n  ERROR: 'amp:error',\n  SIZE_CHANGED: 'amp:size-changed',\n  UNLOAD: 'amp:unload',\n};\n", "/**\n * @enum {number}\n */\nexport const KeyCodes = {\n  ENTER: 13,\n  ESCAPE: 27,\n  SPACE: 32,\n  LEFT_ARROW: 37,\n  UP_ARROW: 38,\n  RIGHT_ARROW: 39,\n  DOWN_ARROW: 40,\n};\n\n/**\n * @enum {string}\n */\nexport const Keys = {\n  ENTER: 'Enter',\n  ESCAPE: 'Escape',\n  SPACE: ' ',\n  LEFT_ARROW: 'ArrowLeft',\n  UP_ARROW: 'ArrowUp',\n  RIGHT_ARROW: 'ArrowRight',\n  DOWN_ARROW: 'ArrowDown',\n  TAB: 'Tab',\n  BACKSPACE: 'Backspace',\n  HOME: 'Home',\n  END: 'End',\n};\n", "import {devAssert} from '#core/assert';\nimport {map} from '#core/types/object';\n\n/** @template STATE */\nexport class FiniteStateMachine {\n  /**\n   * Constructs a FSM using the bits defined in initialState as changeable\n   * states.\n   * @param {STATE} initialState\n   */\n  constructor(initialState) {\n    /**\n     * The current state of the FSM\n     * @private {STATE}\n     */\n    this.state_ = initialState;\n\n    /**\n     * Callbacks that are invoked when transitioning from an old state\n     * to the new.\n     * @private {Object<string, function()>}\n     */\n    this.transitions_ = map();\n  }\n\n  /**\n   * Adds a transition callback that will be called when the oldState\n   * transitions to the newState.\n   * @param {STATE} oldState\n   * @param {STATE} newState\n   * @param {function()} callback\n   */\n  addTransition(oldState, newState, callback) {\n    const transition = this.statesToTransition_(oldState, newState);\n    devAssert(\n      !this.transitions_[transition],\n      'cannot define a duplicate transition callback'\n    );\n    this.transitions_[transition] = callback;\n  }\n\n  /**\n   * Transitions to the newState and invokes the registered transition\n   * callback, if one is defined.\n   * @param {STATE} newState\n   */\n  setState(newState) {\n    const oldState = this.state_;\n    this.state_ = newState;\n\n    const transition = this.statesToTransition_(oldState, newState);\n    const callback = this.transitions_[transition];\n    callback?.();\n  }\n\n  /**\n   * Transforms the state transition into a key which identifies a callback.\n   * @private\n   * @param {STATE} oldState\n   * @param {STATE} newState\n   * @return {string}\n   */\n  statesToTransition_(oldState, newState) {\n    return `${oldState}|${newState}`;\n  }\n}\n", "/**\n * Externs declare that access `defaultView` from `document` or\n * `ownerDocument` is of type `(Window|null)` but most of our parameter types\n * assume that it is never null. This is OK in practice as we ever only get\n * null on disconnected documents or old IE.\n * This helper function casts it into just a simple Window return type.\n *\n * @param {?Window} winOrNull\n * @return {!Window}\n */\nexport function toWin(winOrNull) {\n  return /** @type {!Window} */ (winOrNull);\n}\n\n/**\n * Returns the associated Window for a node.\n *\n * @param {!Node} node\n * @return {!Window}\n */\nexport function getWin(node) {\n  return toWin(\n    (node.ownerDocument || /** @type {!Document} */ (node)).defaultView\n  );\n}\n", "/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */\n\n\n/**\n * This regex consists of 4 matching capture groups and one (non-matching) fallback:\n *\n * - (\\0), catch the null terminator character so it may be replaced by UTF\n *   Replacement Char\n * - ^(-)$, catch a solitary dash char, so that it may be backslash escaped.\n *   This is a separate capture group so that the legal-chars (group 4) doesn't\n *   capture it first, since that group doesn't need to escape its dash.\n * - ([\\x01-\\x1f\\x7f]|^-?[0-9]), catch a UTF control char, or any leading\n *   number (with an optional leading dash). The control or the number (but not\n *   the leading dash) must be hex-escaped,.\n * - ([\\x80-\\uffff0-9a-zA-Z_-]+), catch legal-chars, with the exception of a\n *   solitary dash, which will already have matched in group 1.\n * - [^], finally, a catch-all that allows us to backslash escape the char.\n *\n * Together, this matches everything necessary for CSS.escape.\n */\nvar regex = /(\\0)|^(-)$|([\\x01-\\x1f\\x7f]|^-?[0-9])|([\\x80-\\uffff0-9a-zA-Z_-]+)|[^]/g;\n\nfunction escaper(match, nil, dash, hexEscape, chars) {\n  // Chars is the legal-chars (group 4) capture\n  if (chars) {\n    return chars;\n  }\n  // Nil is the null terminator (group 1) capture\n  if (nil) {\n    return '\\uFFFD';\n  }\n  // Both UTF control chars, and leading numbers (with optional leading dash)\n  // (group 3) must be backslash escaped with a trailing space.  Funnily, the\n  // leading dash must not be escaped, but the number. :shrug:\n  if (hexEscape) {\n    return match.slice(0, -1) + '\\\\' + match.slice(-1).charCodeAt(0).toString(16) + ' '\n  }\n  // Finally, the solitary dash and the catch-all chars require backslash\n  // escaping.\n  return '\\\\' + match;\n}\n\n/**\n * https://drafts.csswg.org/cssom/#serialize-an-identifier\n * @param {string} value\n * @return {string}\n */\nexport function cssEscape(value) {\n  return String(value).replace(regex, escaper);\n}\n", "import {devAssert} from '#core/assert';\nimport * as mode from '#core/mode';\n\nimport {cssEscape} from '#third_party/css-escape/css-escape';\n\n/**\n * @type {boolean|undefined}\n */\nlet scopeSelectorSupported;\n\n/**\n * @param {boolean|undefined} val\n * @visibleForTesting\n */\nexport function setScopeSelectorSupportedForTesting(val) {\n  scopeSelectorSupported = val;\n}\n\n/**\n * Test that the :scope selector is supported and behaves correctly.\n * @param {!Element|!ShadowRoot} el\n * @return {boolean}\n */\nexport function isScopeSelectorSupported(el) {\n  if (scopeSelectorSupported !== undefined) {\n    return scopeSelectorSupported;\n  }\n\n  return (scopeSelectorSupported = testScopeSelector(el));\n}\n\n/**\n * Test that the :scope selector is supported and behaves correctly.\n * @param {!Element|!ShadowRoot} el\n * @return {boolean}\n */\nfunction testScopeSelector(el) {\n  try {\n    const doc = el.ownerDocument;\n    const testElement = doc.createElement('div');\n    const testChild = doc.createElement('div');\n    testElement.appendChild(testChild);\n    // NOTE(cvializ, #12383): Firefox's implementation is incomplete,\n    // therefore we test actual functionality of`:scope` as well.\n    return testElement./*OK*/ querySelector(':scope div') === testChild;\n  } catch (e) {\n    return false;\n  }\n}\n\n/**\n * Prefixes a selector for ancestor selection. Splits in subselectors and\n * applies prefix to each.\n *\n * e.g.\n * ```\n *   prependSelectorsWith('div', '.i-amphtml-scoped');\n *   // => '.i-amphtml-scoped div'\n *   prependSelectorsWith('div, ul', ':scope');\n *   // => ':scope div, :scope ul'\n *   prependSelectorsWith('div, ul', 'article >');\n *   // => 'article > div, article > ul'\n * ```\n *\n * @param {string} selector\n * @param {string} distribute\n * @return {string}\n */\nexport function prependSelectorsWith(selector, distribute) {\n  return selector.replace(/^|,/g, `$&${distribute} `);\n}\n\n/**\n * Escapes an ident (ID or a class name) to be used as a CSS selector.\n *\n * See https://drafts.csswg.org/cssom/#serialize-an-identifier.\n *\n * @param {string} ident\n * @return {string}\n * @suppress {uselessCode}\n */\nexport function escapeCssSelectorIdent(ident) {\n  // This gets rewritten to true/false during compilation. It will trigger an\n  // JSC_UNREACHABLE_CODE warning, but that's intentional for DCE.\n  if (mode.isEsm()) {\n    return CSS.escape(ident);\n  }\n  return cssEscape(ident);\n}\n\n/**\n * Escapes an ident in a way that can be used by :nth-child() psuedo-class.\n *\n * See https://github.com/w3c/csswg-drafts/issues/2306.\n *\n * @param {string|number} ident\n * @return {string}\n */\nexport function escapeCssSelectorNth(ident) {\n  const escaped = String(ident);\n  // Ensure it doesn't close the nth-child psuedo class.\n  devAssert(escaped.indexOf(')') === -1);\n  return escaped;\n}\n", "import {devAssert, devAssertElement} from '#core/assert';\nimport * as mode from '#core/mode';\n\nimport {isScopeSelectorSupported, prependSelectorsWith} from './css-selectors';\n\n/** @fileoverview Helper functions for DOM queries. */\n\n/**\n * Asserts that name is just an alphanumeric word, and does not contain\n * advanced CSS selector features like attributes, psuedo-classes, class names,\n * nor ids.\n * @param {string} name\n */\nfunction assertIsName(name) {\n  devAssert(\n    /^[\\w-]+$/.test(name),\n    `Expected \"${name}\" to be a CSS name composed of alphanumerics and hyphens.`\n  );\n}\n\n/**\n * Finds all elements that matche `selector`, scoped inside `root`\n * for user-agents that do not support native scoping.\n *\n * This method isn't required for modern builds, can be removed.\n *\n * @param {!Element|!ShadowRoot} root\n * @param {string} selector\n * @return {!NodeList<!Element>}\n */\nfunction scopedQuerySelectionFallback(root, selector) {\n  const unique = 'i-amphtml-scoped';\n  root.classList.add(unique);\n  const scopedSelector = prependSelectorsWith(selector, `.${unique}`);\n  const elements = root./*OK*/ querySelectorAll(scopedSelector);\n  root.classList.remove(unique);\n  return elements;\n}\n\n/**\n * Finds the first element that matches `selector`, scoped inside `root`.\n * Note: in IE, this causes a quick mutation of the element's class list.\n * @param {!Element|!ShadowRoot} root\n * @param {string} selector\n * @return {?Element}\n *\n * @suppress {suspiciousCode}\n */\nexport function scopedQuerySelector(root, selector) {\n  if (mode.isEsm() || isScopeSelectorSupported(root)) {\n    return root./*OK*/ querySelector(prependSelectorsWith(selector, ':scope'));\n  }\n\n  // Only IE.\n  const fallbackResult = scopedQuerySelectionFallback(root, selector);\n  return fallbackResult[0] === undefined ? null : fallbackResult[0];\n}\n\n/**\n * Finds every element that matches `selector`, scoped inside `root`.\n * Note: in IE, this causes a quick mutation of the element's class list.\n * @param {!Element|!ShadowRoot} root\n * @param {string} selector\n * @return {!NodeList<!Element>}\n *\n * @suppress {suspiciousCode}\n */\nexport function scopedQuerySelectorAll(root, selector) {\n  if (mode.isEsm() || isScopeSelectorSupported(root)) {\n    return root./*OK*/ querySelectorAll(\n      prependSelectorsWith(selector, ':scope')\n    );\n  }\n\n  // Only IE.\n  return scopedQuerySelectionFallback(root, selector);\n}\n\n/**\n * Checks if the given element matches the selector\n * @param  {!Element} el The element to verify\n * @param  {string} selector The selector to check against\n * @return {boolean} True if the element matched the selector. False otherwise.\n */\nexport function matches(el, selector) {\n  const matcher =\n    el.matches ||\n    el.webkitMatchesSelector ||\n    el.mozMatchesSelector ||\n    el.msMatchesSelector ||\n    el.oMatchesSelector;\n  if (matcher) {\n    return matcher.call(el, selector);\n  }\n  return false; // IE8 always returns false.\n}\n\n/**\n * Finds the closest element that satisfies the callback from this element\n * up the DOM subtree.\n * @param {!Element} element\n * @param {function(!Element):boolean} callback\n * @param {Element=} opt_stopAt optional elemnt to stop the search at.\n * @return {?Element}\n */\nexport function closest(element, callback, opt_stopAt) {\n  for (let el = element; el && el !== opt_stopAt; el = el.parentElement) {\n    if (callback(el)) {\n      return el;\n    }\n  }\n  return null;\n}\n\n/**\n * Finds the closest node that satisfies the callback from this node\n * up the DOM subtree.\n * @param {!Node} node\n * @param {function(!Node):boolean} callback\n * @return {?Node}\n */\nexport function closestNode(node, callback) {\n  for (let n = node; n; n = n.parentNode) {\n    if (callback(n)) {\n      return n;\n    }\n  }\n  return null;\n}\n\n/**\n * Finds the closest ancestor element with the specified selector from this\n * element.\n * @param {!Element} element\n * @param {string} selector\n * @return {?Element} closest ancestor if found.\n */\nexport function closestAncestorElementBySelector(element, selector) {\n  return element.closest\n    ? element.closest(selector)\n    : closest(element, (el) => matches(el, selector));\n}\n\n/**\n * Finds all ancestor elements that satisfy predicate.\n * @param {!Element} child\n * @param {function(!Element):boolean} predicate\n * @return {!Array<!Element>}\n */\nexport function ancestorElements(child, predicate) {\n  const ancestors = [];\n  for (\n    let ancestor = child.parentElement;\n    ancestor;\n    ancestor = ancestor.parentElement\n  ) {\n    if (predicate(ancestor)) {\n      ancestors.push(ancestor);\n    }\n  }\n  return ancestors;\n}\n\n/**\n * Finds all ancestor elements that has the specified tag name.\n * @param {!Element} child\n * @param {string} tagName\n * @return {!Array<!Element>}\n */\nexport function ancestorElementsByTag(child, tagName) {\n  assertIsName(tagName);\n  tagName = tagName.toUpperCase();\n  return ancestorElements(child, (el) => el.tagName == tagName);\n}\n\n/**\n * Finds the first child element that satisfies the callback.\n * TODO(rcebulko): Can we start using generators in childElements and defer to\n * that here?\n * @param {!Element} parent\n * @param {function(!Element):boolean} callback\n * @return {?Element}\n */\nexport function childElement(parent, callback) {\n  for (\n    let child = parent.firstElementChild;\n    child;\n    child = child.nextElementSibling\n  ) {\n    if (callback(child)) {\n      return child;\n    }\n  }\n  return null;\n}\n\n/**\n * Finds the last child element that satisfies the callback.\n * @param {!Element} parent\n * @param {function(!Element):boolean} callback\n * @return {?Element}\n */\nexport function lastChildElement(parent, callback) {\n  for (\n    let child = parent.lastElementChild;\n    child;\n    child = child.previousElementSibling\n  ) {\n    if (callback(child)) {\n      return child;\n    }\n  }\n  return null;\n}\n\n/**\n * Finds all child elements that satisfy the callback.\n * @param {!Element} parent\n * @param {function(!Element):boolean} callback\n * @return {!Array<!Element>}\n */\nexport function childElements(parent, callback) {\n  const children = [];\n  for (\n    let child = parent.firstElementChild;\n    child;\n    child = child.nextElementSibling\n  ) {\n    if (callback(child)) {\n      children.push(child);\n    }\n  }\n  return children;\n}\n\n/**\n * Finds all child nodes that satisfy the callback.\n * These nodes can include Text, Comment and other child nodes.\n * @param {!Node} parent\n * @param {function(!Node):boolean} callback\n * @return {!Array<!Node>}\n */\nexport function childNodes(parent, callback) {\n  const nodes = [];\n  for (let child = parent.firstChild; child; child = child.nextSibling) {\n    if (callback(child)) {\n      nodes.push(child);\n    }\n  }\n  return nodes;\n}\n\n/**\n * Finds the first child element that has the specified attribute.\n * @param {!Element|!ShadowRoot} parent\n * @param {string} attr\n * @return {?Element}\n */\nexport function childElementByAttr(parent, attr) {\n  assertIsName(attr);\n  return /*OK*/ scopedQuerySelector(parent, `> [${attr}]`);\n}\n\n/**\n * Finds the last child element that has the specified attribute.\n * @param {!Element} parent\n * @param {string} attr\n * @return {?Element}\n */\nexport function lastChildElementByAttr(parent, attr) {\n  assertIsName(attr);\n  return lastChildElement(parent, (el) => {\n    return el.hasAttribute(attr);\n  });\n}\n\n/**\n * Finds all child elements that has the specified attribute.\n * @param {!Element|!ShadowRoot} parent\n * @param {string} attr\n * @return {!NodeList<!Element>}\n */\nexport function childElementsByAttr(parent, attr) {\n  assertIsName(attr);\n  return /*OK*/ scopedQuerySelectorAll(parent, `> [${attr}]`);\n}\n\n/**\n * Finds the first child element that has the specified tag name.\n * @param {!Element|!ShadowRoot} parent\n * @param {string} tagName\n * @return {?Element}\n */\nexport function childElementByTag(parent, tagName) {\n  assertIsName(tagName);\n  return /*OK*/ scopedQuerySelector(parent, `> ${tagName}`);\n}\n\n/**\n * Finds all child elements with the specified tag name.\n * @param {!Element|!ShadowRoot} parent\n * @param {string} tagName\n * @return {!NodeList<!Element>}\n */\nexport function childElementsByTag(parent, tagName) {\n  assertIsName(tagName);\n  return /*OK*/ scopedQuerySelectorAll(parent, `> ${tagName}`);\n}\n\n/**\n * Finds the first descendant element with the specified name.\n * @param {!Element|!Document|!ShadowRoot} element\n * @param {string} tagName\n * @return {?Element}\n */\nexport function elementByTag(element, tagName) {\n  assertIsName(tagName);\n  return element./*OK*/ querySelector(tagName);\n}\n\n/**\n * Returns the original nodes of the custom element without any service\n * nodes that could have been added for markup. These nodes can include\n * Text, Comment and other child nodes.\n *\n * @param {!Node} element\n * @return {!Array<!Node>}\n */\nexport function realChildNodes(element) {\n  return childNodes(element, (node) => !isInternalOrServiceNode(node));\n}\n\n/**\n * Returns the original children of the custom element without any service\n * nodes that could have been added for markup.\n *\n * @param {!Element} element\n * @return {!Array<!Element>}\n */\nexport function realChildElements(element) {\n  return childElements(element, (element) => !isInternalOrServiceNode(element));\n}\n\n/**\n * Returns \"true\" for internal AMP nodes or for placeholder elements.\n * @param {!Node} node\n * @return {boolean}\n */\nexport function isInternalOrServiceNode(node) {\n  if (isInternalElement(node)) {\n    return true;\n  }\n  if (node.nodeType !== Node.ELEMENT_NODE) {\n    return false;\n  }\n  devAssertElement(node);\n\n  return (\n    node.hasAttribute('placeholder') ||\n    node.hasAttribute('fallback') ||\n    node.hasAttribute('overflow')\n  );\n}\n\n/**\n * Whether the tag is an internal (service) AMP tag.\n * @param {!Node|string} nodeOrTagName\n * @return {boolean}\n */\nfunction isInternalElement(nodeOrTagName) {\n  /** @type string */\n  let tagName;\n  if (typeof nodeOrTagName == 'string') {\n    tagName = nodeOrTagName;\n  } else if (nodeOrTagName.nodeType === Node.ELEMENT_NODE) {\n    tagName = devAssertElement(nodeOrTagName).tagName;\n  }\n\n  return !!tagName && tagName.toLowerCase().startsWith('i-');\n}\n", "import * as mode from '#core/mode';\nimport {dict} from '#core/types/object';\nimport {parseJson} from '#core/types/object/json';\nimport {getWin} from '#core/window';\n\nimport {childElementsByTag, matches} from './query';\n\nconst HTML_ESCAPE_CHARS = {\n  '&': '&amp;',\n  '<': '&lt;',\n  '>': '&gt;',\n  '\"': '&quot;',\n  \"'\": '&#x27;',\n  '`': '&#x60;',\n};\nconst HTML_ESCAPE_REGEX = /(&|<|>|\"|'|`)/g;\n\n/**\n * @typedef {{\n *   bubbles: (boolean|undefined),\n *   cancelable: (boolean|undefined),\n * }}\n */\nexport let CustomEventOptionsDef;\n\n/** @const {!CustomEventOptionsDef} */\nconst DEFAULT_CUSTOM_EVENT_OPTIONS = {bubbles: true, cancelable: true};\n\n/**\n * Waits until the child element is constructed. Once the child is found, the\n * callback is executed.\n * @param {!Element} parent\n * @param {function(!Element):boolean} checkFunc\n * @param {function()} callback\n */\nexport function waitForChild(parent, checkFunc, callback) {\n  if (checkFunc(parent)) {\n    callback();\n    return;\n  }\n  const win = getWin(parent);\n  if (mode.isEsm() || win.MutationObserver) {\n    const observer = new win.MutationObserver(() => {\n      if (checkFunc(parent)) {\n        observer.disconnect();\n        callback();\n      }\n    });\n    observer.observe(parent, {childList: true});\n  } else {\n    const interval = win.setInterval(() => {\n      if (checkFunc(parent)) {\n        win.clearInterval(interval);\n        callback();\n      }\n    }, /* milliseconds */ 5);\n  }\n}\n\n/**\n * Waits until the child element is constructed. Once the child is found, the\n * promise is resolved.\n * @param {!Element} parent\n * @param {function(!Element):boolean} checkFunc\n * @return {!Promise}\n */\nexport function waitForChildPromise(parent, checkFunc) {\n  return new Promise((resolve) => {\n    waitForChild(parent, checkFunc, resolve);\n  });\n}\n\n/**\n * Waits for document's body to be available and ready.\n * @param {!Document} doc\n * @param {function()} callback\n */\nexport function waitForBodyOpen(doc, callback) {\n  waitForChild(doc.documentElement, () => !!doc.body, callback);\n}\n\n/**\n * Waits for document's body to be available.\n * @param {!Document} doc\n * @return {!Promise}\n */\nexport function waitForBodyOpenPromise(doc) {\n  return new Promise((resolve) => waitForBodyOpen(doc, resolve));\n}\n\n/**\n * Removes the element.\n * @param {!Element} element\n */\nexport function removeElement(element) {\n  element.parentElement?.removeChild(element);\n}\n\n/**\n * Removes all child nodes of the specified element.\n * @param {!Element|!DocumentFragment} parent\n */\nexport function removeChildren(parent) {\n  while (parent.firstChild) {\n    parent.removeChild(parent.firstChild);\n  }\n}\n\n/**\n * Copies all children nodes of element \"from\" to element \"to\". Child nodes\n * are deeply cloned. Notice, that this method should be used with care and\n * preferably on smaller subtrees.\n * @param {!Element} from\n * @param {!Element|!DocumentFragment} to\n */\nexport function copyChildren(from, to) {\n  const frag = to.ownerDocument.createDocumentFragment();\n  for (let n = from.firstChild; n; n = n.nextSibling) {\n    frag.appendChild(n.cloneNode(true));\n  }\n  to.appendChild(frag);\n}\n\n/**\n * Insert the element in the root after the element named after or\n * if that is null at the beginning.\n * @param {!Element|!ShadowRoot} root\n * @param {!Element} element\n * @param {?Node=} after\n */\nexport function insertAfterOrAtStart(root, element, after = null) {\n  if (!after) {\n    insertAtStart(root, element);\n    return;\n  }\n  const before = after.nextSibling;\n  root.insertBefore(element, before);\n}\n\n/**\n * Insert the element in the root after the element named after or\n * if that is null at the beginning.\n * @param {!Element|!ShadowRoot} root\n * @param {!Element} element\n */\nexport function insertAtStart(root, element) {\n  root.insertBefore(element, root.firstChild);\n}\n\n/**\n * Add attributes to an element.\n * @param {!Element} element\n * @param {!JsonObject<string, string>} attributes\n * @return {!Element} created element\n */\nexport function addAttributesToElement(element, attributes) {\n  for (const attr in attributes) {\n    element.setAttribute(attr, attributes[attr]);\n  }\n  return element;\n}\n\n/**\n * Create a new element on document with specified tagName and attributes.\n * @param {!Document} doc\n * @param {string} tagName\n * @param {!JsonObject<string, string>} attributes\n * @return {!Element} created element\n */\nexport function createElementWithAttributes(doc, tagName, attributes) {\n  const element = doc.createElement(tagName);\n  return addAttributesToElement(element, attributes);\n}\n\n/**\n * Returns true if node is connected (attached).\n * @param {!Node} node\n * @return {boolean}\n * @see https://dom.spec.whatwg.org/#connected\n */\nexport function isConnectedNode(node) {\n  const connected = node.isConnected;\n  if (connected !== undefined) {\n    return connected;\n  }\n\n  // \"An element is connected if its shadow-including root is a document.\"\n  let n = node;\n  do {\n    n = rootNodeFor(n);\n    if (n.host) {\n      n = n.host;\n    } else {\n      break;\n    }\n  } while (true);\n  return n.nodeType === Node.DOCUMENT_NODE;\n}\n\n/**\n * Returns the root for a given node. Does not cross shadow DOM boundary.\n * @param {!Node} node\n * @return {!Node}\n */\nexport function rootNodeFor(node) {\n  if (Node.prototype.getRootNode) {\n    // Type checker says `getRootNode` may return null.\n    return node.getRootNode() || node;\n  }\n  let n;\n  // Check isShadowRoot() is only needed for the polyfill case.\n  for (\n    n = node;\n    !!n.parentNode && !isShadowRoot(/** @type {HTMLElement} */ (n));\n    n = n.parentNode\n  ) {}\n  return n;\n}\n\n/**\n * Determines if value is actually a `ShadowRoot` node.\n * @param {?HTMLElement} value\n * @return {boolean}\n */\nexport function isShadowRoot(value) {\n  if (!value) {\n    return false;\n  }\n  // Node.nodeType == DOCUMENT_FRAGMENT to speed up the tests. Unfortunately,\n  // nodeType of DOCUMENT_FRAGMENT is used currently for ShadowRoot nodes.\n  if (value.tagName == 'I-AMPHTML-SHADOW-ROOT') {\n    return true;\n  }\n  return (\n    value.nodeType == /* DOCUMENT_FRAGMENT */ 11 &&\n    Object.prototype.toString.call(value) === '[object ShadowRoot]'\n  );\n}\n\n/**\n * Returns element data-param- attributes as url parameters key-value pairs.\n * e.g. data-param-some-attr=value -> {someAttr: value}.\n * @param {!HTMLElement} element\n * @param {function(string):string=} opt_computeParamNameFunc to compute the\n *    parameter name, get passed the camel-case parameter name.\n * @param {!RegExp=} opt_paramPattern Regex pattern to match data attributes.\n * @return {!JsonObject}\n */\nexport function getDataParamsFromAttributes(\n  element,\n  opt_computeParamNameFunc,\n  opt_paramPattern\n) {\n  const computeParamNameFunc = opt_computeParamNameFunc || ((key) => key);\n  const {dataset} = element;\n  const params = dict();\n  const paramPattern = opt_paramPattern || /^param(.+)/;\n  for (const key in dataset) {\n    const matches = key.match(paramPattern);\n    if (matches) {\n      const param = matches[1][0].toLowerCase() + matches[1].substr(1);\n      params[computeParamNameFunc(param)] = dataset[key];\n    }\n  }\n  return params;\n}\n\n/**\n * Whether the element have a next node in the document order.\n * This means either:\n *  a. The element itself has a nextSibling.\n *  b. Any of the element ancestors has a nextSibling.\n * @param {!Element} element\n * @param {?Node} opt_stopNode\n * @return {boolean}\n */\nexport function hasNextNodeInDocumentOrder(element, opt_stopNode) {\n  let currentElement = element;\n  do {\n    if (currentElement.nextSibling) {\n      return true;\n    }\n  } while (\n    (currentElement = currentElement.parentNode) &&\n    currentElement != opt_stopNode\n  );\n  return false;\n}\n\n/**\n * Returns a clone of the content of a template element.\n *\n * Polyfill to replace .content access for browsers that do not support\n * HTMLTemplateElements natively.\n *\n * @param {!HTMLTemplateElement|!Element} template\n * @return {!DocumentFragment}\n */\nexport function templateContentClone(template) {\n  if ('content' in template) {\n    return template.content.cloneNode(true);\n  } else {\n    const content = template.ownerDocument.createDocumentFragment();\n    copyChildren(template, content);\n    return content;\n  }\n}\n\n/**\n * Iterate over an array-like.\n * Test cases: https://jsbench.github.io/#f638cacc866a1b2d6e517e6cfa900d6b\n * @param {!IArrayLike<T>} iterable\n * @param {function(T, number)} cb\n * @template T\n */\nexport function iterateCursor(iterable, cb) {\n  const {length} = iterable;\n  for (let i = 0; i < length; i++) {\n    cb(iterable[i], i);\n  }\n}\n\n/**\n * Whether the element is a script tag with application/json type.\n * @param {!Element} element\n * @return {boolean}\n */\nexport function isJsonScriptTag(element) {\n  return (\n    element.tagName == 'SCRIPT' &&\n    element.getAttribute('type')?.toUpperCase() == 'APPLICATION/JSON'\n  );\n}\n\n/**\n * Whether the element is a script tag with application/json type.\n * @param {!Element} element\n * @return {boolean}\n */\nexport function isJsonLdScriptTag(element) {\n  return (\n    element.tagName == 'SCRIPT' &&\n    element.getAttribute('type')?.toUpperCase() == 'APPLICATION/LD+JSON'\n  );\n}\n\n/**\n * Whether the page's direction is right to left or not.\n * @param {!Document} doc\n * @return {boolean}\n */\nexport function isRTL(doc) {\n  const dir =\n    doc.body.getAttribute('dir') ||\n    doc.documentElement.getAttribute('dir') ||\n    'ltr';\n  return dir == 'rtl';\n}\n\n/**\n * Escapes `<`, `>` and other HTML charcaters with their escaped forms.\n * @param {string} text\n * @return {string}\n */\nexport function escapeHtml(text) {\n  if (!text) {\n    return text;\n  }\n  return text.replace(HTML_ESCAPE_REGEX, escapeHtmlChar);\n}\n\n/**\n * @param {string} c\n * @return {string}\n */\nfunction escapeHtmlChar(c) {\n  return HTML_ESCAPE_CHARS[c];\n}\n\n/**\n * Tries to focus on the given element; fails silently if browser throws an\n * exception.\n * @param {!Element} element\n */\nexport function tryFocus(element) {\n  try {\n    element./*OK*/ focus();\n  } catch (e) {\n    // IE <= 7 may throw exceptions when focusing on hidden items.\n  }\n}\n\n/**\n * Whether the given window is in an iframe or not.\n * @param {!Window} win\n * @return {boolean}\n */\nexport function isIframed(win) {\n  return win.parent && win.parent != win;\n}\n\n/**\n * Returns true if node is not disabled.\n *\n * IE8 can return false positives, see {@link matches}.\n * @param {!HTMLInputElement} element\n * @return {boolean}\n * @see https://www.w3.org/TR/html5/forms.html#concept-fe-disabled\n */\nexport function isEnabled(element) {\n  return !(element.disabled || matches(element, ':disabled'));\n}\n\n/**\n * A sorting comparator that sorts elements in DOM tree order.\n * A first sibling is sorted to be before its nextSibling.\n * A parent node is sorted to be before a child.\n * See https://developer.mozilla.org/en-US/docs/Web/API/Node/compareDocumentPosition\n *\n * @param {!Element} element1\n * @param {!Element} element2\n * @return {number}\n */\nexport function domOrderComparator(element1, element2) {\n  if (element1 === element2) {\n    return 0;\n  }\n\n  const pos = element1.compareDocumentPosition(element2);\n  const precedingOrContains =\n    Node.DOCUMENT_POSITION_PRECEDING | Node.DOCUMENT_POSITION_CONTAINS;\n\n  // if fe2 is preceding or contains fe1 then, fe1 is after fe2\n  if (pos & precedingOrContains) {\n    return 1;\n  }\n\n  // if fe2 is following or contained by fe1, then fe1 is before fe2\n  return -1;\n}\n\n/**\n * Like `Element.prototype.toggleAttribute`. This either toggles an attribute\n * on by adding an attribute with an empty value, or toggles it off by removing\n * the attribute. This does not mutate the element if the new state matches\n * the existing state.\n * @param {!Element} element An element to toggle the attribute for.\n * @param {string} name The name of the attribute.\n * @param {boolean=} forced Whether the attribute should be forced on/off. If\n *    not specified, it will be toggled from the current state.\n * @return {boolean} Whether or not the element now has the attribute.\n */\nexport function toggleAttribute(element, name, forced) {\n  const hasAttribute = element.hasAttribute(name);\n  const enabled = forced !== undefined ? forced : !hasAttribute;\n\n  if (enabled !== hasAttribute) {\n    if (enabled) {\n      element.setAttribute(name, '');\n    } else {\n      element.removeAttribute(name);\n    }\n  }\n\n  return enabled;\n}\n\n/**\n * Parses a string as a boolean value using the expanded rules for DOM boolean\n * attributes:\n * - a `null` or `undefined` returns `null`;\n * - an empty string returns `true`;\n * - a \"false\" string returns `false`;\n * - otherwise, `true` is returned.\n *\n * @param {?string|undefined} s\n * @return {boolean|undefined}\n */\nexport function parseBooleanAttribute(s) {\n  return s == null ? undefined : s !== 'false';\n}\n\n/**\n * @param {!Window} win\n * @return {number} The width of the vertical scrollbar, in pixels.\n */\nexport function getVerticalScrollbarWidth(win) {\n  const {documentElement} = win.document;\n  const windowWidth = win./*OK*/ innerWidth;\n  const documentWidth = documentElement./*OK*/ clientWidth;\n  return windowWidth - documentWidth;\n}\n\n/**\n * Dispatches a custom event.\n *\n * @param {!Node} node\n * @param {string} name\n * @param {!Object=} opt_data Event data.\n * @param {!CustomEventOptionsDef=} opt_options\n */\nexport function dispatchCustomEvent(node, name, opt_data, opt_options) {\n  const data = opt_data || {};\n  // Constructors of events need to come from the correct window. Sigh.\n  const event = node.ownerDocument.createEvent('Event');\n\n  // Technically .data is not a property of Event.\n  event.data = data;\n\n  const {bubbles, cancelable} = opt_options || DEFAULT_CUSTOM_EVENT_OPTIONS;\n  event.initEvent(name, bubbles, cancelable);\n  node.dispatchEvent(event);\n}\n\n/**\n * Ensures the child is contained by the parent, but not the parent itself.\n *\n * @param {!Node} parent\n * @param {!Node} child\n * @return {boolean}\n */\nexport function containsNotSelf(parent, child) {\n  return child !== parent && parent.contains(child);\n}\n\n/**\n * Helper method to get the json config from an element <script> tag\n * @param {!Element} element\n * @return {?JsonObject}\n * @throws {!Error} If element does not have exactly one <script> child\n * with type=\"application/json\", or if the <script> contents are not valid JSON.\n */\nexport function getChildJsonConfig(element) {\n  const scripts = childElementsByTag(element, 'script');\n  const {length} = scripts;\n  if (length !== 1) {\n    throw new Error(`Found ${length} <script> children. Expected 1.`);\n  }\n\n  const script = scripts[0];\n  if (!isJsonScriptTag(script)) {\n    throw new Error('<script> child must have type=\"application/json\"');\n  }\n\n  try {\n    return parseJson(script.textContent);\n  } catch {\n    throw new Error('Failed to parse <script> contents. Is it valid JSON?');\n  }\n}\n", "/**\n * @fileoverview Implements element layout. See https://goo.gl/9avXuT for\n * details.\n */\n\nimport {userAssert} from '#core/assert';\nimport {isFiniteNumber} from '#core/types';\n\n/**\n * @enum {string}\n */\nexport const Layout = {\n  NODISPLAY: 'nodisplay',\n  FIXED: 'fixed',\n  FIXED_HEIGHT: 'fixed-height',\n  RESPONSIVE: 'responsive',\n  CONTAINER: 'container',\n  FILL: 'fill',\n  FLEX_ITEM: 'flex-item',\n  FLUID: 'fluid',\n  INTRINSIC: 'intrinsic',\n};\n\n/**\n * Layout priorities to use with BaseElement#getLayoutPriority() and\n * BaseElement#updateLayoutPriority().\n * @enum {number}\n */\nexport const LayoutPriority = {\n  CONTENT: 0,\n  METADATA: 1,\n  ADS: 2,\n  BACKGROUND: 3,\n};\n\n/**\n * CSS Length type. E.g. \"1px\" or \"20vh\".\n * @typedef {string}\n */\nexport let LengthDef;\n\n/**\n * @typedef {{\n *   width: string,\n *   height: string\n * }}\n */\nexport let DimensionsDef;\n\n/**\n * Elements that the progress can be shown for. This set has to be externalized\n * since the element's implementation may not be downloaded yet.\n * This list does not include video players which are found via regex later.\n * @enum {boolean}\n * @private  Visible for testing only!\n */\nexport const LOADING_ELEMENTS_ = {\n  'AMP-AD': true,\n  'AMP-ANIM': true,\n  'AMP-EMBED': true,\n  'AMP-FACEBOOK': true,\n  'AMP-FACEBOOK-COMMENTS': true,\n  'AMP-FACEBOOK-PAGE': true,\n  'AMP-GOOGLE-DOCUMENT-EMBED': true,\n  'AMP-IFRAME': true,\n  'AMP-IMG': true,\n  'AMP-INSTAGRAM': true,\n  'AMP-LIST': true,\n  'AMP-PINTEREST': true,\n  'AMP-PLAYBUZZ': true,\n  'AMP-RENDER': true,\n  'AMP-TIKTOK': true,\n  'AMP-TWITTER': true,\n};\n/**\n * All video player components must either have a) \"video\" or b) \"player\" in\n * their name. A few components don't follow this convention for historical\n * reasons, so they are listed individually.\n * @private @const {!RegExp}\n */\nconst videoPlayerTagNameRe =\n  /^amp\\-(video|.+player)|AMP-BRIGHTCOVE|AMP-DAILYMOTION|AMP-YOUTUBE|AMP-VIMEO|AMP-IMA-VIDEO/i;\n\n/**\n * @param {string} s\n * @return {!Layout|undefined} Returns undefined in case of failure to parse\n *   the layout string.\n */\nexport function parseLayout(s) {\n  for (const k in Layout) {\n    if (Layout[k] == s) {\n      return Layout[k];\n    }\n  }\n  return undefined;\n}\n\n/**\n * @param {!Layout} layout\n * @return {string}\n */\nexport function getLayoutClass(layout) {\n  return 'i-amphtml-layout-' + layout;\n}\n\n/**\n * Whether an element with this layout inherently defines the size.\n * @param {!Layout} layout\n * @return {boolean}\n */\nexport function isLayoutSizeDefined(layout) {\n  return (\n    layout == Layout.FIXED ||\n    layout == Layout.FIXED_HEIGHT ||\n    layout == Layout.RESPONSIVE ||\n    layout == Layout.FILL ||\n    layout == Layout.FLEX_ITEM ||\n    layout == Layout.FLUID ||\n    layout == Layout.INTRINSIC\n  );\n}\n\n/**\n * Whether an element with this layout has a fixed dimension.\n * @param {!Layout} layout\n * @return {boolean}\n */\nexport function isLayoutSizeFixed(layout) {\n  return layout == Layout.FIXED || layout == Layout.FIXED_HEIGHT;\n}\n\n/**\n * Parses the CSS length value. If no units specified, the assumed value is\n * \"px\". Returns undefined in case of parsing error.\n * @param {string|undefined|null} s\n * @return {!LengthDef|undefined}\n */\nexport function parseLength(s) {\n  if (typeof s == 'number') {\n    return s + 'px';\n  }\n  if (!s) {\n    return undefined;\n  }\n  if (!/^\\d+(\\.\\d+)?(px|em|rem|vh|vw|vmin|vmax|cm|mm|q|in|pc|pt)?$/.test(s)) {\n    return undefined;\n  }\n  if (/^\\d+(\\.\\d+)?$/.test(s)) {\n    return s + 'px';\n  }\n  return s;\n}\n\n/**\n * Asserts that the supplied value is a non-percent CSS Length value.\n * @param {!LengthDef|string|null|undefined} length\n * @return {!LengthDef}\n * @closurePrimitive {asserts.matchesReturn}\n */\nexport function assertLength(length) {\n  userAssert(\n    /^\\d+(\\.\\d+)?(px|em|rem|vh|vw|vmin|vmax|cm|mm|q|in|pc|pt)$/.test(length),\n    'Invalid length value: %s',\n    length\n  );\n  return /** @type {!LengthDef} */ (length);\n}\n\n/**\n * Asserts that the supplied value is a CSS Length value\n * (including percent unit).\n * @param {!LengthDef|string} length\n * @return {!LengthDef}\n * @closurePrimitive {asserts.matchesReturn}\n */\nexport function assertLengthOrPercent(length) {\n  userAssert(\n    /^\\d+(\\.\\d+)?(px|em|rem|vh|vw|vmin|vmax|%)$/.test(length),\n    'Invalid length or percent value: %s',\n    length\n  );\n  return length;\n}\n\n/**\n * Returns units from the CSS length value.\n * @param {!LengthDef|string|null|undefined} length\n * @return {string}\n */\nexport function getLengthUnits(length) {\n  assertLength(length);\n  const m = userAssert(\n    /[a-z]+/i.exec(length),\n    'Failed to read units from %s',\n    length\n  );\n  return m[0];\n}\n\n/**\n * Returns the numeric value of a CSS length value.\n * @param {!LengthDef|string|null|undefined|number} length\n * @return {number|undefined}\n */\nexport function getLengthNumeral(length) {\n  const res = parseFloat(length);\n  return isFiniteNumber(res) ? res : undefined;\n}\n\n/**\n * Whether the loading can be shown for the specified element. This set has\n * to be externalized since the element's implementation may not be\n * downloaded yet.\n * @param {!Element} element\n * @return {boolean}\n */\nexport function isLoadingAllowed(element) {\n  const tagName = element.tagName.toUpperCase();\n  return LOADING_ELEMENTS_[tagName] || isIframeVideoPlayerComponent(tagName);\n}\n\n/**\n * All video player components must either have a) \"video\" or b) \"player\" in\n * their name. A few components don't follow this convention for historical\n * reasons, so they're present in the LOADING_ELEMENTS_ allowlist.\n * @param {string} tagName\n * @return {boolean}\n */\nexport function isIframeVideoPlayerComponent(tagName) {\n  if (tagName == 'AMP-VIDEO') {\n    return false;\n  }\n  return videoPlayerTagNameRe.test(tagName);\n}\n\n/**\n * Configures the supplied element to have a \"fill content\" layout. The\n * exact interpretation of \"fill content\" depends on the element's layout.\n *\n * If `opt_replacedContent` is specified, it indicates whether the \"replaced\n * content\" styling should be applied. Replaced content is not allowed to\n * have its own paddings or border.\n *\n * @param {!Element} element\n * @param {boolean=} opt_replacedContent\n */\nexport function applyFillContent(element, opt_replacedContent) {\n  element.classList.add('i-amphtml-fill-content');\n  if (opt_replacedContent) {\n    element.classList.add('i-amphtml-replaced-content');\n  }\n}\n", "// Note: loaded by 3p system. Cannot rely on babel polyfills.\nimport {devAssert} from '#core/assert';\nimport {devError} from '#core/error';\nimport {map} from '#core/types/object';\n\n/** @type {Object<string, string>} */\nlet propertyNameCache;\n\n/** @const {!Array<string>} */\nconst vendorPrefixes = ['Webkit', 'webkit', 'Moz', 'moz', 'ms', 'O', 'o'];\n\nconst DISPLAY_STYLE_MESSAGE =\n  '`display` style detected. You must use toggle instead.';\n\nconst EMPTY_CSS_DECLARATION = /** @type {!CSSStyleDeclaration} */ ({\n  'getPropertyPriority': () => '',\n  'getPropertyValue': () => '',\n});\n\n/**\n * @param {string} camelCase camel cased string\n * @return {string} title cased string\n */\nexport function camelCaseToTitleCase(camelCase) {\n  return camelCase.charAt(0).toUpperCase() + camelCase.slice(1);\n}\n\n/**\n  Checks the style if a prefixed version of a property exists and returns\n * it or returns an empty string.\n * @private\n * @param {!Object} style\n * @param {string} titleCase the title case version of a css property name\n * @return {string} the prefixed property name or null.\n */\nfunction getVendorJsPropertyName_(style, titleCase) {\n  for (let i = 0; i < vendorPrefixes.length; i++) {\n    const propertyName = vendorPrefixes[i] + titleCase;\n    if (style[propertyName] !== undefined) {\n      return propertyName;\n    }\n  }\n  return '';\n}\n\n/**\n * Returns the possibly prefixed JavaScript property name of a style property\n * (ex. WebkitTransitionDuration) given a camelCase'd version of the property\n * (ex. transitionDuration).\n * @param {!Object} style\n * @param {string} camelCase the camel cased version of a css property name\n * @param {boolean=} opt_bypassCache bypass the memoized cache of property\n *   mapping\n * @return {string}\n */\nexport function getVendorJsPropertyName(style, camelCase, opt_bypassCache) {\n  if (isVar(camelCase)) {\n    // CSS vars are returned as is.\n    return camelCase;\n  }\n  if (!propertyNameCache) {\n    propertyNameCache = map();\n  }\n  let propertyName = propertyNameCache[camelCase];\n  if (!propertyName || opt_bypassCache) {\n    propertyName = camelCase;\n    if (style[camelCase] === undefined) {\n      const titleCase = camelCaseToTitleCase(camelCase);\n      const prefixedPropertyName = getVendorJsPropertyName_(style, titleCase);\n\n      if (style[prefixedPropertyName] !== undefined) {\n        propertyName = prefixedPropertyName;\n      }\n    }\n    if (!opt_bypassCache) {\n      propertyNameCache[camelCase] = propertyName;\n    }\n  }\n  return propertyName;\n}\n\n/**\n * Sets the CSS styles of the specified element with !important. The styles\n * are specified as a map from CSS property names to their values.\n * @param {!Element} element\n * @param {!Object<string, *>} styles\n */\nexport function setImportantStyles(element, styles) {\n  const {style} = element;\n  for (const k in styles) {\n    style.setProperty(\n      getVendorJsPropertyName(style, k),\n      String(styles[k]),\n      'important'\n    );\n  }\n}\n\n/**\n * Sets the CSS style of the specified element with optional units, e.g. \"px\".\n * @param {?Element} element\n * @param {string} property\n * @param {*} value\n * @param {string=} opt_units\n * @param {boolean=} opt_bypassCache\n */\nexport function setStyle(element, property, value, opt_units, opt_bypassCache) {\n  const propertyName = getVendorJsPropertyName(\n    element.style,\n    property,\n    opt_bypassCache\n  );\n  if (!propertyName) {\n    return;\n  }\n  const styleValue = /** @type {string} */ (\n    opt_units ? value + opt_units : value\n  );\n  if (isVar(propertyName)) {\n    element.style.setProperty(propertyName, styleValue);\n  } else {\n    element.style[propertyName] = styleValue;\n  }\n}\n\n/**\n * Returns the value of the CSS style of the specified element.\n * @param {!Element} element\n * @param {string} property\n * @param {boolean=} opt_bypassCache\n * @return {*}\n */\nexport function getStyle(element, property, opt_bypassCache) {\n  const propertyName = getVendorJsPropertyName(\n    element.style,\n    property,\n    opt_bypassCache\n  );\n  if (!propertyName) {\n    return undefined;\n  }\n  if (isVar(propertyName)) {\n    return element.style.getPropertyValue(propertyName);\n  }\n  return element.style[propertyName];\n}\n\n/**\n * Sets the CSS styles of the specified element. The styles\n * a specified as a map from CSS property names to their values.\n * @param {!Element} element\n * @param {!Object<string, *>} styles\n */\nexport function setStyles(element, styles) {\n  for (const k in styles) {\n    setStyle(element, k, styles[k]);\n  }\n}\n\n/**\n * Sets the initial display style of an element. This is a last resort. If you\n * can set the initial display using CSS, YOU MUST.\n * DO NOT USE THIS TO ARBITRARILY SET THE DISPLAY STYLE AFTER INITIAL SETUP.\n *\n * @param {!Element} el\n * @param {string} value\n */\nexport function setInitialDisplay(el, value) {\n  const {style} = el;\n  devAssert(\n    value !== '' && value !== 'none',\n    'Initial display value must not be \"none\". Use toggle instead.'\n  );\n  devAssert(\n    !style['display'],\n    'setInitialDisplay MUST NOT be used for ' +\n      'resetting the display style. If you are looking for display:none ' +\n      'toggling, use toggle instead.'\n  );\n  style['display'] = value;\n}\n\n/**\n * Shows or hides the specified element.\n * @param {!Element} element\n * @param {boolean=} opt_display\n */\nexport function toggle(element, opt_display) {\n  if (opt_display === undefined) {\n    opt_display = element.hasAttribute('hidden');\n  }\n  if (opt_display) {\n    element.removeAttribute('hidden');\n  } else {\n    element.setAttribute('hidden', '');\n  }\n}\n\n/**\n * Returns a pixel value.\n * @param {number} value\n * @return {string}\n */\nexport function px(value) {\n  return `${value}px`;\n}\n\n/**\n * Returns a degree value.\n * @param {number} value\n * @return {string}\n */\nexport function deg(value) {\n  return `${value}deg`;\n}\n\n/**\n * Coerces a number into a string with units.\n * @param {number|string} value\n * @param {function(number):string} fn\n * @return {string}\n */\nfunction units(value, fn) {\n  return typeof value == 'number' ? fn(value) : value;\n}\n\n/**\n * Returns a \"translateX\" for CSS \"transform\" property.\n * @param {number|string} value\n * @return {string}\n */\nexport function translateX(value) {\n  return `translateX(${units(value, px)})`;\n}\n\n/**\n * Returns a \"translateX\" for CSS \"transform\" property.\n * @param {number|string} x\n * @param {(number|string|null)=} opt_y\n * @return {string}\n */\nexport function translate(x, opt_y) {\n  return opt_y === undefined || opt_y === null\n    ? `translate(${units(x, px)})`\n    : `translate(${units(x, px)}, ${units(opt_y, px)})`;\n}\n\n/**\n * Returns a \"scale\" for CSS \"transform\" property.\n * @param {number|string} value\n * @return {string}\n */\nexport function scale(value) {\n  return `scale(${value})`;\n}\n\n/**\n * Returns a \"rotate\" for CSS \"transform\" property.\n * @param {number|string} value\n * @return {string}\n */\nexport function rotate(value) {\n  return `rotate(${units(value, deg)})`;\n}\n\n/**\n * Remove alpha value from a rgba color value.\n * Return the new color property with alpha equals if has the alpha value.\n * Caller needs to make sure the input color value is a valid rgba/rgb value\n * @param {string} rgbaColor\n * @return {string}\n */\nexport function removeAlphaFromColor(rgbaColor) {\n  return rgbaColor.replace(\n    /\\(([^,]+),([^,]+),([^,)]+),[^)]+\\)/g,\n    '($1,$2,$3, 1)'\n  );\n}\n\n/**\n * Gets the computed style of the element. The helper is necessary to enforce\n * the possible `null` value returned by a buggy Firefox.\n *\n * @param {!Window} win\n * @param {!Element} el\n * @return {!CSSStyleDeclaration}\n */\nexport function computedStyle(win, el) {\n  const style = /** @type {?CSSStyleDeclaration} */ (win.getComputedStyle(el));\n  return style || EMPTY_CSS_DECLARATION;\n}\n\n/**\n * Resets styles that were set dynamically (i.e. inline)\n * @param {!Element} element\n * @param {!Array<string>} properties\n */\nexport function resetStyles(element, properties) {\n  for (let i = 0; i < properties.length; i++) {\n    setStyle(element, properties[i], null);\n  }\n}\n\n/**\n * Propagates the object-fit/position element attributes as styles.\n * @param {!Element} fromEl ie: amp-img\n * @param {!Element} toEl ie: the img within amp-img\n */\nexport function propagateObjectFitStyles(fromEl, toEl) {\n  if (fromEl.hasAttribute('object-fit')) {\n    setStyle(toEl, 'object-fit', fromEl.getAttribute('object-fit'));\n  }\n\n  if (fromEl.hasAttribute('object-position')) {\n    setStyle(toEl, 'object-position', fromEl.getAttribute('object-position'));\n  }\n}\n\n/**\n * @param {string} property\n * @return {boolean}\n */\nfunction isVar(property) {\n  return property.startsWith('--');\n}\n\n/**\n * Asserts that the style is not the `display` style.\n * This is the only possible way to pass a dynamic style to setStyle.\n *\n * If you wish to set `display`, use the `toggle` helper instead. This is so\n * changes to display can trigger necessary updates. See #17475.\n *\n * @param {string} style\n * @return {string}\n */\nexport function assertNotDisplay(style) {\n  // TODO(rcebulko): This calls itself an assert, but doesn't throw an error.\n  // Should it throw sync? If so, this/below can reduce to\n  // `return devAssert(style == 'display', DISPLAY_STYLE_MESSAGE);`\n  if (style === 'display') {\n    devError('STYLE', DISPLAY_STYLE_MESSAGE);\n  }\n  return style;\n}\n\n/**\n * Asserts that the styles does not contain the `display` style.\n * This is the only possible way to pass a dynamic styles object to setStyles\n * and setImportantStyles.\n *\n * If you wish to set `display`, use the `toggle` helper instead. This is so\n * changes to display can trigger necessary updates. See #17475.\n *\n * @param {!Object<string, *>} styles\n * @return {!Object<string, *>}\n */\nexport function assertDoesNotContainDisplay(styles) {\n  if ('display' in styles) {\n    devError('STYLE', DISPLAY_STYLE_MESSAGE);\n  }\n  return styles;\n}\n", "/** @fileoverview Helpers to wrap functions. */\n\n/**\n * Creates a function that is evaluated only once and returns the cached result\n * subsequently.\n *\n * Please note that `once` only takes the function definition into account,\n * so it will return the same cached value even when the arguments are\n * different.\n *\n * @param {function(...):T} fn\n * @return {function(...):T}\n * @template T\n */\nexport function once(fn) {\n  let evaluated = false;\n  let retValue = null;\n  let callback = fn;\n  return (...args) => {\n    if (!evaluated) {\n      retValue = callback.apply(self, args);\n      evaluated = true;\n      callback = null; // GC\n    }\n    return retValue;\n  };\n}\n\n/**\n * Wraps a given callback and applies a rate limit.\n * It throttles the calls so that no consequent calls have time interval\n * smaller than the given minimal interval.\n *\n * @param {!Window} win\n * @param {function(...T):R} callback\n * @param {number} minInterval the minimum time interval in millisecond\n * @return {function(...T)}\n * @template T\n * @template R\n */\nexport function throttle(win, callback, minInterval) {\n  let locker = 0;\n  let nextCallArgs = null;\n\n  /**\n   * @param {!Object} args\n   */\n  function fire(args) {\n    nextCallArgs = null;\n    // Lock the fire for minInterval milliseconds\n    locker = win.setTimeout(waiter, minInterval);\n\n    callback.apply(null, args);\n  }\n\n  /**\n   * Waiter function\n   */\n  function waiter() {\n    locker = 0;\n    // If during the period there're invocations queued up, fire once.\n    if (nextCallArgs) {\n      fire(nextCallArgs);\n    }\n  }\n\n  return function (...args) {\n    if (locker) {\n      nextCallArgs = args;\n    } else {\n      fire(args);\n    }\n  };\n}\n\n/**\n * Wraps a given callback and applies a wait timer, so that minInterval\n * milliseconds must pass since the last call before the callback is actually\n * invoked.\n *\n * @param {!Window} win\n * @param {function(...T):R} callback\n * @param {number} minInterval the minimum time interval in millisecond\n * @return {function(...T)}\n * @template T\n * @template R\n */\nexport function debounce(win, callback, minInterval) {\n  let locker = 0;\n  let timestamp = 0;\n  let nextCallArgs = null;\n\n  /**\n   * @param {?Array} args\n   */\n  function fire(args) {\n    nextCallArgs = null;\n    callback.apply(null, args);\n  }\n\n  /**\n   * Wait function for debounce\n   */\n  function waiter() {\n    locker = 0;\n    const remaining = minInterval - (win.Date.now() - timestamp);\n    if (remaining > 0) {\n      locker = win.setTimeout(waiter, remaining);\n    } else {\n      fire(nextCallArgs);\n    }\n  }\n\n  return function (...args) {\n    timestamp = win.Date.now();\n    nextCallArgs = args;\n    if (!locker) {\n      locker = win.setTimeout(waiter, minInterval);\n    }\n  };\n}\n", "/**\n * Allows for runtime configuration. Internally, the runtime should\n * use the src/config.js module for various constants. We can use the\n * AMP_CONFIG global to translate user-defined configurations to this\n * module.\n * @type {!Object<string, string>}\n */\nconst env = self.AMP_CONFIG || {};\n\nconst thirdPartyFrameRegex =\n  (typeof env['thirdPartyFrameRegex'] == 'string'\n    ? new RegExp(env['thirdPartyFrameRegex'])\n    : env['thirdPartyFrameRegex']) || /^d-\\d+\\.ampproject\\.net$/;\n\nconst cdnProxyRegex =\n  (typeof env['cdnProxyRegex'] == 'string'\n    ? new RegExp(env['cdnProxyRegex'])\n    : env['cdnProxyRegex']) ||\n  /^https:\\/\\/([a-zA-Z0-9_-]+\\.)?cdn\\.ampproject\\.org$/;\n\n/**\n * Check for a custom URL definition in special <meta> tags. Note that this does\n * not allow for distinct custom URLs in AmpDocShadow instances. The shell is\n * allowed to define one set of custom URLs via AMP_CONFIG (recommended) or by\n * including <meta> tags in the shell <head>. Those custom URLs then apply to\n * all AMP documents loaded in the shell.\n * @param {string} name\n * @return {?string}\n * @private\n */\nfunction getMetaUrl(name) {\n  // Avoid exceptions in unit tests\n  if (!self.document || !self.document.head) {\n    return null;\n  }\n\n  // Disallow on proxy origins\n  if (self.location && cdnProxyRegex.test(self.location.origin)) {\n    return null;\n  }\n\n  const metaEl = self.document.head./*OK*/ querySelector(\n    `meta[name=\"${name}\"]`\n  );\n  return (metaEl && metaEl.getAttribute('content')) || null;\n}\n\n/**\n * @typedef {{\n *   thirdParty: string,\n *   thirdPartyFrameHost: string,\n *   thirdPartyFrameRegex: !RegExp,\n *   cdn: string,\n *   cdnProxyRegex: !RegExp,\n *   localhostRegex: !RegExp,\n *   errorReporting: string,\n *   betaErrorReporting: string,\n *   localDev: boolean,\n *   trustedViewerHosts: !Array<!RegExp>,\n *   geoApi: ?string,\n * }}\n */\nexport const urls = {\n  thirdParty: env['thirdPartyUrl'] || 'https://3p.ampproject.net',\n  thirdPartyFrameHost: env['thirdPartyFrameHost'] || 'ampproject.net',\n  thirdPartyFrameRegex,\n  cdn:\n    env['cdnUrl'] || getMetaUrl('runtime-host') || 'https://cdn.ampproject.org',\n  /* Note that cdnProxyRegex is only ever checked against origins\n   * (proto://host[:port]) so does not need to consider path\n   */\n  cdnProxyRegex,\n  localhostRegex: /^https?:\\/\\/localhost(:\\d+)?$/,\n  errorReporting:\n    env['errorReportingUrl'] ||\n    'https://us-central1-amp-error-reporting.cloudfunctions.net/r',\n  betaErrorReporting:\n    env['betaErrorReportingUrl'] ||\n    'https://us-central1-amp-error-reporting.cloudfunctions.net/r-beta',\n  localDev: env['localDev'] || false,\n  /**\n   * These domains are trusted with more sensitive viewer operations such as\n   * propagating the referrer. If you believe your domain should be here,\n   * file the issue on GitHub to discuss. The process will be similar\n   * (but somewhat more stringent) to the one described in the [3p/README.md](\n   * https://github.com/ampproject/amphtml/blob/main/3p/README.md)\n   *\n   * {!Array<!RegExp>}\n   */\n  trustedViewerHosts: [\n    /(^|\\.)google\\.(com?|[a-z]{2}|com?\\.[a-z]{2}|cat)$/,\n    /(^|\\.)gmail\\.(com|dev)$/,\n  ],\n  // Optional fallback API if amp-geo is left unpatched\n  geoApi: env['geoApiUrl'] || getMetaUrl('amp-geo-api'),\n};\n\nexport const config = {\n  urls,\n};\n", "import * as mode from '#core/mode';\n\nimport {urls} from '../config';\nimport {getMode} from '../mode';\n\nconst CUSTOM_TEMPLATES = ['amp-mustache'];\nconst LATEST_VERSION = 'latest';\n\n/**\n * Calculate the base url for any scripts.\n * @param {!Location} location The window's location\n * @param {boolean=} opt_isLocalDev\n * @return {string}\n */\nexport function calculateScriptBaseUrl(location, opt_isLocalDev) {\n  if (opt_isLocalDev) {\n    let prefix = `${location.protocol}//${location.host}`;\n    if (\n      location.protocol == 'about:' ||\n      location.protocol == 'blob:' ||\n      location.protocol == 'data:'\n    ) {\n      prefix = '';\n    }\n    return `${prefix}/dist`;\n  }\n  return urls.cdn;\n}\n\n/**\n * Calculate script url for an extension.\n * @param {!Location} location The window's location\n * @param {string} extensionId\n * @param {string} version\n * @param {boolean=} opt_isLocalDev\n * @return {string}\n */\nexport function calculateExtensionScriptUrl(\n  location,\n  extensionId,\n  version,\n  opt_isLocalDev\n) {\n  const fileExtension = mode.isEsm() ? '.mjs' : '.js';\n  const base = calculateScriptBaseUrl(location, opt_isLocalDev);\n  const rtv = getMode().rtvVersion;\n  const extensionVersion = version ? '-' + version : '';\n  return `${base}/rtv/${rtv}/v0/${extensionId}${extensionVersion}${fileExtension}`;\n}\n\n/**\n * Calculate script url for an entry point.\n * If `opt_rtv` is true, returns the URL matching the current RTV.\n * @param {!Location} location The window's location\n * @param {string} entryPoint\n * @param {boolean=} isLocalDev\n * @param {boolean=} opt_rtv\n * @return {string}\n */\nexport function calculateEntryPointScriptUrl(\n  location,\n  entryPoint,\n  isLocalDev,\n  opt_rtv\n) {\n  const fileExtension = mode.isEsm() ? '.mjs' : '.js';\n  const base = calculateScriptBaseUrl(location, isLocalDev);\n  if (isLocalDev) {\n    return `${base}/${entryPoint}${fileExtension}`;\n  }\n  if (opt_rtv) {\n    return `${base}/rtv/${getMode().rtvVersion}/${entryPoint}${fileExtension}`;\n  }\n  return `${base}/${entryPoint}${fileExtension}`;\n}\n\n/**\n * Parse the extension version from a given script URL.\n * @param {string} scriptUrl\n * @return {?{extensionId: string, extensionVersion: string}}\n */\nexport function parseExtensionUrl(scriptUrl) {\n  if (!scriptUrl) {\n    return null;\n  }\n  // Note that the \"(\\.max)?\" group only applies to local dev.\n  const matches = scriptUrl.match(\n    /^(.*)\\/(.*)-([0-9.]+|latest)(\\.max)?\\.(?:js|mjs)$/i\n  );\n  const extensionId = matches ? matches[2] : undefined;\n  const extensionVersion = matches ? matches[3] : undefined;\n  if (!extensionId || !extensionVersion) {\n    return null;\n  }\n  return {extensionId, extensionVersion};\n}\n\n/**\n * Create the missing amp extension HTML script element.\n * @param {!Window} win\n * @param {string} extensionId\n * @param {string} version\n * @return {!Element} Script object\n */\nexport function createExtensionScript(win, extensionId, version) {\n  const scriptElement = win.document.createElement('script');\n  scriptElement.async = true;\n  if (isIntermediateExtension(extensionId)) {\n    version = '';\n  } else {\n    scriptElement.setAttribute(\n      CUSTOM_TEMPLATES.indexOf(extensionId) >= 0\n        ? 'custom-template'\n        : 'custom-element',\n      extensionId\n    );\n  }\n  scriptElement.setAttribute('data-script', extensionId);\n  scriptElement.setAttribute('i-amphtml-inserted', '');\n  if (mode.isEsm()) {\n    scriptElement.setAttribute('type', 'module');\n  }\n\n  // Propagate nonce to all generated script tags.\n  const currentScript = win.document.head.querySelector('script[nonce]');\n  if (currentScript) {\n    scriptElement.setAttribute('nonce', currentScript.getAttribute('nonce'));\n  }\n\n  // Allow error information to be collected\n  // https://github.com/ampproject/amphtml/issues/7353\n  scriptElement.setAttribute('crossorigin', 'anonymous');\n  let loc = win.location;\n  if (getMode(win).test && win.testLocation) {\n    loc = win.testLocation;\n  }\n  const scriptSrc = calculateExtensionScriptUrl(\n    loc,\n    extensionId,\n    version,\n    getMode(win).localDev\n  );\n  scriptElement.src = scriptSrc;\n  return scriptElement;\n}\n\n/**\n * Returns the extension <script> element and attribute for the given\n * extension ID, if it exists. Otherwise, returns null.\n * @param {!Window} win\n * @param {string} extensionId\n * @param {string} version\n * @param {boolean} latest\n * @param {boolean=} includeInserted If true, includes script elements that\n *   are inserted by the runtime dynamically. Default is true.\n * @return {!Array<!Element>}\n */\nexport function getExtensionScripts(\n  win,\n  extensionId,\n  version,\n  latest,\n  includeInserted = true\n) {\n  // Always ignore <script> elements that have a mismatched RTV.\n  const modifier =\n    ':not([i-amphtml-loaded-new-version])' +\n    (includeInserted ? '' : ':not([i-amphtml-inserted])');\n  // We have to match against \"src\" because a few extensions, such as\n  // \"amp-viewer-integration\", do not have \"custom-element\" attribute.\n  const matches = win.document.head./*OK*/ querySelectorAll(\n    `script[src*=\"/${extensionId}-\"]${modifier}`\n  );\n  const filtered = [];\n  for (let i = 0; i < matches.length; i++) {\n    const match = matches[i];\n    const urlParts = parseExtensionUrl(match.src);\n    if (!urlParts) {\n      continue;\n    }\n    const {\n      extensionId: scriptExtensionId,\n      extensionVersion: scriptExtensionVersion,\n    } = urlParts;\n    if (\n      scriptExtensionId == extensionId &&\n      (isIntermediateExtension(extensionId) ||\n        scriptExtensionVersion == version ||\n        (scriptExtensionVersion == LATEST_VERSION && latest))\n    ) {\n      filtered.push(match);\n    }\n  }\n  return filtered;\n}\n\n/**\n * Get list of all the extension JS files.\n * @param {HTMLHeadElement|Element|ShadowRoot|Document} head\n * @return {!Array<{script: HTMLScriptElement, extensionId: string, extensionVersion: string}>}\n */\nexport function extensionScriptsInNode(head) {\n  // ampdoc.getHeadNode() can return null.\n  if (!head) {\n    return [];\n  }\n  // Note: Some extensions don't have [custom-element] or [custom-template]\n  // e.g. amp-viewer-integration.\n  const list = head.querySelectorAll(\n    'script[custom-element],script[custom-template]'\n  );\n  const scripts = [];\n  for (let i = 0; i < list.length; i++) {\n    const script = list[i];\n    const extensionId =\n      script.getAttribute('custom-element') ||\n      script.getAttribute('custom-template');\n    const urlParts = parseExtensionUrl(script.src);\n    if (extensionId && urlParts) {\n      scripts.push({\n        script,\n        extensionId,\n        extensionVersion: urlParts.extensionVersion,\n      });\n    }\n  }\n  return scripts;\n}\n\n/**\n * Verifies that an extension script is present in head for\n * installation.\n * @param {!Window} win\n * @param {string} id\n * @param {string} version\n * @return {boolean}\n */\nexport function extensionScriptInNode(win, id, version) {\n  return extensionScriptsInNode(win.document.head).some(\n    ({extensionId, extensionVersion}) =>\n      id == extensionId && version == extensionVersion\n  );\n}\n\n/**\n * @param {string} extensionId\n * @return {boolean}\n */\nfunction isIntermediateExtension(extensionId) {\n  return extensionId.startsWith('_');\n}\n", "import * as assertions from '#core/assert/base';\nimport {\n  createError,\n  createExpectedError,\n  duplicateErrorIfNecessary,\n} from '#core/error';\nimport {\n  USER_ERROR_EMBED_SENTINEL,\n  USER_ERROR_SENTINEL,\n  elementStringOrPassThru,\n  isUserErrorMessage,\n  stripUserError,\n} from '#core/error/message-helpers';\nimport * as mode from '#core/mode';\nimport {isArray, isString} from '#core/types';\nimport {once} from '#core/types/function';\nimport {getHashParams} from '#core/types/string/url';\n\nimport {urls} from '../config';\nimport {getMode} from '../mode';\n\nconst noop = () => {};\n\n// These are exported here despite being defined elswhere to avoid updating\n// imports across many files for now.\nexport {USER_ERROR_SENTINEL, isUserErrorMessage};\n\n/**\n * Sets reportError function. Called from error-reporting.js to break cyclic\n * dependency.\n * @param {function(this:Window, Error, (?Element)=): ?|undefined} fn\n */\nexport function setReportError(fn) {\n  self.__AMP_REPORT_ERROR = fn;\n}\n\n/**\n * @enum {number}\n */\nexport const LogLevel = {\n  OFF: 0,\n  ERROR: 1,\n  WARN: 2,\n  INFO: 3,\n  FINE: 4,\n};\n\n/**\n * @type {!LogLevel|undefined}\n * @private\n */\nlet levelOverride_ = undefined;\n\n/**\n * @param {!LogLevel} level\n */\nexport function overrideLogLevel(level) {\n  levelOverride_ = level;\n}\n\n/**\n * Prefixes `internalRuntimeVersion` with the `01` channel signifier (for prod.) for\n * extracted message URLs.\n * (Specific channel is irrelevant: message tables are invariant on internal version.)\n * @return {string}\n */\nconst messageUrlRtv = () => `01${mode.version()}`;\n\n/**\n * Gets a URL to display a message on amp.dev.\n * @param {string} id\n * @param {!Array} interpolatedParts\n * @return {string}\n */\nconst externalMessageUrl = (id, interpolatedParts) =>\n  interpolatedParts.reduce(\n    (prefix, arg) => `${prefix}&s[]=${messageArgToEncodedComponent(arg)}`,\n    `https://log.amp.dev/?v=${messageUrlRtv()}&id=${encodeURIComponent(id)}`\n  );\n\n/**\n * URL to simple log messages table JSON file, which contains an Object<string, string>\n * which maps message id to full message template.\n * @return {string}\n */\nconst externalMessagesSimpleTableUrl = () =>\n  `${urls.cdn}/rtv/${messageUrlRtv()}/log-messages.simple.json`;\n\n/**\n * @param {*} arg\n * @return {string}\n */\nconst messageArgToEncodedComponent = (arg) =>\n  encodeURIComponent(String(elementStringOrPassThru(arg)));\n\n/**\n * @param {!Window=} opt_win\n * @return {number}\n */\nexport const logHashParam = (opt_win) =>\n  parseInt(getHashParams(opt_win)['log'], 10);\n\n/**\n * Logging class. Use of sentinel string instead of a boolean to check user/dev\n * errors because errors could be rethrown by some native code as a new error,\n * and only a message would survive. Also, some browser don\u2019t support a 5th\n * error object argument in window.onerror. List of supporting browser can be\n * found here:\n * https://blog.sentry.io/2016/01/04/client-javascript-reporting-window-onerror.html\n * @final\n * @private Visible for testing only.\n */\nexport class Log {\n  /**\n   * opt_suffix will be appended to error message to identify the type of the\n   * error message. We can't rely on the error object to pass along the type\n   * because some browsers do not have this param in its window.onerror API.\n   * See:\n   * https://blog.sentry.io/2016/01/04/client-javascript-reporting-window-onerror.html\n   *\n   * @param {!Window} win\n   * @param {function(number, boolean):!LogLevel} levelFunc\n   * @param {string=} opt_suffix\n   */\n  constructor(win, levelFunc, opt_suffix = '') {\n    /**\n     * In tests we use the main test window instead of the iframe where\n     * the tests runs because only the former is relayed to the console.\n     * @const {!Window}\n     */\n    this.win = getMode().test && win.__AMP_TEST_IFRAME ? win.parent : win;\n\n    /** @private @const {function(number, boolean):!LogLevel} */\n    this.levelFunc_ = levelFunc;\n\n    /** @private @const {!LogLevel} */\n    this.level_ = this.defaultLevel_();\n\n    /** @private @const {string} */\n    this.suffix_ = opt_suffix;\n\n    /** @private {?JsonObject} */\n    this.messages_ = null;\n\n    this.fetchExternalMessagesOnce_ = once(() => {\n      win\n        .fetch(externalMessagesSimpleTableUrl())\n        .then((response) => response.json(), noop)\n        .then((opt_messages) => {\n          if (opt_messages) {\n            this.messages_ = /** @type {!JsonObject} */ (opt_messages);\n          }\n        });\n    });\n\n    // This bound assertion function is capable of handling the format used when\n    // error/assertion messages are extracted. This logic hasn't yet been\n    // migrated to an AMP-independent form for use in core. This binding allows\n    // Log assertion helpers to maintain message-extraction capabilities until\n    // that logic can be moved to core.\n    this.boundAssertFn_ = /** @type {!assertions.AssertionFunctionDef} */ (\n      this.assert.bind(this)\n    );\n  }\n\n  /**\n   * @return {!LogLevel}\n   * @private\n   */\n  defaultLevel_() {\n    const {win} = this;\n    // No console - can't enable logging.\n    if (\n      !win.console?.log ||\n      // Logging has been explicitly disabled.\n      logHashParam(win) == 0\n    ) {\n      return LogLevel.OFF;\n    }\n\n    // Logging is enabled for tests directly.\n    if (getMode().test && win.ENABLE_LOG) {\n      return LogLevel.FINE;\n    }\n\n    // LocalDev by default allows INFO level, unless overriden by `#log`.\n    if (getMode().localDev) {\n      return LogLevel.INFO;\n    }\n\n    return this.defaultLevelWithFunc_();\n  }\n\n  /**\n   * @param {!Window=} opt_win provided for testing\n   * @return {!LogLevel}\n   * @private\n   */\n  defaultLevelWithFunc_(opt_win) {\n    // Delegate to the specific resolver.\n    return this.levelFunc_(logHashParam(opt_win), getMode().development);\n  }\n\n  /**\n   * @param {string} tag\n   * @param {!LogLevel} level\n   * @param {!Array} messages\n   * @return {boolean} true if a the message was logged\n   */\n  msg_(tag, level, messages) {\n    if (level > (levelOverride_ ?? this.level_)) {\n      return false;\n    }\n\n    const cs = this.win.console;\n    const fn =\n      {\n        [LogLevel.ERROR]: cs.error,\n        [LogLevel.INFO]: cs.info,\n        [LogLevel.WARN]: cs.warn,\n      }[level] ?? cs.log;\n\n    const args = this.maybeExpandMessageArgs_(messages);\n    // Prefix console message with \"[tag]\".\n    const prefix = `[${tag}]`;\n    if (isString(args[0])) {\n      // Prepend string to avoid breaking string substitutions e.g. %s.\n      args[0] = prefix + ' ' + args[0];\n    } else {\n      args.unshift(prefix);\n    }\n    fn.apply(cs, args);\n\n    return true;\n  }\n\n  /**\n   * Reports a fine-grained message.\n   * @param {string} tag\n   * @param {...*} args\n   */\n  fine(tag, ...args) {\n    this.msg_(tag, LogLevel.FINE, args);\n  }\n\n  /**\n   * Reports a informational message.\n   * @param {string} tag\n   * @param {...*} args\n   */\n  info(tag, ...args) {\n    this.msg_(tag, LogLevel.INFO, args);\n  }\n\n  /**\n   * Reports a warning message.\n   * @param {string} tag\n   * @param {...*} args\n   */\n  warn(tag, ...args) {\n    this.msg_(tag, LogLevel.WARN, args);\n  }\n\n  /**\n   * Reports an error message.\n   * @param {string} tag\n   * @param {...*} args\n   */\n  error(tag, ...args) {\n    if (!this.msg_(tag, LogLevel.ERROR, args)) {\n      const error = this.createError.apply(this, args);\n      error.name = tag || error.name;\n      self.__AMP_REPORT_ERROR?.(error);\n    }\n  }\n\n  /**\n   * Reports an error message and marks with an expected property. If the\n   * logging is disabled, the error is rethrown asynchronously.\n   * @param {string} tag\n   * @param {...*} args\n   */\n  expectedError(tag, ...args) {\n    if (!this.msg_(tag, LogLevel.ERROR, args)) {\n      self.__AMP_REPORT_ERROR?.(this.createExpectedError.apply(this, args));\n    }\n  }\n\n  /**\n   * Creates an error object.\n   * @param {...*} var_args\n   * @return {!Error}\n   */\n  createError(var_args) {\n    return this.setErrorSuffix_(createError.apply(null, arguments));\n  }\n\n  /**\n   * Creates an error object with its expected property set to true.\n   * @param {...*} var_args\n   * @return {!Error}\n   */\n  createExpectedError(var_args) {\n    return this.setErrorSuffix_(createExpectedError.apply(null, arguments));\n  }\n\n  /**\n   * @param {!Error} error\n   * @return {!Error}\n   * @private\n   */\n  setErrorSuffix_(error) {\n    error = duplicateErrorIfNecessary(error);\n\n    if (this.suffix_) {\n      if (!error.message) {\n        error.message = this.suffix_;\n      } else if (error.message.indexOf(this.suffix_) == -1) {\n        error.message += this.suffix_;\n      }\n    } else if (isUserErrorMessage(error.message)) {\n      error.message = stripUserError(error.message);\n    }\n\n    return error;\n  }\n\n  /**\n   * @param {!Array} args\n   * @return {!Array}\n   * @private\n   */\n  maybeExpandMessageArgs_(args) {\n    return isArray(args[0])\n      ? this.expandMessageArgs_(/** @type {!Array} */ (args[0]))\n      : args;\n  }\n\n  /**\n   * Either redirects a pair of (errorId, ...args) to a URL where the full\n   * message is displayed, or displays it from a fetched table.\n   *\n   * This method is used by the output of the `transform-log-methods` babel\n   * plugin. It should not be used directly. Use the (*error|assert*|info|warn)\n   * methods instead.\n   *\n   * @param {!Array} parts\n   * @return {!Array}\n   * @private\n   */\n  expandMessageArgs_(parts) {\n    // First value should exist.\n    const id = parts.shift();\n    // Best effort fetch of message template table.\n    // Since this is async, the first few logs might be indirected to a URL even\n    // if in development mode. Message table is ~small so this should be a short\n    // gap.\n    if (getMode(this.win).development) {\n      this.fetchExternalMessagesOnce_();\n    }\n\n    return this.messages_?.[id]\n      ? [this.messages_[id]].concat(parts)\n      : [`More info at ${externalMessageUrl(id, parts)}`];\n  }\n\n  /**\n   * Throws an error if the first argument isn't trueish.\n   *\n   * Supports argument substitution into the message via %s placeholders.\n   *\n   * Throws an error object that has two extra properties:\n   * - associatedElement: This is the first element provided in the var args.\n   *   It can be used for improved display of error messages.\n   * - messageArray: The elements of the substituted message as non-stringified\n   *   elements in an array. When e.g. passed to console.error this yields\n   *   native displays of things like HTML elements.\n   *\n   * @param {T} shouldBeTrueish The value to assert. The assert fails if it does\n   *     not evaluate to true.\n   * @param {!Array|string=} opt_message The assertion message\n   * @param {...*} var_args Arguments substituted into %s in the message.\n   * @return {T} The value of shouldBeTrueish.\n   * @throws {!Error} When `value` is falsey.\n   * @template T\n   * @closurePrimitive {asserts.truthy}\n   */\n  assert(shouldBeTrueish, opt_message, var_args) {\n    if (isArray(opt_message)) {\n      return this.assert.apply(\n        this,\n        [shouldBeTrueish].concat(\n          this.expandMessageArgs_(/** @type {!Array} */ (opt_message))\n        )\n      );\n    }\n\n    return assertions.assert.apply(\n      null,\n      [this.suffix_].concat(Array.prototype.slice.call(arguments))\n    );\n  }\n\n  /**\n   * Throws an error if the first argument isn't an Element\n   *\n   * Otherwise see `assert` for usage\n   *\n   * @param {*} shouldBeElement\n   * @param {!Array|string=} opt_message The assertion message\n   * @return {!Element} The value of shouldBeTrueish.\n   * @closurePrimitive {asserts.matchesReturn}\n   */\n  assertElement(shouldBeElement, opt_message) {\n    return assertions.assertElement(\n      this.boundAssertFn_,\n      shouldBeElement,\n      opt_message\n    );\n  }\n\n  /**\n   * Throws an error if the first argument isn't a string. The string can\n   * be empty.\n   *\n   * For more details see `assert`.\n   *\n   * @param {*} shouldBeString\n   * @param {!Array|string=} opt_message The assertion message\n   * @return {string} The string value. Can be an empty string.\n   * @closurePrimitive {asserts.matchesReturn}\n   */\n  assertString(shouldBeString, opt_message) {\n    return assertions.assertString(\n      this.boundAssertFn_,\n      shouldBeString,\n      opt_message\n    );\n  }\n\n  /**\n   * Throws an error if the first argument isn't a number. The allowed values\n   * include `0` and `NaN`.\n   *\n   * For more details see `assert`.\n   *\n   * @param {*} shouldBeNumber\n   * @param {!Array|string=} opt_message The assertion message\n   * @return {number} The number value. The allowed values include `0`\n   *   and `NaN`.\n   * @closurePrimitive {asserts.matchesReturn}\n   */\n  assertNumber(shouldBeNumber, opt_message) {\n    return assertions.assertNumber(\n      this.boundAssertFn_,\n      shouldBeNumber,\n      opt_message\n    );\n  }\n\n  /**\n   * Throws an error if the first argument is not an array.\n   * The array can be empty.\n   *\n   * @param {*} shouldBeArray\n   * @param {!Array|string=} opt_message The assertion message\n   * @return {!Array} The array value\n   * @closurePrimitive {asserts.matchesReturn}\n   */\n  assertArray(shouldBeArray, opt_message) {\n    return assertions.assertArray(\n      this.boundAssertFn_,\n      shouldBeArray,\n      opt_message\n    );\n  }\n\n  /**\n   * Throws an error if the first argument isn't a boolean.\n   *\n   * For more details see `assert`.\n   *\n   * @param {*} shouldBeBoolean\n   * @param {!Array|string=} opt_message The assertion message\n   * @return {boolean} The boolean value.\n   * @closurePrimitive {asserts.matchesReturn}\n   */\n  assertBoolean(shouldBeBoolean, opt_message) {\n    return assertions.assertBoolean(\n      this.boundAssertFn_,\n      shouldBeBoolean,\n      opt_message\n    );\n  }\n}\n\n/**\n * Cache for logs. We do not use a Service since the service module depends\n * on Log and closure literally can't even.\n * @type {{user: ?Log, dev: ?Log, userForEmbed: ?Log}}\n */\nself.__AMP_LOG = self.__AMP_LOG || {\n  user: null,\n  dev: null,\n  userForEmbed: null,\n};\n\nconst logs = self.__AMP_LOG;\n\n/**\n * Eventually holds a constructor for Log objects. Lazily initialized, so we\n * can avoid ever referencing the real constructor except in JS binaries\n * that actually want to include the implementation.\n * @type {?typeof Log}\n */\nlet logConstructor = null;\n\n/**\n * Initializes log constructor.\n */\nexport function initLogConstructor() {\n  logConstructor = Log;\n  // Initialize instances for use. If a binary (an extension for example) that\n  // does not call `initLogConstructor` invokes `dev()` or `user()` earlier than\n  // the binary that does call `initLogConstructor` (amp.js), the extension will\n  // throw an error as that extension will never be able to initialize the log\n  // instances and we also don't want it to call `initLogConstructor` either\n  // (since that will cause the Log implementation to be bundled into that\n  // binary). So we must initialize the instances eagerly so that they are ready\n  // for use (stored globally) after the main binary calls `initLogConstructor`.\n  dev();\n  user();\n}\n\n/**\n * Resets log constructor for testing.\n */\nexport function resetLogConstructorForTesting() {\n  logConstructor = null;\n}\n\n/**\n * Calls the log constructor with a given level function and suffix.\n * @param {function(number, boolean):!LogLevel} levelFunc\n * @param {string=} opt_suffix\n * @return {!Log}\n */\nfunction callLogConstructor(levelFunc, opt_suffix) {\n  if (!logConstructor) {\n    throw new Error('failed to call initLogConstructor');\n  }\n  return new logConstructor(self, levelFunc, opt_suffix);\n}\n\n/**\n * Publisher level log.\n *\n * Enabled in the following conditions:\n *  1. Not disabled using `#log=0`.\n *  2. Development mode is enabled via `#development=1` or logging is explicitly\n *     enabled via `#log=D` where D >= 1.\n *  3. AMP.setLogLevel(D) is called, where D >= 1.\n *\n * @param {!Element=} opt_element\n * @return {!Log}\n */\nexport function user(opt_element) {\n  // logs.user must exist first to perform the logs.user.win check below\n  if (!logs.user) {\n    logs.user = getUserLogger(USER_ERROR_SENTINEL);\n  }\n\n  if (isFromEmbed(logs.user.win, opt_element)) {\n    return (\n      logs.userForEmbed ||\n      (logs.userForEmbed = getUserLogger(USER_ERROR_EMBED_SENTINEL))\n    );\n  }\n  return logs.user;\n}\n\n/**\n * Getter for user logger\n * @param {string=} suffix\n * @return {!Log}\n */\nfunction getUserLogger(suffix) {\n  return callLogConstructor(\n    (logNum, development) =>\n      development || logNum >= 1 ? LogLevel.FINE : LogLevel.WARN,\n    suffix\n  );\n}\n\n/**\n * AMP development log. Calls to `devLog().assert` and `dev.fine` are stripped\n * in the PROD binary. However, `devLog().assert` result is preserved in either\n * case.\n *\n * Enabled in the following conditions:\n *  1. Not disabled using `#log=0`.\n *  2. Logging is explicitly enabled via `#log=D`, where D >= 2.\n *  3. AMP.setLogLevel(D) is called, where D >= 2.\n *\n * @return {!Log}\n */\nexport function dev() {\n  return (\n    logs.dev ||\n    (logs.dev = callLogConstructor((logNum) =>\n      logNum >= 3 ? LogLevel.FINE : logNum >= 2 ? LogLevel.INFO : LogLevel.OFF\n    ))\n  );\n}\n\n/**\n * @param {!Window} win\n * @param {!Element=} opt_element\n * @return {boolean} isEmbed\n */\nfunction isFromEmbed(win, opt_element) {\n  return opt_element && opt_element.ownerDocument.defaultView != win;\n}\n\n/**\n * Throws an error if the first argument isn't trueish.\n *\n * Supports argument substitution into the message via %s placeholders.\n *\n * Throws an error object that has two extra properties:\n * - associatedElement: This is the first element provided in the var args.\n *   It can be used for improved display of error messages.\n * - messageArray: The elements of the substituted message as non-stringified\n *   elements in an array. When e.g. passed to console.error this yields\n *   native displays of things like HTML elements.\n *\n * @param {T} shouldBeTrueish The value to assert. The assert fails if it does\n *     not evaluate to true.\n * @param {!Array|string=} opt_message The assertion message\n * @param {*=} opt_1 Optional argument (Var arg as individual params for better\n * @param {*=} opt_2 Optional argument inlining)\n * @param {*=} opt_3 Optional argument\n * @param {*=} opt_4 Optional argument\n * @param {*=} opt_5 Optional argument\n * @param {*=} opt_6 Optional argument\n * @param {*=} opt_7 Optional argument\n * @param {*=} opt_8 Optional argument\n * @param {*=} opt_9 Optional argument\n * @return {T} The value of shouldBeTrueish.\n * @throws {!Error} When `shouldBeTrueish` is falsey.\n * @template T\n * @closurePrimitive {asserts.truthy}\n */\nexport function devAssert(\n  shouldBeTrueish,\n  opt_message,\n  opt_1,\n  opt_2,\n  opt_3,\n  opt_4,\n  opt_5,\n  opt_6,\n  opt_7,\n  opt_8,\n  opt_9\n) {\n  if (mode.isMinified()) {\n    return shouldBeTrueish;\n  }\n  if (self.__AMP_ASSERTION_CHECK) {\n    // This will never execute regardless, but will be included on unminified\n    // builds. It will be DCE'd away from minified builds, and so can be used to\n    // validate that Babel is properly removing dev assertions in minified\n    // builds.\n    console /*OK*/\n      .log('__devAssert_sentinel__');\n  }\n\n  return dev()./*Orig call*/ assert(\n    shouldBeTrueish,\n    opt_message,\n    opt_1,\n    opt_2,\n    opt_3,\n    opt_4,\n    opt_5,\n    opt_6,\n    opt_7,\n    opt_8,\n    opt_9\n  );\n}\n\n/**\n * Throws an error if the first argument isn't trueish.\n *\n * Supports argument substitution into the message via %s placeholders.\n *\n * Throws an error object that has two extra properties:\n * - associatedElement: This is the first element provided in the var args.\n *   It can be used for improved display of error messages.\n * - messageArray: The elements of the substituted message as non-stringified\n *   elements in an array. When e.g. passed to console.error this yields\n *   native displays of things like HTML elements.\n *\n * @param {T} shouldBeTrueish The value to assert. The assert fails if it does\n *     not evaluate to true.\n * @param {!Array|string=} opt_message The assertion message\n * @param {*=} opt_1 Optional argument (Var arg as individual params for better\n * @param {*=} opt_2 Optional argument inlining)\n * @param {*=} opt_3 Optional argument\n * @param {*=} opt_4 Optional argument\n * @param {*=} opt_5 Optional argument\n * @param {*=} opt_6 Optional argument\n * @param {*=} opt_7 Optional argument\n * @param {*=} opt_8 Optional argument\n * @param {*=} opt_9 Optional argument\n * @return {T} The value of shouldBeTrueish.\n * @throws {!Error} When `shouldBeTrueish` is falsey.\n * @template T\n * @closurePrimitive {asserts.truthy}\n */\nexport function userAssert(\n  shouldBeTrueish,\n  opt_message,\n  opt_1,\n  opt_2,\n  opt_3,\n  opt_4,\n  opt_5,\n  opt_6,\n  opt_7,\n  opt_8,\n  opt_9\n) {\n  return user()./*Orig call*/ assert(\n    shouldBeTrueish,\n    opt_message,\n    opt_1,\n    opt_2,\n    opt_3,\n    opt_4,\n    opt_5,\n    opt_6,\n    opt_7,\n    opt_8,\n    opt_9\n  );\n}\n", "/**\n * @fileoverview Registration and getter functions for AMP services.\n *\n * Invariant: Service getters never return null for registered services.\n */\n\nimport {Deferred} from '#core/data-structures/promise';\nimport {getWin} from '#core/window';\n\nimport {dev, devAssert} from '#utils/log';\n\n/**\n * Holds info about a service.\n * - obj: Actual service implementation when available.\n * - promise: Promise for the obj.\n * - resolve: Function to resolve the promise with the object.\n * - context: Argument for ctor, either a window or an ampdoc.\n * - ctor: Function that constructs and returns the service.\n * @typedef {{\n *   obj: (?Object),\n *   promise: (?Promise),\n *   resolve: (?function(!Object)),\n *   reject: (?function((*))),\n *   context: (?Window|?./service/ampdoc-impl.AmpDoc),\n *   ctor: (function(new:Object, !Window)|\n *          function(new:Object, !./service/ampdoc-impl.AmpDoc)),\n * }}\n */\nlet ServiceHolderDef;\n\n/**\n * This interface provides a `dispose` method that will be called by\n * runtime when a service needs to be disposed of.\n * @interface\n */\nexport class Disposable {\n  /**\n   * Instructs the service to release any resources it might be holding. Can\n   * be called only once in the lifecycle of a service.\n   */\n  dispose() {}\n}\n\n/**\n * Installs a service override on amp-doc level.\n * @param {!./service/ampdoc-impl.AmpDoc} ampdoc\n * @param {string} id\n * @param {!Object} service The service.\n */\nexport function installServiceInEmbedDoc(ampdoc, id, service) {\n  registerServiceInternal(\n    getAmpdocServiceHolder(ampdoc),\n    ampdoc,\n    id,\n    function () {\n      return service;\n    },\n    /* override */ true\n  );\n}\n\n/**\n * Installs a service override in the scope of an embedded window.\n * @param {!Window} embedWin\n * @param {string} id\n * @param {function(new:Object, !Window)} constructor\n */\nexport function registerServiceBuilderInEmbedWin(embedWin, id, constructor) {\n  registerServiceInternal(\n    embedWin,\n    embedWin,\n    id,\n    constructor,\n    /* override */ true\n  );\n}\n\n/**\n * Registers a service given a class to be used as implementation.\n * @param {!Window} win\n * @param {string} id of the service.\n * @param {function(new:Object, !Window)} constructor\n * @param {boolean=} opt_instantiate Whether to immediately create the service\n */\nexport function registerServiceBuilder(win, id, constructor, opt_instantiate) {\n  win = getTopWindow(win);\n  registerServiceInternal(win, win, id, constructor);\n  if (opt_instantiate) {\n    getServiceInternal(win, id);\n  }\n}\n\n/**\n * Returns a service and registers it given a class to be used as\n * implementation.\n * @param {!Node|!./service/ampdoc-impl.AmpDoc} nodeOrDoc\n * @param {string} id of the service.\n * @param {function(new:Object, !./service/ampdoc-impl.AmpDoc)} constructor\n * @param {boolean=} opt_instantiate Whether to immediately create the service\n */\nexport function registerServiceBuilderForDoc(\n  nodeOrDoc,\n  id,\n  constructor,\n  opt_instantiate\n) {\n  const ampdoc = getAmpdoc(nodeOrDoc);\n  const holder = getAmpdocServiceHolder(ampdoc);\n  registerServiceInternal(holder, ampdoc, id, constructor);\n  if (opt_instantiate) {\n    getServiceInternal(holder, id);\n  }\n}\n\n/**\n * Reject a service promise.\n * @param {!Node|!./service/ampdoc-impl.AmpDoc} nodeOrDoc\n * @param {string} id\n * @param {*} error\n */\nexport function rejectServicePromiseForDoc(nodeOrDoc, id, error) {\n  const ampdoc = getAmpdoc(nodeOrDoc);\n  const holder = getAmpdocServiceHolder(ampdoc);\n  rejectServicePromiseInternal(holder, id, error);\n}\n\n/**\n * Returns a service for the given id and window (a per-window singleton). Users\n * should typically wrap this as a special purpose function (e.g.\n * `Services.vsyncFor(win)`) for type safety and because the factory should not\n * be passed around.\n * @param {!Window} win\n * @param {string} id of the service.\n * @template T\n * @return {T}\n */\nexport function getService(win, id) {\n  win = getTopWindow(win);\n  return getServiceInternal(win, id);\n}\n\n/**\n * Returns a service for the given id and window (a per-window singleton). But\n * it looks in the immediate window scope, not the top-level window.\n * @param {!Window} win\n * @param {string} id of the service.\n * @template T\n * @return {T}\n */\nexport function getServiceInEmbedWin(win, id) {\n  return getServiceInternal(win, id);\n}\n\n/**\n * Returns a promise for a service for the given id and window. Also expects an\n * element that has the actual implementation. The promise resolves when the\n * implementation loaded. Users should typically wrap this as a special purpose\n * function (e.g. `Services.vsyncFor(win)`) for type safety and because the\n * factory should not be passed around.\n * @param {!Window} win\n * @param {string} id of the service.\n * @return {!Promise<!Object>}\n */\nexport function getServicePromise(win, id) {\n  return getServicePromiseInternal(win, id);\n}\n\n/**\n * Returns a service or null with the given id.\n * @param {!Window} win\n * @param {string} id\n * @return {?Object} The service.\n */\nexport function getExistingServiceOrNull(win, id) {\n  win = getTopWindow(win);\n  if (isServiceRegistered(win, id)) {\n    return getServiceInternal(win, id);\n  } else {\n    return null;\n  }\n}\n\n/**\n * Like getServicePromise but returns null if the service was never registered.\n * @param {!Window} win\n * @param {string} id\n * @return {?Promise<!Object>}\n */\nexport function getServicePromiseOrNull(win, id) {\n  return getServicePromiseOrNullInternal(win, id);\n}\n\n/**\n * Returns a service for the given id and ampdoc (a per-ampdoc singleton).\n * Expects service `id` to be registered.\n * @param {!Element|!ShadowRoot|!./service/ampdoc-impl.AmpDoc} elementOrAmpDoc\n * @param {string} id\n * @return {T}\n * @template T\n */\nexport function getServiceForDoc(elementOrAmpDoc, id) {\n  const ampdoc = getAmpdoc(elementOrAmpDoc);\n  const holder = getAmpdocServiceHolder(ampdoc);\n  return getServiceInternal(holder, id);\n}\n\n/**\n * Returns a service for the given id and ampdoc (a per-ampdoc singleton).\n * If service `id` is not registered, returns null.\n * @param {!Element|!ShadowRoot|!./service/ampdoc-impl.AmpDoc} elementOrAmpDoc\n * @param {string} id\n * @return {?Object}\n */\nexport function getServiceForDocOrNull(elementOrAmpDoc, id) {\n  const ampdoc = getAmpdoc(elementOrAmpDoc);\n  const holder = getAmpdocServiceHolder(ampdoc);\n  if (isServiceRegistered(holder, id)) {\n    return getServiceInternal(holder, id);\n  } else {\n    return null;\n  }\n}\n\n/**\n * Returns a promise for a service for the given id and ampdoc. Also expects\n * a service that has the actual implementation. The promise resolves when\n * the implementation loaded.\n * @param {!Element|!ShadowRoot|!./service/ampdoc-impl.AmpDoc} elementOrAmpDoc\n * @param {string} id\n * @return {!Promise<!Object>}\n */\nexport function getServicePromiseForDoc(elementOrAmpDoc, id) {\n  return getServicePromiseInternal(getAmpdocServiceHolder(elementOrAmpDoc), id);\n}\n\n/**\n * Like getServicePromiseForDoc but returns null if the service was never\n * registered for this ampdoc.\n * @param {!Element|!ShadowRoot|!./service/ampdoc-impl.AmpDoc} elementOrAmpDoc\n * @param {string} id\n * @return {?Promise<!Object>}\n */\nexport function getServicePromiseOrNullForDoc(elementOrAmpDoc, id) {\n  return getServicePromiseOrNullInternal(\n    getAmpdocServiceHolder(elementOrAmpDoc),\n    id\n  );\n}\n\n/**\n * Set the parent and top windows on a child window (friendly iframe).\n * @param {!Window} win\n * @param {!Window} parentWin\n */\nexport function setParentWindow(win, parentWin) {\n  win.__AMP_PARENT = parentWin;\n  win.__AMP_TOP = getTopWindow(parentWin);\n}\n\n/**\n * Returns the parent window for a child window (friendly iframe).\n * @param {!Window} win\n * @return {!Window}\n */\nexport function getParentWindow(win) {\n  return win.__AMP_PARENT || win;\n}\n\n/**\n * Returns the top window where AMP Runtime is installed for a child window\n * (friendly iframe).\n * @param {!Window} win\n * @return {!Window}\n */\nexport function getTopWindow(win) {\n  return win.__AMP_TOP || (win.__AMP_TOP = win);\n}\n\n/**\n * Returns the parent \"friendly\" iframe if the node belongs to a child window.\n * @param {!Node} node\n * @param {!Window=} opt_topWin\n * @return {?HTMLIFrameElement}\n */\nexport function getParentWindowFrameElement(node, opt_topWin) {\n  const childWin = (node.ownerDocument || node).defaultView;\n  const topWin = opt_topWin || getTopWindow(childWin);\n  if (childWin && childWin != topWin && getTopWindow(childWin) == topWin) {\n    try {\n      return /** @type {?HTMLIFrameElement} */ (childWin.frameElement);\n    } catch (e) {\n      // Ignore the error.\n    }\n  }\n  return null;\n}\n\n/**\n * @param {!Node|!./service/ampdoc-impl.AmpDoc} nodeOrDoc\n * @return {!./service/ampdoc-impl.AmpDoc}\n */\nexport function getAmpdoc(nodeOrDoc) {\n  if (nodeOrDoc.nodeType) {\n    const win = getWin(nodeOrDoc);\n    return getAmpdocService(win).getAmpDoc(/** @type {!Node} */ (nodeOrDoc));\n  }\n  return /** @type {!./service/ampdoc-impl.AmpDoc} */ (nodeOrDoc);\n}\n\n/**\n * @param {!Node|!./service/ampdoc-impl.AmpDoc} nodeOrDoc\n * @return {!./service/ampdoc-impl.AmpDoc|!Window}\n */\nfunction getAmpdocServiceHolder(nodeOrDoc) {\n  const ampdoc = getAmpdoc(nodeOrDoc);\n  return ampdoc.isSingleDoc() ? ampdoc.win : ampdoc;\n}\n\n/**\n * This is essentially a duplicate of `ampdoc.js`, but necessary to avoid\n * circular dependencies.\n * @param {!Window} win\n * @return {!./service/ampdoc-impl.AmpDocService}\n */\nfunction getAmpdocService(win) {\n  return /** @type {!./service/ampdoc-impl.AmpDocService} */ (\n    getService(win, 'ampdoc')\n  );\n}\n\n/**\n * Get service `id` from `holder`. Assumes the service\n * has already been registered.\n * @param {!Object} holder Object holding the service instance.\n * @param {string} id of the service.\n * @return {Object}\n */\nfunction getServiceInternal(holder, id) {\n  devAssert(\n    isServiceRegistered(holder, id),\n    `Expected service ${id} to be registered`\n  );\n  const services = getServices(holder);\n  const s = services[id];\n  if (!s.obj) {\n    devAssert(s.ctor, `Service ${id} registered without ctor nor impl.`);\n    devAssert(s.context, `Service ${id} registered without context.`);\n    s.obj = new s.ctor(s.context);\n    devAssert(s.obj, `Service ${id} constructed to null.`);\n    s.context = null;\n    // The service may have been requested already, in which case we have a\n    // pending promise we need to fulfill.\n    if (s.resolve) {\n      s.resolve(s.obj);\n    }\n  }\n  return s.obj;\n}\n\n/**\n * @param {!Object} holder Object holding the service instance.\n * @param {!Window|!./service/ampdoc-impl.AmpDoc} context Win or AmpDoc.\n * @param {string} id of the service.\n * @param {?function(new:Object, !Window)|?function(new:Object, !./service/ampdoc-impl.AmpDoc)} ctor Constructor function to new the service. Called with context.\n * @param {boolean=} opt_override\n * @param {boolean=} opt_sharedInstance\n */\nfunction registerServiceInternal(\n  holder,\n  context,\n  id,\n  ctor,\n  opt_override,\n  opt_sharedInstance\n) {\n  const services = getServices(holder);\n  let s = services[id];\n\n  if (!s) {\n    s = services[id] = {\n      obj: null,\n      promise: null,\n      resolve: null,\n      reject: null,\n      context: null,\n      ctor: null,\n      sharedInstance: opt_sharedInstance || false,\n    };\n  }\n\n  if (!opt_override && s.ctor) {\n    // Service already registered.\n    return;\n  }\n\n  s.ctor = ctor;\n  s.context = context;\n  s.sharedInstance = opt_sharedInstance || false;\n\n  // The service may have been requested already, in which case there is a\n  // pending promise that needs to fulfilled.\n  if (s.resolve) {\n    // getServiceInternal will resolve the promise.\n    getServiceInternal(holder, id);\n  }\n}\n\n/**\n * @param {!Object} holder\n * @param {string} id of the service.\n * @return {!Promise<!Object>}\n */\nfunction getServicePromiseInternal(holder, id) {\n  const cached = getServicePromiseOrNullInternal(holder, id);\n  if (cached) {\n    return cached;\n  }\n  // Service is not registered.\n\n  // TODO(@cramforce): Add a check that if the element is eventually registered\n  // that the service is actually provided and this promise resolves.\n  const services = getServices(holder);\n  services[id] = emptyServiceHolderWithPromise();\n  return /** @type {!Promise<!Object>} */ (services[id].promise);\n}\n\n/**\n * @param {!Object} holder\n * @param {string} id of the service.\n * @param {*} error\n */\nfunction rejectServicePromiseInternal(holder, id, error) {\n  const services = getServices(holder);\n  const s = services[id];\n  if (s) {\n    if (s.reject) {\n      s.reject(error);\n    }\n    return;\n  }\n\n  services[id] = emptyServiceHolderWithPromise();\n  services[id].reject(error);\n}\n\n/**\n * Returns a promise for service `id` if the service has been registered\n * on `holder`.\n * @param {!Object} holder\n * @param {string} id of the service.\n * @return {?Promise<!Object>}\n */\nfunction getServicePromiseOrNullInternal(holder, id) {\n  const services = getServices(holder);\n  const s = services[id];\n  if (s) {\n    if (s.promise) {\n      return s.promise;\n    } else {\n      // Instantiate service if not already instantiated.\n      getServiceInternal(holder, id);\n      return (s.promise = Promise.resolve(/** @type {!Object} */ (s.obj)));\n    }\n  }\n  return null;\n}\n\n/**\n * Returns the object that holds the services registered in a holder.\n * @param {!Object} holder\n * @return {!Object<string,!ServiceHolderDef>}\n */\nfunction getServices(holder) {\n  let services = holder.__AMP_SERVICES;\n  if (!services) {\n    services = holder.__AMP_SERVICES = {};\n  }\n  return services;\n}\n\n/**\n * Whether the specified service implements `Disposable` interface.\n * @param {!Object} service\n * @return {boolean}\n */\nexport function isDisposable(service) {\n  return typeof service.dispose == 'function';\n}\n\n/**\n * Asserts that the specified service implements `Disposable` interface and\n * typecasts the instance to `Disposable`.\n * @param {!Object} service\n * @return {!Disposable}\n */\nexport function assertDisposable(service) {\n  devAssert(isDisposable(service), 'required to implement Disposable');\n  return /** @type {!Disposable} */ (service);\n}\n\n/**\n * Disposes all disposable (implements `Disposable` interface) services in\n * ampdoc scope.\n * @param {!./service/ampdoc-impl.AmpDoc} ampdoc\n */\nexport function disposeServicesForDoc(ampdoc) {\n  disposeServicesInternal(ampdoc);\n}\n\n/**\n * Disposes all disposable (implements `Disposable` interface) services in\n * embed scope.\n * @param {!Window} embedWin\n */\nexport function disposeServicesForEmbed(embedWin) {\n  disposeServicesInternal(embedWin);\n}\n\n/**\n * @param {!Object} holder Object holding the service instances.\n */\nfunction disposeServicesInternal(holder) {\n  const services = getServices(holder);\n  for (const id in services) {\n    if (!Object.prototype.hasOwnProperty.call(services, id)) {\n      continue;\n    }\n    const serviceHolder = services[id];\n    if (serviceHolder.sharedInstance) {\n      continue;\n    }\n    if (serviceHolder.obj) {\n      disposeServiceInternal(id, serviceHolder.obj);\n    } else if (serviceHolder.promise) {\n      serviceHolder.promise.then((instance) =>\n        disposeServiceInternal(id, instance)\n      );\n    }\n  }\n}\n\n/**\n * @param {string} id\n * @param {!Object} service\n */\nfunction disposeServiceInternal(id, service) {\n  if (!isDisposable(service)) {\n    return;\n  }\n  try {\n    assertDisposable(service).dispose();\n  } catch (e) {\n    // Ensure that a failure to dispose a service does not disrupt other\n    // services.\n    dev().error('SERVICE', 'failed to dispose service', id, e);\n  }\n}\n\n/**\n * This adopts the service **instance** from the parent.\n *\n * This function is dangerous! Sharing an instance means data can leak to and\n * from a child ampdoc.\n *\n * @param {!./service/ampdoc-impl.AmpDoc} ampdoc\n * @param {string} id\n */\nexport function adoptServiceForEmbedDoc(ampdoc, id) {\n  const service = getServiceInternal(\n    getAmpdocServiceHolder(devAssert(ampdoc.getParent())),\n    id\n  );\n  registerServiceInternal(\n    getAmpdocServiceHolder(ampdoc),\n    ampdoc,\n    id,\n    function () {\n      return service;\n    },\n    /* override */ false,\n    /* sharedInstance */ true\n  );\n}\n\n/**\n * This adopts the service **factory** from the parent.\n *\n * This function is safer than sharing the service instance, since each ampdoc\n * will create its own instance of the factory (and each instance will have its\n * own instance data). Note that static data is still shared, so it's not 100%\n * foolproof.\n *\n * @param {!./service/ampdoc-impl.AmpDoc} ampdoc\n * @param {string} id\n */\nexport function adoptServiceFactoryForEmbedDoc(ampdoc, id) {\n  const parentHolder = getAmpdocServiceHolder(devAssert(ampdoc.getParent()));\n  devAssert(\n    isServiceRegistered(parentHolder, id),\n    `Expected service ${id} to be registered`\n  );\n  const service = getServices(parentHolder)[id];\n  registerServiceInternal(\n    getAmpdocServiceHolder(ampdoc),\n    ampdoc,\n    id,\n    devAssert(service.ctor)\n  );\n}\n\n/**\n * Resets a single service, so it gets recreated on next getService invocation.\n * @param {!Object} holder\n * @param {string} id of the service.\n */\nexport function resetServiceForTesting(holder, id) {\n  if (holder.__AMP_SERVICES) {\n    holder.__AMP_SERVICES[id] = null;\n  }\n}\n\n/**\n * @param {!Object} holder Object holding the service instance.\n * @param {string} id of the service.\n * @return {boolean}\n */\nfunction isServiceRegistered(holder, id) {\n  const service = holder.__AMP_SERVICES && holder.__AMP_SERVICES[id];\n  // All registered services must have a constructor.\n  return !!(service && service.ctor);\n}\n\n/** @return {!ServiceHolderDef} */\nfunction emptyServiceHolderWithPromise() {\n  const deferred = new Deferred();\n  const {promise, reject, resolve} = deferred;\n  promise.catch(() => {}); // avoid uncaught exception when service gets rejected\n  return {\n    obj: null,\n    promise,\n    resolve,\n    reject,\n    context: null,\n    ctor: null,\n  };\n}\n", "import * as dom from '#core/dom';\n\nimport {extensionScriptInNode} from '#service/extension-script';\n\nimport {userAssert} from '#utils/log';\n\nimport {\n  getAmpdoc,\n  getService,\n  getServiceForDocOrNull,\n  getServicePromise,\n  getServicePromiseForDoc,\n  getServicePromiseOrNull,\n  getServicePromiseOrNullForDoc,\n} from './service-helpers';\n\n/**\n * Same as getElementService but produces null if the given element is not\n * actually available on the current page.\n * @param {!Window} win\n * @param {string} id of the service.\n * @param {string} extension Name of the custom extension that provides the\n *     implementation of this service.\n * @param {string} version The extension version.\n * @param {boolean=} opt_element Whether this service is provided by an\n *     element, not the extension.\n * @return {!Promise<?Object>}\n */\nexport function getElementServiceIfAvailable(\n  win,\n  id,\n  extension,\n  version,\n  opt_element\n) {\n  const s = getServicePromiseOrNull(win, id);\n  if (s) {\n    return /** @type {!Promise<?Object>} */ (s);\n  }\n  return getElementServicePromiseOrNull(\n    win,\n    id,\n    extension,\n    version,\n    opt_element\n  );\n}\n\n/**\n * Returns a promise for a service for the given id and window. Also expects an\n * element that has the actual implementation. The promise resolves when the\n * implementation loaded. Users should typically wrap this as a special purpose\n * function (e.g. Services.viewportForDoc(...)) for type safety and because the\n * factory should not be passed around.\n * @param {!Element|!ShadowRoot} element\n * @param {string} id of the service.\n * @param {string} extension Name of the custom extension that provides the\n *     implementation of this service.\n * @param {boolean=} opt_element Whether this service is provided by an element,\n *     not the extension.\n * @return {!Promise<*>}\n */\nexport function getElementServiceForDoc(element, id, extension, opt_element) {\n  return getElementServiceIfAvailableForDoc(\n    element,\n    id,\n    extension,\n    opt_element\n  ).then((service) => assertService(service, id, extension));\n}\n\n/**\n * Same as getElementService but produces null if the given element is not\n * actually available on the current page.\n * @param {!Element|!ShadowRoot} element\n * @param {string} id of the service.\n * @param {string} extension Name of the custom extension that provides the\n *     implementation of this service.\n * @param {boolean=} opt_element Whether this service is provided by an\n *     element, not the extension.\n * @return {!Promise<?Object>}\n */\nexport function getElementServiceIfAvailableForDoc(\n  element,\n  id,\n  extension,\n  opt_element\n) {\n  const s = getServicePromiseOrNullForDoc(element, id);\n  if (s) {\n    return /** @type {!Promise<?Object>} */ (s);\n  }\n  const ampdoc = getAmpdoc(element);\n  return ampdoc\n    .whenExtensionsKnown()\n    .then(() => {\n      const version = ampdoc.getExtensionVersion(extension);\n      if (!version) {\n        return null;\n      }\n      const extensions = getService(ampdoc.win, 'extensions');\n      return extensions.waitForExtension(extension, version);\n    })\n    .then((ext) => {\n      if (!ext) {\n        return null;\n      }\n      // If this service is provided by an element, then we can't depend on\n      // the service (they may not use the element).\n      if (opt_element) {\n        return getServicePromiseOrNullForDoc(element, id);\n      }\n      return getServicePromiseForDoc(element, id);\n    });\n}\n\n/**\n * Returns a promise for service for the given id in the embed scope of\n * a given element, if it exists. Falls back to ampdoc scope if the element\n * is not embedded.\n *\n * @param {!Element|!ShadowRoot} element\n * @param {string} id of the service.\n * @param {string} extension Name of the custom element that provides\n *     the implementation of this service.\n * @return {!Promise<?Object>}\n */\nexport function getElementServiceIfAvailableForDocInEmbedScope(\n  element,\n  id,\n  extension\n) {\n  const s = getServiceForDocOrNull(element, id);\n  if (s) {\n    return /** @type {!Promise<?Object>} */ (Promise.resolve(s));\n  }\n  return getElementServiceIfAvailableForDoc(element, id, extension);\n}\n\n/**\n * Throws user error if `service` is null.\n * @param {Object} service\n * @param {string} id\n * @param {string} extension\n * @return {!Object}\n * @private\n * @closurePrimitive {asserts.matchesReturn}\n */\nfunction assertService(service, id, extension) {\n  return /** @type {!Object} */ (\n    userAssert(\n      service,\n      'Service %s was requested to be provided through %s, ' +\n        'but %s is not loaded in the current page. To fix this ' +\n        'problem load the JavaScript file for %s in this page.',\n      id,\n      extension,\n      extension,\n      extension\n    )\n  );\n}\n\n/**\n * Returns the promise for service with `id` on the given window if available.\n * Otherwise, resolves with null (service was not registered).\n * @param {!Window} win\n * @param {string} id\n * @param {string} extension\n * @param {string} version\n * @param {boolean=} opt_element\n * @return {!Promise<Object>}\n * @private\n */\nfunction getElementServicePromiseOrNull(\n  win,\n  id,\n  extension,\n  version,\n  opt_element\n) {\n  return dom\n    .waitForBodyOpenPromise(win.document)\n    .then(() => {\n      // If there is an extension script wait for it to load before trying\n      // to get the service. Prevents a race condition when everything but\n      // the extensions is in cache. If there is no script then it's either\n      // not present, or the service was defined by a test. In those cases\n      // we don't wait around for an extension that does not exist.\n      const extensions = getService(win, 'extensions');\n\n      // TODO(jpettitt) investigate registerExtension to short circuit\n      // the dom call in extensionScriptsInNode()\n      if (!extensionScriptInNode(extensions.win, extension, version)) {\n        return null;\n      }\n      return extensions.waitForExtension(extension, version);\n    })\n    .then((ext) => {\n      if (!ext) {\n        return null;\n      }\n      // If this service is provided by an element, then we can't depend on\n      // the service (they may not use the element).\n      if (opt_element) {\n        return getServicePromiseOrNull(win, id);\n      }\n      return getServicePromise(win, id);\n    });\n}\n", "import {\n  getElementServiceForDoc,\n  getElementServiceIfAvailable,\n  getElementServiceIfAvailableForDoc,\n  getElementServiceIfAvailableForDocInEmbedScope,\n} from '../element-service';\nimport {\n  getAmpdoc,\n  getExistingServiceOrNull,\n  getService,\n  getServiceForDoc,\n  getServiceForDocOrNull,\n  getServiceInEmbedWin,\n  getServicePromiseForDoc,\n} from '../service-helpers';\n\n/** @typedef {!../extensions/amp-subscriptions/0.1/amp-subscriptions.SubscriptionService} */\nexport let SubscriptionService;\n\nexport class Services {\n  /**\n   * Hint: Add extensions folder path to compile.js with\n   * warnings cannot find modules.\n   */\n\n  /**\n   * Returns a promise for the Access service.\n   * @param {!Element|!ShadowRoot} element\n   * @return {!Promise<!../extensions/amp-access/0.1/amp-access.AccessService>}\n   */\n  static accessServiceForDoc(element) {\n    return /** @type {!Promise<!../extensions/amp-access/0.1/amp-access.AccessService>} */ (\n      getElementServiceForDoc(element, 'access', 'amp-access')\n    );\n  }\n\n  /**\n   * Returns a promise for the Access service or a promise for null if the\n   * service is not available on the current page.\n   * @param {!Element|!ShadowRoot} element\n   * @return {!Promise<?../extensions/amp-access/0.1/amp-access.AccessService>}\n   */\n  static accessServiceForDocOrNull(element) {\n    return /** @type {!Promise<?../extensions/amp-access/0.1/amp-access.AccessService>} */ (\n      getElementServiceIfAvailableForDoc(element, 'access', 'amp-access')\n    );\n  }\n\n  /**\n   * Returns a promise for the Subscriptions service.\n   * @param {!Element|!ShadowRoot} element\n   * @return {!Promise<!SubscriptionService>}\n   */\n  static subscriptionsServiceForDoc(element) {\n    return /** @type {!Promise<!SubscriptionService>} */ (\n      getElementServiceForDoc(element, 'subscriptions', 'amp-subscriptions')\n    );\n  }\n\n  /**\n   * Returns a promise for the Subscriptions service.\n   * @param {!Element|!ShadowRoot} element\n   * @return {!Promise<?SubscriptionService>}\n   */\n  static subscriptionsServiceForDocOrNull(element) {\n    return /** @type {!Promise<?SubscriptionService>} */ (\n      getElementServiceIfAvailableForDoc(\n        element,\n        'subscriptions',\n        'amp-subscriptions'\n      )\n    );\n  }\n\n  /**\n   * @param {!Element|!ShadowRoot} element\n   * @return {!./service/action-impl.ActionService}\n   */\n  static actionServiceForDoc(element) {\n    return /** @type {!./service/action-impl.ActionService} */ (\n      getServiceForDocOrNull(element, 'action')\n    );\n  }\n\n  /**\n   * @param {!Element|!ShadowRoot} element\n   * @return {!./service/standard-actions-impl.StandardActions}\n   */\n  static standardActionsForDoc(element) {\n    return /** @type {!./service/standard-actions-impl.StandardActions} */ (\n      getServiceForDocOrNull(element, 'standard-actions')\n    );\n  }\n\n  /**\n   * @param {!Element|!ShadowRoot} element\n   * @return {!Promise<!../extensions/amp-analytics/0.1/activity-impl.Activity>}\n   */\n  static activityForDoc(element) {\n    return /** @type {!Promise<!../extensions/amp-analytics/0.1/activity-impl.Activity>} */ (\n      getElementServiceForDoc(element, 'activity', 'amp-analytics')\n    );\n  }\n\n  /**\n   * Returns the global instance of the `AmpDocService` service that can be\n   * used to resolve an ampdoc for any node: either in the single-doc or\n   * shadow-doc environment.\n   * @param {!Window} window\n   * @return {!./service/ampdoc-impl.AmpDocService}\n   */\n  static ampdocServiceFor(window) {\n    return /** @type {!./service/ampdoc-impl.AmpDocService} */ (\n      getService(window, 'ampdoc')\n    );\n  }\n\n  /**\n   * Returns the AmpDoc for the specified context node.\n   * @param {!Node|!./service/ampdoc-impl.AmpDoc} nodeOrAmpDoc\n   * @return {!./service/ampdoc-impl.AmpDoc}\n   */\n  static ampdoc(nodeOrAmpDoc) {\n    return getAmpdoc(nodeOrAmpDoc);\n  }\n\n  /**\n   * @param {!Element|!ShadowRoot} element\n   * @param {boolean=} loadAnalytics\n   * @return {!Promise<!../extensions/amp-analytics/0.1/instrumentation.InstrumentationService>}\n   */\n  static analyticsForDoc(element, loadAnalytics = false) {\n    if (loadAnalytics) {\n      // Get Extensions service and force load analytics extension.\n      const ampdoc = getAmpdoc(element);\n      Services.extensionsFor(ampdoc.win)./*OK*/ installExtensionForDoc(\n        ampdoc,\n        'amp-analytics'\n      );\n    }\n    return /** @type {!Promise<!../extensions/amp-analytics/0.1/instrumentation.InstrumentationService>} */ (\n      getElementServiceForDoc(\n        element,\n        'amp-analytics-instrumentation',\n        'amp-analytics'\n      )\n    );\n  }\n\n  /**\n   * @param {!Element|!ShadowRoot} element\n   * @return {!Promise<?../extensions/amp-analytics/0.1/instrumentation.InstrumentationService>}\n   */\n  static analyticsForDocOrNull(element) {\n    return /** @type {!Promise<?../extensions/amp-analytics/0.1/instrumentation.InstrumentationService>} */ (\n      getElementServiceIfAvailableForDoc(\n        element,\n        'amp-analytics-instrumentation',\n        'amp-analytics'\n      )\n    );\n  }\n\n  /**\n   * @param {!Window} window\n   * @return {!./service/batched-xhr-impl.BatchedXhr}\n   */\n  static batchedXhrFor(window) {\n    return /** @type {!./service/batched-xhr-impl.BatchedXhr} */ (\n      getService(window, 'batched-xhr')\n    );\n  }\n\n  /**\n   * @param {!Element|!ShadowRoot} element\n   * @return {!Promise<?../extensions/amp-bind/0.1/bind-impl.Bind>}\n   */\n  static bindForDocOrNull(element) {\n    return /** @type {!Promise<?../extensions/amp-bind/0.1/bind-impl.Bind>} */ (\n      getElementServiceIfAvailableForDocInEmbedScope(\n        element,\n        'bind',\n        'amp-bind'\n      )\n    );\n  }\n\n  /**\n   * @param {!Element|!ShadowRoot} element\n   * @return {!Promise<?../extensions/amp-script/0.1/amp-script.AmpScriptService>}\n   */\n  static scriptForDocOrNull(element) {\n    return /** @type {!Promise<?../extensions/amp-script/0.1/amp-script.AmpScriptService>} */ (\n      getElementServiceIfAvailableForDocInEmbedScope(\n        element,\n        'amp-script',\n        'amp-script'\n      )\n    );\n  }\n\n  /**\n   * @param {!Element|!ShadowRoot|!./service/ampdoc-impl.AmpDoc} elementOrAmpDoc\n   * @return {!Promise<!./service/cid-impl.CidDef>}\n   */\n  static cidForDoc(elementOrAmpDoc) {\n    return /** @type {!Promise<!./service/cid-impl.CidDef>} */ (\n      getServicePromiseForDoc(elementOrAmpDoc, 'cid')\n    );\n  }\n\n  /**\n   * @param {!Element|!./service/ampdoc-impl.AmpDoc} elementOrAmpDoc\n   * @return {!./service/navigation.Navigation}\n   */\n  static navigationForDoc(elementOrAmpDoc) {\n    return /** @type {!./service/navigation.Navigation} */ (\n      getServiceForDoc(elementOrAmpDoc, 'navigation')\n    );\n  }\n\n  /**\n   * @param {!Element|!ShadowRoot} element\n   * @return {!Promise<!../extensions/amp-loader/0.1/amp-loader.LoaderService>}\n   */\n  static loaderServiceForDoc(element) {\n    return /** @type {!Promise<!../extensions/amp-loader/0.1/amp-loader.LoaderService>} */ (\n      getElementServiceForDoc(element, 'loader', 'amp-loader')\n    );\n  }\n\n  /**\n   * @param {!Element|!ShadowRoot} element\n   * @return {!Promise<!../extensions/amp-standalone/0.1/amp-standalone.StandaloneService>}\n   */\n  static standaloneServiceForDoc(element) {\n    return /** @type {!Promise<!../extensions/amp-standalone/0.1/amp-standalone.StandaloneService>} */ (\n      getElementServiceForDoc(element, 'standalone', 'amp-standalone')\n    );\n  }\n\n  /**\n   * @param {!Window} window\n   * @return {!./service/crypto-impl.Crypto}\n   */\n  static cryptoFor(window) {\n    return /** @type {!./service/crypto-impl.Crypto} */ (\n      getService(window, 'crypto')\n    );\n  }\n\n  /**\n   * @param {!Element|!./service/ampdoc-impl.AmpDoc} elementOrAmpDoc\n   * @return {!./service/document-info-impl.DocumentInfoDef} Info about the doc\n   */\n  static documentInfoForDoc(elementOrAmpDoc) {\n    return /** @type {!./service/document-info-impl.DocInfo} */ (\n      getServiceForDoc(elementOrAmpDoc, 'documentInfo')\n    ).get();\n  }\n\n  /**\n   * @param {!Window} window\n   * @return {!./service/extensions-impl.Extensions}\n   */\n  static extensionsFor(window) {\n    return /** @type {!./service/extensions-impl.Extensions} */ (\n      getService(window, 'extensions')\n    );\n  }\n\n  /**\n   * Returns a service to register callbacks we wish to execute when an\n   * amp-form is submitted.\n   * @param {!Element|!./service/ampdoc-impl.AmpDoc} elementOrAmpDoc\n   * @return {!Promise<../extensions/amp-form/0.1/form-submit-service.FormSubmitService>}\n   */\n  static formSubmitForDoc(elementOrAmpDoc) {\n    return /** @type {!Promise<../extensions/amp-form/0.1/form-submit-service.FormSubmitService>} */ (\n      getServicePromiseForDoc(elementOrAmpDoc, 'form-submit-service')\n    );\n  }\n\n  /**\n   * Returns service to listen for `hidden` attribute mutations.\n   * @param {!Element|!ShadowRoot} element\n   * @return {!./service/hidden-observer-impl.HiddenObserver}\n   */\n  static hiddenObserverForDoc(element) {\n    return /** @type {!./service/hidden-observer-impl.HiddenObserver} */ (\n      getServiceForDocOrNull(element, 'hidden-observer')\n    );\n  }\n\n  /**\n   * Returns service implemented in service/history-impl.\n   * @param {!Element|!./service/ampdoc-impl.AmpDoc} elementOrAmpDoc\n   * @return {!./service/history-impl.History}\n   */\n  static historyForDoc(elementOrAmpDoc) {\n    return /** @type {!./service/history-impl.History} */ (\n      getServiceForDoc(elementOrAmpDoc, 'history')\n    );\n  }\n\n  /**\n   * @param {!Window} win\n   * @return {!./input.Input}\n   */\n  static inputFor(win) {\n    return getService(win, 'input');\n  }\n\n  /**s\n   * Returns a promise for the Inputmask service.\n   * @param {!Element|!ShadowRoot} element\n   * @return {!Promise<?../extensions/amp-inputmask/0.1/amp-inputmask.AmpInputmaskService>}\n   */\n  static inputmaskServiceForDocOrNull(element) {\n    return /** @type {!Promise<?../extensions/amp-inputmask/0.1/amp-inputmask.AmpInputmaskService>} */ (\n      getElementServiceIfAvailableForDoc(element, 'inputmask', 'amp-inputmask')\n    );\n  }\n\n  /**\n   * @param {!Element|!./service/ampdoc-impl.AmpDoc} elementOrAmpDoc\n   * @return {?./service/loading-indicator.LoadingIndicatorImpl}\n   */\n  static loadingIndicatorOrNull(elementOrAmpDoc) {\n    return /** @type {?./service/loading-indicator.LoadingIndicatorImpl} */ (\n      getServiceForDocOrNull(elementOrAmpDoc, 'loadingIndicator')\n    );\n  }\n\n  /**\n   * @param {!Element|!./service/ampdoc-impl.AmpDoc} elementOrAmpDoc\n   * @return {!../extensions/amp-next-page/1.0/service.NextPageService}\n   */\n  static nextPageServiceForDoc(elementOrAmpDoc) {\n    return /** @type {!../extensions/amp-next-page/1.0/service.NextPageService} */ (\n      getServiceForDoc(elementOrAmpDoc, 'next-page')\n    );\n  }\n\n  /**\n   * @param {!Element|!./service/ampdoc-impl.AmpDoc} elementOrAmpDoc\n   * @return {!./service/mutator-interface.MutatorInterface}\n   */\n  static mutatorForDoc(elementOrAmpDoc) {\n    return /** @type {!./service/mutator-interface.MutatorInterface} */ (\n      getServiceForDoc(elementOrAmpDoc, 'mutator')\n    );\n  }\n\n  /**\n   * @param {!Element|!./service/ampdoc-impl.AmpDoc} elementOrAmpDoc\n   * @return {!./service/owners-interface.OwnersInterface}\n   */\n  static ownersForDoc(elementOrAmpDoc) {\n    return /** @type {!./service/owners-interface.OwnersInterface} */ (\n      getServiceForDoc(elementOrAmpDoc, 'owners')\n    );\n  }\n\n  /**\n   * @param {!Window} window\n   * @return {!./service/performance-impl.Performance}\n   */\n  static performanceFor(window) {\n    return /** @type {!./service/performance-impl.Performance}*/ (\n      getService(window, 'performance')\n    );\n  }\n\n  /**\n   * @param {!Window} window\n   * @return {!./service/performance-impl.Performance}\n   */\n  static performanceForOrNull(window) {\n    return /** @type {!./service/performance-impl.Performance}*/ (\n      getExistingServiceOrNull(window, 'performance')\n    );\n  }\n\n  /**\n   * @param {!Window} window\n   * @return {!./service/platform-impl.Platform}\n   */\n  static platformFor(window) {\n    return /** @type {!./service/platform-impl.Platform} */ (\n      getService(window, 'platform')\n    );\n  }\n\n  /**\n   * Not installed by default; must be installed in extension code before use.\n   * @param {!Element|!ShadowRoot} element\n   * @return {!./service/position-observer/position-observer-impl.PositionObserver}\n   * @throws If the service is not installed.\n   */\n  static positionObserverForDoc(element) {\n    return /** @type {!./service/position-observer/position-observer-impl.PositionObserver} */ (\n      getServiceForDoc(element, 'position-observer')\n    );\n  }\n\n  /**\n   * @param {!Window} window\n   * @return {!./preconnect.PreconnectService}\n   */\n  static preconnectFor(window) {\n    return getService(window, 'preconnect');\n  }\n\n  /**\n   * @param {!Element|!./service/ampdoc-impl.AmpDoc} elementOrAmpDoc\n   * @return {!./service/resources-interface.ResourcesInterface}\n   */\n  static resourcesForDoc(elementOrAmpDoc) {\n    return /** @type {!./service/resources-interface.ResourcesInterface} */ (\n      getServiceForDoc(elementOrAmpDoc, 'resources')\n    );\n  }\n\n  /**\n   * @param {!Element|!./service/ampdoc-impl.AmpDoc} elementOrAmpDoc\n   * @return {!Promise<!./service/resources-interface.ResourcesInterface>}\n   */\n  static resourcesPromiseForDoc(elementOrAmpDoc) {\n    return /** @type {!Promise<!./service/resources-interface.ResourcesInterface>} */ (\n      getServicePromiseForDoc(elementOrAmpDoc, 'resources')\n    );\n  }\n\n  /**\n   * @param {!Window} win\n   * @return {?Promise<?../extensions/amp-story/1.0/variable-service.AmpStoryVariableService>}\n   */\n  static storyVariableServiceForOrNull(win) {\n    return (\n      /** @type {!Promise<?../extensions/amp-story/1.0/variable-service.AmpStoryVariableService>} */\n      (getElementServiceIfAvailable(win, 'story-variable', 'amp-story', '1.0'))\n    );\n  }\n\n  /**\n   * @param {!Window} win\n   * @return {?../extensions/amp-story/1.0/variable-service.AmpStoryVariableService}\n   */\n  static storyVariableService(win) {\n    return (\n      /** @type {?../extensions/amp-story/1.0/variable-service.AmpStoryVariableService} */\n      (getExistingServiceOrNull(win, 'story-variable'))\n    );\n  }\n\n  /**\n   * Version of the story store service depends on which version of amp-story\n   * the publisher is loading. They all have the same implementation.\n   * @param {!Window} win\n   * @return {?Promise<?../extensions/amp-story/1.0/amp-story-store-service.AmpStoryStoreService>}\n   */\n  static storyStoreServiceForOrNull(win) {\n    return (\n      /** @type {!Promise<?../extensions/amp-story/1.0/amp-story-store-service.AmpStoryStoreService>} */\n      (getElementServiceIfAvailable(win, 'story-store', 'amp-story', '1.0'))\n    );\n  }\n\n  /**\n   * @param {!Window} win\n   * @return {?../extensions/amp-story/1.0/amp-story-store-service.AmpStoryStoreService}\n   */\n  static storyStoreService(win) {\n    return (\n      /** @type {?../extensions/amp-story/1.0/amp-story-store-service.AmpStoryStoreService} */\n      (getExistingServiceOrNull(win, 'story-store'))\n    );\n  }\n\n  /**\n   * @param {!Window} win\n   * @return {?../extensions/amp-story/1.0/amp-story-media-query-service.AmpStoryMediaQueryService}\n   */\n  static storyMediaQueryService(win) {\n    return (\n      /** @type {?../extensions/amp-story/1.0/amp-story-media-query-service.AmpStoryMediaQueryService} */\n      (getExistingServiceOrNull(win, 'story-media-query'))\n    );\n  }\n\n  /**\n   * Get promise with story request service\n   * @param {!Window} win\n   * @return {?Promise<?../extensions/amp-story/1.0/amp-story-request-service.AmpStoryRequestService>}\n   */\n  static storyRequestServiceForOrNull(win) {\n    return (\n      /** @type {!Promise<?../extensions/amp-story/1.0/amp-story-request-service.AmpStoryRequestService>} */\n      (getElementServiceIfAvailable(win, 'story-request', 'amp-story', '1.0'))\n    );\n  }\n\n  /**\n   * @param {!Window} win\n   * @return {?../extensions/amp-story/1.0/amp-story-request-service.AmpStoryRequestService}\n   */\n  static storyRequestService(win) {\n    return (\n      /** @type {?../extensions/amp-story/1.0/amp-story-request-service.AmpStoryRequestService} */\n      (getExistingServiceOrNull(win, 'story-request'))\n    );\n  }\n\n  /**\n   * @param {!Window} win\n   * @return {?../extensions/amp-story/1.0/media-performance-metrics-service.MediaPerformanceMetricsService}\n   */\n  static mediaPerformanceMetricsService(win) {\n    return (\n      /** @type {?../extensions/amp-story/1.0/media-performance-metrics-service.MediaPerformanceMetricsService} */\n      (getExistingServiceOrNull(win, 'media-performance-metrics'))\n    );\n  }\n\n  /**\n   * @param {!Element} el\n   * @return {!Promise<./service/localization.LocalizationService>}\n   */\n  static localizationServiceForOrNull(el) {\n    return /** @type {!Promise<?./service/localization.LocalizationService>} */ (\n      getServicePromiseForDoc(el, 'localization')\n    );\n  }\n\n  /**\n   * @param {!Element} element\n   * @return {?./service/localization.LocalizationService}\n   */\n  static localizationForDoc(element) {\n    return /** @type {?./service/localization.LocalizationService} */ (\n      getServiceForDocOrNull(element, 'localization')\n    );\n  }\n\n  /**\n   * TODO(#14357): Remove this when amp-story:0.1 is deprecated.\n   * @param {!Window} win\n   * @return {!Promise<?../extensions/amp-story/1.0/story-analytics.StoryAnalyticsService>}\n   */\n  static storyAnalyticsServiceForOrNull(win) {\n    return (\n      /** @type {!Promise<?../extensions/amp-story/1.0/story-analytics.StoryAnalyticsService>} */\n      (\n        getElementServiceIfAvailable(\n          win,\n          'story-analytics',\n          'amp-story',\n          '1.0',\n          true\n        )\n      )\n    );\n  }\n\n  /**\n   * @param {!Window} win\n   * @return {?../extensions/amp-story/1.0/story-analytics.StoryAnalyticsService}\n   */\n  static storyAnalyticsService(win) {\n    return (\n      /** @type {?../extensions/amp-story/1.0/story-analytics.StoryAnalyticsService} */\n      (getExistingServiceOrNull(win, 'story-analytics'))\n    );\n  }\n\n  /**\n   * @param {!Element|!ShadowRoot} element\n   * @return {!Promise<!../extensions/amp-animation/0.1/web-animation-service.WebAnimationService>}\n   */\n  static webAnimationServiceFor(element) {\n    return (\n      /** @type {!Promise<!../extensions/amp-animation/0.1/web-animation-service.WebAnimationService>} */\n      (getElementServiceForDoc(element, 'web-animation', 'amp-animation'))\n    );\n  }\n\n  /**\n   * @param {!Element|!./service/ampdoc-impl.AmpDoc} elementOrAmpDoc\n   * @return {!Promise<!./service/real-time-config/real-time-config-impl.RealTimeConfigManager>}\n   */\n  static realTimeConfigForDoc(elementOrAmpDoc) {\n    return /** @type {!Promise<!./service/real-time-config/real-time-config-impl.RealTimeConfigManager>} */ (\n      getServicePromiseForDoc(elementOrAmpDoc, 'real-time-config')\n    );\n  }\n\n  /**\n   * @param {!Element|!./service/ampdoc-impl.AmpDoc} elementOrAmpDoc\n   * @return {!Promise<!./service/storage-impl.Storage>}\n   */\n  static storageForDoc(elementOrAmpDoc) {\n    return /** @type {!Promise<!./service/storage-impl.Storage>} */ (\n      getServicePromiseForDoc(elementOrAmpDoc, 'storage')\n    );\n  }\n\n  /**\n   * @param {!Element|!./service/ampdoc-impl.AmpDoc} elementOrAmpDoc\n   * @return {!Promise<!./service/storage-impl.Storage>}\n   * TODO(dmanek): Add tests for this method.\n   */\n  static storageForTopLevelDoc(elementOrAmpDoc) {\n    const thisAmpdoc = Services.ampdoc(elementOrAmpDoc);\n    const ampdocService = Services.ampdocServiceFor(thisAmpdoc.win);\n    const topAmpdoc = ampdocService.isSingleDoc()\n      ? ampdocService.getSingleDoc()\n      : null;\n    // We need to verify that ampdocs are on the same origin, therefore\n    // we compare the windows of both.\n    const ampdoc =\n      topAmpdoc && topAmpdoc.win == thisAmpdoc.win ? topAmpdoc : thisAmpdoc;\n    return /** @type {!Promise<!./service/storage-impl.Storage>} */ (\n      getServicePromiseForDoc(ampdoc, 'storage')\n    );\n  }\n\n  /**\n   * @param {!Element|!./service/ampdoc-impl.AmpDoc} elementOrAmpDoc\n   * @return {!./service/template-impl.Templates}\n   */\n  static templatesForDoc(elementOrAmpDoc) {\n    return /** @type {!./service/template-impl.Templates} */ (\n      getServiceForDoc(elementOrAmpDoc, 'templates')\n    );\n  }\n\n  /**\n   * @param {!Window} window\n   * @return {!./service/timer-impl.Timer}\n   */\n  static timerFor(window) {\n    // TODO(alabiaga): This will always return the top window's Timer service.\n    return /** @type {!./service/timer-impl.Timer} */ (\n      getServiceInEmbedWin(window, 'timer')\n    );\n  }\n\n  /**\n   * @param {!Element|!ShadowRoot} element\n   * @return {!./service/url-replacements-impl.UrlReplacements}\n   */\n  static urlReplacementsForDoc(element) {\n    return /** @type {!./service/url-replacements-impl.UrlReplacements} */ (\n      getServiceForDocOrNull(element, 'url-replace')\n    );\n  }\n\n  /**\n   * @param {!Element|!ShadowRoot} element\n   * @return {!Promise<!../extensions/amp-user-notification/0.1/amp-user-notification.UserNotificationManager>}\n   */\n  static userNotificationManagerForDoc(element) {\n    return (\n      /** @type {!Promise<!../extensions/amp-user-notification/0.1/amp-user-notification.UserNotificationManager>} */\n      (\n        getElementServiceForDoc(\n          element,\n          'userNotificationManager',\n          'amp-user-notification'\n        )\n      )\n    );\n  }\n\n  /**\n   * Returns a promise for the consentPolicy Service or a promise for null if\n   * the service is not available on the current page.\n   * @param {!Element|!ShadowRoot} element\n   * @return {!Promise<?../extensions/amp-consent/0.1/consent-policy-manager.ConsentPolicyManager>}\n   */\n  static consentPolicyServiceForDocOrNull(element) {\n    return (\n      /** @type {!Promise<?../extensions/amp-consent/0.1/consent-policy-manager.ConsentPolicyManager>} */\n      (\n        getElementServiceIfAvailableForDoc(\n          element,\n          'consentPolicyManager',\n          'amp-consent'\n        )\n      )\n    );\n  }\n\n  /**\n   * Returns a promise for the geo service or a promise for null if\n   * the service is not available on the current page.\n   * @param {!Element|!ShadowRoot} element\n   * @return {!Promise<?../extensions/amp-geo/0.1/amp-geo.GeoDef>}\n   */\n  static geoForDocOrNull(element) {\n    return /** @type {!Promise<?../extensions/amp-geo/0.1/amp-geo.GeoDef>} */ (\n      getElementServiceIfAvailableForDoc(element, 'geo', 'amp-geo', true)\n    );\n  }\n\n  /**\n   * Unlike most service getters, passing `Node` is necessary for some FIE-scope\n   * services since sometimes we only have the FIE Document for context.\n   * @param {!Element|!ShadowRoot} element\n   * @return {!./service/url-impl.Url}\n   */\n  static urlForDoc(element) {\n    return /** @type {!./service/url-impl.Url} */ (\n      getServiceForDocOrNull(element, 'url')\n    );\n  }\n\n  /**\n   * Returns a promise for the experiment variants or a promise for null if it\n   * is not available on the current page.\n   * @param {!Element|!ShadowRoot} element\n   * @return {!Promise<?../extensions/amp-experiment/0.1/variant.Variants>}\n   */\n  static variantsForDocOrNull(element) {\n    return /** @type {!Promise<?../extensions/amp-experiment/0.1/variant.Variants>} */ (\n      getElementServiceIfAvailableForDoc(\n        element,\n        'variant',\n        'amp-experiment',\n        true\n      )\n    );\n  }\n\n  /**\n   * @param {!Element|!./service/ampdoc-impl.AmpDoc} elementOrAmpDoc\n   * @return {!./service/video-manager-impl.VideoManager}\n   */\n  static videoManagerForDoc(elementOrAmpDoc) {\n    return /** @type {!./service/video-manager-impl.VideoManager} */ (\n      getServiceForDoc(elementOrAmpDoc, 'video-manager')\n    );\n  }\n\n  /**\n   * @param {!Element|!./service/ampdoc-impl.AmpDoc} elementOrAmpDoc\n   * @return {!./service/viewer-interface.ViewerInterface}\n   */\n  static viewerForDoc(elementOrAmpDoc) {\n    return /** @type {!./service/viewer-interface.ViewerInterface} */ (\n      getServiceForDoc(elementOrAmpDoc, 'viewer')\n    );\n  }\n\n  /**\n   * Returns promise for the viewer. This is an unusual case and necessary only\n   * for services that need reference to the viewer before it has been\n   * initialized. Most of the code, however, just should use `viewerForDoc`.\n   * @param {!Element|!./service/ampdoc-impl.AmpDoc} elementOrAmpDoc\n   * @return {!Promise<!./service/viewer-interface.ViewerInterface>}\n   */\n  static viewerPromiseForDoc(elementOrAmpDoc) {\n    return /** @type {!Promise<!./service/viewer-interface.ViewerInterface>} */ (\n      getServicePromiseForDoc(elementOrAmpDoc, 'viewer')\n    );\n  }\n\n  /**\n   * @param {!Window} window\n   * @return {!./service/vsync-impl.Vsync}\n   */\n  static vsyncFor(window) {\n    return /** @type {!./service/vsync-impl.Vsync} */ (\n      getService(window, 'vsync')\n    );\n  }\n\n  /**\n   * @param {!Element|!./service/ampdoc-impl.AmpDoc} elementOrAmpDoc\n   * @return {!./service/viewport/viewport-interface.ViewportInterface}\n   */\n  static viewportForDoc(elementOrAmpDoc) {\n    return /** @type {!./service/viewport/viewport-interface.ViewportInterface} */ (\n      getServiceForDoc(elementOrAmpDoc, 'viewport')\n    );\n  }\n\n  /**\n   * @param {!Window} window\n   * @return {!./service/xhr-impl.Xhr}\n   */\n  static xhrFor(window) {\n    return /** @type {!./service/xhr-impl.Xhr} */ (getService(window, 'xhr'));\n  }\n\n  /**\n   * @param {!Element|!./service/ampdoc-impl.AmpDoc} elementOrAmpDoc\n   * @return {!Promise<../amp-cache-url/amp-cache-url.AmpCacheUrlService>}\n   */\n  static cacheUrlServicePromiseForDoc(elementOrAmpDoc) {\n    return /** @type {!Promise<?../amp-cache-url/amp-cache-url.AmpCacheUrlService>} */ (\n      getServicePromiseForDoc(elementOrAmpDoc, 'cache-url')\n    );\n  }\n}\n", "/**\n * Whether addEventListener supports options or only takes capture as a boolean\n * @type {boolean|undefined}\n * @visibleForTesting\n */\nlet optsSupported;\n\n/**\n * Whether addEventListener supports options or only takes passive as a boolean\n * @type {boolean|undefined}\n */\nlet passiveSupported;\n\n/**\n * Options supported by addEventListener\n * @typedef AddEventListenerOptsDef\n * @property {undefined|boolean} [capture]\n * @property {undefined|boolean} [once]\n * @property {undefined|boolean} [passive]\n * @property {undefined|!AbortSignal} [signal]\n * }}\n */\nlet AddEventListenerOptsDef;\n\n/**\n * Listens for the specified event on the element.\n *\n * Do not use this directly. This method is implemented as a shared\n * dependency. Use `listen()` in either `event-helper` or\n * `#core/3p-frame-messaging`, depending on your use case.\n *\n * @param {!EventTarget} element\n * @param {string} eventType\n * @param {function(!Event)} listener\n * @param {!AddEventListenerOptsDef=} opt_evtListenerOpts\n * @return {!UnlistenDef}\n */\nexport function internalListenImplementation(\n  element,\n  eventType,\n  listener,\n  opt_evtListenerOpts\n) {\n  let localElement = element;\n  let localListener = listener;\n  /** @type {?function(!Event)} */\n  let wrapped = (event) => {\n    try {\n      return localListener(event);\n    } catch (e) {\n      // __AMP_REPORT_ERROR is installed globally per window in the entry point.\n      self.__AMP_REPORT_ERROR?.(e);\n      throw e;\n    }\n  };\n  const optsSupported = detectEvtListenerOptsSupport();\n  const capture = !!opt_evtListenerOpts?.capture;\n\n  localElement.addEventListener(\n    eventType,\n    wrapped,\n    optsSupported ? opt_evtListenerOpts : capture\n  );\n  return () => {\n    localElement?.removeEventListener(\n      eventType,\n      wrapped,\n      optsSupported ? opt_evtListenerOpts : capture\n    );\n    // Ensure these are GC'd\n    localListener = null;\n    localElement = null;\n    wrapped = null;\n  };\n}\n\n/**\n * Tests whether the browser supports options as an argument of addEventListener\n * or not.\n *\n * @return {boolean}\n */\nexport function detectEvtListenerOptsSupport() {\n  // Only run the test once\n  if (optsSupported !== undefined) {\n    return optsSupported;\n  }\n\n  optsSupported = false;\n  try {\n    // Test whether browser supports EventListenerOptions or not\n    const options = {\n      get capture() {\n        optsSupported = true;\n      },\n    };\n    self.addEventListener('test-options', null, options);\n    self.removeEventListener('test-options', null, options);\n  } catch (err) {\n    // EventListenerOptions are not supported\n  }\n  return optsSupported;\n}\n\n/**\n * Resets the test for whether addEventListener supports options or not.\n */\nexport function resetEvtListenerOptsSupportForTesting() {\n  optsSupported = undefined;\n}\n\n/**\n * Return boolean. if listener option is supported, return `true`.\n * if not supported, return `false`\n * @param {!Window} win\n * @return {boolean}\n */\nexport function supportsPassiveEventListener(win) {\n  if (passiveSupported !== undefined) {\n    return passiveSupported;\n  }\n\n  passiveSupported = false;\n  try {\n    const options = {\n      get passive() {\n        // This function will be called when the browser\n        // attempts to access the passive property.\n        passiveSupported = true;\n        return false;\n      },\n    };\n\n    win.addEventListener('test-options', null, options);\n    win.removeEventListener('test-options', null, options);\n  } catch (err) {\n    // EventListenerOptions are not supported\n  }\n  return passiveSupported;\n}\n\n/**\n * Resets the test for whether addEventListener supports passive options or not.\n */\nexport function resetPassiveSupportedForTesting() {\n  passiveSupported = undefined;\n}\n", "import {internalListenImplementation} from '#core/dom/event-helper-listen';\nimport {lastChildElement} from '#core/dom/query';\nimport * as mode from '#core/mode';\n\nimport {user} from '#utils/log';\n\n/** @const {string}  */\nconst LOAD_FAILURE_PREFIX = 'Failed to load:';\n\n/** @const {string} */\nexport const MEDIA_LOAD_FAILURE_SRC_PROPERTY = '__AMP_MEDIA_LOAD_FAILURE_SRC';\n\n/**\n * Returns a CustomEvent with a given type and detail; supports fallback for IE.\n * @param {!Window} win\n * @param {string} type\n * @param {!JsonObject|string|undefined|null} detail\n * @param {EventInit=} opt_eventInit\n * @return {!Event}\n */\nexport function createCustomEvent(win, type, detail, opt_eventInit) {\n  const eventInit = /** @type {!CustomEventInit} */ ({detail});\n  Object.assign(eventInit, opt_eventInit);\n  // win.CustomEvent is a function on Edge, Chrome, FF, Safari but\n  // is an object on IE 11.\n  if (mode.isEsm() || typeof win.CustomEvent == 'function') {\n    return new win.CustomEvent(type, eventInit);\n  } else {\n    // Deprecated fallback for IE.\n    const e = win.document.createEvent('CustomEvent');\n    e.initCustomEvent(\n      type,\n      !!eventInit.bubbles,\n      !!eventInit.cancelable,\n      detail\n    );\n    return e;\n  }\n}\n\n/**\n * Listens for the specified event on the element.\n * @param {!EventTarget} element\n * @param {string} eventType\n * @param {function(!Event)} listener\n * @param {Object=} opt_evtListenerOpts\n * @return {!UnlistenDef}\n */\nexport function listen(element, eventType, listener, opt_evtListenerOpts) {\n  return internalListenImplementation(\n    element,\n    eventType,\n    listener,\n    opt_evtListenerOpts\n  );\n}\n\n/**\n * Returns the data property of an event with the correct type.\n * @param {!Event|{data: !JsonObject}} event\n * @return {?JsonObject|string|undefined}\n */\nexport function getData(event) {\n  return /** @type {?JsonObject|string|undefined} */ (event.data);\n}\n\n/**\n * Returns the detail property of an event with the correct type.\n * @param {!Event|{detail: !JsonObject}} event\n * @return {?JsonObject|string|undefined}\n */\nexport function getDetail(event) {\n  return /** @type {?JsonObject|string|undefined} */ (event.detail);\n}\n\n/**\n * Listens for the specified event on the element and removes the listener\n * as soon as event has been received.\n * @param {!EventTarget} element\n * @param {string} eventType\n * @param {function(!Event)} listener\n * @param {Object=} opt_evtListenerOpts\n * @return {!UnlistenDef}\n */\nexport function listenOnce(element, eventType, listener, opt_evtListenerOpts) {\n  let localListener = listener;\n  const unlisten = internalListenImplementation(\n    element,\n    eventType,\n    (event) => {\n      try {\n        localListener(event);\n      } finally {\n        // Ensure listener is GC'd\n        localListener = null;\n        unlisten();\n      }\n    },\n    opt_evtListenerOpts\n  );\n  return unlisten;\n}\n\n/**\n * Returns  a promise that will resolve as soon as the specified event has\n * fired on the element.\n * @param {!EventTarget} element\n * @param {string} eventType\n * @param {Object=} opt_evtListenerOpts\n * @param {function(!UnlistenDef)=} opt_cancel An optional function that, when\n *     provided, will be called with the unlistener. This gives the caller\n *     access to the unlistener, so it may be called manually when necessary.\n * @return {!Promise<!Event>}\n */\nexport function listenOncePromise(\n  element,\n  eventType,\n  opt_evtListenerOpts,\n  opt_cancel\n) {\n  let unlisten;\n  const eventPromise = new Promise((resolve) => {\n    unlisten = listenOnce(element, eventType, resolve, opt_evtListenerOpts);\n  });\n  eventPromise.then(unlisten, unlisten);\n  if (opt_cancel) {\n    opt_cancel(unlisten);\n  }\n  return eventPromise;\n}\n\n/**\n * Whether the specified element/window has been loaded already.\n * @param {!Element|!Window} eleOrWindow\n * @return {boolean}\n */\nexport function isLoaded(eleOrWindow) {\n  return !!(\n    eleOrWindow.complete ||\n    eleOrWindow.readyState == 'complete' ||\n    (isHTMLMediaElement(eleOrWindow) && eleOrWindow.readyState > 0) ||\n    // If the passed in thing is a Window, infer loaded state from\n    //\n    (eleOrWindow.document && eleOrWindow.document.readyState == 'complete')\n  );\n}\n\n/**\n * Returns a promise that will resolve or fail based on the eleOrWindow's 'load'\n * and 'error' events. Optionally this method takes a timeout, which will reject\n * the promise if the resource has not loaded by then.\n * @param {T} eleOrWindow Supports both Elements and as a special case Windows.\n * @return {!Promise<T>}\n * @template T\n */\nexport function loadPromise(eleOrWindow) {\n  let unlistenLoad;\n  let unlistenError;\n  if (isLoaded(eleOrWindow)) {\n    return Promise.resolve(eleOrWindow);\n  }\n  const isMediaElement = isHTMLMediaElement(eleOrWindow);\n  if (\n    isMediaElement &&\n    eleOrWindow[MEDIA_LOAD_FAILURE_SRC_PROPERTY] === eleOrWindow.currentSrc\n  ) {\n    return Promise.reject(eleOrWindow);\n  }\n  const loadingPromise = new Promise((resolve, reject) => {\n    // Listen once since IE 5/6/7 fire the onload event continuously for\n    // animated GIFs.\n    if (isMediaElement) {\n      // The following event can be triggered by the media or one of its\n      // sources. Using capture is required as the media events do not bubble.\n      unlistenLoad = listenOnce(eleOrWindow, 'loadedmetadata', resolve, {\n        capture: true,\n      });\n    } else {\n      unlistenLoad = listenOnce(eleOrWindow, 'load', resolve);\n    }\n    // Don't unlisten on error for Windows.\n    if (!eleOrWindow.tagName) {\n      return;\n    }\n    let errorTarget = eleOrWindow;\n    // If the media element has no `src`, it will try to load the sources in\n    // document order. If the last source errors, then the media element\n    // loading errored.\n    if (isMediaElement && !eleOrWindow.hasAttribute('src')) {\n      errorTarget = lastChildElement(\n        eleOrWindow,\n        (child) => child.tagName === 'SOURCE'\n      );\n      if (!errorTarget) {\n        return reject(new Error('Media has no source.'));\n      }\n    }\n    unlistenError = listenOnce(errorTarget, 'error', reject);\n  });\n\n  return loadingPromise.then(\n    () => {\n      if (unlistenError) {\n        unlistenError();\n      }\n      return eleOrWindow;\n    },\n    () => {\n      if (unlistenLoad) {\n        unlistenLoad();\n      }\n      failedToLoad(eleOrWindow);\n    }\n  );\n}\n\n/**\n * Emit error on load failure.\n * @param {!Element|!Window} eleOrWindow Supports both Elements and as a special\n *     case Windows.\n */\nfunction failedToLoad(eleOrWindow) {\n  // Mark the element as errored since some elements - like HTMLMediaElement\n  // using HTMLSourceElement - do not provide any synchronous way to verify if\n  // they already errored, even though the error event was already dispatched.\n  if (isHTMLMediaElement(eleOrWindow)) {\n    eleOrWindow[MEDIA_LOAD_FAILURE_SRC_PROPERTY] =\n      eleOrWindow.currentSrc || true;\n  }\n\n  // Report failed loads as user errors so that they automatically go\n  // into the \"document error\" bucket.\n  let target = eleOrWindow;\n  if (target && target.src) {\n    target = target.src;\n  }\n  throw user().createError(LOAD_FAILURE_PREFIX, target);\n}\n\n/**\n * Returns true if the parameter is a HTMLMediaElement.\n * @param {!Element|!Window} eleOrWindow\n * @return {boolean}\n */\nfunction isHTMLMediaElement(eleOrWindow) {\n  return eleOrWindow.tagName === 'AUDIO' || eleOrWindow.tagName === 'VIDEO';\n}\n\n/**\n * Returns true if this error message is was created for a load error.\n * @param {string} message An error message\n * @return {boolean}\n */\nexport function isLoadErrorMessage(message) {\n  return message.indexOf(LOAD_FAILURE_PREFIX) != -1;\n}\n", "export const DEFAULT_LOCALE = 'en';\n\n/**\n * Standard ISO 8601 date format. https://xkcd.com/1179/\n * Matches what input[type=\"date\"] expects for setting the value property.\n */\nexport const DEFAULT_FORMAT = 'YYYY-MM-DD';\n\nexport const FORMAT_STRINGS = [\n  'M',\n  'Mo',\n  'MM',\n  'MMM',\n  'MMMM',\n  'Q',\n  'Qo',\n  'D',\n  'Do',\n  'DD',\n  'DDD',\n  'DDDo',\n  'DDDD',\n  'd',\n  'do',\n  'dd',\n  'ddd',\n  'dddd',\n  'e',\n  'E',\n  'w',\n  'wo',\n  'ww',\n  'W',\n  'Wo',\n  'WW',\n  'YY',\n  'YYYY',\n  'Y',\n  'gg',\n  'gggg',\n  'GG',\n  'GGGG',\n  'A',\n  'a',\n  'H',\n  'HH',\n  'h',\n  'hh',\n  'k',\n  'kk',\n  'm',\n  'mm',\n  's',\n  'ss',\n  'S',\n  'SS',\n  'SSS',\n  'SSSS',\n  'SSSSSSSSS',\n  'z',\n  'zz',\n  'Z',\n  'ZZ',\n  'X',\n  'x',\n];\n", "import {dev} from '#utils/log';\n\nconst TAG = 'AMP.require';\n\n/**\n * Allows `require`ing modules exported by non-AMP build code.\n * @param {string} module\n * @return {?}\n */\nexport function requireExternal(module) {\n  const required =\n    (AMP.dependencies && AMP.dependencies[module]) ||\n    (AMP.require && AMP.require(module));\n  if (required) {\n    return required;\n  } else {\n    dev().error(\n      TAG,\n      'Could not require external module %s.' +\n        ' Did you import the bundle in the extension?',\n      module\n    );\n  }\n}\n", "import {dict, omit} from '#core/types/object';\n\nimport {requireExternal} from '../../../src/module';\n\n/**\n * A higher-order component that wraps a specific date-picker implmentation\n * with common functionality.\n * @param {typeof React.Component} WrappedComponent A date-picker component to wrap\n * @return {typeof React.Component} A date picker component with common functionality\n */\nexport function withDatePickerCommon(WrappedComponent) {\n  const reactDates = requireExternal('react-dates');\n  const isSameDay = reactDates['isSameDay'];\n  const isInclusivelyAfterDay = reactDates['isInclusivelyAfterDay'];\n  const isInclusivelyBeforeDay = reactDates['isInclusivelyBeforeDay'];\n  const react = requireExternal('react');\n  const Moment = requireExternal('moment');\n\n  /**\n   * If `max` is null, the default minimum date is the current date.\n   * If `max` is a Moment date and earlier than the current date, then\n   * there is no default minimum date. If `max` is later than the current date,\n   * then the default minimum date is the current date.\n   * @param {?moment} max\n   * @return {?moment}\n   */\n  function getDefaultMinDate(max) {\n    const today = Moment();\n    if (max) {\n      return !isInclusivelyAfterDay(today, max) ? today : null;\n    } else {\n      return today;\n    }\n  }\n\n  /**\n   * Check if the given date is between or equal to the two bounds.\n   * @param {!moment} date\n   * @param {!moment} min\n   * @param {!moment} max\n   * @return {boolean}\n   */\n  function isInclusivelyBetween(date, min, max) {\n    return (\n      isInclusivelyAfterDay(date, min) && isInclusivelyBeforeDay(date, max)\n    );\n  }\n\n  /**\n   * @param {string} min\n   * @param {string} max\n   * @param {!moment} date\n   * @return {boolean}\n   */\n  function isOutsideRange(min, max, date) {\n    const maxInclusive = max ? Moment(max) : null;\n    const minInclusive = min ? Moment(min) : getDefaultMinDate(maxInclusive);\n    if (!maxInclusive && !minInclusive) {\n      return false;\n    } else if (!minInclusive) {\n      return !isInclusivelyBeforeDay(date, maxInclusive);\n    } else if (!maxInclusive) {\n      return !isInclusivelyAfterDay(date, minInclusive);\n    } else {\n      return !isInclusivelyBetween(date, minInclusive, maxInclusive);\n    }\n  }\n\n  /**\n   * @param {!./dates-list.DatesList} list\n   * @param {!moment} day\n   * @return {boolean}\n   */\n  function datesListContains(list, day) {\n    if (!list) {\n      return false;\n    }\n    return list.contains(day);\n  }\n\n  const defaultProps = dict({\n    'allowBlockedEndDate': false,\n    'blocked': null,\n    'highlighted': null,\n    'initialVisibleMonth': '',\n    'max': '',\n    'min': '',\n  });\n\n  /**\n   * Detect if a date is a blocked date. This is aware of the\n   * `allow-blocked-end-date` attribute to allow the user to select the first\n   * blocked date after their selected start date.\n   * @param {!./dates-list.DatesList} list\n   * @param {?moment} startDate\n   * @param {?moment} endDate\n   * @param {boolean} allowBlockedEndDate\n   * @param {!moment} day\n   * @return {*} TODO(#23582): Specify return type\n   */\n  function isDayBlocked(list, startDate, endDate, allowBlockedEndDate, day) {\n    const isBlocked = datesListContains(list, day);\n\n    if (startDate && !endDate && allowBlockedEndDate) {\n      return isBlocked && !isSameDay(day, list.firstDateAfter(startDate));\n    }\n\n    return isBlocked;\n  }\n\n  /**\n   * Creates an instance of Component.\n   * @param {!JsonObject} props\n   * @struct\n   * @constructor\n   * @extends {React.Component}\n   */\n  function DateComponent(props) {\n    react.Component.call(this, props);\n\n    /** @type {!JsonObject} */\n    this.props;\n\n    const allowBlockedEndDate = props['allowBlockedEndDate'];\n    const blocked = props['blocked'];\n    const endDate = props['endDate'];\n    const highlighted = props['highlighted'];\n    const max = props['max'];\n    const min = props['min'];\n    const startDate = props['startDate'];\n\n    this.isDayBlocked = isDayBlocked.bind(\n      null,\n      blocked,\n      startDate,\n      endDate,\n      allowBlockedEndDate\n    );\n    this.isDayHighlighted = datesListContains.bind(null, highlighted);\n    this.isOutsideRange = isOutsideRange.bind(null, min, max);\n  }\n\n  DateComponent.prototype = Object.create(react.Component.prototype);\n  DateComponent.prototype.constructor = DateComponent;\n\n  /** @override */\n  DateComponent.prototype.componentDidMount = function () {\n    if (this.props['onMount']) {\n      this.props['onMount']();\n    }\n  };\n\n  /** @override */\n  DateComponent.prototype.componentWillReceiveProps = function (nextProps) {\n    const allowBlockedEndDate = nextProps['allowBlockedEndDate'];\n    const blocked = nextProps['blocked'];\n    const endDate = nextProps['endDate'];\n    const highlighted = nextProps['highlighted'];\n    const max = nextProps['max'];\n    const min = nextProps['min'];\n    const startDate = nextProps['startDate'];\n\n    if (min != this.props['min'] || max != this.props['max']) {\n      this.isOutsideRange = isOutsideRange.bind(null, min, max);\n    }\n\n    if (\n      blocked != this.props['blocked'] ||\n      allowBlockedEndDate != this.props['allowBlockedEndDate'] ||\n      startDate != this.props['startDate'] ||\n      endDate != this.props['endDate']\n    ) {\n      this.isDayBlocked = isDayBlocked.bind(\n        null,\n        blocked,\n        startDate,\n        endDate,\n        allowBlockedEndDate\n      );\n    }\n\n    if (highlighted != this.props['highlighted']) {\n      this.isDayHighlighted = datesListContains.bind(null, highlighted);\n    }\n  };\n\n  /** @override */\n  DateComponent.prototype.render = function () {\n    const props = /** @type {!JsonObject} */ (\n      omit(this.props, Object.keys(defaultProps))\n    );\n\n    const date = props['date'];\n    const daySize = props['daySize'];\n    const endDate = props['endDate'];\n    const initialVisibleMonth = props['initialVisibleMonth'];\n    const startDate = props['startDate'];\n\n    const initialDate =\n      initialVisibleMonth || date || startDate || endDate || undefined;\n    props['initialVisibleMonth'] = () => Moment(initialDate);\n\n    return react.createElement(WrappedComponent, {\n      ...props,\n      ...dict({\n        'daySize': Number(daySize),\n        'isDayBlocked': this.isDayBlocked,\n        'isDayHighlighted': this.isDayHighlighted,\n        'isOutsideRange': this.isOutsideRange,\n      }),\n    });\n  };\n\n  /** @dict */\n  DateComponent['defaultProps'] = defaultProps;\n\n  return DateComponent;\n}\n", "import {dict} from '#core/types/object';\n\nconst calendarLabel = 'Calendar';\nconst jumpToPrevMonth = 'Move backward to switch to the previous month.';\nconst jumpToNextMonth = 'Move forward to switch to the next month.';\nconst keyboardShortcuts = 'Keyboard Shortcuts';\nconst showKeyboardShortcutsPanel = 'Open the keyboard shortcuts panel.';\nconst hideKeyboardShortcutsPanel = 'Close the shortcuts panel.';\nconst openThisPanel = 'Open this panel.';\nconst enterKey = 'Enter key';\nconst leftArrowRightArrow = 'Right and left arrow keys';\nconst upArrowDownArrow = 'up and down arrow keys';\nconst pageUpPageDown = 'page up and page down keys';\nconst homeEnd = 'Home and end keys';\nconst escape = 'Escape key';\nconst questionMark = 'Question mark';\nconst selectFocusedDate = 'Select the date in focus.';\nconst moveFocusByOneDay =\n  'Move backward (left) and forward (right) by one day.';\nconst moveFocusByOneWeek = 'Move backward (up) and forward (down) by one week.';\nconst moveFocusByOneMonth = 'Switch months.';\nconst moveFocustoStartAndEndOfWeek = 'Go to the first or last day of a week.';\nconst returnFocusToInput = 'Return to the date input field.';\n\n/**\n * @param {!JsonObject} obj\n * @return {string}\n */\nconst chooseAvailableStartDate = (obj) => {\n  return `Choose ${obj['date']} as the first date.`;\n};\n\n/**\n * @param {!JsonObject} obj\n * @return {string}\n */\nconst chooseAvailableEndDate = (obj) => {\n  return `Choose ${obj['date']} as the last date.`;\n};\n\n/**\n * @param {!JsonObject} obj\n * @return {string}\n */\nconst chooseAvailableDate = (obj) => {\n  return obj['date'];\n};\n\n/**\n * @param {!JsonObject} obj\n * @return {string}\n */\nconst dateIsUnavailable = (obj) => {\n  return `Not available. ${obj['date']}`;\n};\n\n/**\n * @type {!JsonObject}\n */\n// eslint-disable-next-line local/no-export-side-effect\nexport const DayPickerPhrases = dict({\n  'calendarLabel': calendarLabel,\n  'jumpToPrevMonth': jumpToPrevMonth,\n  'jumpToNextMonth': jumpToNextMonth,\n  'keyboardShortcuts': keyboardShortcuts,\n  'showKeyboardShortcutsPanel': showKeyboardShortcutsPanel,\n  'hideKeyboardShortcutsPanel': hideKeyboardShortcutsPanel,\n  'openThisPanel': openThisPanel,\n  'enterKey': enterKey,\n  'leftArrowRightArrow': leftArrowRightArrow,\n  'upArrowDownArrow': upArrowDownArrow,\n  'pageUpPageDown': pageUpPageDown,\n  'homeEnd': homeEnd,\n  'escape': escape,\n  'questionMark': questionMark,\n  'selectFocusedDate': selectFocusedDate,\n  'moveFocusByOneDay': moveFocusByOneDay,\n  'moveFocusByOneWeek': moveFocusByOneWeek,\n  'moveFocusByOneMonth': moveFocusByOneMonth,\n  'moveFocustoStartAndEndOfWeek': moveFocustoStartAndEndOfWeek,\n  'returnFocusToInput': returnFocusToInput,\n  'chooseAvailableStartDate': chooseAvailableStartDate,\n  'chooseAvailableEndDate': chooseAvailableEndDate,\n  'chooseAvailableDate': chooseAvailableDate,\n  'dateIsUnavailable': dateIsUnavailable,\n});\n", "import {requireExternal} from '../../../../src/module';\n\n/**\n * Implements the `maximum-nights` attribute on the date range picker.\n * @param {typeof React.Component} WrappedComponent A date-picker component to wrap\n * @return {typeof React.Component}\n */\nexport function wrap(WrappedComponent) {\n  const react = requireExternal('react');\n  const reactDatesConstants = requireExternal('react-dates/constants');\n  const reactDates = requireExternal('react-dates');\n\n  const END_DATE = reactDatesConstants['END_DATE'];\n  const START_DATE = reactDatesConstants['START_DATE'];\n  const isInclusivelyAfterDay = reactDates['isInclusivelyAfterDay'];\n  const isInclusivelyBeforeDay = reactDates['isInclusivelyBeforeDay'];\n\n  /**\n   * Creates an instance of FocusedTrueHack.\n   * @param {!JsonObject} props\n   * @struct\n   * @constructor\n   * @extends {React.Component}\n   */\n  function MaximumNights(props) {\n    react.Component.call(this, props);\n\n    /** @private */\n    this.isOutsideRange_ = getIsOutsideRange(props);\n  }\n\n  MaximumNights.prototype = Object.create(react.Component.prototype);\n  MaximumNights.prototype.constructor = MaximumNights;\n\n  /** @override */\n  MaximumNights.prototype.componentWillReceiveProps = function (nextProps) {\n    const {props} = this;\n    const shouldUpdate =\n      props['isOutsideRange'] != nextProps['isOutsideRange'] ||\n      props['startDate'] != nextProps['startDate'] ||\n      props['endDate'] != nextProps['endDate'] ||\n      props['focusedInput'] != nextProps['focusedInput'] ||\n      props['maximumNights'] != nextProps['maximumNights'];\n    if (shouldUpdate) {\n      this.isOutsideRange_ = getIsOutsideRange(nextProps);\n    }\n  };\n\n  /** @override */\n  MaximumNights.prototype.render = function () {\n    const props = {...this.props};\n    props['isOutsideRange'] = this.isOutsideRange_;\n    return react.createElement(WrappedComponent, props);\n  };\n\n  /** @private @const visible for testing */\n  MaximumNights.getIsOutsideRange = getIsOutsideRange;\n\n  /**\n   * Creates a function that will restrict the user from selecting a range\n   * of dates whose length would exceed the value of the maximumDates prop,\n   * if present.\n   * @param {!Object} props\n   * @return {function(!moment):boolean}\n   */\n  function getIsOutsideRange(props) {\n    const isOutsideRange = props['isOutsideRange'];\n    const startDate = props['startDate'];\n    const endDate = props['endDate'];\n    const focusedInput = props['focusedInput'];\n    const maximumNights = Number(props['maximumNights']);\n\n    if (!maximumNights) {\n      return isOutsideRange;\n    }\n\n    if (startDate && focusedInput == END_DATE) {\n      const firstIneligibleDay = startDate\n        .clone()\n        .add(maximumNights + 1, 'days');\n      return (date) => {\n        return (\n          isOutsideRange(date) ||\n          isInclusivelyAfterDay(date, firstIneligibleDay)\n        );\n      };\n    }\n\n    if (endDate && focusedInput == START_DATE) {\n      const lastIneligibleDay = endDate\n        .clone()\n        .add(-1 * (maximumNights + 1), 'days');\n      return (date) => {\n        return (\n          isOutsideRange(date) ||\n          isInclusivelyBeforeDay(date, lastIneligibleDay)\n        );\n      };\n    }\n\n    return isOutsideRange;\n  }\n\n  return MaximumNights;\n}\n", "import {dict} from '#core/types/object';\n\nimport {withDatePickerCommon} from './date-picker-common';\nimport {DayPickerPhrases} from './defaultPhrases';\nimport {wrap as withMaximumNights} from './wrappers/maximum-nights';\n\nimport {requireExternal} from '../../../src/module';\n\n/**\n * Create a DateRangePicker React component\n * @return {typeof React.Component} A date range picker component class\n */\nfunction createDateRangePickerBase() {\n  const constants = /** @type {JsonObject} */ (\n    requireExternal('react-dates/constants')\n  );\n  const DAY_SIZE = constants['DAY_SIZE'];\n  const HORIZONTAL_ORIENTATION = constants['HORIZONTAL_ORIENTATION'];\n  const DayPickerRangeController = /** @type {typeof  React.Component} */ (\n    requireExternal('react-dates')['DayPickerRangeController']\n  );\n\n  const defaultProps = dict({\n    'startDate': null, // TODO: use null\n    'endDate': null, // TODO: use null\n    'onDatesChange': function () {},\n\n    'focusedInput': null,\n    'onFocusChange': function () {},\n    'onClose': function () {},\n\n    'keepOpenOnDateSelect': false,\n    'minimumNights': 1,\n    'isOutsideRange': function () {},\n    'isDayBlocked': function () {},\n    'isDayHighlighted': function () {},\n\n    // DayPicker props\n    'renderMonth': null,\n    'enableOutsideDays': false,\n    'numberOfMonths': 1,\n    'orientation': HORIZONTAL_ORIENTATION,\n    'withPortal': false,\n    'hideKeyboardShortcutsPanel': false,\n    'initialVisibleMonth': null,\n    'daySize': DAY_SIZE,\n\n    'navPrev': null,\n    'navNext': null,\n\n    'onPrevMonthClick': function () {},\n    'onNextMonthClick': function () {},\n    'onOutsideClick': function () {},\n\n    'renderDay': null,\n    'renderCalendarInfo': null,\n    'firstDayOfWeek': null,\n    'verticalHeight': null,\n    'noBorder': false,\n    'transitionDuration': undefined,\n\n    // accessibility\n    'onBlur': function () {},\n    'isFocused': false,\n    'showKeyboardShortcuts': false,\n\n    // i18n\n    'monthFormat': 'MMMM YYYY',\n    'weekDayFormat': 'd',\n    'phrases': DayPickerPhrases,\n\n    'isRTL': false,\n  });\n\n  const WrappedDayPickerRangeController = withDatePickerCommon(\n    withMaximumNights(DayPickerRangeController)\n  );\n  WrappedDayPickerRangeController['defaultProps'] = defaultProps;\n\n  return WrappedDayPickerRangeController;\n}\n\n/** @private {?typeof React.Component} */\nlet DateRangePicker_ = null;\n\n/**\n * Creates a date range picker, injecting its dependencies.\n * @return {typeof React.Component} A date range picker component class\n */\nexport function createDateRangePicker() {\n  if (!DateRangePicker_) {\n    DateRangePicker_ = createDateRangePickerBase();\n  }\n  return DateRangePicker_;\n}\n", "import * as rrule from '../../../node_modules/rrule/dist/es5/rrule';\nimport {requireExternal} from '../../../src/module';\n\nconst rrulestr = rrule.default.rrulestr || rrule.rrulestr; // closure imports into .default, esbuild flattens a layer.\n\n/** @enum {string} */\nconst DateType = {\n  INVALID: 'invalid',\n  RRULE: 'rrule',\n  DATE: 'date',\n};\n\n/**\n * A class which wraps a list of moment dates or RRULE dates.\n */\nexport class DatesList {\n  /**\n   * @param {!Array<string>} dates\n   */\n  constructor(dates) {\n    /** @private @const */\n    this.ReactDates_ = /** @type {!JsonObject} */ (\n      requireExternal('react-dates')\n    );\n\n    /** @private @const */\n    this.moment_ = requireExternal('moment');\n\n    /** @private @const */\n    this.rrulestrs_ = dates\n      .filter((d) => this.getDateType_(d) === DateType.RRULE)\n      .map((d) => tryParseRrulestr(d));\n\n    /** @private @const */\n    this.dates_ = dates\n      .filter((d) => this.getDateType_(d) == DateType.DATE)\n      .map((d) => this.moment_(d))\n      .sort((a, b) => a.toDate() - b.toDate());\n  }\n\n  /**\n   * Determines if the given date is contained within the RRULEs or moment dates\n   * contained in the date list.\n   * @param {!moment|string} date\n   * @return {boolean}\n   */\n  contains(date) {\n    const m = this.moment_(date);\n    return this.matchesDate_(m) || this.matchesRrule_(m);\n  }\n\n  /**\n   * Gets the first date in the date list after the given date.\n   * @param {!moment|string} momentOrString\n   * @return {!moment}\n   */\n  firstDateAfter(momentOrString) {\n    const m = this.moment_(momentOrString);\n    const date = m.toDate();\n\n    const firstDatesAfter = [];\n    for (let i = 0; i < this.dates_.length; i++) {\n      if (this.dates_[i].toDate() >= date) {\n        firstDatesAfter.push(this.dates_[i]);\n        break;\n      }\n    }\n\n    const rruleDates = this.rrulestrs_\n      .map((rrule) => /** @type {RRule} */ (rrule).after(date))\n      .filter(Boolean)\n      .map(normalizeRruleReturn);\n\n    return firstDatesAfter.concat(rruleDates).sort((a, b) => {\n      // toDate method does not exist for RRule dates.\n      a = a.toDate ? a.toDate() : a;\n      b = b.toDate ? b.toDate() : b;\n      return a - b;\n    })[0];\n  }\n\n  /**\n   * Determines if any internal moment object matches the given date.\n   * @param {!moment} date\n   * @return {boolean}\n   * @private\n   */\n  matchesDate_(date) {\n    return this.dates_.some((d) => this.ReactDates_['isSameDay'](d, date));\n  }\n\n  /**\n   * Determines if any internal RRULE object matches the given date.\n   * @param {!moment} date\n   * @return {boolean}\n   * @private\n   */\n  matchesRrule_(date) {\n    const nextDate = date.clone().startOf('day').add(1, 'day').toDate();\n    return this.rrulestrs_.some((rrule) => {\n      const rruleUTCDate = /** @type {RRule} */ (rrule).before(nextDate);\n      if (!rruleUTCDate) {\n        return false;\n      }\n      const rruleLocalDate = normalizeRruleReturn(rruleUTCDate);\n      const rruleMoment = this.moment_(rruleLocalDate);\n      return this.ReactDates_['isSameDay'](rruleMoment, date);\n    });\n  }\n\n  /**\n   * Distinguish between RRULE dates and moment dates.\n   * @param {!moment|string} date\n   * @return {!DateType}\n   * @private\n   */\n  getDateType_(date) {\n    if (this.moment_(date).isValid()) {\n      return DateType.DATE;\n    }\n\n    const dateStr = /** @type {string} */ (date);\n    if (tryParseRrulestr(dateStr)) {\n      return DateType.RRULE;\n    }\n\n    return DateType.INVALID;\n  }\n}\n\n/**\n * RRULE returns dates as local time formatted at UTC, so the\n * Date.prototype.getUTC* methods must be used to create a new date object.\n * {@link https://github.com/jakubroztocil/rrule#important-use-utc-dates}\n * @param {!Date} rruleDate\n * @return {!Date}\n */\nfunction normalizeRruleReturn(rruleDate) {\n  const year = rruleDate.getUTCFullYear();\n  const month = rruleDate.getUTCMonth();\n  const day = rruleDate.getUTCDate();\n  const hours = rruleDate.getUTCHours();\n  const minutes = rruleDate.getUTCMinutes();\n  const seconds = rruleDate.getUTCSeconds();\n  const ms = rruleDate.getUTCMilliseconds();\n  return new Date(year, month, day, hours, minutes, seconds, ms);\n}\n\n/**\n * Tries to parse a string into an RRULE object.\n * @param {string} str A string which represents a repeating date RRULE spec.\n * @return {?RRule}\n */\nfunction tryParseRrulestr(str) {\n  try {\n    return rrulestr(str, {});\n  } catch (e) {\n    return null;\n  }\n}\n", "import {requireExternal} from '../../../src/module';\n\n/**\n * Create a React component that can render Promises.\n * Note: The nested class cannot be named Deferred, since src/promise.js already\n * exports a class with that name.\n * @return {typeof React.Component}\n */\nfunction createDeferred_() {\n  const react = requireExternal('react');\n\n  /**\n   * Creates an instance of DeferredType.\n   * @param {!Object} props\n   * @struct\n   * @constructor\n   * @extends {React.Component}\n   */\n  function DeferredType(props) {\n    react.Component.call(this, props);\n    const self = /** @type {!React.Component} */ (this);\n    self.state = {value: this.props.initial};\n  }\n\n  DeferredType.prototype = Object.create(react.Component.prototype);\n  DeferredType.prototype.constructor = DeferredType;\n\n  /** @override */\n  DeferredType.prototype.componentWillReceiveProps = function (nextProps) {\n    const promise = nextProps['promise'];\n    if (promise) {\n      promise.then((value) => this.setState({value}));\n    }\n  };\n\n  /** @override */\n  DeferredType.prototype.shouldComponentUpdate = function (props, state) {\n    const self = /** @type {!React.Component} */ (this);\n    return Boolean(\n      shallowDiffers(this.props, props) || shallowDiffers(self.state, state)\n    );\n  };\n\n  /** @override */\n  DeferredType.prototype.componentDidMount = function () {\n    this.props.promise.then((value) => this.setState({value}));\n  };\n\n  /** @override */\n  DeferredType.prototype.render = function () {\n    const self = /** @type {!React.Component} */ (this);\n    return this.props.then(self.state.value);\n  };\n\n  DeferredType['defaultProps'] = {\n    initial: '',\n  };\n\n  return DeferredType;\n}\n\n/**\n * Duplicated from Preact PureComponent implementation.\n * https://github.com/developit/preact-compat/blob/ae018abb/src/index.js#L402\n * Shallow compare a and b.\n * @param {*} a\n * @param {*} b\n * @return {*} TODO(#23582): Specify return type\n */\nfunction shallowDiffers(a, b) {\n  for (const i in a) {\n    if (!(i in b)) {\n      return true;\n    }\n  }\n  for (const i in b) {\n    if (a[i] !== b[i]) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/** @private {?typeof React.Component} */\nlet DeferredType_ = null;\n\n/**\n * Creates a single date picker.\n * @return {typeof React.Component} A date picker class\n */\nexport function createDeferred() {\n  if (!DeferredType_) {\n    DeferredType_ = createDeferred_();\n  }\n  return DeferredType_;\n}\n", "import {dict} from '#core/types/object';\n\nimport {withDatePickerCommon} from './date-picker-common';\nimport {DayPickerPhrases} from './defaultPhrases';\n\nimport {requireExternal} from '../../../src/module';\n\n/**\n * Create a SingleDatePicker React component\n * @return {typeof React.Component} A single date picker component class\n */\nfunction createSingleDatePickerBase() {\n  const constants = /** @type {!JsonObject} */ (\n    requireExternal('react-dates/constants')\n  );\n\n  const DAY_SIZE = constants['DAY_SIZE'];\n  const HORIZONTAL_ORIENTATION = constants['HORIZONTAL_ORIENTATION'];\n  const DayPickerSingleDateController = /** @type {typeof  React.Component} */ (\n    requireExternal('react-dates')['DayPickerSingleDateController']\n  );\n\n  const defaultProps = dict({\n    'date': null,\n    'onDateChange': function () {},\n\n    'focused': false,\n    'onFocusChange': function () {},\n    'onClose': function () {},\n\n    'keepOpenOnDateSelect': false,\n    'isOutsideRange': function () {},\n    'isDayBlocked': function () {},\n    'isDayHighlighted': function () {},\n\n    // DayPicker props\n    'renderMonth': null,\n    'enableOutsideDays': false,\n    'numberOfMonths': 1,\n    'orientation': HORIZONTAL_ORIENTATION,\n    'withPortal': false,\n    'hideKeyboardShortcutsPanel': false,\n    'initialVisibleMonth': null,\n    'firstDayOfWeek': null,\n    'daySize': DAY_SIZE,\n    'verticalHeight': null,\n    'noBorder': false,\n    'transitionDuration': undefined,\n\n    'navPrev': null,\n    'navNext': null,\n\n    'onPrevMonthClick': function () {},\n    'onNextMonthClick': function () {},\n    'onOutsideClick': null,\n\n    'renderDay': null,\n    'renderCalendarInfo': null,\n\n    // accessibility\n    'onBlur': function () {},\n    'isFocused': false,\n    'showKeyboardShortcuts': false,\n\n    // i18n\n    'monthFormat': 'MMMM YYYY',\n    'weekDayFormat': 'dd',\n    'phrases': DayPickerPhrases,\n\n    'isRTL': false,\n  });\n\n  const WrappedDayPickerSingleDateController = withFocusedTrueHack(\n    withDatePickerCommon(DayPickerSingleDateController)\n  );\n  WrappedDayPickerSingleDateController.defaultProps = defaultProps;\n\n  return WrappedDayPickerSingleDateController;\n}\n\n/**\n * Fixes bug where overlay single date pickers do not open to\n * the month containing the selected date.\n * https://github.com/airbnb/react-dates/issues/931\n * @param {typeof React.Component} WrappedComponent A date-picker component to wrap\n * @return {typeof React.Component} A class with a preset focused prop\n */\nfunction withFocusedTrueHack(WrappedComponent) {\n  const react = requireExternal('react');\n\n  /**\n   * Creates an instance of FocusedTrueHack.\n   * @param {!JsonObject} props\n   * @struct\n   * @constructor\n   * @extends {React.Component}\n   */\n  function FocusedTrueHack(props) {\n    react.Component.call(this, props);\n  }\n\n  FocusedTrueHack.prototype = Object.create(react.Component.prototype);\n  FocusedTrueHack.prototype.constructor = FocusedTrueHack;\n\n  /** @override */\n  FocusedTrueHack.prototype.render = function () {\n    const props = {...this.props, ...dict({'focused': true})};\n    return react.createElement(WrappedComponent, props);\n  };\n\n  return FocusedTrueHack;\n}\n\n/** @private {?typeof React.Component} */\nlet SingleDatePicker_ = null;\n\n/**\n * Creates a single date picker, injecting its dependencies\n * @return {typeof React.Component} A date picker component class\n */\nexport function createSingleDatePicker() {\n  if (!SingleDatePicker_) {\n    SingleDatePicker_ = createSingleDatePickerBase();\n  }\n  return SingleDatePicker_;\n}\n", "export const CSS = \".PresetDateRangePicker_panel{padding:0 22px 11px}.PresetDateRangePicker_button{position:relative;height:100%;text-align:center;background:0 0;border:2px solid #00a699;color:#00a699;padding:4px 12px;margin-right:8px;font:inherit;font-weight:700;line-height:normal;overflow:visible;box-sizing:border-box;cursor:pointer}.PresetDateRangePicker_button:active{outline:0}.PresetDateRangePicker_button__selected{color:#fff;background:#00a699}.SingleDatePicker{position:relative;display:inline-block}.SingleDatePicker__block{display:block}.SingleDatePicker_picker{z-index:1;background-color:#fff;position:absolute}.SingleDatePicker_picker__rtl{direction:rtl}.SingleDatePicker_picker__directionLeft{left:0}.SingleDatePicker_picker__directionRight{right:0}.SingleDatePicker_picker__portal{background-color:rgba(0,0,0,.3);position:fixed;top:0;left:0;height:100%;width:100%}.SingleDatePicker_picker__fullScreenPortal{background-color:#fff}.SingleDatePicker_closeButton{background:0 0;border:0;color:inherit;font:inherit;line-height:normal;overflow:visible;cursor:pointer;position:absolute;top:0;right:0;padding:15px;z-index:2}.SingleDatePicker_closeButton:focus,.SingleDatePicker_closeButton:hover{color:darken(#cacccd,10%);text-decoration:none}.SingleDatePicker_closeButton_svg{height:15px;width:15px;fill:#cacccd}.SingleDatePickerInput{display:inline-block;background-color:#fff}.SingleDatePickerInput__withBorder{border:1px solid #dbdbdb}.SingleDatePickerInput__rtl{direction:rtl}.SingleDatePickerInput__disabled{background-color:#f2f2f2}.SingleDatePickerInput__block{display:block}.SingleDatePickerInput__showClearDate{padding-right:30px}.SingleDatePickerInput_clearDate{background:0 0;border:0;color:inherit;font:inherit;line-height:normal;overflow:visible;cursor:pointer;padding:10px;margin:0 10px 0 5px;position:absolute;right:0;top:50%;transform:translateY(-50%)}.SingleDatePickerInput_clearDate__default:focus,.SingleDatePickerInput_clearDate__default:hover{background:#dbdbdb;border-radius:50%}.SingleDatePickerInput_clearDate__small{padding:6px}.SingleDatePickerInput_clearDate__hide{visibility:hidden}.SingleDatePickerInput_clearDate_svg{fill:#82888a;height:12px;width:15px;vertical-align:middle}.SingleDatePickerInput_clearDate_svg__small{height:9px}.SingleDatePickerInput_calendarIcon{background:0 0;border:0;color:inherit;font:inherit;line-height:normal;overflow:visible;cursor:pointer;display:inline-block;vertical-align:middle;padding:10px;margin:0 5px 0 10px}.SingleDatePickerInput_calendarIcon_svg{fill:#82888a;height:15px;width:14px;vertical-align:middle}.DateRangePicker{position:relative;display:inline-block}.DateRangePicker__block{display:block}.DateRangePicker_picker{z-index:1;background-color:#fff;position:absolute}.DateRangePicker_picker__rtl{direction:rtl}.DateRangePicker_picker__directionLeft{left:0}.DateRangePicker_picker__directionRight{right:0}.DateRangePicker_picker__portal{background-color:rgba(0,0,0,.3);position:fixed;top:0;left:0;height:100%;width:100%}.DateRangePicker_picker__fullScreenPortal{background-color:#fff}.DateRangePicker_closeButton{background:0 0;border:0;color:inherit;font:inherit;line-height:normal;overflow:visible;cursor:pointer;position:absolute;top:0;right:0;padding:15px;z-index:2}.DateRangePicker_closeButton:focus,.DateRangePicker_closeButton:hover{color:darken(#cacccd,10%);text-decoration:none}.DateRangePicker_closeButton_svg{height:15px;width:15px;fill:#cacccd}.DayPicker{position:relative;text-align:left}.DayPicker,.DayPicker__horizontal{background:#fff}.DayPicker__verticalScrollable{height:100%}.DayPicker__hidden{visibility:hidden}.DayPicker__withBorder{box-shadow:0 2px 6px rgba(0,0,0,.05),0 0 0 1px rgba(0,0,0,.07);border-radius:3px}.DayPicker_portal__horizontal{box-shadow:none;position:absolute;left:50%;top:50%}.DayPicker_portal__vertical{position:initial}.DayPicker_focusRegion{outline:0}.DayPicker_weekHeaders{position:relative}.DayPicker_weekHeaders__horizontal{margin-left:9px}.DayPicker_weekHeader{color:#757575;position:absolute;top:62px;z-index:2;padding:0 13px;text-align:left}.DayPicker_weekHeader__vertical{left:50%}.DayPicker_weekHeader__verticalScrollable{top:0;display:table-row;border-bottom:1px solid #dbdbdb;background:#fff;margin-left:0;left:0;width:100%;text-align:center}.DayPicker_weekHeader_ul{list-style:none;margin:1px 0;padding-left:0;padding-right:0;font-size:14px}.DayPicker_weekHeader_li{display:inline-block;text-align:center}.DayPicker_transitionContainer{position:relative;overflow:hidden;border-radius:3px}.DayPicker_transitionContainer__horizontal{transition:height .2s ease-in-out}.DayPicker_transitionContainer__vertical{width:100%}.DayPicker_transitionContainer__verticalScrollable{padding-top:20px;height:100%;position:absolute;top:0;bottom:0;right:0;left:0;overflow-y:scroll}.DayPickerKeyboardShortcuts_buttonReset{background:0 0;border:0;border-radius:0;color:inherit;font:inherit;line-height:normal;overflow:visible;padding:0;cursor:pointer;font-size:14px}.DayPickerKeyboardShortcuts_buttonReset:active{outline:0}.DayPickerKeyboardShortcuts_show{width:22px;position:absolute;z-index:2}.DayPickerKeyboardShortcuts_show__bottomRight{border-top:26px solid transparent;border-right:33px solid #00a699;bottom:0;right:0}.DayPickerKeyboardShortcuts_show__bottomRight:hover{border-right:33px solid #008489}.DayPickerKeyboardShortcuts_show__topRight{border-bottom:26px solid transparent;border-right:33px solid #00a699;top:0;right:0}.DayPickerKeyboardShortcuts_show__topRight:hover{border-right:33px solid #008489}.DayPickerKeyboardShortcuts_show__topLeft{border-bottom:26px solid transparent;border-left:33px solid #00a699;top:0;left:0}.DayPickerKeyboardShortcuts_show__topLeft:hover{border-left:33px solid #008489}.DayPickerKeyboardShortcuts_showSpan{color:#fff;position:absolute}.DayPickerKeyboardShortcuts_showSpan__bottomRight{bottom:0;right:-28px}.DayPickerKeyboardShortcuts_showSpan__topRight{top:1px;right:-28px}.DayPickerKeyboardShortcuts_showSpan__topLeft{top:1px;left:-28px}.DayPickerKeyboardShortcuts_panel{overflow:auto;background:#fff;border:1px solid #dbdbdb;border-radius:2px;position:absolute;top:0;bottom:0;right:0;left:0;z-index:2;padding:22px;margin:33px}.DayPickerKeyboardShortcuts_title{font-size:16px;font-weight:700;margin:0}.DayPickerKeyboardShortcuts_list{list-style:none;padding:0;font-size:14px}.DayPickerKeyboardShortcuts_close{position:absolute;right:22px;top:22px;z-index:2}.DayPickerKeyboardShortcuts_close:active{outline:0}.DayPickerKeyboardShortcuts_closeSvg{height:15px;width:15px;fill:#cacccd}.DayPickerKeyboardShortcuts_closeSvg:focus,.DayPickerKeyboardShortcuts_closeSvg:hover{fill:#82888a}.KeyboardShortcutRow{list-style:none;margin:6px 0}.KeyboardShortcutRow__block{margin-bottom:16px}.KeyboardShortcutRow_keyContainer{display:inline-block;white-space:nowrap;text-align:right;margin-right:6px}.KeyboardShortcutRow_keyContainer__block{text-align:left;display:inline}.KeyboardShortcutRow_key{font-family:monospace;font-size:12px;text-transform:uppercase;background:#f2f2f2;padding:2px 6px}.KeyboardShortcutRow_action{display:inline;word-break:break-word;margin-left:8px}.DayPickerNavigation_container{position:relative;z-index:2}.DayPickerNavigation_container__vertical{background:#fff;box-shadow:0 0 5px 2px rgba(0,0,0,.1);position:absolute;bottom:0;left:0;height:52px;width:100%}.DayPickerNavigation_container__verticalScrollable{position:relative}.DayPickerNavigation_button{cursor:pointer;line-height:.78;-webkit-user-select:none;-ms-user-select:none;user-select:none}.DayPickerNavigation_button__default{border:1px solid #e4e7e7;background-color:#fff;color:#757575}.DayPickerNavigation_button__default:focus,.DayPickerNavigation_button__default:hover{border:1px solid #c4c4c4}.DayPickerNavigation_button__default:active{background:#f2f2f2}.DayPickerNavigation_button__horizontal{border-radius:3px;padding:6px 9px;top:18px;position:absolute}.DayPickerNavigation_leftButton__horizontal{left:22px}.DayPickerNavigation_rightButton__horizontal{right:22px}.DayPickerNavigation_button__vertical{display:inline-block;position:relative;height:100%;width:50%}.DayPickerNavigation_button__vertical__default{padding:5px}.DayPickerNavigation_nextButton__vertical__default{border-left:0}.DayPickerNavigation_nextButton__verticalScrollable{width:100%}.DayPickerNavigation_svg__horizontal{height:19px;width:19px;fill:#82888a}.DayPickerNavigation_svg__vertical{height:42px;width:42px;fill:#565a5c}.CalendarMonthGrid{background:#fff;text-align:left;z-index:0}.CalendarMonthGrid__animating{z-index:1}.CalendarMonthGrid__horizontal{position:absolute;left:9px}.CalendarMonthGrid__vertical{margin:0 auto}.CalendarMonthGrid__vertical_scrollable{margin:0 auto;overflow-y:scroll}.CalendarMonthGrid_month__horizontal{display:inline-block;vertical-align:top;min-height:100%}.CalendarMonthGrid_month__hideForAnimation{position:absolute;z-index:-1;opacity:0;pointer-events:none}.CalendarMonth{background:#fff;text-align:center;padding:0 13px;vertical-align:top;-webkit-user-select:none;-ms-user-select:none;user-select:none}.CalendarMonth_table{border-collapse:collapse;border-spacing:0}.CalendarMonth_caption{color:#565a5c;font-size:18px;text-align:center;padding-top:22px;padding-bottom:37px;caption-side:initial}.CalendarMonth_caption__verticalScrollable{padding-top:12px;padding-bottom:7px}.CalendarDay_container{border:1px solid #e4e7e7;padding:0;box-sizing:border-box;color:#565a5c;background:#fff}.CalendarDay_container:hover{background:#e4e7e7;border:1px double #e4e7e7;color:inherit}.CalendarDay_button{position:relative;height:100%;width:100%;text-align:center;background:0 0;border:0;margin:0;padding:0;color:inherit;line-height:normal;overflow:visible;box-sizing:border-box;cursor:pointer;font-family:inherit;font-style:inherit;font-size:14px}.CalendarDay_button:active{outline:0}.CalendarDay_button__default{cursor:default}.CalendarDay__outside{border:0;background:#fff;color:#565a5c}.CalendarDay__blocked_minimum_nights{background:#fff;border:1px solid #eceeee;color:#cacccd}.CalendarDay__blocked_minimum_nights:active,.CalendarDay__blocked_minimum_nights:hover{background:#fff;color:#cacccd}.CalendarDay__highlighted_calendar{background:#ffe8bc;color:#565a5c}.CalendarDay__highlighted_calendar:active,.CalendarDay__highlighted_calendar:hover{background:#ffce71;color:#565a5c}.CalendarDay__selected_span{background:#66e2da;border:1px solid #33dacd;color:#fff}.CalendarDay__selected_span:active,.CalendarDay__selected_span:hover{background:#33dacd;border:1px solid #33dacd;color:#fff}.CalendarDay__last_in_range{border-right:#00a699}.CalendarDay__selected,.CalendarDay__selected:active,.CalendarDay__selected:hover{background:#00a699;border:1px solid #00a699;color:#fff}.CalendarDay__hovered_span,.CalendarDay__hovered_span:hover{background:#b2f1ec;border:1px solid #80e8e0;color:#007a87}.CalendarDay__hovered_span:active{background:#80e8e0;border:1px solid #80e8e0;color:#007a87}.CalendarDay__blocked_calendar,.CalendarDay__blocked_calendar:active,.CalendarDay__blocked_calendar:hover{background:#cacccd;border:1px solid #cacccd;color:#82888a}.CalendarDay__blocked_out_of_range,.CalendarDay__blocked_out_of_range:active,.CalendarDay__blocked_out_of_range:hover{background:#fff;border:1px solid #e4e7e7;color:#cacccd}.DateRangePickerInput{background-color:#fff;display:inline-block}.DateRangePickerInput__disabled{background:#f2f2f2}.DateRangePickerInput__withBorder{border:1px solid #cacccd}.DateRangePickerInput__rtl{direction:rtl}.DateRangePickerInput__block{display:block}.DateRangePickerInput__showClearDates{padding-right:30px}.DateRangePickerInput_arrow{display:inline-block;vertical-align:middle}.DateRangePickerInput_arrow_svg{vertical-align:middle;fill:#565a5c;height:24px;width:24px}.DateRangePickerInput_arrow_svg__small{height:19px;width:19px}.DateRangePickerInput_clearDates{background:0 0;border:0;color:inherit;font:inherit;line-height:normal;overflow:visible;cursor:pointer;padding:10px;margin:0 10px 0 5px;position:absolute;right:0;top:50%;transform:translateY(-50%)}.DateRangePickerInput_clearDates__small{padding:6px}.DateRangePickerInput_clearDates_default:focus,.DateRangePickerInput_clearDates_default:hover{background:#dbdbdb;border-radius:50%}.DateRangePickerInput_clearDates__hide{visibility:hidden}.DateRangePickerInput_clearDates_svg{fill:#82888a;height:12px;width:15px;vertical-align:middle}.DateRangePickerInput_clearDates_svg__small{height:9px}.DateRangePickerInput_calendarIcon{background:0 0;border:0;color:inherit;font:inherit;line-height:normal;overflow:visible;cursor:pointer;display:inline-block;vertical-align:middle;padding:10px;margin:0 5px 0 10px}.DateRangePickerInput_calendarIcon_svg{fill:#82888a;height:15px;width:14px;vertical-align:middle}.DateInput{margin:0;padding:0;background:#fff;position:relative;display:inline-block;width:130px;vertical-align:middle}.DateInput__small{width:90px}.DateInput__disabled{background:#f2f2f2;color:#dbdbdb}.DateInput_input{font-weight:200;font-size:18px;line-height:24px;color:#565a5c;background-color:#fff;width:100%;padding:13px 12px 11px;border:0;border-bottom:2px solid transparent}.DateInput_input__small{font-size:14px;line-height:18px;padding:8px 8px 6px}.DateInput_input__readOnly{-webkit-user-select:none;-ms-user-select:none;user-select:none}.DateInput_input__focused{outline:0;background:#fff;border:0;border-bottom:2px solid #008489}.DateInput_input__disabled{background:#f2f2f2;font-style:italic}.DateInput_screenReaderMessage{border:0;clip:rect(0,0,0,0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px}.DateInput_fang{position:absolute;width:20px;height:10px;left:22px;z-index:2}.DateInput_fangShape{fill:#fff}.DateInput_fangStroke{stroke:#dbdbdb;fill:transparent}amp-date-picker[mode=overlay] .i-amphtml-date-picker-container{position:absolute;top:calc(100% + 10px);left:10px;z-index:10}.i-amphtml-date-picker-fullscreen .i-amphtml-date-picker-container{position:absolute;top:0;right:0;bottom:0;left:0}.i-amphtml-date-picker-fullscreen .DayPicker_weekHeader{top:0;padding:40px 0 5px}.i-amphtml-date-picker-fullscreen .CalendarMonth{margin-bottom:38px}.i-amphtml-date-picker-fullscreen .CalendarMonth_caption{margin:0 -30px 10px}.i-amphtml-date-picker-fullscreen .CalendarMonthGrid{padding-top:70px}amp-date-picker input::-webkit-calendar-picker-indicator{display:none}.amp-date-picker-calendar-container *{box-sizing:border-box}.amp-date-picker-calendar-container{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif}.DateInput_input{font-size:100%}.CalendarMonth_caption{font-weight:lighter;margin:0 -30px 38px;padding-bottom:20px;background-color:#000;color:#fff}.CalendarMonth_caption>*{font-weight:lighter}.DayPicker_weekHeader{top:75px}.i-amphtml-default-week-day-format .DayPicker_weekHeader li:first-letter{font-size:small}.i-amphtml-default-week-day-format .DayPicker_weekHeader li{font-size:0}.DayPicker{background:#fdfdfd}.DayPicker__withBorder{background-color:#fdfdfd;border:1px solid rgba(0,0,0,0.07);box-shadow:none;overflow:hidden}amp-lightbox .DayPicker__withBorder{border:0}amp-date-picker[mode=overlay] .DayPicker__withBorder{box-shadow:0 2px 6px rgba(0,0,0,0.05),0 0 0 1px rgba(0,0,0,0.07);border:0}.CalendarMonth,.CalendarMonthGrid{background-color:transparent}.CalendarDay__highlighted_calendar,.CalendarDay__highlighted_calendar:hover{background-color:#fff;border:1px solid transparent}.CalendarDay__default,.CalendarDay_container{background-color:transparent;border:1px solid transparent}.CalendarDay__default:hover,.CalendarDay_container:hover{background-color:#e4e7e7;border:1px solid #e4e7e7}.CalendarDay__blocked_calendar{border:1px solid #cacccd;background-color:#cacccd}amp-date-picker:not([allow-blocked-ranges]) .CalendarDay__blocked_calendar.CalendarDay__hovered_span{background-color:#ff8080;border:1px solid #ff8080}.CalendarDay__blocked_out_of_range,.CalendarDay__blocked_out_of_range:active,.CalendarDay__blocked_out_of_range:hover{color:rgb(0,0,0,.1);border:1px solid transparent;background:transparent}.CalendarDay__hovered_span,.CalendarDay__hovered_span:hover,.CalendarDay__selected_span,.CalendarDay__selected_span:active,.CalendarDay__selected_span:hover{background-color:#9bbbdd;border:1px solid #9bbbdd;color:#000}.CalendarDay__selected,.CalendarDay__selected:active,.CalendarDay__selected:hover,.CalendarDay__selected_start{background-color:#0654ab;border:1px solid #0654ab;color:#fff}.DayPickerNavigation_leftButton__horizontal,.DayPickerNavigation_leftButton__horizontal:active{background-image:url(\\\"data:image/svg+xml;charset=utf-8,%3Csvg width='16' height='25' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='%23fff' d='m15.7 22-9.5-9.5L15.7 3l-3-3L.4 12.6 12.8 25'/%3E%3C/svg%3E\\\")}.DayPickerNavigation_rightButton__horizontal,.DayPickerNavigation_rightButton__horizontal:active{background-image:url(\\\"data:image/svg+xml;charset=utf-8,%3Csvg width='16' height='25' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='%23fff' d='m.3 3 9.5 9.5L.3 22l3 3 12.4-12.5L3.2 0'/%3E%3C/svg%3E\\\")}.DayPickerNavigation_button__horizontal,.DayPickerNavigation_button__horizontal:active,.DayPickerNavigation_button__horizontal:hover{border:0;background-color:transparent;background-repeat:no-repeat;background-position:55% 50%;height:30px;width:26px;background-size:13px 20px}.DayPickerNavigation_svg__horizontal{display:none}.DateInput_fangShape{fill:#000}.DayPickerKeyboardShortcuts_show,.DayPickerKeyboardShortcuts_show:hover{border:2px solid #0654ab;border-radius:50%;color:#0654ab;width:22px;height:22px;margin:10px}.DayPickerKeyboardShortcuts_show:hover{border:2px solid #9bbbdd}.DayPickerKeyboardShortcuts_show:hover .DayPickerKeyboardShortcuts_showSpan{color:#9bbbdd}.DayPickerKeyboardShortcuts_showSpan{position:static;color:#0654ab;font-weight:700}.CalendarDay__highlighted_calendar,.CalendarDay__highlighted_calendar:hover{background-image:radial-gradient(circle at 50% 82%,#0654ab 0px,#0654ab 2px,transparent 3px,transparent 100%)}.CalendarDay__selected.CalendarDay__highlighted_calendar{background-image:radial-gradient(circle at 50% 82%,#fff 0px,#fff 2px,transparent 3px,transparent 100%)}.CalendarDay__blocked_out_of_range.CalendarDay__highlighted_calendar:after{background-image:radial-gradient(circle at 50% 82%,rgba(0,0,0,0.1) 0px,rgba(0,0,0,0.1) 2px,transparent 3px,transparent 100%)}.i-amphtml-date-picker-info{display:block;padding:10px}.amp-date-picker-resize-bug .DayPicker_transitionContainer{min-height:354px;max-width:100%;border-radius:0}\\n/*# sourceURL=/extensions/amp-date-picker/0.1/amp-date-picker.css*/\";\n", "import {map} from '#core/types/object';\n\n/**\n * @template T\n */\nexport class LruCache {\n  /**\n   * @param {number} capacity\n   */\n  constructor(capacity) {\n    /** @private @const {number} */\n    this.capacity_ = capacity;\n\n    /** @private {number} */\n    this.size_ = 0;\n\n    /**\n     * An incrementing counter to define the last access.\n     * @private {number}\n     */\n    this.access_ = 0;\n\n    /** @private {!Object<(number|string), {payload: T, access: number}>} */\n    this.cache_ = map();\n  }\n\n  /**\n   * Returns whether key is cached.\n   *\n   * @param {number|string} key\n   * @return {boolean}\n   */\n  has(key) {\n    return !!this.cache_[key];\n  }\n\n  /**\n   * @param {number|string} key\n   * @return {T} The cached payload.\n   */\n  get(key) {\n    const cacheable = this.cache_[key];\n    if (cacheable) {\n      cacheable.access = ++this.access_;\n      return cacheable.payload;\n    }\n    return undefined;\n  }\n\n  /**\n   * @param {number|string} key\n   * @param {T} payload The payload to cache.\n   */\n  put(key, payload) {\n    if (!this.has(key)) {\n      this.size_++;\n    }\n    this.cache_[key] = {payload, access: this.access_};\n    this.evict_();\n  }\n\n  /**\n   * Evicts the oldest cache entry, if we've exceeded capacity.\n   */\n  evict_() {\n    if (this.size_ <= this.capacity_) {\n      return;\n    }\n\n    const cache = this.cache_;\n    let oldest = this.access_ + 1;\n    let oldestKey;\n    for (const key in cache) {\n      const {access} = cache[key];\n      if (access < oldest) {\n        oldest = access;\n        oldestKey = key;\n      }\n    }\n\n    if (oldestKey !== undefined) {\n      delete cache[oldestKey];\n      this.size_--;\n    }\n  }\n}\n", "import {LruCache} from '#core/data-structures/lru-cache';\nimport * as mode from '#core/mode';\nimport {arrayOrSingleItemToArray} from '#core/types/array';\nimport {dict, hasOwn} from '#core/types/object';\nimport {endsWith} from '#core/types/string';\nimport {parseQueryString} from '#core/types/string/url';\n\nimport {userAssert} from '#utils/log';\n\nimport {urls} from './config';\n\nconst SERVING_TYPE_PREFIX = new Set([\n  // No viewer\n  'c',\n  // In viewer\n  'v',\n  // Ad landing page\n  'a',\n  // Ad\n  'ad',\n]);\n\n/**\n * Cached a-tag to avoid memory allocation during URL parsing.\n * @type {HTMLAnchorElement}\n */\nlet cachedAnchorEl;\n\n/**\n * We cached all parsed URLs. As of now there are no use cases\n * of AMP docs that would ever parse an actual large number of URLs,\n * but we often parse the same one over and over again.\n * @type {LruCache}\n */\nlet urlCache;\n\n// eslint-disable-next-line no-script-url\nconst INVALID_PROTOCOLS = ['javascript:', 'data:', 'vbscript:'];\n\n/** @const {string} */\nexport const SOURCE_ORIGIN_PARAM = '__amp_source_origin';\n\n/**\n * Coerces a url into a location;\n * @function\n * @param {string|!Location} url\n * @return {!Location}\n */\nconst urlAsLocation = (url) =>\n  typeof url == 'string' ? parseUrlDeprecated(url) : url;\n\n/**\n * Returns the correct origin for a given window.\n * TODO(rcebulko): This really belongs under #core/window somewhere, not in url\n * @param {!Window} win\n * @return {string} origin\n */\nexport function getWinOrigin(win) {\n  return win.origin || parseUrlDeprecated(win.location.href).origin;\n}\n\n/**\n * Returns a Location-like object for the given URL. If it is relative,\n * the URL gets resolved.\n * Consider the returned object immutable. This is enforced during\n * testing by freezing the object.\n * TODO(#34453): The URL constructor isn't supported in IE11, but is supported\n * everywhere else. There's a lot of code paths (and all uses of the LruCache)\n * that are built around this polyfill. Once we can drop IE11 support and just\n * use the URL constructor, we can clear out all of parseWithA, all the URL\n * cache logic (incl. additional caches in other call-sites). Most is guarded by\n * isEsm() and is only included in nomodule builds, but still.\n * @param {string} url\n * @param {boolean=} opt_nocache\n *   Cache is always ignored on ESM builds, see https://go.amp.dev/pr/31594\n * @return {!Location}\n */\nexport function parseUrlDeprecated(url, opt_nocache) {\n  if (!cachedAnchorEl) {\n    cachedAnchorEl = /** @type {!HTMLAnchorElement} */ (\n      self.document.createElement('a')\n    );\n    urlCache = mode.isEsm()\n      ? null\n      : self.__AMP_URL_CACHE || (self.__AMP_URL_CACHE = new LruCache(100));\n  }\n\n  return parseUrlWithA(\n    cachedAnchorEl,\n    url,\n    mode.isEsm() || opt_nocache ? null : urlCache\n  );\n}\n\n/**\n * Returns a Location-like object for the given URL. If it is relative,\n * the URL gets resolved.\n * Consider the returned object immutable. This is enforced during\n * testing by freezing the object.\n * @param {!HTMLAnchorElement} anchorEl\n * @param {string} url\n * @param {LruCache=} opt_cache\n *   Cache is always ignored on ESM builds, see https://go.amp.dev/pr/31594\n * @return {!Location}\n * @restricted\n */\nexport function parseUrlWithA(anchorEl, url, opt_cache) {\n  if (mode.isEsm()) {\n    // Doing this causes the <a> to auto-set its own href to the resolved path,\n    // which would be the baseUrl for the URL constructor.\n    anchorEl.href = '';\n    return /** @type {?} */ (new URL(url, anchorEl.href));\n  }\n\n  if (opt_cache && opt_cache.has(url)) {\n    return opt_cache.get(url);\n  }\n\n  anchorEl.href = url;\n\n  // IE11 doesn't provide full URL components when parsing relative URLs.\n  // Assigning to itself again does the trick #3449.\n  if (!anchorEl.protocol) {\n    anchorEl.href = anchorEl.href;\n  }\n\n  const info = /** @type {!Location} */ ({\n    href: anchorEl.href,\n    protocol: anchorEl.protocol,\n    host: anchorEl.host,\n    hostname: anchorEl.hostname,\n    port: anchorEl.port == '0' ? '' : anchorEl.port,\n    pathname: anchorEl.pathname,\n    search: anchorEl.search,\n    hash: anchorEl.hash,\n    origin: null, // Set below.\n  });\n\n  // Some IE11 specific polyfills.\n  // 1) IE11 strips out the leading '/' in the pathname.\n  if (info.pathname[0] !== '/') {\n    info.pathname = '/' + info.pathname;\n  }\n\n  // 2) For URLs with implicit ports, IE11 parses to default ports while\n  // other browsers leave the port field empty.\n  if (\n    (info.protocol == 'http:' && info.port == 80) ||\n    (info.protocol == 'https:' && info.port == 443)\n  ) {\n    info.port = '';\n    info.host = info.hostname;\n  }\n\n  // For data URI anchorEl.origin is equal to the string 'null' which is not useful.\n  // We instead return the actual origin which is the full URL.\n  let origin;\n  if (anchorEl.origin && anchorEl.origin != 'null') {\n    origin = anchorEl.origin;\n  } else if (info.protocol == 'data:' || !info.host) {\n    origin = info.href;\n  } else {\n    origin = info.protocol + '//' + info.host;\n  }\n  info.origin = origin;\n\n  // Freeze during testing to avoid accidental mutation.\n  const frozen = mode.isTest() && Object.freeze ? Object.freeze(info) : info;\n\n  if (opt_cache) {\n    opt_cache.put(url, frozen);\n  }\n\n  return frozen;\n}\n\n/**\n * Appends the string just before the fragment part (or optionally\n * to the front of the query string) of the URL.\n * @param {string} url\n * @param {string} paramString\n * @param {boolean=} opt_addToFront\n * @return {string}\n */\nexport function appendEncodedParamStringToUrl(\n  url,\n  paramString,\n  opt_addToFront\n) {\n  if (!paramString) {\n    return url;\n  }\n  const mainAndFragment = url.split('#', 2);\n  const mainAndQuery = mainAndFragment[0].split('?', 2);\n\n  let newUrl =\n    mainAndQuery[0] +\n    (mainAndQuery[1]\n      ? opt_addToFront\n        ? `?${paramString}&${mainAndQuery[1]}`\n        : `?${mainAndQuery[1]}&${paramString}`\n      : `?${paramString}`);\n  newUrl += mainAndFragment[1] ? `#${mainAndFragment[1]}` : '';\n  return newUrl;\n}\n\n/**\n * @param {string} key\n * @param {string} value\n * @return {string}\n */\nfunction urlEncodeKeyValue(key, value) {\n  return `${encodeURIComponent(key)}=${encodeURIComponent(value)}`;\n}\n\n/**\n * Appends a query string field and value to a url. `key` and `value`\n * will be ran through `encodeURIComponent` before appending.\n * @param {string} url\n * @param {string} key\n * @param {string} value\n * @param {boolean=} opt_addToFront\n * @return {string}\n */\nexport function addParamToUrl(url, key, value, opt_addToFront) {\n  return appendEncodedParamStringToUrl(\n    url,\n    urlEncodeKeyValue(key, value),\n    opt_addToFront\n  );\n}\n\n/**\n * Appends query string fields and values to a url. The `params` objects'\n * `key`s and `value`s will be transformed into query string keys/values.\n * @param {string} url\n * @param {!JsonObject<string, string|!Array<string>>} params\n * @return {string}\n */\nexport function addParamsToUrl(url, params) {\n  return appendEncodedParamStringToUrl(url, serializeQueryString(params));\n}\n\n/**\n * Append query string fields and values to a url, only if the key does not\n * exist in current query string.\n * @param {string} url\n * @param {!JsonObject<string, string|!Array<string>>} params\n * @return {string}\n */\nexport function addMissingParamsToUrl(url, params) {\n  const location = parseUrlDeprecated(url);\n  const existingParams = parseQueryString(location.search);\n  const paramsToAdd = dict({});\n  const keys = Object.keys(params);\n  for (let i = 0; i < keys.length; i++) {\n    if (!hasOwn(existingParams, keys[i])) {\n      paramsToAdd[keys[i]] = params[keys[i]];\n    }\n  }\n  return addParamsToUrl(url, paramsToAdd);\n}\n\n/**\n * Serializes the passed parameter map into a query string with both keys\n * and values encoded.\n * @param {!JsonObject<string, string|!Array<string>>} params\n * @return {string}\n */\nexport function serializeQueryString(params) {\n  const s = [];\n  for (const k in params) {\n    let v = params[k];\n    if (v == null) {\n      continue;\n    }\n\n    v = arrayOrSingleItemToArray(v);\n    for (let i = 0; i < v.length; i++) {\n      s.push(urlEncodeKeyValue(k, v[i]));\n    }\n  }\n  return s.join('&');\n}\n\n/**\n * Returns `true` if the URL is secure: either HTTPS or localhost (for testing).\n * @param {string|!Location} url\n * @return {boolean}\n */\nexport function isSecureUrlDeprecated(url) {\n  url = urlAsLocation(url);\n  return (\n    url.protocol == 'https:' ||\n    url.hostname == 'localhost' ||\n    url.hostname == '127.0.0.1' ||\n    endsWith(url.hostname, '.localhost')\n  );\n}\n\n/**\n * Asserts that a given url is HTTPS or protocol relative. It's a user-level\n * assert.\n *\n * Provides an exception for localhost.\n *\n * @param {?string|undefined} urlString\n * @param {!Element|string} elementContext Element where the url was found.\n * @param {string=} sourceName Used for error messages.\n * @return {string}\n */\nexport function assertHttpsUrl(\n  urlString,\n  elementContext,\n  sourceName = 'source'\n) {\n  userAssert(\n    urlString != null,\n    '%s %s must be available',\n    elementContext,\n    sourceName\n  );\n  userAssert(\n    isSecureUrlDeprecated(urlString) || /^\\/\\//.test(urlString),\n    '%s %s must start with ' +\n      '\"https://\" or \"//\" or be relative and served from ' +\n      'either https or from localhost. Invalid value: %s',\n    elementContext,\n    sourceName,\n    urlString\n  );\n  return urlString;\n}\n\n/**\n * Asserts that a given url is an absolute HTTP or HTTPS URL.\n * @param {string} urlString\n * @return {string}\n */\nexport function assertAbsoluteHttpOrHttpsUrl(urlString) {\n  userAssert(\n    /^https?\\:/i.test(urlString),\n    'URL must start with \"http://\" or \"https://\". Invalid value: %s',\n    urlString\n  );\n  return parseUrlDeprecated(urlString).href;\n}\n\n/**\n * Returns the URL without fragment. If URL doesn't contain fragment, the same\n * string is returned.\n * @param {string} url\n * @return {string}\n */\nexport function removeFragment(url) {\n  const index = url.indexOf('#');\n  if (index == -1) {\n    return url;\n  }\n  return url.substring(0, index);\n}\n\n/**\n * Returns the fragment from the URL. If the URL doesn't contain fragment,\n * the empty string is returned.\n * @param {string} url\n * @return {string}\n */\nexport function getFragment(url) {\n  const index = url.indexOf('#');\n  if (index == -1) {\n    return '';\n  }\n  return url.substring(index);\n}\n\n/**\n * Returns whether the URL has the origin of a proxy.\n * @param {string|!Location} url URL of an AMP document.\n * @return {boolean}\n */\nexport function isProxyOrigin(url) {\n  return urls.cdnProxyRegex.test(urlAsLocation(url).origin);\n}\n\n/**\n * Returns whether the URL origin is localhost.\n * @param {string|!Location} url URL of an AMP document.\n * @return {boolean}\n */\nexport function isLocalhostOrigin(url) {\n  return urls.localhostRegex.test(urlAsLocation(url).origin);\n}\n\n/**\n * @param {string} uri\n * @return {boolean}\n */\nexport function isAmpScriptUri(uri) {\n  return uri.startsWith('amp-script:');\n}\n\n/**\n * For proxy-origin URLs, returns the serving type. Otherwise, returns null.\n * E.g., 'https://amp-com.cdn.ampproject.org/a/s/amp.com/amp_document.html'\n * returns 'a'.\n * @param {string|!Location} url URL of an AMP document.\n * @return {?string}\n */\nexport function getProxyServingType(url) {\n  url = urlAsLocation(url);\n  if (!isProxyOrigin(url)) {\n    return null;\n  }\n  const path = url.pathname.split('/', 2);\n  return path[1];\n}\n\n/**\n * Returns whether the URL has valid protocol.\n * Deep link protocol is valid, but not javascript etc.\n * @param {string|!Location} url\n * @return {boolean}\n */\nexport function isProtocolValid(url) {\n  return !(url && INVALID_PROTOCOLS.includes(urlAsLocation(url).protocol));\n}\n\n/**\n * Returns a URL without AMP JS parameters.\n * @param {string} url\n * @return {string}\n */\nexport function removeAmpJsParamsFromUrl(url) {\n  const {hash, origin, pathname, search} = parseUrlDeprecated(url);\n  const searchRemoved = removeAmpJsParamsFromSearch(search);\n  return origin + pathname + searchRemoved + hash;\n}\n\n/**\n * Returns a URL without a query string.\n * @param {string} url\n * @return {string}\n */\nexport function removeSearch(url) {\n  const index = url.indexOf('?');\n  if (index == -1) {\n    return url;\n  }\n  const fragment = getFragment(url);\n  return url.substring(0, index) + fragment;\n}\n\n/**\n * Removes parameters that start with amp js parameter pattern and returns the\n * new search string.\n * @param {string} urlSearch\n * @return {string}\n */\nfunction removeAmpJsParamsFromSearch(urlSearch) {\n  // The below regex is a combo of these original patterns. Combining these,\n  // removing the corresponding `.replace` calls, and reusing\n  // removeParamsFromSearch saves ~175B. Matches params in query string:\n  // - /[?&]amp_js[^&]*/   amp_js_*\n  // - /[?&]amp_gsa[^&]*/  amp_gsa\n  // - /[?&]amp_r[^&]*/    amp_r\n  // - /[?&]amp_kit[^&]*/  amp_kit\n  // - /[?&]usqp[^&]*/     usqp (from goog experiment)\n  return removeParamsFromSearch(urlSearch, '(amp_(js[^&=]*|gsa|r|kit)|usqp)');\n}\n\n/**\n * Removes parameters with param name and returns the new search string.\n * @param {string} urlSearch\n * @param {string} paramName\n * @return {string}\n */\nexport function removeParamsFromSearch(urlSearch, paramName) {\n  // TODO: Accept paramNames as an array.\n  if (!urlSearch || urlSearch == '?') {\n    return '';\n  }\n  const paramRegex = new RegExp(`[?&]${paramName}\\\\b[^&]*`, 'g');\n  const search = urlSearch.replace(paramRegex, '').replace(/^[?&]/, '');\n  return search ? '?' + search : '';\n}\n\n/**\n * Returns the source URL of an AMP document for documents served\n * on a proxy origin or directly.\n * @param {string|!Location} url URL of an AMP document.\n * @return {string}\n */\nexport function getSourceUrl(url) {\n  url = urlAsLocation(url);\n\n  // Not a proxy URL - return the URL itself.\n  if (!isProxyOrigin(url)) {\n    return url.href;\n  }\n\n  // A proxy URL.\n  // Example path that is being matched here.\n  // https://cdn.ampproject.org/c/s/www.origin.com/foo/\n  // The /s/ is optional and signals a secure origin.\n  const path = url.pathname.split('/');\n  const prefix = path[1];\n  userAssert(\n    SERVING_TYPE_PREFIX.has(prefix),\n    'Unknown path prefix in url %s',\n    url.href\n  );\n  const domainOrHttpsSignal = path[2];\n  const origin =\n    domainOrHttpsSignal == 's'\n      ? 'https://' + decodeURIComponent(path[3])\n      : 'http://' + decodeURIComponent(domainOrHttpsSignal);\n  // Sanity test that what we found looks like a domain.\n  userAssert(origin.indexOf('.') > 0, 'Expected a . in origin %s', origin);\n  path.splice(1, domainOrHttpsSignal == 's' ? 3 : 2);\n  return (\n    origin +\n    path.join('/') +\n    removeAmpJsParamsFromSearch(url.search) +\n    (url.hash || '')\n  );\n}\n\n/**\n * Returns the source origin of an AMP document for documents served\n * on a proxy origin or directly.\n * @param {string|!Location} url URL of an AMP document.\n * @return {string} The source origin of the URL.\n */\nexport function getSourceOrigin(url) {\n  return parseUrlDeprecated(getSourceUrl(url)).origin;\n}\n\n/**\n * Returns absolute URL resolved based on the relative URL and the base.\n * @param {string} relativeUrlString\n * @param {string|!Location} baseUrl\n * @return {string}\n */\nexport function resolveRelativeUrl(relativeUrlString, baseUrl) {\n  baseUrl = urlAsLocation(baseUrl);\n  if (mode.isEsm() || typeof URL == 'function') {\n    return new URL(relativeUrlString, baseUrl.href).toString();\n  }\n  return resolveRelativeUrlFallback_(relativeUrlString, baseUrl);\n}\n\n/**\n * Fallback for URL resolver when URL class is not available.\n * @param {string} relativeUrlString\n * @param {string|!Location} baseUrl\n * @return {string}\n * @private @visibleForTesting\n */\nexport function resolveRelativeUrlFallback_(relativeUrlString, baseUrl) {\n  baseUrl = urlAsLocation(baseUrl);\n  relativeUrlString = relativeUrlString.replace(/\\\\/g, '/');\n  const relativeUrl = parseUrlDeprecated(relativeUrlString);\n\n  // Absolute URL.\n  if (relativeUrlString.toLowerCase().startsWith(relativeUrl.protocol)) {\n    return relativeUrl.href;\n  }\n\n  // Protocol-relative URL.\n  if (relativeUrlString.startsWith('//')) {\n    return baseUrl.protocol + relativeUrlString;\n  }\n\n  // Absolute path.\n  if (relativeUrlString.startsWith('/')) {\n    return baseUrl.origin + relativeUrlString;\n  }\n\n  // Relative path.\n  return (\n    baseUrl.origin +\n    baseUrl.pathname.replace(/\\/[^/]*$/, '/') +\n    relativeUrlString\n  );\n}\n\n/**\n * Add \"__amp_source_origin\" query parameter to the URL.\n * @param {!Window} win\n * @param {string} url\n * @return {string}\n */\nexport function getCorsUrl(win, url) {\n  checkCorsUrl(url);\n  const sourceOrigin = getSourceOrigin(win.location.href);\n  return addParamToUrl(url, SOURCE_ORIGIN_PARAM, sourceOrigin);\n}\n\n/**\n * Checks if the url has __amp_source_origin and throws if it does.\n * @param {string} url\n */\nexport function checkCorsUrl(url) {\n  const parsedUrl = parseUrlDeprecated(url);\n  const query = parseQueryString(parsedUrl.search);\n  userAssert(\n    !(SOURCE_ORIGIN_PARAM in query),\n    'Source origin is not allowed in %s',\n    url\n  );\n}\n\n/**\n * Adds the path to the given url.\n *\n * @param {!Location} url\n * @param {string} path\n * @return {string}\n */\nexport function appendPathToUrl(url, path) {\n  const pathname = url.pathname.replace(/\\/?$/, '/') + path.replace(/^\\//, '');\n  return url.origin + pathname + url.search + url.hash;\n}\n", "import {getValueForExpr} from '#core/types/object';\n\nimport {Services} from '#service';\n\nimport {user} from '#utils/log';\n\nimport {assertHttpsUrl} from './url';\n\n/**\n * Detail of each `options` property:\n * expr - Dot-syntax reference to subdata of JSON result to return. If not specified,\n *     entire JSON result is returned.\n * urlReplacement - If ALL, replaces all URL vars. If OPT_IN, replaces allowlisted\n *     URL vars. Otherwise, don't expand.\n * refresh - Forces refresh of browser cache.\n * xssiPrefix - Prefix to optionally strip from the response before calling parseJson.\n *\n * @typedef {{\n *  expr:(string|undefined),\n *  urlReplacement: (UrlReplacementPolicy|undefined),\n *  refresh: (boolean|undefined),\n *  xssiPrefix: (string|undefined),\n * }}\n */\nexport let BatchFetchOptionsDef;\n\n/**\n * @enum {number}\n */\nexport const UrlReplacementPolicy = {\n  NONE: 0,\n  OPT_IN: 1,\n  ALL: 2,\n};\n\n/**\n * Batch fetches the JSON endpoint at the given element's `src` attribute.\n * Sets the fetch credentials option from the element's `credentials` attribute,\n * if it exists.\n *\n * @param {!./service/ampdoc-impl.AmpDoc} ampdoc\n * @param {!Element} element\n * @param {!BatchFetchOptionsDef} options options bag for modifying the request.\n * @return {!Promise<!JsonObject|!Array<JsonObject>>} Resolved with JSON\n *     result or rejected if response is invalid.\n */\nexport function batchFetchJsonFor(ampdoc, element, options = {}) {\n  const {\n    expr = '.',\n    urlReplacement = UrlReplacementPolicy.NONE,\n    refresh = false,\n    xssiPrefix = undefined,\n  } = options;\n  assertHttpsUrl(element.getAttribute('src'), element);\n  const xhr = Services.batchedXhrFor(ampdoc.win);\n  return requestForBatchFetch(element, urlReplacement, refresh)\n    .then((data) => {\n      return xhr.fetchJson(data.xhrUrl, data.fetchOpt);\n    })\n    .then((res) => Services.xhrFor(ampdoc.win).xssiJson(res, xssiPrefix))\n    .then((data) => {\n      if (data == null) {\n        throw new Error('Response is undefined.');\n      }\n      return getValueForExpr(data, expr || '.');\n    })\n    .catch((err) => {\n      throw user().createError('failed fetching JSON data', err);\n    });\n}\n\n/**\n * Handles url replacement and constructs the FetchInitJsonDef required for a\n * fetch.\n * @param {!Element} element\n * @param {!UrlReplacementPolicy} replacement If ALL, replaces all URL\n *     vars. If OPT_IN, replaces allowlisted URL vars. Otherwise, don't expand.\n * @param {boolean} refresh Forces refresh of browser cache.\n * @return {!Promise<!FetchRequestDef>}\n */\nexport function requestForBatchFetch(element, replacement, refresh) {\n  const url = element.getAttribute('src');\n\n  // Replace vars in URL if desired.\n  const urlReplacements = Services.urlReplacementsForDoc(element);\n  const promise =\n    replacement >= UrlReplacementPolicy.OPT_IN\n      ? urlReplacements.expandUrlAsync(url)\n      : Promise.resolve(url);\n\n  return promise.then((xhrUrl) => {\n    // Throw user error if this element is performing URL substitutions\n    // without the soon-to-be-required opt-in (#12498).\n    if (replacement == UrlReplacementPolicy.OPT_IN) {\n      const invalid = urlReplacements.collectDisallowedVarsSync(element);\n      if (invalid.length > 0) {\n        throw user().createError(\n          'URL variable substitutions in CORS ' +\n            'fetches from dynamic URLs (e.g. via amp-bind) require opt-in. ' +\n            `Please add data-amp-replace=\"${invalid.join(' ')}\" to the ` +\n            `<${element.tagName}> element. See https://bit.ly/amp-var-subs.`\n        );\n      }\n    }\n    const fetchOpt = {};\n    if (element.hasAttribute('credentials')) {\n      fetchOpt.credentials = element.getAttribute('credentials');\n    }\n    // https://hacks.mozilla.org/2016/03/referrer-and-cache-control-apis-for-fetch/\n    if (refresh) {\n      fetchOpt.cache = 'reload';\n    }\n    return {'xhrUrl': xhrUrl, 'fetchOpt': fetchOpt};\n  });\n}\n", "import {ActionTrust} from '#core/constants/action-constants';\nimport {AmpEvents} from '#core/constants/amp-events';\nimport {Keys} from '#core/constants/key-codes';\nimport {FiniteStateMachine} from '#core/data-structures/finite-state-machine';\nimport {Deferred} from '#core/data-structures/promise';\nimport {isRTL, iterateCursor, tryFocus} from '#core/dom';\nimport {escapeCssSelectorIdent} from '#core/dom/css-selectors';\nimport {Layout, isLayoutSizeDefined} from '#core/dom/layout';\nimport {\n  closestAncestorElementBySelector,\n  scopedQuerySelector,\n} from '#core/dom/query';\nimport {computedStyle} from '#core/dom/style';\nimport {once} from '#core/types/function';\nimport {dict, map} from '#core/types/object';\nimport {dashToCamelCase} from '#core/types/string';\n\nimport {Services} from '#service';\n\nimport {createCustomEvent, listen} from '#utils/event-helper';\nimport {dev, devAssert, user, userAssert} from '#utils/log';\n\nimport {DEFAULT_FORMAT, DEFAULT_LOCALE, FORMAT_STRINGS} from './constants';\nimport {createDateRangePicker} from './date-range-picker';\nimport {DatesList} from './dates-list';\nimport {createDeferred} from './react-utils';\nimport {createSingleDatePicker} from './single-date-picker';\n\nimport {CSS} from '../../../build/amp-date-picker-0.1.css';\nimport {batchFetchJsonFor} from '../../../src/batched-json';\nimport {requireExternal} from '../../../src/module';\n\n/**\n * @typedef {{\n *   dates: !DatesList,\n *   template: Element\n * }}\n */\nlet DateTemplateMapDef;\n\n/** @dict @extends {JsonObject} */\nclass BindDateDetails {\n  /**\n   * @param {string} date\n   * @param {?string} id\n   */\n  constructor(date, id) {\n    /** @const */\n    this['date'] = date;\n\n    /** @const */\n    this['id'] = id;\n  }\n}\n\n/** @dict @extends {JsonObject} */\nclass BindDatesDetails {\n  /**\n   * @param {!Array<!BindDateDetails>} dates\n   */\n  constructor(dates) {\n    /** @const */\n    this['dates'] = dates;\n\n    /** @const */\n    this['start'] = map(dates[0]);\n\n    /** @const */\n    this['end'] = map(dates[dates.length - 1]);\n  }\n}\n\nconst TAG = 'amp-date-picker';\nconst DATE_SEPARATOR = ' ';\n\nconst attributesToForward = [\n  'month-format',\n  'number-of-months',\n  'minimum-nights',\n  'maximum-nights',\n  'hide-keyboard-shortcuts-panel',\n];\n\n/** @enum {string} */\nconst DatePickerMode = {\n  STATIC: 'static',\n  OVERLAY: 'overlay',\n};\n\n/**\n * @enum {string}\n * @private visible for testing\n */\nexport const DatePickerState = {\n  OVERLAY_CLOSED: 'overlay-closed',\n  OVERLAY_OPEN_INPUT: 'overlay-open-input',\n  OVERLAY_OPEN_PICKER: 'overlay-open-picker',\n  STATIC: 'static',\n};\n\n/** @enum {string} */\nconst DatePickerType = {\n  SINGLE: 'single',\n  RANGE: 'range',\n};\n\n/** @enum {string} */\nconst DateFieldType = {\n  DATE: 'input',\n  START_DATE: 'start-input',\n  END_DATE: 'end-input',\n};\n\nconst DateFieldNameByType = {\n  [DateFieldType.DATE]: 'date',\n  [DateFieldType.START_DATE]: 'start-date',\n  [DateFieldType.END_DATE]: 'end-date',\n};\n\n/** @enum {string} */\nconst DatePickerEvent = {\n  /**\n   * Triggered when the overlay opens or when the static date picker should\n   * receive focus from the attached input.\n   */\n  ACTIVATE: 'activate',\n\n  /**\n   * Triggered when the overlay closes or when the static date picker has\n   * finished selecting.\n   */\n  DEACTIVATE: 'deactivate',\n\n  /** Triggered when the user selects a date range. */\n  SELECT: 'select',\n};\n\n/**\n * The size in PX of each calendar day. This value allows the date picker to\n * fit within a 320px wide viewport when fully rendered.\n */\nconst DEFAULT_DAY_SIZE = 39;\n\n/**\n * This is related to a bug in preact-compat impacting 'react-dates' rendering.\n * NOTE: If this is updated, make sure to change .DayPicker_tranitionContainer\n * min-height in amp-date-picker.css\n * TODO(cvializ): remove this when #13897 is fixed.\n */\nconst DEFAULT_TRANSITION_CONTAINER_MIN_HEIGHT = '354px';\n\n/**\n * TODO(cvializ): remove this when #13897 is fixed.\n */\nconst RESIZE_BUG_CSS = 'amp-date-picker-resize-bug';\n\nconst TRANSITION_CONTAINER_SELECTOR = `.${RESIZE_BUG_CSS} .DayPicker_transitionContainer`;\n\nconst DEFAULT_FIRST_DAY_OF_WEEK = 0; // Sunday\n\nconst DEFAULT_WEEK_DAY_FORMAT_CSS = 'i-amphtml-default-week-day-format';\n\nconst DEFAULT_WEEK_DAY_FORMAT = 'dd';\n\nconst INPUT_FOCUS_CSS = 'amp-date-picker-selecting';\n\nconst CALENDAR_CONTAINER_CSS = 'i-amphtml-date-picker-container';\n\nconst PRIVATE_CALENDAR_CONTAINER_CSS = 'amp-date-picker-calendar-container';\n\nconst INFO_TEMPLATE_AREA_CSS = 'i-amphtml-date-picker-info';\n\nconst FULLSCREEN_CSS = 'i-amphtml-date-picker-fullscreen';\n\nconst MIN_PICKER_YEAR = 1900;\n\nconst AMP_READONLY_DATA_ATTR = 'iAmphtmlReadonly';\n\nconst AMP_DATE_BLUR_DATA_ATTR = 'iAmphtmlDateBlur';\n\nexport class AmpDatePicker extends AMP.BaseElement {\n  /** @param {!AmpElement} element */\n  constructor(element) {\n    super(element);\n\n    /** @private @const */\n    this.document_ = this.element.ownerDocument;\n\n    /** @private @const */\n    this.moment_ = requireExternal('moment');\n\n    /** @private @const */\n    this.react_ = requireExternal('react');\n    if (this.react_.options) {\n      this.react_.options.syncComponentUpdates = false;\n    }\n\n    /**\n     * @private\n     * @const\n     */\n    this.reactRender_ = requireExternal('react-dom').render;\n\n    /** @private @const */\n    this.ReactDates_ = /** @type {!JsonObject} */ (\n      requireExternal('react-dates')\n    );\n\n    /**\n     * @private\n     * @const\n     * @dict\n     */\n    this.ReactDatesConstants_ = /** @type {!JsonObject} */ (\n      requireExternal('react-dates/constants')\n    );\n\n    /** @private {?../../../src/service/action-impl.ActionService} */\n    this.action_ = null;\n\n    /** @private {?../../../src/service/template-impl.Templates} */\n    this.templates_ = null;\n\n    /** @private @const */\n    this.input_ = Services.inputFor(this.win);\n\n    /** @const */\n    this.onDateChange = this.onDateChange.bind(this);\n\n    /** @const */\n    this.onDatesChange = this.onDatesChange.bind(this);\n\n    /** @const */\n    this.onFocusChange = this.onFocusChange.bind(this);\n\n    /** @const */\n    this.onMount = this.onMount.bind(this);\n\n    /** @const */\n    this.renderInfo = this.renderInfo.bind(this);\n\n    /** @const */\n    this.renderDay = this.renderDay_.bind(this);\n\n    /** @private {?Promise<string>} */\n    this.infoTemplatePromise_ = null;\n\n    /** @private {string} */\n    this.format_ = DEFAULT_FORMAT;\n\n    /** @private */\n    this.firstDayOfWeek_ = DEFAULT_FIRST_DAY_OF_WEEK;\n\n    /** @private */\n    this.daySize_ = DEFAULT_DAY_SIZE;\n\n    /** @private */\n    this.blocked_ = new DatesList([]);\n\n    /** @private */\n    this.highlighted_ = new DatesList([]);\n\n    /** @private */\n    this.type_ = DatePickerType.SINGLE;\n\n    /** @private {?typeof React.Component} */\n    this.pickerClass_ = null;\n\n    /** @private {!DatePickerMode} */\n    this.mode_ = DatePickerMode.STATIC; // default\n\n    /** @private */\n    this.weekDayFormat_ = DEFAULT_WEEK_DAY_FORMAT;\n\n    /** @private */\n    this.allowBlockedRanges_ = false;\n\n    /** @private */\n    this.allowBlockedEndDate_ = false;\n\n    /** @private */\n    this.fullscreen_ = false;\n\n    /** @private */\n    this.openAfterClear_ = false;\n\n    /** @private */\n    this.openAfterSelect_ = false;\n\n    /** @private {!Array<!DateTemplateMapDef>} */\n    this.elementTemplates_ = [];\n\n    /** @private {!Array<!DateTemplateMapDef>} */\n    this.srcTemplates_ = [];\n\n    /** @private {?Element} */\n    this.srcDefaultTemplate_ = null;\n\n    /** @private {boolean} */\n    this.isRTL_ = false;\n\n    /** @private {?function(?):?} */\n    this.templateThen_ = null;\n\n    /** @private {?Element} */\n    this.startDateField_ = null;\n\n    /** @private {?Element} */\n    this.endDateField_ = null;\n\n    /** @private {?Element} */\n    this.dateField_ = null;\n\n    /** @private @const */\n    this.container_ = this.document_.createElement('div');\n    this.container_.classList.add(\n      CALENDAR_CONTAINER_CSS,\n      PRIVATE_CALENDAR_CONTAINER_CSS,\n      RESIZE_BUG_CSS\n    );\n\n    /** @private */\n    this.renderedTemplates_ = dict();\n\n    const deferred = new Deferred();\n\n    /** @private {!Promise} */\n    this.templatesReadyPromise_ = deferred.promise;\n\n    /** @private {?function()} */\n    this.templatesReadyResolver_ = deferred.resolve;\n\n    /** @private @const {!Array<!UnlistenDef>} */\n    this.unlisteners_ = [];\n\n    /** @private {?FiniteStateMachine} visible for testing */\n    this.stateMachine_ = null;\n\n    /** @private */\n    this.locale_ = DEFAULT_LOCALE;\n\n    /** @private {?JsonObject} */\n    this.props_ = null;\n\n    /** @private {?JsonObject} */\n    this.state_ = null;\n\n    /** @private @const */\n    this.warnDaySizeOnce_ = once(this.warnDaySize_.bind(this));\n  }\n\n  /** @override */\n  isLayoutSupported(layout) {\n    // NOTE: Layout.CONTAINER is only valid for mode=\"overlay\",\n    // but since element attributes are not guaranteed to be present until\n    // buildCallback is called, we cannot check the mode here.\n    return isLayoutSizeDefined(layout) || layout == Layout.CONTAINER;\n  }\n\n  /** @override */\n  buildCallback() {\n    this.templates_ = Services.templatesForDoc(this.element);\n\n    const format = this.element.getAttribute('format');\n    if (format) {\n      this.format_ = format;\n    }\n\n    const firstDayOfWeek = this.element.getAttribute('first-day-of-week');\n    if (firstDayOfWeek) {\n      this.firstDayOfWeek_ = Number(firstDayOfWeek);\n    }\n\n    const daySize = this.element.getAttribute('day-size');\n    if (daySize) {\n      this.daySize_ = Number(daySize);\n    }\n\n    const blocked = this.element.getAttribute('blocked');\n    if (blocked) {\n      this.blocked_ = new DatesList(blocked.split(DATE_SEPARATOR));\n    }\n\n    const highlighted = this.element.getAttribute('highlighted');\n    if (highlighted) {\n      this.highlighted_ = new DatesList(highlighted.split(DATE_SEPARATOR));\n    }\n\n    const type = this.element.getAttribute('type');\n    if (type) {\n      this.type_ = type;\n    }\n\n    this.pickerClass_ =\n      this.type_ === DatePickerType.RANGE\n        ? createDateRangePicker()\n        : createSingleDatePicker(); // default\n\n    const mode = this.element.getAttribute('mode');\n    if (mode) {\n      this.mode_ = /** @type {!DatePickerMode} */ (mode);\n    }\n\n    this.weekDayFormat_ =\n      this.element.getAttribute('week-day-format') || DEFAULT_WEEK_DAY_FORMAT;\n\n    this.allowBlockedRanges_ = this.element.hasAttribute(\n      'allow-blocked-ranges'\n    );\n\n    this.allowBlockedEndDate_ = this.element.hasAttribute(\n      'allow-blocked-end-date'\n    );\n\n    this.fullscreen_ = this.element.hasAttribute('fullscreen');\n    if (this.fullscreen_) {\n      userAssert(\n        this.mode_ == DatePickerMode.STATIC,\n        'amp-date-picker mode must be \"static\" to use fullscreen attribute'\n      );\n    }\n\n    this.openAfterClear_ = this.element.hasAttribute('open-after-clear');\n\n    this.openAfterSelect_ = this.element.hasAttribute('open-after-select');\n\n    this.elementTemplates_ = this.parseElementTemplates_(\n      this.element.querySelectorAll('[date-template][dates]')\n    );\n\n    this.locale_ = this.element.getAttribute('locale');\n    this.moment_.locale(this.locale_);\n\n    this.action_ = Services.actionServiceForDoc(this.element);\n\n    this.isRTL_ = isRTL(this.win.document);\n\n    if (this.type_ === DatePickerType.SINGLE) {\n      this.dateField_ = this.setupDateField_(DateFieldType.DATE);\n      if (this.mode_ == DatePickerMode.OVERLAY && this.dateField_ === null) {\n        user().error(\n          TAG,\n          'Overlay single pickers must specify \"input-selector\" to ' +\n            'an existing input element.'\n        );\n      }\n    } else if (this.type_ === DatePickerType.RANGE) {\n      this.startDateField_ = this.setupDateField_(DateFieldType.START_DATE);\n      this.endDateField_ = this.setupDateField_(DateFieldType.END_DATE);\n\n      if (\n        this.mode_ == DatePickerMode.OVERLAY &&\n        (!this.startDateField_ || !this.endDateField_)\n      ) {\n        user().error(\n          TAG,\n          'Overlay range pickers must \"start-input-selector\" and ' +\n            '\"end-input-selector\" to existing start and end input elements.'\n        );\n      }\n    } else {\n      user().error(TAG, 'Invalid date picker type', this.type_);\n    }\n\n    const initialState =\n      this.mode_ == DatePickerMode.OVERLAY\n        ? DatePickerState.OVERLAY_CLOSED\n        : DatePickerState.STATIC;\n    this.stateMachine_ = this.setupStateMachine_(initialState);\n\n    this.props_ = this.getProps_();\n\n    this.registerAction('setDate', (invocation) =>\n      this.handleSetDateFromString_(invocation.args['date'])\n    );\n    this.registerAction('setDates', (invocation) =>\n      this.handleSetDatesFromString_(\n        invocation.args['startDate'],\n        invocation.args['endDate']\n      )\n    );\n    this.registerAction('clear', () => this.handleClear_());\n    this.registerAction(\n      'today',\n      this.todayAction_.bind(this, (d) => this.handleSetDate_(d))\n    );\n    this.registerAction(\n      'startToday',\n      this.todayAction_.bind(this, (d) => this.handleSetDates_(d, null))\n    );\n    this.registerAction(\n      'endToday',\n      this.todayAction_.bind(this, (d) => this.handleSetDates_(null, d))\n    );\n\n    return this.mutateElement(() => {\n      // NOTE(cvializ): There is no standard date format for just the first\n      // letter of the week-day. So we hack it in with this CSS class and don't\n      // apply the CSS class if there is a week-day-format specified.\n      this.element.classList.toggle(\n        DEFAULT_WEEK_DAY_FORMAT_CSS,\n        this.weekDayFormat_ == DEFAULT_WEEK_DAY_FORMAT\n      );\n      this.element.classList.toggle(FULLSCREEN_CSS, this.fullscreen_);\n      this.element.appendChild(this.container_);\n      this.state_ = this.getInitialState_();\n      this.render(this.state_);\n    });\n  }\n\n  /** @override */\n  mutatedAttributesCallback(mutations) {\n    const newState = dict();\n\n    const min = mutations['min'];\n    if (min !== undefined) {\n      newState['min'] = min;\n    }\n\n    const max = mutations['max'];\n    if (max !== undefined) {\n      newState['max'] = max;\n    }\n\n    let p = null;\n    const src = mutations['src'];\n    if (src !== undefined) {\n      this.clearRenderedTemplates_();\n      this.cleanupSrcTemplates_();\n\n      p = this.setupSrcAttributes_();\n      this.setupTemplates_();\n    }\n\n    return Promise.resolve(p).then(() => this.setState_(newState));\n  }\n\n  /** @override */\n  layoutCallback() {\n    const srcAttributesPromise = this.setupSrcAttributes_();\n    this.setupTemplates_();\n    this.setupListeners_();\n\n    if (this.element.contains(this.document_.activeElement)) {\n      this.maybeTransitionWithFocusChange_(\n        dev().assertElement(this.document_.activeElement)\n      );\n    }\n\n    // Make sure it's rendered and measured properly. Then if possible, attempt\n    // to adjust expand the height to fit the element for static pickers.\n    return srcAttributesPromise\n      .then(() => {\n        return this.render(this.state_);\n      })\n      .then(() => {\n        if (this.mode_ == DatePickerMode.STATIC) {\n          this.measureElement(() => {\n            const scrollHeight = this.container_./*OK*/ scrollHeight;\n            const height = this.element./*OK*/ offsetHeight;\n            if (scrollHeight > height) {\n              // Add 1px to allow the bottom border to show\n              this.forceChangeHeight(scrollHeight + 1);\n            }\n          });\n        }\n      });\n  }\n\n  /** @override */\n  detachedCallback() {\n    this.cleanupListeners_();\n    this.cleanupSrcTemplates_();\n    this.clearRenderedTemplates_();\n  }\n\n  /**\n   * Configure the states and transitions in the state machine.\n   * @param {string} initialState\n   * @return {!FiniteStateMachine}\n   */\n  setupStateMachine_(initialState) {\n    const sm = new FiniteStateMachine(initialState);\n    const {OVERLAY_CLOSED, OVERLAY_OPEN_INPUT, OVERLAY_OPEN_PICKER, STATIC} =\n      DatePickerState;\n    const noop = () => {};\n    sm.addTransition(STATIC, STATIC, noop);\n\n    sm.addTransition(OVERLAY_CLOSED, OVERLAY_OPEN_INPUT, () => {\n      this.setState_(\n        dict({\n          'isOpen': true,\n          'isFocused': false,\n          'focused': false,\n        })\n      ).then(() => {\n        this.triggerEvent_(DatePickerEvent.ACTIVATE);\n      });\n    });\n    sm.addTransition(OVERLAY_CLOSED, OVERLAY_OPEN_PICKER, () => {\n      this.setState_(\n        dict({\n          'isOpen': true,\n          'isFocused': true,\n          'focused': true,\n        })\n      );\n    });\n    sm.addTransition(OVERLAY_CLOSED, OVERLAY_CLOSED, noop);\n\n    sm.addTransition(OVERLAY_OPEN_INPUT, OVERLAY_OPEN_PICKER, () => {\n      this.setState_(\n        dict({\n          'isOpen': true,\n          'isFocused': true,\n          'focused': true,\n        })\n      );\n    });\n    sm.addTransition(OVERLAY_OPEN_INPUT, OVERLAY_CLOSED, () => {\n      this.updateDateFieldFocus_(null);\n      this.setState_(\n        dict({\n          'isOpen': false,\n          'isFocused': false,\n          'focused': false,\n        })\n      );\n    });\n    sm.addTransition(OVERLAY_OPEN_INPUT, OVERLAY_OPEN_INPUT, noop);\n\n    sm.addTransition(OVERLAY_OPEN_PICKER, OVERLAY_OPEN_PICKER, noop);\n    sm.addTransition(OVERLAY_OPEN_PICKER, OVERLAY_OPEN_INPUT, () => {\n      this.setState_(\n        dict({\n          'isFocused': false,\n          'focused': false,\n        })\n      );\n    });\n    sm.addTransition(OVERLAY_OPEN_PICKER, OVERLAY_CLOSED, () => {\n      this.updateDateFieldFocus_(null);\n      this.setState_(\n        dict({\n          'isOpen': false,\n          'isFocused': false,\n          'focused': false,\n        })\n      );\n    });\n\n    return sm;\n  }\n\n  /**\n   * Helper method for transitioning states.\n   * @param {!DatePickerState} state\n   */\n  transitionTo_(state) {\n    if (this.mode_ == DatePickerMode.STATIC) {\n      return;\n    }\n\n    devAssert(\n      this.stateMachine_,\n      'transitonTo called before state machine is initialized'\n    );\n    this.stateMachine_.setState(state);\n  }\n\n  /**\n   * Trigger an action that consumes the current day plus an offset\n   * @param {function(!moment)} cb\n   * @param {!../../../src/service/action-impl.ActionInvocation} invocation\n   */\n  todayAction_(cb, invocation) {\n    const moment = this.moment_();\n    const offset = invocation.args && invocation.args['offset'];\n    if (offset) {\n      moment.add(offset, 'days');\n    }\n    cb(moment);\n  }\n\n  /**\n   * Set the date via a string.\n   * @param {string} date\n   * @return {*} TODO(#23582): Specify return type\n   */\n  handleSetDateFromString_(date) {\n    const momentDate = this.createOffsetMoment_(date);\n    return this.handleSetDate_(momentDate);\n  }\n\n  /**\n   * Set the date via a moment object.\n   * @param {moment} date\n   */\n  handleSetDate_(date) {\n    this.setState_(dict({'date': date}));\n    this.updateDateField_(this.dateField_, date);\n    this.element.setAttribute('date', this.getFormattedDate_(date));\n    this.triggerEvent_(DatePickerEvent.SELECT, this.getSelectData_(date));\n  }\n\n  /**\n   *\n   * @param {?string} startDate\n   * @param {?string} endDate\n   */\n  handleSetDatesFromString_(startDate, endDate) {\n    const momentStart = startDate ? this.createOffsetMoment_(startDate) : null;\n    const momentEnd = endDate ? this.createOffsetMoment_(endDate) : null;\n    this.handleSetDates_(momentStart, momentEnd);\n  }\n\n  /**\n   * Set one, both, or neither date via AMP action.\n   * @param {?moment} startDate\n   * @param {?moment} endDate\n   */\n  handleSetDates_(startDate, endDate) {\n    const state = dict();\n\n    if (startDate) {\n      state['startDate'] = startDate;\n      this.element.setAttribute(\n        'start-date',\n        this.getFormattedDate_(startDate)\n      );\n      this.updateDateField_(this.startDateField_, startDate);\n    }\n    if (endDate) {\n      state['endDate'] = endDate;\n      this.element.setAttribute('end-date', this.getFormattedDate_(endDate));\n      this.updateDateField_(this.endDateField_, endDate);\n    }\n\n    // TODO(cvializ): check if valid date, blocked, outside range, etc\n    this.setState_(state);\n    if (startDate && endDate) {\n      const selectData = this.getSelectData_(startDate, endDate);\n      this.triggerEvent_(DatePickerEvent.SELECT, selectData);\n    }\n  }\n\n  /**\n   * Forgivingly parse an ISO8601 input string into a moment object,\n   * preferring the date picker's configured format.\n   * @param {string} input The input date string to parse\n   * @return {?moment}\n   * @private\n   */\n  createMoment_(input) {\n    if (!input) {\n      return null;\n    }\n    const moment = this.moment_(input, this.format_);\n    return moment.isValid() ? moment : this.moment_(input);\n  }\n\n  /**\n   * Parse an ISO8601 date or duration.\n   * @param {string} input The input date string to parse\n   * @return {?moment}\n   * @private\n   */\n  createOffsetMoment_(input) {\n    if (!input) {\n      return null;\n    }\n    const isISO8601Duration = input[0] == 'P';\n\n    if (isISO8601Duration) {\n      const duration = this.moment_.duration(input);\n      return this.moment_().add(duration);\n    } else {\n      return this.createMoment_(input);\n    }\n  }\n\n  /**\n   * Clear the values from the input fields and\n   * trigger events with the empty values.\n   */\n  handleClear_() {\n    this.clearDateField_(this.dateField_);\n    this.clearDateField_(this.startDateField_);\n    this.clearDateField_(this.endDateField_);\n    this.element.removeAttribute('date');\n    this.element.removeAttribute('start-date');\n    this.element.removeAttribute('end-date');\n\n    this.setState_(\n      dict({\n        'date': null,\n        'startDate': null,\n        'endDate': null,\n        'focusedInput': this.ReactDatesConstants_['START_DATE'],\n      })\n    );\n    this.triggerEvent_(DatePickerEvent.SELECT, null);\n\n    if (this.props_['reopenPickerOnClearDate']) {\n      this.updateDateFieldFocus_(this.startDateField_, true);\n      this.triggerEvent_(DatePickerEvent.ACTIVATE);\n      this.transitionTo_(DatePickerState.OVERLAY_OPEN_INPUT);\n    }\n  }\n\n  /**\n   * Get the initial value for properties that change during the lifetime of\n   * the AMP element.\n   * @return {!JsonObject}\n   */\n  getInitialState_() {\n    const {element} = this;\n    const date = this.createOffsetMoment_(\n      element.getAttribute('date') || (this.dateField_ && this.dateField_.value)\n    );\n    const startDate = this.createOffsetMoment_(\n      element.getAttribute('start-date') ||\n        (this.startDateField_ && this.startDateField_.value)\n    );\n    const endDate = this.createOffsetMoment_(\n      element.getAttribute('end-date') ||\n        (this.endDateField_ && this.endDateField_.value)\n    );\n\n    if (date && this.dateField_) {\n      this.dateField_.value = this.getFormattedDate_(date);\n    }\n    if (startDate && this.startDateField_) {\n      this.startDateField_.value = this.getFormattedDate_(startDate);\n    }\n    if (endDate && this.endDateField_) {\n      this.endDateField_.value = this.getFormattedDate_(endDate);\n    }\n\n    const max = element.getAttribute('max') || '';\n    const min = element.getAttribute('min') || '';\n\n    return dict({\n      'date': date,\n      'endDate': endDate,\n      'focused': this.mode_ == DatePickerMode.STATIC,\n      'focusedInput': this.ReactDatesConstants_['START_DATE'],\n      'isFocused': false,\n      'isOpen': this.mode_ == DatePickerMode.STATIC,\n      'max': max,\n      'min': min,\n      'startDate': startDate,\n    });\n  }\n\n  /**\n   * Merge the supplied state object with the existing state and re-render the\n   * React tree.\n   * @param {!JsonObject} newState\n   * @return {*} TODO(#23582): Specify return type\n   */\n  setState_(newState) {\n    return this.render(\n      /** @type {!JsonObject} */ (\n        Object.assign(/** @type {!Object} */ (this.state_), newState)\n      )\n    );\n  }\n\n  /**\n   * Get the existing input, or create a hidden input for the date field.\n   * @param {!DateFieldType} type The selector for the input field\n   * @return {?Element}\n   */\n  setupDateField_(type) {\n    const fieldSelector = this.element.getAttribute(`${type}-selector`);\n    const existingField = this.getAmpDoc()\n      .getRootNode()\n      .querySelector(fieldSelector);\n    if (existingField) {\n      if (\n        !this.element.hasAttribute('touch-keyboard-editable') &&\n        this.mode_ == DatePickerMode.OVERLAY &&\n        this.input_.isTouchDetected()\n      ) {\n        setTouchNonValidationReadonly(existingField, true);\n      }\n      return existingField;\n    }\n\n    const form = closestAncestorElementBySelector(this.element, 'form');\n    if (this.mode_ == DatePickerMode.STATIC && form) {\n      const hiddenInput = this.document_.createElement('input');\n      hiddenInput.type = 'hidden';\n      hiddenInput.name = this.getHiddenInputId_(form, type);\n      this.element.appendChild(hiddenInput);\n      return hiddenInput;\n    }\n\n    return null;\n  }\n\n  /**\n   * Generate a name for a hidden input.\n   * Date pickers not in a form don't need named hidden inputs.\n   * @param {!Element} form\n   * @param {!DateFieldType} type\n   * @return {string}\n   * @private\n   */\n  getHiddenInputId_(form, type) {\n    const {id} = this.element;\n    const name = DateFieldNameByType[type];\n    if (!form) {\n      return '';\n    }\n\n    if (!form.elements[name]) {\n      return name;\n    }\n\n    const alternativeName = `${id}-${name}`;\n    if (id && !form.elements[alternativeName]) {\n      return alternativeName;\n    }\n\n    user().error(\n      TAG,\n      'Multiple date-pickers with implicit %s fields need to have IDs',\n      name\n    );\n    return '';\n  }\n\n  /**\n   * Add the document-level event listeners to attach behavior to any referenced\n   * input fields and to enable overlay open/close.\n   * @private\n   */\n  setupListeners_() {\n    const ampdoc = this.getAmpDoc();\n    const root = ampdoc.getRootNode().documentElement || ampdoc.getBody();\n    // Only add for overlay since click events just handle opening and closing\n    if (this.mode_ == DatePickerMode.OVERLAY) {\n      this.listen_(root, 'click', this.handleClick_.bind(this));\n    }\n    this.listen_(root, 'input', this.handleInput_.bind(this));\n    // TODO(cvializ): Add aria message to use down arrow to trigger calendar.\n    this.listen_(root, 'focusin', this.handleFocus_.bind(this));\n    this.listen_(root, 'focusout', this.removeTouchReadonly_.bind(this));\n    this.listen_(root, 'keydown', this.handleKeydown_.bind(this));\n  }\n\n  /**\n   * True if the input is a field of this date picker.\n   * @param {?Element} field\n   * @return {boolean}\n   * @private\n   */\n  isDateField_(field) {\n    return (\n      field === this.dateField_ ||\n      field === this.startDateField_ ||\n      field === this.endDateField_\n    );\n  }\n\n  /**\n   * Handle clicks inside and outside of the date picker to detect when to\n   * open and close the date picker.\n   * @param {!Event} e\n   * @private\n   */\n  handleClick_(e) {\n    const target = dev().assertElement(e.target);\n    const clickWasInDatePicker =\n      this.container_.contains(target) || this.isDateField_(target);\n\n    if (!clickWasInDatePicker) {\n      this.transitionTo_(DatePickerState.OVERLAY_CLOSED);\n    }\n  }\n\n  /**\n   * Suppress the touch keyboard on focus.\n   * The `readonly` property on input elements prevents the touch keyboard from\n   * appearing when the input receives focus.\n   * However, `readonly` also prevents form validation from triggering.\n   * To suppress the touch keyboard and also allow validation to occur, this\n   * method adds `readonly` when focus occurs, and removes it on blur.\n   * @param {!Event} e\n   * @private\n   */\n  addTouchReadonly_(e) {\n    const target = dev().assertElement(e.target);\n\n    if (!this.isDateField_(target)) {\n      return;\n    }\n\n    if (!isTouchNonValidationReadonly(target)) {\n      return;\n    }\n\n    if (target.readOnly) {\n      return;\n    }\n\n    target.readOnly = true;\n    // This data-attribute prevents an infinite loop between blur and focus\n    target.dataset[AMP_DATE_BLUR_DATA_ATTR] = true;\n\n    // Force blur to close the keyboard. When focus returns, the field will\n    // have `readonly` set and the mobile keyboard will not open.\n    target.blur();\n\n    // Return focus to the field\n    tryFocus(target);\n\n    // Clean this up since it isn't needed after this point.\n    delete target.dataset[AMP_DATE_BLUR_DATA_ATTR];\n  }\n\n  /**\n   * Remove the behavior added by `addTouchReadonly`.\n   * @param {!Event} e\n   * @private\n   */\n  removeTouchReadonly_(e) {\n    const target = dev().assertElement(e.target);\n\n    if (!this.isDateField_(target)) {\n      return;\n    }\n\n    if (!isTouchNonValidationReadonly(target)) {\n      return;\n    }\n\n    // If the blur was caused by the forced blur in addTouchReadonly_,\n    // don't remove readonly yet. We want to wait until the user navigates away.\n    if (target.dataset[AMP_DATE_BLUR_DATA_ATTR]) {\n      return;\n    }\n\n    target.readOnly = false;\n  }\n\n  /**\n   * Handle focus events in the document.\n   * @param {!Event} e\n   * @private\n   */\n  handleFocus_(e) {\n    this.addTouchReadonly_(e);\n    this.maybeTransitionWithFocusChange_(dev().assertElement(e.target));\n  }\n\n  /**\n   * Switch between selecting the start and end dates,\n   * and when to open and close the date picker.\n   * @param {!Element} target\n   */\n  maybeTransitionWithFocusChange_(target) {\n    if (this.isDateField_(target)) {\n      if (target == this.startDateField_) {\n        this.updateDateFieldFocus_(this.startDateField_);\n        this.setState_(\n          dict({\n            'focusedInput': this.ReactDatesConstants_['START_DATE'],\n          })\n        );\n      } else if (target == this.endDateField_) {\n        this.updateDateFieldFocus_(this.endDateField_);\n        this.setState_(\n          dict({\n            'focusedInput': this.ReactDatesConstants_['END_DATE'],\n          })\n        );\n      } else if (target == this.dateField_) {\n        this.updateDateFieldFocus_(this.dateField_);\n      }\n      this.transitionTo_(DatePickerState.OVERLAY_OPEN_INPUT);\n    } else if (!this.element.contains(target)) {\n      this.updateDateFieldFocus_(null);\n      this.transitionTo_(DatePickerState.OVERLAY_CLOSED);\n    }\n  }\n\n  /**\n   * For inputs that are valid dates, update the date-picker value.\n   * @param {!Event} e\n   * @private\n   */\n  handleInput_(e) {\n    const target = dev().assertElement(e.target);\n    if (!this.isDateField_(target) || target.type == 'hidden') {\n      return;\n    }\n\n    const property =\n      target === this.dateField_\n        ? 'date'\n        : target === this.startDateField_\n        ? 'startDate'\n        : target === this.endDateField_\n        ? 'endDate'\n        : '';\n    const moment = this.createMoment_(target.value);\n    const isValid =\n      moment && moment.isValid() && moment.year() > MIN_PICKER_YEAR;\n    this.setState_(dict({[property]: isValid ? moment : null}));\n  }\n\n  /**\n   * Handle changing values of the attached input fields, and the hotkey for\n   * closing the date picker.\n   * @param {!Event} e\n   * @private\n   * @return {*} TODO(#23582): Specify return type\n   */\n  handleKeydown_(e) {\n    const target = dev().assertElement(e.target);\n    if (this.isDateField_(target)) {\n      this.handleInputKeydown_(e);\n    } else {\n      return this.handleDocumentKeydown_(e);\n    }\n  }\n\n  /**\n   * Close the date picker overlay when the escape key is pressed.\n   * @param {!Event} e\n   * @private\n   * @return {*} TODO(#23582): Specify return type\n   */\n  handleDocumentKeydown_(e) {\n    if (\n      e.key == Keys.ESCAPE &&\n      this.mode_ == DatePickerMode.OVERLAY &&\n      this.element.contains(this.document_.activeElement)\n    ) {\n      this.transitionTo_(DatePickerState.OVERLAY_CLOSED);\n    }\n    return true;\n  }\n\n  /**\n   * Handle the states for keyboard input.\n   * @param {!Event} e\n   * @private\n   */\n  handleInputKeydown_(e) {\n    const target = dev().assertElement(e.target);\n    if (!this.isDateField_(target) || target.type == 'hidden') {\n      return;\n    }\n\n    if (e.key == Keys.DOWN_ARROW) {\n      this.updateDateFieldFocus_(target);\n      this.transitionTo_(DatePickerState.OVERLAY_OPEN_PICKER);\n      if (this.mode_ === DatePickerMode.STATIC) {\n        this.triggerEvent_(DatePickerEvent.ACTIVATE);\n        const toFocus = this.container_.querySelector('[tabindex=\"0\"]');\n        if (toFocus) {\n          this.mutateElement(() => toFocus./*OK*/ focus());\n        }\n      }\n      e.preventDefault();\n    } else if (e.key == Keys.ESCAPE) {\n      this.transitionTo_(DatePickerState.OVERLAY_CLOSED);\n    } else {\n      this.transitionTo_(DatePickerState.OVERLAY_OPEN_INPUT);\n    }\n  }\n\n  /**\n   * Listens for the specified event on the element.\n   * @param {!EventTarget} element\n   * @param {string} eventType\n   * @param {function(!Event)} listener\n   * @param {Object=} opt_evtListenerOpts\n   * @private\n   */\n  listen_(element, eventType, listener, opt_evtListenerOpts) {\n    this.unlisteners_.push(\n      listen(element, eventType, listener, opt_evtListenerOpts)\n    );\n  }\n\n  /**\n   * Remove the listeners that the date picker has created.\n   * @private\n   */\n  cleanupListeners_() {\n    this.unlisteners_.forEach((unlisten) => unlisten());\n    this.unlisteners_.length = 0;\n  }\n\n  /**\n   * Fetch and parse any templates specified via the `src` attribute.\n   * @return {!Promise}\n   * @private\n   */\n  setupTemplates_() {\n    return this.fetchSrc_()\n      .then((json) => this.parseSrcTemplates_(json))\n      .then((parsedTemplates) => {\n        if (parsedTemplates) {\n          const {srcDefaultTemplate, srcTemplates} = parsedTemplates;\n          this.srcTemplates_ = srcTemplates;\n          this.srcDefaultTemplate_ = srcDefaultTemplate;\n        }\n\n        this.templatesReadyResolver_();\n      })\n      .catch((error) => {\n        user().error(TAG, 'Failed fetching date src data', error);\n      });\n  }\n\n  /**\n   * Fetch and parse any attributes specified via the `src` attribute.\n   * @return {!Promise}\n   * @private\n   */\n  setupSrcAttributes_() {\n    return this.fetchSrc_().then((json) => {\n      if (!json) {\n        return;\n      }\n\n      // We should only set the value if the field is empty or absent.\n      const shouldSetDate = !this.dateField_ || !this.dateField_.value;\n      const shouldSetStartDate =\n        !this.startDateField_ || !this.startDateField_.value;\n      const shouldSetEndDate = !this.endDateField_ || !this.endDateField_.value;\n\n      const date = shouldSetDate ? json['date'] : null;\n      const startDate = shouldSetStartDate ? json['startDate'] : null;\n      const endDate = shouldSetEndDate ? json['endDate'] : null;\n\n      if (date) {\n        this.handleSetDateFromString_(date);\n      }\n      if (startDate || endDate) {\n        this.handleSetDatesFromString_(startDate, endDate);\n      }\n\n      const blocked = json['blocked'];\n      if (blocked) {\n        this.blocked_ = new DatesList(blocked);\n      }\n\n      const highlighted = json['highlighted'];\n      if (highlighted) {\n        this.highlighted_ = new DatesList(highlighted);\n      }\n    });\n  }\n\n  /**\n   * Fetch the JSON from the URL specified in the src attribute.\n   * @return {!Promise<!JsonObject|!Array<!JsonObject>>}\n   * @private\n   */\n  fetchSrc_() {\n    return this.element.getAttribute('src')\n      ? batchFetchJsonFor(this.getAmpDoc(), this.element)\n      : Promise.resolve();\n  }\n\n  /**\n   * Create an array of objects mapping dates to templates.\n   * @param {!JsonObject|!Array<!JsonObject>} srcJson\n   * @return {?{srcTemplates: !Array<!DateTemplateMapDef>, srcDefaultTemplate: ?Element}}\n   * @private\n   */\n  parseSrcTemplates_(srcJson) {\n    const templates = srcJson && srcJson['templates'];\n    if (!templates) {\n      return null;\n    }\n    const ampdoc = this.getAmpDoc();\n    const srcTemplates = templates\n      .filter((t) => t.dates)\n      .map((t) => ({\n        dates: new DatesList(t.dates),\n        template: ampdoc\n          .getRootNode()\n          .querySelector(`#${escapeCssSelectorIdent(t.id)}[date-template]`),\n      }));\n\n    const srcDefaultTemplate = templates\n      .filter((t) => t.dates == null)\n      .map((t) => ampdoc.getElementById(t.id))[0];\n\n    return {\n      srcTemplates,\n      srcDefaultTemplate,\n    };\n  }\n\n  /**\n   * Create a new map to store rendered templates and drop the old reference\n   * for garbage collection.\n   * @private\n   */\n  clearRenderedTemplates_() {\n    this.renderedTemplates_ = dict();\n  }\n\n  /**\n   * Cleanup the resources allocated for the src templates.\n   * @private\n   */\n  cleanupSrcTemplates_() {\n    this.srcTemplates_ = [];\n    this.srcDefaultTemplate_ = null;\n  }\n\n  /**\n   * Iterate over template element children and map their IDs\n   * to a list of dates\n   * @param {!NodeList<!Element>} templates\n   * @return {!Array<!DateTemplateMapDef>}\n   * @private\n   */\n  parseElementTemplates_(templates) {\n    const parsed = [];\n    iterateCursor(templates, (template) =>\n      parsed.push(this.parseElementTemplate_(template))\n    );\n    return parsed;\n  }\n\n  /**\n   * Parse a date picker template element.\n   * @param {!Element} template\n   * @return {!DateTemplateMapDef}\n   * @private\n   */\n  parseElementTemplate_(template) {\n    const dates = template.getAttribute('dates').split(DATE_SEPARATOR);\n    return {\n      dates: new DatesList(dates),\n      template,\n    };\n  }\n\n  /**\n   * Get the initial values for properties whose values do not change during\n   * the lifetime of the AMP element. Convert the kebab-case html attributes to\n   * camelCase React props.\n   * @return {!JsonObject} Initialized props for the react component.\n   * @private\n   */\n  getProps_() {\n    const props = attributesToForward.reduce((acc, attr) => {\n      const value = this.element.getAttribute(attr);\n      if (value != null) {\n        acc[dashToCamelCase(attr)] = value || true;\n      }\n      return acc;\n    }, {});\n\n    if (this.hasInfoTemplate_()) {\n      props.renderCalendarInfo = this.renderInfo;\n    }\n\n    if (this.fullscreen_) {\n      props.orientation = 'verticalScrollable';\n      props.withFullScreenPortal = true;\n    }\n\n    props.reopenPickerOnClearDate = this.openAfterClear_;\n    props.keepOpenOnDateSelect = this.openAfterSelect_;\n\n    return props;\n  }\n\n  /**\n   * Respond to user interactions that change a DateRangePicker's dates.\n   * @param {!JsonObject} param\n   */\n  onDatesChange(param) {\n    const startDate = param['startDate'];\n    const endDate = param['endDate'];\n    const isFinalSelection =\n      !this.props_['keepOpenOnDateSelect'] &&\n      this.state_['focusedInput'] != this.ReactDatesConstants_['END_DATE'];\n\n    if (this.isBlockedRange_(startDate, endDate)) {\n      return;\n    }\n\n    const selectData = this.getSelectData_(startDate, endDate);\n    this.triggerEvent_(DatePickerEvent.SELECT, selectData);\n    this.setState_(\n      dict({\n        'startDate': startDate,\n        'endDate': endDate,\n        'isFocused': this.mode_ == DatePickerMode.STATIC || !isFinalSelection,\n      })\n    );\n    this.updateDateField_(this.startDateField_, startDate);\n    this.element.setAttribute('start-date', this.getFormattedDate_(startDate));\n    this.updateDateField_(this.endDateField_, endDate);\n    this.element.setAttribute('end-date', this.getFormattedDate_(endDate));\n\n    if (isFinalSelection && startDate && endDate) {\n      this.transitionTo_(DatePickerState.OVERLAY_CLOSED);\n      this.triggerEvent_(DatePickerEvent.DEACTIVATE);\n    }\n  }\n\n  /**\n   * Detect if a blocked date is between the start and end date, inclusively,\n   * accounting for the `allow-blocked-end-date` attribute.\n   * @param {?moment} startDate\n   * @param {?moment} endDate\n   * @return {boolean} True if the range should not be selected.\n   */\n  isBlockedRange_(startDate, endDate) {\n    if (!startDate || !endDate) {\n      return false;\n    }\n\n    const isSameDay = this.ReactDates_['isSameDay'];\n    let blockedCount = 0;\n    if (!this.allowBlockedRanges_) {\n      this.iterateDateRange_(startDate, endDate, (index) => {\n        if (this.blocked_.contains(index)) {\n          blockedCount++;\n        }\n      });\n    }\n\n    // If allow-blocked-end-date is enabled, we do not consider the range\n    // blocked when the end date is the only blocked date.\n    if (\n      blockedCount == 1 &&\n      this.allowBlockedEndDate_ &&\n      isSameDay(endDate, this.blocked_.firstDateAfter(startDate))\n    ) {\n      return false;\n    }\n\n    // If there are any blocked dates in the range, it cannot\n    // be selected.\n    if (blockedCount > 0) {\n      return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * Respond to user interactions that change a SingleDatePicker's dates.\n   * @param {?moment} date\n   */\n  onDateChange(date) {\n    this.triggerEvent_(DatePickerEvent.SELECT, this.getSelectData_(date));\n    this.setState_(dict({'date': date}));\n    this.updateDateField_(this.dateField_, date);\n    this.element.setAttribute('date', this.getFormattedDate_(date));\n\n    if (!this.props_['keepOpenOnDateSelect']) {\n      this.transitionTo_(DatePickerState.OVERLAY_CLOSED);\n    }\n  }\n\n  /**\n   * Select the given input to be focused.\n   * @param {?string} focusedInput The currently focused input.\n   */\n  onFocusChange(focusedInput) {\n    const START_DATE = this.ReactDatesConstants_['START_DATE'];\n    const END_DATE = this.ReactDatesConstants_['END_DATE'];\n    const focusedField =\n      focusedInput === START_DATE\n        ? this.startDateField_\n        : focusedInput === END_DATE\n        ? this.endDateField_\n        : this.dateField_;\n    this.updateDateFieldFocus_(focusedField, this.state_['isOpen']);\n\n    this.setState_(\n      dict({\n        'focusedInput': !focusedInput\n          ? this.ReactDatesConstants_['START_DATE']\n          : focusedInput,\n        'focused': this.mode_ == DatePickerMode.STATIC,\n      })\n    );\n  }\n\n  /**\n   * Apply the focus CSS class to the given field and unapply it from\n   * the others.\n   * @param {?Element} focusedField The field to apply focus to\n   * @param {boolean=} opt_toggle\n   * @private\n   */\n  updateDateFieldFocus_(focusedField, opt_toggle) {\n    if (this.mode_ == DatePickerMode.STATIC) {\n      return;\n    }\n\n    const toggle = typeof opt_toggle != 'undefined' ? opt_toggle : true;\n    this.toggleDateFieldClass_(this.startDateField_, INPUT_FOCUS_CSS, false);\n    this.toggleDateFieldClass_(this.endDateField_, INPUT_FOCUS_CSS, false);\n    this.toggleDateFieldClass_(this.dateField_, INPUT_FOCUS_CSS, false);\n    this.toggleDateFieldClass_(focusedField, INPUT_FOCUS_CSS, toggle);\n  }\n\n  /**\n   * Trigger the activate AMP action. Triggered when the overlay opens or when\n   * the static date picker should receive focus from the attached input.\n   * @param {string} name\n   * @param {?BindDatesDetails|?BindDateDetails=} opt_data\n   * @private\n   */\n  triggerEvent_(name, opt_data = null) {\n    const event = createCustomEvent(this.win, `${TAG}.${name}`, opt_data);\n    this.action_.trigger(this.element, name, event, ActionTrust.HIGH);\n  }\n\n  /**\n   * Create the response for the 'select' AMP event.\n   * @param {?moment} dateOrStartDate\n   * @param {?moment=} endDate\n   * @return {?BindDatesDetails|?BindDateDetails}\n   * @private\n   */\n  getSelectData_(dateOrStartDate, endDate = null) {\n    if (this.type_ == DatePickerType.SINGLE) {\n      return this.getBindDate_(dateOrStartDate);\n    } else if (this.type_ == DatePickerType.RANGE) {\n      return dateOrStartDate\n        ? this.getBindDates_(dateOrStartDate, endDate)\n        : null;\n    } else {\n      dev().error(TAG, 'Invalid date picker type');\n      return null;\n    }\n  }\n\n  /**\n   * Toggle the provided class on the given input\n   * @param {?Element} field An input field\n   * @param {string} className A css classname\n   * @param {boolean=} value\n   * @private\n   */\n  toggleDateFieldClass_(field, className, value) {\n    if (field) {\n      this.mutateElement(() => field.classList.toggle(className, value), field);\n    }\n  }\n\n  /**\n   * Assign the provided date value to the given input.\n   * input[type=\"date\"] expects YYYY-MM-DD for setting its value,\n   * so it is special-cased here.\n   * @param {?Element} field An input field\n   * @param {?moment} date A date value\n   * @private\n   */\n  updateDateField_(field, date) {\n    if (field) {\n      field.value =\n        field.type == 'date'\n          ? this.getFormattedDate_(date, DEFAULT_FORMAT, DEFAULT_LOCALE)\n          : this.getFormattedDate_(date);\n    }\n  }\n\n  /**\n   * Clear the value from the given input field.\n   * @param {?Element} field An input field\n   * @private\n   */\n  clearDateField_(field) {\n    if (field) {\n      field.value = '';\n    }\n  }\n\n  /**\n   * Create a date object to be consumed by AMP actions and events or amp-bind.\n   * @param {?moment} date\n   * @return {?BindDateDetails}\n   * @private\n   */\n  getBindDate_(date) {\n    if (!date) {\n      return null;\n    }\n\n    const template = this.getDayTemplate_(date);\n    const details = new BindDateDetails(\n      this.getFormattedDate_(date),\n      template && template.id\n    );\n    return details;\n  }\n\n  /**\n   * Create an array for date objects to be consumed by AMP actions and events\n   * or amp-bind.\n   * @param {!moment} startDate\n   * @param {?moment} endDate\n   * @return {!BindDatesDetails}\n   * @private\n   */\n  getBindDates_(startDate, endDate) {\n    const dates = [];\n    this.iterateDateRange_(startDate, endDate, (index) => {\n      dates.push(this.getBindDate_(index));\n    });\n    return new BindDatesDetails(dates);\n  }\n\n  /**\n   * Iterate over the dates between a start and end date.\n   * @param {!moment} startDate\n   * @param {?moment} endDate\n   * @param {function(!moment)} cb\n   * @private\n   * @return {*} TODO(#23582): Specify return type\n   */\n  iterateDateRange_(startDate, endDate, cb) {\n    const normalizedEndDate = endDate || startDate;\n    if (!normalizedEndDate.isSameOrAfter(startDate)) {\n      return;\n    }\n\n    const isSameDay = this.ReactDates_['isSameDay'];\n    if (isSameDay(startDate, endDate)) {\n      return cb(startDate);\n    }\n\n    const days = normalizedEndDate.diff(startDate, 'days');\n    cb(startDate);\n    for (let i = 0; i < days; i++) {\n      cb(startDate.clone().add(i + 1, 'days'));\n    }\n  }\n\n  /**\n   * Formats a date in the page's locale and the element's configured format.\n   * @param {?moment} date\n   * @param {string=} opt_format\n   * @param {string=} opt_locale\n   * @return {string}\n   * @private\n   */\n  getFormattedDate_(date, opt_format, opt_locale) {\n    if (!date) {\n      return '';\n    }\n    const format = opt_format || this.format_;\n    const isUnixTimestamp = format.match(/[Xx]/);\n    const locale = isUnixTimestamp\n      ? DEFAULT_LOCALE\n      : opt_locale || this.locale_;\n    return date.clone().locale(locale).format(format);\n  }\n\n  /**\n   * Render a day in the calendar view.\n   * @param {!moment} date\n   * @return {*} TODO(#23582): Specify return type\n   */\n  renderDay_(date) {\n    const key = date.format(DEFAULT_FORMAT);\n    const cachedDay = this.renderedTemplates_[key];\n    if (cachedDay) {\n      return cachedDay;\n    }\n\n    const templatePromise = this.templatesReadyPromise_.then(() =>\n      this.renderDayTemplate_(date)\n    );\n    const rendered = this.renderPromiseIntoReact_(\n      templatePromise,\n      date.format('D')\n    );\n\n    this.renderedTemplates_[key] = rendered;\n    return rendered;\n  }\n\n  /**\n   * @param {!Array<!DateTemplateMapDef>} templates\n   * @param {!moment} date\n   * @return {?Element}\n   * @private\n   */\n  getTemplate_(templates, date) {\n    for (let i = 0; i < templates.length; i++) {\n      if (templates[i].dates.contains(date)) {\n        return templates[i].template;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Get the template tag corresponding to a given date.\n   * @param {!moment} date\n   * @return {?Element}\n   * @private\n   */\n  getDayTemplate_(date) {\n    return (\n      this.getTemplate_(this.srcTemplates_, date) ||\n      this.getTemplate_(this.elementTemplates_, date) ||\n      this.srcDefaultTemplate_ ||\n      this.element.querySelector('[date-template][default]')\n    );\n  }\n\n  /**\n   * Render the template that corresponds to the date with its data.\n   * @param {!moment} date\n   * @return {!Promise<string>}\n   * @private\n   */\n  renderDayTemplate_(date) {\n    const template = this.getDayTemplate_(date);\n    const data = this.getDayTemplateData_(date);\n    return this.renderTemplate_(template, data, date.format('D'));\n  }\n\n  /**\n   * Render the info section of the calendar view.\n   * @return {*} TODO(#23582): Specify return type\n   */\n  renderInfo() {\n    if (!this.infoTemplatePromise_) {\n      this.infoTemplatePromise_ = this.renderInfoTemplate_();\n    }\n    return this.renderPromiseIntoReact_(this.infoTemplatePromise_);\n  }\n\n  /**\n   * Returns `true` if an info template exists.\n   * @return {boolean}\n   * @private\n   */\n  hasInfoTemplate_() {\n    return this.templates_.hasTemplate(this.element, '[info-template]');\n  }\n\n  /**\n   * Render any template for the info section of the date picker.\n   * @return {!Promise<string>}\n   * @private\n   */\n  renderInfoTemplate_() {\n    const template = this.element.querySelector('[info-template]');\n    if (template) {\n      return this.renderTemplateElement_(template).then((element) => {\n        element.classList.add(INFO_TEMPLATE_AREA_CSS);\n        return this.getRenderedTemplateString_(element);\n      });\n    } else {\n      return Promise.resolve('');\n    }\n  }\n\n  /**\n   * Render the given template into an element with the given data.\n   * @param {!Element} template\n   * @param {!JsonObject=} opt_data\n   * @return {!Promise<!Element>}\n   * @private\n   */\n  renderTemplateElement_(template, opt_data = /** @type {!JsonObject} */ ({})) {\n    return this.templates_.renderTemplate(template, opt_data);\n  }\n\n  /**\n   * Render the given template with the given data. If the template does not\n   * exist, use a fallback string.\n   * The fallback string will be rendered directly into the DOM. Note that\n   * it is currently just a date or an empty string, but if extended beyond\n   * those cases, it should be sanitized.\n   * @param {?Element} template\n   * @param {!JsonObject=} opt_data\n   * @param {string=} opt_fallback\n   * @return {!Promise<string>}\n   * @private\n   */\n  renderTemplate_(template, opt_data, opt_fallback = '') {\n    if (template) {\n      return this.renderTemplateElement_(template, opt_data).then((rendered) =>\n        this.getRenderedTemplateString_(rendered)\n      );\n    } else {\n      return Promise.resolve(opt_fallback);\n    }\n  }\n\n  /**\n   * Convert a rendered template element to a string\n   * @param {!Element} rendered\n   * @return {string}\n   * @private\n   */\n  getRenderedTemplateString_(rendered) {\n    return rendered./*OK*/ outerHTML;\n  }\n\n  /**\n   * Create the data needed to render a day template\n   * @param {!moment} date\n   * @return {!JsonObject}\n   * @private\n   */\n  getDayTemplateData_(date) {\n    const templateData = FORMAT_STRINGS.reduce((acc, key) => {\n      if (key === 'X' || key === 'x') {\n        const defaultLocaleDate = date.clone().locale(DEFAULT_LOCALE);\n        acc[key] = defaultLocaleDate.format(key);\n      } else {\n        acc[key] = date.format(key);\n      }\n      return acc;\n    }, {});\n    templateData.isHighlighted = this.highlighted_.contains(date);\n    templateData.isBlocked = this.blocked_.contains(date);\n\n    return templateData;\n  }\n\n  /**\n   * Render asynchronous HTML into a React component.\n   * @param {!Promise<string>} promise\n   * @param {string=} opt_initial\n   * @return {React.Component}\n   * @private\n   */\n  renderPromiseIntoReact_(promise, opt_initial) {\n    if (!this.templateThen_) {\n      this.templateThen_ = (html) =>\n        this.react_.createElement('div', {\n          // This should be safe because this HTML is rendered through\n          // amp-mustache and is sanitized.\n          dangerouslySetInnerHTML: {__html: html},\n        });\n    }\n\n    return this.react_.createElement(createDeferred(), {\n      initial: opt_initial,\n      promise,\n      then: this.templateThen_,\n    });\n  }\n\n  /**\n   * Notify any listener (like bind) that a DOM update occurred.\n   */\n  onMount() {\n    if (this.mode_ == DatePickerMode.OVERLAY) {\n      // REVIEW: this should be ok, since opening the overlay requires a\n      // user interaction, and this won't run until then.\n      Services.bindForDocOrNull(this.element).then((bind) => {\n        if (bind) {\n          return bind.rescan([this.element], [this.element], {'apply': true});\n        }\n      });\n    } else {\n      const renderedEvent = createCustomEvent(\n        this.win,\n        AmpEvents.DOM_UPDATE,\n        /* detail */ null,\n        {bubbles: true}\n      );\n      this.element.dispatchEvent(renderedEvent);\n    }\n  }\n\n  /**\n   * If the author changed the \"day-size\" attribute, warn them about the\n   * resize bug and give a workaround for it.\n   * Should only be called from within a `measureElement` block\n   * @param {!Element} container\n   */\n  warnDaySize_(container) {\n    if (this.daySize_ !== DEFAULT_DAY_SIZE) {\n      // Check to see if the publisher has fixed the bug by updating the height\n      const {minHeight} = computedStyle(this.win, container);\n      if (minHeight === DEFAULT_TRANSITION_CONTAINER_MIN_HEIGHT) {\n        user().warn(\n          TAG,\n          '%s\\n The \"day-size\" attribute is changed from the default value ' +\n            '%s. You must specify a new \"min-height\" `for the %s element in ' +\n            'your AMP CSS.\\n This is necessary due to a bug in the ' +\n            'date-picker library. When the bug is fixed, the %s CSS class ' +\n            'will be removed. ' +\n            'See https://github.com/ampproject/amphtml/issues/13897',\n          this.element,\n          DEFAULT_DAY_SIZE,\n          TRANSITION_CONTAINER_SELECTOR,\n          RESIZE_BUG_CSS\n        );\n      }\n    }\n  }\n\n  /**\n   * Render the configured date picker component.\n   * @param {?JsonObject=} opt_additionalProps\n   * @return {!Promise}\n   */\n  render(opt_additionalProps) {\n    const props = /** @type {!JsonObject} */ ({\n      ...this.props_,\n      ...opt_additionalProps,\n    });\n    const shouldBeOpen = props['isOpen'] || this.mode_ == DatePickerMode.STATIC;\n    const Picker = shouldBeOpen ? this.pickerClass_ : null;\n\n    return this.mutateElement(() => {\n      if (Picker) {\n        // TODO(cvializ, #13897):\n        // When rendered with React, the picker expands to fit\n        // the number of weeks for that month. When rendered with preact-compat,\n        // the picker expands 1 behind where it should for the number of weeks\n        // in the month.\n        this.reactRender_(\n          this.react_.createElement(Picker, {\n            ...dict({\n              'allowBlockedEndDate': this.allowBlockedEndDate_,\n              'min': props['min'],\n              'max': props['max'],\n              'date': props['date'],\n              'startDate': props['startDate'],\n              'endDate': props['endDate'],\n              'isRTL': this.isRTL_,\n              'onDateChange': this.onDateChange,\n              'onDatesChange': this.onDatesChange,\n              'onFocusChange': this.onFocusChange,\n              'onMount': this.onMount,\n              'renderDay': this.renderDay,\n              'blocked': this.blocked_,\n              'highlighted': this.highlighted_,\n              'firstDayOfWeek': this.firstDayOfWeek_,\n              'daySize': this.daySize_,\n              'weekDayFormat': this.weekDayFormat_,\n              'isFocused': props['isFocused'], // should automatically focus\n              'focused': props['focused'],\n            }),\n            ...props,\n          }),\n          this.container_\n        );\n      } else {\n        this.reactRender_(null, this.container_);\n      }\n    }).then(() => {\n      this.measureElement(() => {\n        const transitionContainer = scopedQuerySelector(\n          this.element,\n          TRANSITION_CONTAINER_SELECTOR\n        );\n        if (transitionContainer) {\n          this.warnDaySizeOnce_(transitionContainer);\n        }\n\n        if (this.mode_ === DatePickerMode.STATIC) {\n          const scrollHeight = this.container_./*OK*/ scrollHeight;\n          const height = this.element./*OK*/ offsetHeight;\n          if (scrollHeight > height) {\n            // Add 1px to allow the bottom border to show\n            this.forceChangeHeight(scrollHeight + 1);\n          }\n        }\n      });\n    });\n  }\n}\n\n/**\n * Mark an element to receive the `readonly` property on focus.\n * That will prevent the touch keyboard from appearing when it is not desired.\n * @param {!Element} element\n * @param {boolean} toggle\n */\nfunction setTouchNonValidationReadonly(element, toggle) {\n  if (!toggle) {\n    delete element.dataset[AMP_READONLY_DATA_ATTR];\n    return;\n  }\n\n  element.dataset[AMP_READONLY_DATA_ATTR] = true;\n}\n\n/**\n * Detect if an element has been marked to receive the\n * `readonly` property on focus.\n * @param {!Element} element\n * @return {boolean}\n */\nfunction isTouchNonValidationReadonly(element) {\n  return Boolean(element.dataset[AMP_READONLY_DATA_ATTR]);\n}\n\nAMP.extension(TAG, '0.1', (AMP) => {\n  AMP.registerElement(TAG, AmpDatePicker, CSS);\n});\n"],
  "mappings": "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",
  "names": []
}
