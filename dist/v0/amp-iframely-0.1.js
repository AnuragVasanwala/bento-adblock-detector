(self.AMP=self.AMP||[]).push({m:0,v:"2110121450047",n:"amp-iframely",ev:"0.1",l:true,f:function(AMP,_){"use strict";var g="function"==typeof Object.create?Object.create:function(a){function b(){}b.prototype=a;return new b};function h(a){for(var b=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global],c=0;c<b.length;++c){var d=b[c];if(d&&d.Math==Math)return}(function(){throw Error("Cannot find global object")})()}h(this);"function"===typeof Symbol&&Symbol("x");var m;if("function"==typeof Object.setPrototypeOf)m=Object.setPrototypeOf;else{var n;a:{var p={a:!0},q={};try{q.__proto__=p;n=q.a;break a}catch(a){}n=!1}m=n?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var r=m;function t(a){var b=["id","domain","key","url","img"];return Object.keys(a).reduce((function(c,d){b.includes(d)||(c[d]=a[d]);return c}),{})}var u=Array.isArray;
/* https://mths.be/cssescape v1.5.1 by @mathias | MIT license */function v(a){a.classList.add("i-amphtml-fill-content")}function w(){var a=this;this.promise=new Promise((function(b,c){a.resolve=b;a.reject=c}))}function x(a,b){var c={needsRootBounds:!0},d=c=void 0===c?{}:c,e=d.needsRootBounds;return new b.IntersectionObserver(a,{threshold:d.threshold,root:b.parent&&b.parent!=b&&e?b.document:void 0})}new WeakMap;new WeakMap;var y,z;function A(a){y||(y=new WeakMap,z=new WeakMap);var b=z.get(a);b||(b=x((function(c){for(var d=new Set,e=c.length-1;0<=e;e--){var f=c[e].target;d.has(f)||(d.add(f),b.unobserve(f),y.get(f).resolve(c[e]),y.delete(f))}}),a),z.set(a,b));return b}function B(a){if(y&&y.has(a))return y.get(a).promise;A((a.ownerDocument||a).defaultView).observe(a);var b=new w;y.set(a,b);return b.promise}var C,F="Webkit webkit Moz moz ms O o".split(" ");function G(a){var b=a.style;if("border".startsWith("--"))b="border";else{C||(C=Object.create(null));var c=C.border;if(!c){c="border";if(void 0===b.border){var d;b:{for(d=0;d<F.length;d++){var e=F[d]+"Border";if(void 0!==b[e]){d=e;break b}}d=""}void 0!==b[d]&&(c=d)}C.border=c}b=c}b&&(b.startsWith("--")?a.style.setProperty(b,"0px"):a.style[b]="0px")}var H;function I(a,b){function c(k){try{return e(k)}catch(D){var l,E;null==(E=(l=self).__AMP_REPORT_ERROR)||E.call(l,D);throw D}}var d=a,e=b,f=J();d.addEventListener("message",c,f?void 0:!1);return function(){var k;null==(k=d)||k.removeEventListener("message",c,f?void 0:!1);c=d=e=null}}function J(){if(void 0!==H)return H;H=!1;try{var a={get capture(){H=!0}};self.addEventListener("test-options",null,a);self.removeEventListener("test-options",null,a)}catch(b){}return H}var K=self.AMP_CONFIG||{},L=("string"==typeof K.cdnProxyRegex?new RegExp(K.cdnProxyRegex):K.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;function M(a){if(self.document&&self.document.head&&(!self.location||!L.test(self.location.origin))){var b=self.document.head.querySelector('meta[name="'+a+'"]');b&&b.getAttribute("content")}}K.cdnUrl||M("runtime-host");K.geoApiUrl||M("amp-geo-api");self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var N=self.__AMP_LOG;function O(a,b,c){if(!N.user)throw Error("failed to call initLogConstructor");N.user.assert(a,b,"amp-iframely",c,void 0,void 0,void 0,void 0,void 0,void 0,void 0)}function P(a,b){return I(a,b)}new Set(["c","v","a","ad"]);function Q(a,b){if(!b)return a;var c=a.split("#",2),d=c[0].split("?",2),e=d[0]+(d[1]?"?"+d[1]+"&"+b:"?"+b);return e+=c[1]?"#"+c[1]:""}function R(a){var c,b=[];for(c in a){var d=a[c];if(null!=d){d=u(d)?d:[d];for(var e=0;e<d.length;e++){var f=b,k=f.push;var l=d[e];l=encodeURIComponent(c)+"="+encodeURIComponent(l);k.call(f,l)}}}return b.join("&")}function S(a){a=AMP.BaseElement.call(this,a)||this;a.C=null;a.h=null;a.j=null;a.B=null;a.o=null;a.A=null;a.D=null;return a}var T=AMP.BaseElement;S.prototype=g(T.prototype);S.prototype.constructor=S;if(r)r(S,T);else for(var U in T)if("prototype"!=U)if(Object.defineProperties){var V=Object.getOwnPropertyDescriptor(T,U);V&&Object.defineProperty(S,U,V)}else S[U]=T[U];S.G=T.prototype;S.prototype.isLayoutSupported=function(a){return"fixed"==a||"fixed-height"==a||"responsive"==a||"fill"==a||"flex-item"==a||"fluid"==a||"intrinsic"==a};S.prototype.buildCallback=function(){this.j=this.element.getAttribute("data-id");this.o=this.element.getAttribute("data-url");this.A=this.element.getAttribute("data-key");this.D=t(this.element.dataset);var a="cdn.iframe.ly",b=this.element.getAttribute("data-domain");b&&W(b)&&(a=b);this.B="https://"+a+"/";O(this.element.getAttribute("data-id")||this.element.getAttribute("data-url"),'<%s> requires either "data-id" or a pair of "data-url" and "data-key" attributes for %s',this.element);this.j||(this.o&&O(this.A,"Iframely data-key must also be set when you specify data-url parameter at <%s> %s",this.element),this.A&&O(this.o,"Iframely data-url must also be set when you specify data-key parameter at <%s> %s",this.element),(this.A||this.o)&&O(!this.j,"Iframely data-id should not be set when there is already a pair of data-url and data-key for <%s> %s",this.element));(this.j&&this.o||this.j&&this.A)&&O(!this.j,"Only one way of setting either data-id or data-url and data-key supported for <%s> %s",this.element);this.C=X(this,"/iframe")};S.prototype.preconnectCallback=function(a){this.preconnect&&this.preconnect.o&&this.preconnect.url(this.B,a)};S.prototype.createPlaceholderCallback=function(){var a=this.getLayout();if(this.element.hasAttribute("data-img")||"responsive"===a&&!this.element.hasAttribute("resizable")){a=X(this,"/thumbnail");a={src:Q(a,R(this.D)),loading:"lazy",placeholder:""};var c,b=this.element.ownerDocument.createElement("img");for(c in a)b.setAttribute(c,a[c]);v(b);return b}return null};S.prototype.layoutCallback=function(){var a=this;this.h=this.element.ownerDocument.createElement("iframe");G(this.h);this.h.setAttribute("sandbox","allow-scripts allow-same-origin allow-popups allow-forms allow-presentation");this.C=Q(this.C,R(this.D));this.h.src=this.C;v(this.h);this.element.appendChild(this.h);this.H=P(this.win,(function(b){b.source===a.h.contentWindow&&Y(a,b)}));return this.loadPromise(this.h)};function Y(a,b){try{var c=JSON.parse(b.data)}catch(e){c=null}if(b=c){if("resize"===b.method&&50<b.height)a.attemptChangeHeight(b.height).catch((function(){}));else if("setIframelyEmbedData"===b.method){var d=b.data.media||null;d&&d["aspect-ratio"]&&B(a.element).then((function(e){if(d["padding-bottom"])a.attemptChangeHeight(Math.round(e.boundingClientRect.width/d["aspect-ratio"]+d["padding-bottom"])).catch((function(){}));else{var f=e.boundingClientRect.width/d["aspect-ratio"];1<Math.abs(e.boundingClientRect.height-f)&&a.attemptChangeHeight(Math.round(f)).catch((function(){}))}}))}"cancelWidget"===b.method&&a.attemptCollapse().catch((function(){}))}}function X(a,b){return a.j?""+a.B+a.j+("/iframe"!==b?b:"")+"?amp=1":Q(a.B+"api"+b,R({url:a.o,key:a.A,amp:"1"}))}S.prototype.unlayoutCallback=function(){if(this.h){var b,a=this.h;null==(b=a.parentElement)||b.removeChild(a);this.h=null}this.F&&(this.F(),this.F=null);return!0};function W(a){return[/^(?:[^\.\/]+\.)?iframe\.ly$/i,/^if\-cdn\.com$/i,/^iframely\.net$/i,/^oembed\.vice\.com$/i,/^iframe\.nbcnews\.com$/i].reduce((function(b,c){return b||c.test(a)}),!1)}AMP.registerElement("amp-iframely",S)}});//# sourceMappingURL=amp-iframely-0.1.js.map