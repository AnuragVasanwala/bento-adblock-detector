(self.AMP=self.AMP||[]).push({m:0,v:"2110121450047",n:"amp-vk",ev:"0.1",l:true,f:function(AMP,_){"use strict";var e,f="function"==typeof Object.create?Object.create:function(a){function b(){}b.prototype=a;return new b};function h(a){for(var b=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global],c=0;c<b.length;++c){var d=b[c];if(d&&d.Math==Math)return}(function(){throw Error("Cannot find global object")})()}h(this);"function"===typeof Symbol&&Symbol("x");var m;if("function"==typeof Object.setPrototypeOf)m=Object.setPrototypeOf;else{var n;a:{var p={a:!0},r={};try{r.__proto__=p;n=r.a;break a}catch(a){}n=!1}m=n?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var t=m;var u=Array.isArray;
/* https://mths.be/cssescape v1.5.1 by @mathias | MIT license */var v=self.AMP_CONFIG||{},w=("string"==typeof v.cdnProxyRegex?new RegExp(v.cdnProxyRegex):v.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;function x(a){if(self.document&&self.document.head&&(!self.location||!w.test(self.location.origin))){var b=self.document.head.querySelector('meta[name="'+a+'"]');b&&b.getAttribute("content")}}v.cdnUrl||x("runtime-host");v.geoApiUrl||x("amp-geo-api");self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var y=self.__AMP_LOG;function z(a,b,c){if(!y.user)throw Error("failed to call initLogConstructor");return y.user.assert(a,b,c,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0)}function A(a,b){a=a.__AMP_TOP||(a.__AMP_TOP=a);return B(a,b)}function C(a){var b=D(a);b=D(b);b=b.isSingleDoc()?b.win:b;return B(b,"viewer")}function D(a){return a.nodeType?A((a.ownerDocument||a).defaultView,"ampdoc").getAmpDoc(a):a}function B(a,b){var c=a.__AMP_SERVICES;c||(c=a.__AMP_SERVICES={});a=c[b];a.obj||(a.obj=new a.ctor(a.context),a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}var G;function H(a,b){function c(k){try{return g(k)}catch(E){var l,F;null==(F=(l=self).__AMP_REPORT_ERROR)||F.call(l,E);throw E}}var d=a,g=b,q=I();d.addEventListener("message",c,q?void 0:!1);return function(){var k;null==(k=d)||k.removeEventListener("message",c,q?void 0:!1);c=d=g=null}}function I(){if(void 0!==G)return G;G=!1;try{var a={get capture(){G=!0}};self.addEventListener("test-options",null,a);self.removeEventListener("test-options",null,a)}catch(b){}return G}function J(a,b){return H(a,b)}new Set(["c","v","a","ad"]);function K(a,b){if(!b)return a;var c=a.split("#",2),d=c[0].split("?",2),g=d[0]+(d[1]?"?"+d[1]+"&"+b:"?"+b);return g+=c[1]?"#"+c[1]:""}function L(a){var c,b=[];for(c in a){var d=a[c];if(null!=d){d=u(d)?d:[d];for(var g=0;g<d.length;g++){var q=b,k=q.push;var l=d[g];l=encodeURIComponent(c)+"="+encodeURIComponent(l);k.call(q,l)}}}return b.join("&")}function M(a){a=AMP.BaseElement.call(this,a)||this;a.j=null;a.G=0;a.o=null;a.h=null;a.C=null;a.F=null;a.B=null;a.A=null;a.D=null;return a}var N=AMP.BaseElement;M.prototype=f(N.prototype);M.prototype.constructor=M;if(t)t(M,N);else for(var O in N)if("prototype"!=O)if(Object.defineProperties){var P=Object.getOwnPropertyDescriptor(N,O);P&&Object.defineProperty(M,O,P)}else M[O]=N[O];M.I=N.prototype;e=M.prototype;e.preconnectCallback=function(a){A(this.win,"preconnect").url(this.getAmpDoc(),"https://vk.com",a)};function Q(a){var c,b=Date.now().toString(16);"post"===a.h?c=R(a):"poll"===a.h&&(c=S(a));return c.then((function(d){return K(d,b)}))}function R(a){return C(a.element).getReferrerUrl().then((function(b){var c=a.element.offsetWidth,d=a.getAmpDoc().getUrl();return K("https://vk.com/widget_post.php",L({app:"0",width:"100%",_ver:"1",owner_id:a.C,post_id:a.F,hash:a.B,amp:"1",startWidth:c,url:d,referrer:b,title:"AMP Post"}))}))}function S(a){return C(a.element).getReferrerUrl().then((function(b){var c=a.getAmpDoc().getUrl();return K("https://vk.com/al_widget_poll.php",L({app:a.A,width:"100%",_ver:"1",poll_id:a.D,amp:"1",url:c,title:"AMP Poll",description:"",referrer:b}))}))}e.buildCallback=function(){this.h=z(this.element.getAttribute("data-embedtype"),"The data-embedtype attribute is required for <amp-vk> %s",this.element);z("post"===this.h||"poll"===this.h,"Unknown data-embedtype: "+this.h);"post"===this.h?(this.C=z(this.element.getAttribute("data-owner-id"),"The data-owner-id attribute is required for <amp-vk> Post %s",this.element),this.F=z(this.element.getAttribute("data-post-id"),"The data-post-id attribute is required for <amp-vk> Post %s",this.element),this.B=z(this.element.getAttribute("data-hash"),"The data-hash attribute is required for <amp-vk> Post %s",this.element)):"poll"===this.h&&(this.A=z(this.element.getAttribute("data-api-id"),"The data-api-id attribute is required for <amp-vk> Poll %s",this.element),this.D=z(this.element.getAttribute("data-poll-id"),"The data-poll-id attribute is required for <amp-vk> Poll %s",this.element))};e.layoutCallback=function(){var a=this,b=this.element.ownerDocument.createElement("iframe");this.j=b;this.o=J(this.win,this.H.bind(this));return Q(this).then((function(c){b.src=c;b.setAttribute("name","fXD");b.setAttribute("scrolling","no");b.setAttribute("frameborder","0");b.setAttribute("allowfullscreen","true");b.classList.add("i-amphtml-fill-content");a.element.appendChild(b);return a.loadPromise(b)}))};e.H=function(a){if("https://vk.com"===a.origin&&a.source===this.j.contentWindow){var b=a.data;b&&(a=/\["resize",\[(\d+)\]]/.exec(b))&&a[1]&&(a=parseInt(a[1],10),this.G!==a&&(this.G=a,this.forceChangeHeight(a)))}};e.isLayoutSupported=function(a){return"responsive"===a||"flex-item"===a||"fixed"===a};e.unlayoutOnPause=function(){return!0};e.unlayoutCallback=function(){if(this.j){var b,a=this.j;null==(b=a.parentElement)||b.removeChild(a);this.j=null}this.o&&this.o();return!0};AMP.registerElement("amp-vk",M)}});//# sourceMappingURL=amp-vk-0.1.js.map