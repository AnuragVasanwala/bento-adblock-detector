(self.AMP=self.AMP||[]).push({m:0,v:"2110121450047",n:"amp-viewer-integration",ev:"0.1",l:true,p:"high",f:function(AMP,_){"use strict";var n;function aa(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}var p;function q(){return p?p:p=Promise.resolve(void 0)}function ba(){var a=this;this.promise=new Promise((function(b,c){a.resolve=b;a.reject=c}))}function r(a){return a||{}}function ca(a,b){for(var c=[],d=0,e=0;e<a.length;e++){var f=a[e];b(f,e,a)?c.push(f):(d<e&&(a[d]=f),d++)}d<a.length&&(a.length=d);return c}function ea(a){var b=a.length-6;return 0<=b&&a.indexOf("sticky",b)==b}
/* https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
function fa(a){return a.parent&&a.parent!=a}var t=self.AMP_CONFIG||{},ha=("string"==typeof t.cdnProxyRegex?new RegExp(t.cdnProxyRegex):t.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;function ia(a){if(!self.document||!self.document.head||self.location&&ha.test(self.location.origin))return null;var b=self.document.head.querySelector('meta[name="'+a+'"]');return b&&b.getAttribute("content")||null}var ja={thirdParty:t.thirdPartyUrl||"https://3p.ampproject.net",thirdPartyFrameHost:t.thirdPartyFrameHost||"ampproject.net",thirdPartyFrameRegex:("string"==typeof t.thirdPartyFrameRegex?new RegExp(t.thirdPartyFrameRegex):t.thirdPartyFrameRegex)||/^d-\d+\.ampproject\.net$/,cdn:t.cdnUrl||ia("runtime-host")||"https://cdn.ampproject.org",cdnProxyRegex:ha,localhostRegex:/^https?:\/\/localhost(:\d+)?$/,errorReporting:t.errorReportingUrl||"https://us-central1-amp-error-reporting.cloudfunctions.net/r",betaErrorReporting:t.betaErrorReportingUrl||"https://us-central1-amp-error-reporting.cloudfunctions.net/r-beta",localDev:t.localDev||!1,trustedViewerHosts:[/(^|\.)google\.(com?|[a-z]{2}|com?\.[a-z]{2}|cat)$/,/(^|\.)gmail\.(com|dev)$/],geoApi:t.geoApiUrl||ia("amp-geo-api")};var ka=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;function la(a,b){var c=b=void 0===b?"":b;try{return decodeURIComponent(a)}catch(d){return c}}function ma(a){var b=null,c="";var d=arguments;var e="undefined"!=typeof Symbol&&Symbol.iterator&&d[Symbol.iterator];d=e?e.call(d):{next:aa(d)};for(e=d.next();!e.done;e=d.next())if(e=e.value,e instanceof Error&&!b){var f=b=void 0;if(null==(f=Object.getOwnPropertyDescriptor(e,"message"))?0:f.writable)b=e;else{f=e.stack;var g=Error(e.message);for(b in e)g[b]=e[b];g.stack=f;b=g}}else c&&(c+=" "),c+=e;b?c&&(b.message=c+": "+b.message):b=Error(c);return b}function na(a,b){for(var c=[],d=1;d<arguments.length;++d)c[d-1]=arguments[d];c=ma.apply(null,c);c.name=a||c.name;var e,f;null==(f=(e=self).__AMP_REPORT_ERROR)||f.call(e,c)}function oa(a){var b=!1,c=null,d=a;return function(e){for(var f=[],g=0;g<arguments.length;++g)f[g-0]=arguments[g];b||(c=d.apply(self,f),b=!0,d=null);return c}}self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var w=self.__AMP_LOG;function pa(){throw Error("failed to call initLogConstructor")}function x(){w.user||(w.user=pa());return w.user}function y(){return w.dev||(w.dev=pa())}function qa(a,b,c){x().assert(a,b,c,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0)}function z(a,b){a=a.__AMP_TOP||(a.__AMP_TOP=a);return A(a,b)}function B(a,b){var c=C(a);c=ra(c);return A(c,b)}function sa(a){a=C(a);a=ra(a);return ta(a,"hidden-observer")?A(a,"hidden-observer"):null}function C(a){return a.nodeType?z((a.ownerDocument||a).defaultView,"ampdoc").getAmpDoc(a):a}function ra(a){a=C(a);return a.isSingleDoc()?a.win:a}function A(a,b){ta(a,b);var c=a.__AMP_SERVICES;c||(c=a.__AMP_SERVICES={});a=c[b];a.obj||(a.obj=new a.ctor(a.context),a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}function ta(a,b){a=a.__AMP_SERVICES&&a.__AMP_SERVICES[b];return!(!a||!a.ctor)}var D,ua="Webkit webkit Moz moz ms O o".split(" "),E={getPropertyPriority:function(){return""},getPropertyValue:function(){return""}};function F(a,b,c){if(b.startsWith("--"))return b;D||(D=Object.create(null));var d=D[b];if(!d||c){d=b;if(void 0===a[b]){var e=b.charAt(0).toUpperCase()+b.slice(1);a:{for(var f=0;f<ua.length;f++){var g=ua[f]+e;if(void 0!==a[g]){e=g;break a}}e=""}var k=e;void 0!==a[k]&&(d=k)}c||(D[b]=d)}return d}function G(a,b,c){(b=F(a.style,b,void 0))&&(b.startsWith("--")?a.style.setProperty(b,c):a.style[b]=c)}function va(a,b){if(b=F(a.style,b,void 0))return b.startsWith("--")?a.style.getPropertyValue(b):a.style[b]}function H(a,b){for(var c in b)G(a,c,b[c])}function wa(a){var b=!1;void 0===b&&(b=a.hasAttribute("hidden"));b?a.removeAttribute("hidden"):a.setAttribute("hidden","")}function xa(a,b,c,d){return function(e){return I(e,a,b,c,d)}}function I(a,b,c,d,e){a:{var f=a-0;if(0>=f)a=0;else if(1<=f)a=1;else{for(var g=0,k=1,h=0,l=0;8>l;l++){h=ya(f,b,d);var m=(ya(f+1e-6,b,d)-h)/1e-6;if(1e-6>Math.abs(h-a)){a=f;break a}if(1e-6>Math.abs(m))break;else h<a?g=f:k=f,f-=(h-a)/m}for(l=0;1e-6<Math.abs(h-a)&&8>l;l++)h<a?(g=f,f=(f+k)/2):(k=f,f=(f+g)/2),h=ya(f,b,d);a=f}}0==a?e=0:1==a?e=1:(b=J(0,c,a),c=J(c,e,a),e=J(e,1,a),b=J(b,c,a),c=J(c,e,a),e=J(b,c,a));return e}function ya(a,b,c){if(0==a)return 0;if(1==a)return 1;var d=J(0,b,a),e=J(b,c,a),f=J(c,1,a);d=J(d,e,a);e=J(e,f,a);return J(d,e,a)}function J(a,b,c){return a+c*(b-a)}var za={linear:function(a){return a},ease:function(a){return I(a,.25,.1,.25,1)},"ease-in":function(a){return I(a,.42,0,1,1)},"ease-out":function(a){return I(a,0,0,.58,1)},"ease-in-out":function(a){return I(a,.42,0,.58,1)}};function Aa(a){if(!a)return null;if("string"==typeof a){if(-1!=a.indexOf("cubic-bezier")){var b=a.match(/cubic-bezier\((.+)\)/);if(b&&(b=b[1].split(",").map(parseFloat),4==b.length)){for(var c=0;4>c;c++)if(isNaN(b[c]))return null;return xa(b[0],b[1],b[2],b[3])}return null}return za[a]}return a}function Ba(){}function K(a){this.K=a;this.A=z(self,"vsync");this.qa=null;this.o=[]}function Ca(a,b,c,d){return new K(a).setCurve(d).add(0,b,1).start(c)}K.prototype.setCurve=function(a){a&&(this.qa=Aa(a));return this};K.prototype.add=function(a,b,c,d){this.o.push({delay:a,func:b,duration:c,curve:Aa(d)});return this};K.prototype.start=function(a){return new L(this.A,this.K,this.o,this.qa,a)};function L(a,b,c,d,e){this.A=a;this.K=b;this.o=[];for(b=0;b<c.length;b++){var f=c[b];this.o.push({delay:f.delay,func:f.func,duration:f.duration,curve:f.curve||d,started:!1,completed:!1})}this.Ha=e;this.Ra=Date.now();this.G=!0;this.wa={};c=new ba;this.ua=c.promise;this.Oa=c.resolve;this.Ma=c.reject;this.ya=this.A.createAnimTask(this.K,{mutate:this.Sa.bind(this)});this.A.canAnimate(this.K)?this.ya(this.wa):(y().warn("Animation","cannot animate"),M(this,!1,0))}L.prototype.then=function(a,b){return a||b?this.ua.then(a,b):this.ua};L.prototype.thenAlways=function(a){a=a||Ba;return this.then(a,a)};L.prototype.halt=function(a){M(this,!1,a||0)};function M(a,b,c){if(a.G){a.G=!1;if(0!=c){1<a.o.length&&a.o.sort((function(e,f){return e.delay+e.duration-(f.delay+f.duration)}));try{if(0<c)for(c=0;c<a.o.length;c++)a.o[c].func(1,!0);else for(var d=a.o.length-1;0<=d;d--)a.o[d].func(0,!1)}catch(e){y().error("Animation","completion failed: "+e,e),b=!1}}b?a.Oa():a.Ma()}}L.prototype.Sa=function(){if(this.G){for(var a=Date.now(),b=Math.min((a-this.Ra)/this.Ha,1),c=0;c<this.o.length;c++){var d=this.o[c];!d.started&&b>=d.delay&&(d.started=!0)}for(c=0;c<this.o.length;c++)if(d=this.o[c],d.started&&!d.completed)a:{var e;if(0<d.duration){var f=e=Math.min((b-d.delay)/d.duration,1);if(d.curve&&1!=f)try{f=d.curve(e)}catch(g){y().error("Animation","step curve failed: "+g,g);M(this,!1,0);break a}}else f=e=1;1==e&&(d.completed=!0);try{d.func(f,d.completed)}catch(g){y().error("Animation","step mutate failed: "+g,g),M(this,!1,0)}}1==b?M(this,!0,0):this.A.canAnimate(this.K)?this.ya(this.wa):(y().warn("Animation","cancel animation"),M(this,!1,0))}};function N(a,b){var c=this;this.za=A(a,"timer");this.Ka=b;this.Ga=0;this.M=-1;this.fa=0;this.G=!1;this.Ca=function(){c.M=-1;c.fa=0;c.G=!0;c.Ka();c.G=!1}}N.prototype.isPending=function(){return-1!=this.M};N.prototype.schedule=function(a){a=a||this.Ga;this.G&&10>a&&(a=10);var b=Date.now()+a;return!this.isPending()||-10>b-this.fa?(this.cancel(),this.fa=b,this.M=this.za.delay(this.Ca,a),!0):!1};N.prototype.cancel=function(){this.isPending()&&(this.za.cancel(this.M),this.M=-1)};function Da(a,b,c,d,e){var f=this;this.ampdoc=a;this.A=b;this.Ba=c;this.S=this.ia=d;this.O=e&&a.isSingleDoc();this.D=null;this.Fa=0;this.h=[];this.Z=new N(a.win,(function(){return f.update()}));this.V=null;this.U=[];this.X=[]}n=Da.prototype;n.enterLightbox=function(a,b){var c=this,d=O(this);d&&d.setLightboxMode(!0);a&&b&&b.then((function(){Ga(c,a,!0);Ha(c);c.update()}))};n.leaveLightbox=function(){var a=O(this);a&&a.setLightboxMode(!1);var b=ca(this.h,(function(c){return!!c.lightboxed}));Ia(this,b);this.h.length||Ja(this)};n.setup=function(){if(!B(this.ampdoc,"viewer").isEmbedded())return!1;var a=this.ampdoc.getRootNode(),b=a.styleSheets;if(!b)return!0;this.U.length=0;for(var c=this.X.length=0;c<b.length;c++){var d=b[c];if(!d)return y().error("FixedLayer","Aborting setup due to null stylesheet."),!0;var e=d,f=e.ownerNode;e.disabled||!f||"STYLE"!=f.tagName||f.hasAttribute("amp-boilerplate")||f.hasAttribute("amp-runtime")||f.hasAttribute("amp-extension")||Ka(this,d.cssRules)}Ga(this,a,void 0);Ha(this);this.update();0<this.h.length&&this.observeHiddenMutations();var g=z(this.ampdoc.win,"platform");0<this.h.length&&!this.O&&g.isIos()&&x().warn("FixedLayer","Please test this page inside of an AMP Viewer such as Google's because the fixed or sticky positioning might have slightly different layout.");return!0};n.observeHiddenMutations=function(){La(this)};function Ja(a){a.Z.cancel();var b=a.V;b&&(b(),a.V=null)}function La(a){if(!a.V){var b=a.ampdoc.getRootNode();a.V=sa(b.documentElement||b).add((function(){a.Z.isPending()||a.Z.schedule(16)}))}}n.updatePaddingTop=function(a,b){this.ia=a;b||(this.S=a);this.update()};n.transformMutate=function(a){a?this.h.forEach((function(b){b.fixedNow&&b.top&&(G(b.element,"transition","none"),b.transform&&"none"!=b.transform?G(b.element,"transform",b.transform+" "+a):G(b.element,"transform",a))})):this.h.forEach((function(b){b.fixedNow&&b.top&&H(b.element,{transform:"",transition:""})}))};n.addElement=function(a,b){if(!Ma(this,a,"*","fixed",b))return q();Ha(this);this.observeHiddenMutations();return this.update()};n.removeElement=function(a){a=Na(this,a);Ia(this,a)};function Ia(a,b){0<b.length&&a.D&&a.A.mutate((function(){for(var c=0;c<b.length;c++){var d=b[c];"fixed"==d.position&&a.D.returnFrom(d)}}))}n.isDeclaredFixed=function(a){return!!a.__AMP_DECLFIXED};n.isDeclaredSticky=function(a){return!!a.__AMP_DECLSTICKY};n.update=function(){var a=this;this.h.filter((function(c){return!a.ampdoc.contains(c.element)})).forEach((function(c){return Na(a,c.element)}));if(0==this.h.length)return q();this.Z.cancel();var b=!1;return this.A.runPromise({measure:function(c){for(var d=a.h,e=[],f=a.ampdoc.win,g=0;g<d.length;g++){var k=void 0,h={top:"",bottom:"-9999vh",transition:"none"},l=d[g].element.style;for(k in h)l.setProperty(F(l,k),String(h[k]),"important")}for(g=0;g<d.length;g++)e.push((f.getComputedStyle(d[g].element)||E).top);for(g=0;g<d.length;g++)G(d[g].element,"bottom","");for(g=0;g<d.length;g++){h=k=d[g];l=h.element;var m=h.forceTransfer;h=f.getComputedStyle(l)||E;var u=l.offsetHeight,R=l.offsetTop,nb=l.offsetWidth,v=h;l=v.bottom;var ob=void 0===v.display?"":v.display,Ea=void 0===v.position?"":v.position,pb=v.zIndex,qb=parseFloat(h.opacity);v=h[F(h,"transform")];h=h.top;var S="fixed"===Ea&&(m||0<nb&&0<u),Fa=ea(Ea);if("none"===ob||!S&&!Fa)c[k.id]={fixed:!1,sticky:!1,transferrable:!1,top:"",zIndex:""};else{if("auto"===h||e[g]!==h)h=S&&R===a.S+a.Ba?"0px":"";var da=!1;S&&(da=!0===m?!0:!1===m?!1:0<qb&&300>u&&!(!h&&!l));da&&(b=!0);c[k.id]={fixed:S,sticky:Fa,transferrable:da,top:h,zIndex:pb,transform:v}}}},mutate:function(c){b&&a.O&&O(a).update();for(var d=a.h,e=0;e<d.length;e++){var f=d[e],g=c[f.id];G(f.element,"transition","none");G(f.element,"transition","");if(g){var k=e,h=g,l=f.element,m=f.fixedNow;f.fixedNow=h.fixed;f.stickyNow=h.sticky;f.top=h.fixed||h.sticky?h.top:"";f.transform=h.transform;!m||h.fixed&&h.transferrable||!a.D||a.D.returnFrom(f);h.top&&(h.fixed||h.sticky)&&!f.lightboxed&&(h.fixed||!a.O?G(l,"top","calc("+h.top+" + "+a.ia+"px)"):a.S===a.ia?G(l,"top",h.top):G(l,"top","calc("+h.top+" - "+a.S+"px)"));a.O&&h.fixed&&h.transferrable&&O(a).transferTo(f,k,h)}}}},{}).catch((function(c){y().error("FixedLayer","Failed to mutate fixed elements:",c)}))};function Ga(a,b,c){try{for(var d=0;d<a.U.length;d++)for(var e=a.U[d],f=b.querySelectorAll(e),g=0;g<f.length&&!(10<a.h.length);g++)Ma(a,f[g],e,"fixed",void 0,c);for(d=0;d<a.X.length;d++){var k=a.X[d],h=b.querySelectorAll(k);for(e=0;e<h.length;e++)Ma(a,h[e],k,"sticky",void 0,c)}}catch(l){y().error("FixedLayer","Failed to setup fixed elements:",l)}}function Ma(a,b,c,d,e,f){e||b.hasAttribute("style")&&(va(b,"top")||va(b,"bottom"))&&x().error("FixedLayer","Inline styles with `top`, `bottom` and other CSS rules are not supported yet for fixed or sticky elements (#14186). Unexpected behavior may occur.",b);if(-1!==b.tagName.indexOf("LIGHTBOX"))return!1;var g;a:{for(g=b;g&&void 0!==g;g=g.parentElement)if(-1!==g.tagName.indexOf("LIGHTBOX"))break a;g=null}var k=g;if(!f&&k)return!1;f=a.h;var h=[];for(g=0;g<f.length;g++){var l=f[g].element;if(l===b)break;if(l.contains(b))return!1;b.contains(l)&&h.push(l)}for(g=0;g<h.length;g++)a.removeElement(h[g]);g=null;for(l=0;l<f.length;l++){var m=f[l];if(m.element==b&&m.position==d){g=m;break}}l="fixed"==d;g?g.selectors.includes(c)||g.selectors.push(c):(a="F"+a.Fa++,b.setAttribute("i-amphtml-fixedid",a),l?b.__AMP_DECLFIXED=!0:b.__AMP_DECLSTICKY=!0,g={id:a,element:b,position:d,selectors:[c],fixedNow:!1,stickyNow:!1,lightboxed:!!k},f.push(g));g.forceTransfer=l?e:!1;return!0}function Na(a,b){for(var c=[],d=0;d<a.h.length;d++){var e=a.h[d];e.element===b&&(e.lightboxed||a.A.mutate((function(){G(b,"top","")})),a.h.splice(d,1),c.push(e))}a.h.length||Ja(a);return c}function Ha(a){a.h.sort((function(b,c){var d=b.element,e=c.element;return d===e?0:d.compareDocumentPosition(e)&(Node.DOCUMENT_POSITION_PRECEDING|Node.DOCUMENT_POSITION_CONTAINS)?1:-1}))}function O(a){if(!a.O||a.D)return a.D;a.D=new Oa(a.ampdoc.win.document,a.A);return a.D}function Ka(a,b){for(var c=0;c<b.length;c++){var d=b[c];if(4==d.type||12==d.type)Ka(a,d.cssRules);else if(1==d.type){var e=d.selectorText;d=d.style.position;"*"!==e&&d&&("fixed"===d?a.U.push(e):ea(d)&&a.X.push(e))}}}n.animateFixedElements=function(a,b,c,d,e){function f(k){return b-a+(a-b)*k}var g=this;this.updatePaddingTop(a,e);return 0>=c?q():Ca(this.ampdoc.getRootNode(),(function(k){var h=f(k);g.transformMutate("translateY("+h+"px)")}),c,d).thenAlways((function(){g.transformMutate(null)}))};function Oa(a,b){this.T=a;this.A=b;this.C=a.body.cloneNode(!1);this.C.removeAttribute("style");b=this.C;var c={position:"absolute",top:0,left:0,height:0,width:0,pointerEvents:"none",overflow:"hidden",animation:"none",background:"none",border:"none",borderImage:"none",boxSizing:"border-box",boxShadow:"none",float:"none",margin:0,opacity:1,outline:"none",padding:"none",transform:"none",transition:"none"};"display"in c&&na("STYLE","`display` style detected. You must use toggle instead.");H(b,c);this.C.style.display="block";a.documentElement.appendChild(this.C)}n=Oa.prototype;n.getRoot=function(){return this.C};n.setLightboxMode=function(a){var b=this;this.A.mutate((function(){var c=b.getRoot();a?c.setAttribute("i-amphtml-lightbox",""):c.removeAttribute("i-amphtml-lightbox")}))};n.update=function(){for(var a=this.T.body,b=this.C,c=a.attributes,d=b.attributes,e=0;e<c.length;e++){var f=c[e];"style"!==f.name&&d.setNamedItem(f.cloneNode(!1))}for(e=0;e<d.length;e++)f=d[e].name,"style"===f||"i-amphtml-lightbox"===f||a.hasAttribute(f)||(b.removeAttribute(f),e--)};n.transferTo=function(a,b,c){var d=a.element;if(d.parentElement!=this.C){y().fine("FixedLayer","transfer to fixed:",a.id,a.element);x().warn("FixedLayer","In order to improve scrolling performance in Safari, we now move the element to a fixed positioning layer:",a.element);if(!a.placeholder){G(d,"pointer-events","initial");var e=a.placeholder=this.T.createElement("i-amphtml-fpa");wa(e);e.setAttribute("i-amphtml-fixedid",a.id)}G(d,"zIndex","calc("+(1e4+b)+" + "+(c.zIndex||0)+")");a.lightboxed&&d.classList.add("i-amphtml-lightbox-element");d.parentElement.replaceChild(a.placeholder,d);this.C.appendChild(d);a.selectors.some((function(f){try{var g=d.matches||d.webkitMatchesSelector||d.mozMatchesSelector||d.msMatchesSelector||d.oMatchesSelector;var k=g?g.call(d,f):!1}catch(h){y().error("FixedLayer","Failed to test query match:",h),k=!1}return k}))||(x().warn("FixedLayer","Failed to move the element to the fixed position layer. This is most likely due to the compound CSS selector:",a.element),this.returnFrom(a))}};n.returnFrom=function(a){if(a.placeholder&&this.T.contains(a.placeholder)){var b=a.element,c=a.placeholder;y().fine("FixedLayer","return from fixed:",a.id,b);a.lightboxed&&b.classList.remove("i-amphtml-lightbox-element");this.T.contains(b)?(G(a.element,"zIndex",""),c.parentElement.replaceChild(b,c)):c.parentElement.removeChild(c)}};var P;function Q(a,b,c,d){function e(l){try{return g(l)}catch(R){var m,u;null==(u=(m=self).__AMP_REPORT_ERROR)||u.call(m,R);throw R}}var f=a,g=c,k=Pa(),h=!(null==d||!d.capture);f.addEventListener(b,e,k?d:h);return function(){var l;null==(l=f)||l.removeEventListener(b,e,k?d:h);e=f=g=null}}function Pa(){if(void 0!==P)return P;P=!1;try{var a={get capture(){P=!0}};self.addEventListener("test-options",null,a);self.removeEventListener("test-options",null,a)}catch(b){}return P}function Qa(a,b,c,d){return Q(a,b,c,d)}function Ra(a,b,c){var d=c,e=Q(a,b,(function(f){try{d(f)}finally{d=null,e()}}),void 0)}function Sa(a,b){this.win=a;this.L=b;Qa(this.win.document,"focusin",this.aa.bind(this),{capture:!1})}Sa.prototype.aa=function(a){a.defaultPrevented||this.L.sendRequest(a.type,r({focusTargetRect:a.target.getBoundingClientRect()}),!1)};function Ta(a){return"loading"!=a.readyState&&"uninitialized"!=a.readyState}function Ua(a,b){var c=Ta(a);if(c)b(a);else{var d=function(){Ta(a)&&(c||(c=!0,b(a)),a.removeEventListener("readystatechange",d))};a.addEventListener("readystatechange",d)}}function Va(a){return new Promise((function(b){Ua(a,b)}))}function T(a){this.da=a;this.P=[];this.W=0}T.prototype.push=function(a){this.P[this.W]=a;this.W=(this.W+1)%this.da};T.prototype.get=function(a){this.P.length>=this.da&&(a=(this.W+a)%this.da);return this.P[a]};T.prototype.size=function(){return this.P.length};var Wa=/[,.\s\u2022()]/;function Xa(a){return"’"==a||"‘"==a?"'":"“"==a||"”"==a?'"':a.toLowerCase()}function Ya(a){for(var b=[],c=0;c<a.length;c++){for(var d=a[c],e=[],f=0;f<d.length;f++){var g=d[f];Wa.test(g)||e.push(Xa(g))}var k=e.join("");k&&b.push(k)}return b}function Za(a,b){this.Qa=a;this.Da=b;this.matches=[];this.va={};this.ma=a.length-1;for(b=0;b<a.length;b++)this.va[a[b]]=a.length-1-b}Za.prototype.update=function(){if(0<this.ma)this.ma--;else{for(var a=this.Da,b=this.Qa,c=a.size(),d=0;d<b.length;d++){var e=a.get(c-1-d).pos;e=Xa(e.node.wholeText[e.offset]);if(b[b.length-1-d]!=e){var f=this.va[e];null==f&&(f=b.length);f-=d;1>f&&(f=1);this.ma=f-1;return}}var g=a.get(c-1),k=g.pos;this.matches.push({start:a.get(c-b.length),end:{pos:{node:k.node,offset:k.offset+1},idx:g.idx+1}})}};function $a(a,b,c){c=Ya(c);if(0>=c.length)return null;var d=new U(a,b);a=new T(c.map((function(l){return l.length})).reduce((function(l,m){return Math.max(l,m)})));for(var e=[new Za(c[0],a)],f=-1;;){f++;b=d.next();if(null==b)return null;if(!Wa.test(b.node.wholeText[b.offset])){a.push({pos:b,idx:f});for(b=0;b<e.length;b++)e[b].update();if(0!=e[e.length-1].matches.length){if(e.length==c.length)break;e.push(new Za(c[e.length],a))}}}a=[];c=c.length-1;a:for(;0<=c;c--){var g=e[c].matches;if(0==a.length)a.push(g[g.length-1]);else{var k=a[a.length-1];for(b=g.length-1;0<=b;b--){var h=g[b];if(k.start.idx>=h.end.idx){a.push(h);continue a}}}}c=[];for(b=a.length-1;0<=b;b--)h=a[b],c.push({start:h.start.pos,end:h.end.pos});return c}function ab(a,b,c,d,e){if(c>=d)return null;a=a.document;var f=b.parentNode,g=b.wholeText;0<c&&f.insertBefore(a.createTextNode(g.substring(0,c)),b);var k=a.createElement("span");k.appendChild(a.createTextNode(g.substring(c,d)));f.insertBefore(k,b);e.push(k);var h=null;d<g.length&&(h=a.createTextNode(g.substring(d)),f.insertBefore(h,b));f.removeChild(b);return h}function U(a,b){this.I=a;this.ga=b;this.N=-1;this.J=null;b instanceof a.Text?this.N=0:b instanceof a.Element&&"none"!=(a.getComputedStyle(b)||E).display&&(b=b.firstChild,null!=b&&(this.J=new U(a,b)))}U.prototype.next=function(){if(0<=this.N){if(this.N<this.ga.wholeText.length){var a=this.N;this.N++;a={node:this.ga,offset:a}}else a=null;return a}for(;null!=this.J;){a=this.J.next();if(null!=a)return a;var b=this.J.ga.nextSibling;this.J=null!=b?new U(this.I,b):null}return null};function bb(a){a=a.win.location.hash;var b=Object.create(null);if(a)for(var c;c=ka.exec(a);){var d=la(c[1],c[1]);c=c[2]?la(c[2].replace(/\+/g," "),c[2]):"";b[d]=c}a=b.highlight;if(!a||102400<a.length)return null;var e=JSON.parse(a),f=e.s;if(!(f instanceof Array)||15<f.length)return null;var g=0;for(a=0;a<f.length;a++){b=f[a];if("string"!=typeof b||!b)return null;g+=b.length;if(1500<g)return null}var k=!1;e.n&&(k=!0);var h=!1;e.na&&(h=!0);return{sentences:f,skipScrollAnimation:h,skipRendering:k}}function V(a,b){var c=this;this.j=a;this.Ta=B(a,"viewer");this.F=B(this.j,"viewport");this.B=null;var d=z(this.j.win,"platform");"fragmentDirective"in document&&d.isChrome()&&93<=d.getMajorVersion()?a.whenFirstVisible().then((function(){return cb(c,b)})):Va(a.win.document).then((function(){db(c,b)}))}function cb(a,b){b=b.sentences;if(null!=b&&b.length){var c=b.map((function(d){return"text="+encodeURIComponent(d)})).join("&");eb(a,c)}}function eb(a,b){var c=a.j.win.location.hash;c?a.j.win.location.replace(c+":~:"+b):a.j.win.location.replace("#:~:"+b)}function W(a,b,c){b=r({state:b});for(var d in c)b[d]=c[d];a.Ta.sendMessage("highlightState",b)}function fb(a,b){var c=a.j.win;if(b=$a(c,a.j.getBody(),b.sentences)){for(var d=[],e=null,f=0;f<b.length;f++){var g=b[f];e&&e.end.node==g.start.node&&e.end.offset==g.start.offset?e.end=g.end:(e=g,d.push(g))}b=d;d=[];for(e=0;e<b.length;e++){f=b[e];var k=f.start,h=f.end;g=b;for(f=e;;){if(k.node==h.node){if(k=ab(c,k.node,k.offset,h.offset,d))for(f+=1;f<g.length;f++){var l=g[f];if(h.node!=l.start.node)break;l.start.node=k;l.start.offset-=h.offset;if(h.node!=l.end.node)break;l.end.node=k;l.end.offset-=h.offset}break}a:{l=!0;for(var m=k.node;;){if(null==m){l=null;break a}if(l){var u=m.nextSibling;u?(m=u,l=!1):m=m.parentNode}else{if(m instanceof c.Text){l=m;break a}m.firstChild?m=m.firstChild:l=!0}}}ab(c,k.node,k.offset,k.node.wholeText.length,d);if(!l)break;k={node:l,offset:0}}}d&&0!=d.length&&(a.B=d)}}V.prototype.onVisibleOnce=function(a){var b=this;a=oa(a);this.j.onVisibilityChanged((function(){"visible"==b.j.getVisibilityState()&&a()}))};function db(a,b){if(a.j.win.document.querySelector('script[id="amp-access"]'))W(a,"has_amp_access");else if(fb(a,b),a.B){var c=X(a);W(a,"found",r({scroll:c}));if(!b.skipRendering){for(var d=0;d<a.B.length;d++)H(a.B[d],{backgroundColor:"#fcff00",color:"#000"});var e=a.j.getVisibilityState();b.skipScrollAnimation?"visible"==e?gb(a,c):(a.F.setScrollTop(c),a.onVisibleOnce((function(){gb(a,X(a))}))):"visible"==e?hb(a,c):(a.F.setScrollTop(Math.max(0,c-500)),a.onVisibleOnce((function(){hb(a,X(a))})));Ra(a.j.getBody(),"click",a.sa.bind(a))}}else W(a,"not_found")}function X(a){var b=a.B;if(!b)return 0;a=a.F;for(var c=Number.MAX_VALUE,d=0,e=a.getPaddingTop(),f=0;f<b.length;f++){var g=a.getLayoutRect(b[f]),k=-e;if(0==k||0==g.width&&0==g.height)var h=g;else{h=g.left+0;k=g.top+k;var l=g.width;g=g.height;h={left:h,top:k,width:l,height:g,bottom:k+g,right:h+l,x:h,y:k}}g=h.bottom;c=Math.min(c,h.top);d=Math.max(d,g)}if(c>=d)return 0;b=a.getHeight()-e;b=(d+c-b)/2;b>c-80&&(b=c-80);return 0<b?b:0}function gb(a,b){W(a,"auto_scroll");a.F.setScrollTop(b);W(a,"shown")}function hb(a,b){a.F.setScrollTop(Math.max(0,b-500));var c=a.j.win.document.createElement("div");c.style.display="block";H(c,{position:"absolute",top:Math.floor(b)+"px",height:"1px",left:"0",width:"1px","pointer-events":"none"});var d=a.j.getBody();d.appendChild(c);W(a,"auto_scroll");a.F.animateScrollIntoView(c).then((function(){d.removeChild(c);var e=X(a);var f=a.F.getScrollTop();if(f==e&&f==b)e=null;else{var g={};f!=e&&(a.F.setScrollTop(e),g.nd=f-e);f!=b&&(g.od=f-b);e=g}W(a,"shown",e)}))}V.prototype.setupMessaging=function(a){a.registerHandler("highlightDismiss",this.sa.bind(this))};V.prototype.sa=function(){if(this.B)for(var a=0;a<this.B.length;a++)for(var b=this.B[a],c=["backgroundColor","color"],d=0;d<c.length;d++)G(b,c[d],null)};var ib="key code location ctrlKey shiftKey altKey metaKey repeat isComposing charCode keyCode which".split(" ");function jb(a,b){this.win=a;this.L=b;a=this.ba.bind(this);Q(this.win,"keydown",a,void 0);Q(this.win,"keypress",a,void 0);Q(this.win,"keyup",a,void 0)}jb.prototype.ba=function(a){kb(a)||this.aa(a)};jb.prototype.aa=function(a){this.L.sendRequest(a.type,lb(a),!1)};function kb(a){if(a.defaultPrevented)return!0;if("Escape"==a.key)return!1;switch(a.target.nodeName){case"INPUT":return"checkbox"!=a.target.type||" "==a.key;case"TEXTAREA":case"BUTTON":case"SELECT":case"OPTION":return!0}return a.target.hasAttribute&&a.target.hasAttribute("contenteditable")}function lb(a){var b={};ib.forEach((function(c){void 0!==a[c]&&(b[c]=a[c])}));return b}function mb(a){if("string"!=typeof a)return a;if("{"!=a.charAt(0))return null;try{return JSON.parse(a)}catch(b){return null}}function Y(a,b,c){this.I=a;this.ha=b;this.xa=c}Y.prototype.addEventListener=function(a,b){var c=this;this.I.addEventListener("message",(function(d){d.origin==c.ha&&d.source==c.xa&&b(d)}))};Y.prototype.postMessage=function(a){this.xa.postMessage(a,"null"===this.ha?"*":this.ha)};Y.prototype.start=function(){};function rb(a,b,c,d){this.I=a;this.ja=b;this.La=!!c;this.Y=d||null;this.Aa=!1;this.Na=0;this.pa={};this.ea={};this.ra=null;this.ja.addEventListener("message",this.Ia.bind(this));this.ja.start()}n=rb.prototype;n.registerHandler=function(a,b){this.ea[a]=b};n.unregisterHandler=function(a){delete this.ea[a]};n.setDefaultHandler=function(a){this.ra=a};n.Ia=function(a){if((a=mb(a.data))&&"__AMPHTML__"===a.app)if(this.Y&&this.Aa&&a.messagingToken!==this.Y)sb(this,"amp-viewer-messaging: handleMessage_ error: ","invalid token");else if("q"===a.type)tb(this,a);else if("s"===a.type){var b=a.requestid,c=this.pa[b];c&&(delete this.pa[b],a.error?(sb(this,"amp-viewer-messaging: handleResponse_ error: ",a.error),c.reject(Error("Request "+a.name+" failed: "+a.error))):c.resolve(a.data))}};n.sendRequest=function(a,b,c){var d=this,e=++this.Na,f=void 0;c&&(f=new Promise((function(g,k){d.pa[e]={resolve:g,reject:k}})));ub(this,{app:"__AMPHTML__",requestid:e,type:"q",name:a,data:b,rsvp:c});return f};function vb(a,b,c,d){var e=d?d.message?d.message:String(d):"unknown error";sb(a,"amp-viewer-messaging: sendResponseError_, message name: "+c,e);ub(a,{app:"__AMPHTML__",requestid:b,type:"s",name:c,data:null,error:e})}function ub(a,b){var c=Object.assign(b,{});a.Y&&!a.Aa&&(c.messagingToken=a.Y);a.ja.postMessage(a.La?JSON.stringify(c):c)}function tb(a,b){var c=a.ea[b.name];c||(c=a.ra);if(!c)throw c=Error("Cannot handle request because no default handler is set!"),c.args=b.name,c;c=c(b.name,b.data,!!b.rsvp);if(b.rsvp){var d=b.requestid;if(!c)throw vb(a,d,b.name,Error("no response")),Error("expected response but none given: "+b.name);c.then((function(e){ub(a,{app:"__AMPHTML__",requestid:d,type:"s",name:b.name,data:e})}),(function(e){vb(a,d,b.name,e)}))}}function sb(a,b,c){if(a.I){var d="amp-messaging-error-logger: "+b;d+=" data: "+(c?c.message?c.message:String(c):"unknown error");a.I.viewerState=d}}var wb="altKey charCode ctrlKey detail eventPhase key layerX layerY metaKey pageX pageY returnValue shiftKey timeStamp type which".split(" "),xb="clientX clientY force identifier pageX pageY radiusX radiusY screenX screenY".split(" ");function yb(a,b){this.win=a;this.L=b;this.ka=!1;this.oa=[];b.registerHandler("scrollLock",this.Pa.bind(this));zb(this)}function zb(a){var b=a.ba.bind(a),c=a.win.document,d={capture:!1,passive:!a.ka};a.oa.push(Q(c,"touchstart",b,d),Q(c,"touchend",b,d),Q(c,"touchmove",b,d))}function Ab(a){a.oa.forEach((function(b){return b()}));a.oa.length=0}yb.prototype.ba=function(a){switch(a.type){case"touchstart":case"touchend":case"touchmove":if(null==a?0:a.shouldViewerCancelPropagation)a.stopImmediatePropagation();else{if(a&&a.type){var b=Bb(a,wb);a.touches&&(b.touches=Cb(a.touches));a.changedTouches&&(b.changedTouches=Cb(a.changedTouches));this.L.sendRequest(a.type,b,!1)}this.ka&&a.cancelable&&a.preventDefault()}}};function Cb(a){for(var b=[],c=0;c<a.length;c++)b.push(Bb(a[c],xb));return b}function Bb(a,b){for(var c={},d=0;d<b.length;d++){var e=b[d];void 0!==a[e]&&(c[e]=a[e])}return c}yb.prototype.Pa=function(a,b,c){this.ka=!!b;Ab(this);zb(this);return c?Promise.resolve({}):void 0};function Z(){this.Ea=100;this.$=this.la=0;this.R=Object.create(null)}Z.prototype.has=function(a){return!!this.R[a]};Z.prototype.get=function(a){var b=this.R[a];if(b)return b.access=++this.$,b.payload};Z.prototype.put=function(a,b){this.has(a)||this.la++;this.R[a]={payload:b,access:this.$};if(!(this.la<=this.Ea)){a=this.R;b=this.$+1;var c;for(c in a){var d=a[c].access;if(d<b){b=d;var e=c}}void 0!==e&&(delete a[e],this.la--)}};var Eb,Fb,Db=new Set(["c","v","a","ad"]);function Gb(a){if("string"==typeof a){Eb||(Eb=self.document.createElement("a"),Fb=self.__AMP_URL_CACHE||(self.__AMP_URL_CACHE=new Z));var b=Eb,c=Fb;if(c&&c.has(a))a=c.get(a);else{b.href=a;b.protocol||(b.href=b.href);var d={href:b.href,protocol:b.protocol,host:b.host,hostname:b.hostname,port:"0"==b.port?"":b.port,pathname:b.pathname,search:b.search,hash:b.hash,origin:null};"/"!==d.pathname[0]&&(d.pathname="/"+d.pathname);if("http:"==d.protocol&&80==d.port||"https:"==d.protocol&&443==d.port)d.port="",d.host=d.hostname;d.origin=b.origin&&"null"!=b.origin?b.origin:"data:"!=d.protocol&&d.host?d.protocol+"//"+d.host:d.href;c&&c.put(a,d);a=d}}return a}function Hb(a){a=Gb(a);if(!ja.cdnProxyRegex.test(Gb(a).origin))return a.href;var b=a.pathname.split("/");qa(Db.has(b[1]),"Unknown path prefix in url %s",a.href);var c=b[2],d="s"==c?"https://"+decodeURIComponent(b[3]):"http://"+decodeURIComponent(c);qa(0<d.indexOf("."),"Expected a . in origin %s",d);b.splice(1,"s"==c?3:2);b=d+b.join("/");d=(d=a.search)&&"?"!=d?(d=d.replace(/[?&](amp_(js[^&=]*|gsa|r|kit)|usqp)\b[^&]*/g,"").replace(/^[?&]/,""))?"?"+d:"":"";return b+d+(a.hash||"")}function Ib(){this.win=AMP.win;this.ta=this.H=!1;this.ca=null}Ib.prototype.init=function(){var a=this;y().fine("amp-viewer-integration","handshake init()");var b=C(this.win.document),c=B(b,"viewer");this.H="1"==c.getParam("webview");this.ta=c.hasCapability("handshakepoll");var d=c.getParam("messagingToken"),e=c.getParam("origin")||"";if(!this.H&&!e)return q();B(b,"viewport").createFixedLayer(Da);if(this.H||this.ta){var f=fa(this.win)?this.win.parent:null;return Jb(this,f,e).then((function(g){return Kb(a,c,b,e,new rb(a.win,g,a.H,d))}))}if(f=bb(b))this.ca=new V(b,f);f=new Y(this.win,e,this.win.parent);return Kb(this,c,b,e,new rb(this.win,f,this.H,d))};function Jb(a,b,c){return new Promise((function(d){var e=Qa(a.win,"message",(function(f){y().fine("amp-viewer-integration","AMPDOC got a pre-handshake message:",f.type,f.data);var g=mb(f.data);if(g&&f.origin===c&&f.source===b&&"__AMPHTML__"==g.app&&"handshake-poll"==g.name){if(a.H&&(!f.ports||!f.ports.length))throw Error("Did not receive communication port from the Viewer!");f=f.ports&&0<f.ports.length?f.ports[0]:new Y(a.win,c,a.win.parent);d(f);e()}}))}))}function Kb(a,b,c,d,e){y().fine("amp-viewer-integration","Send a handshake request");var f=c.getUrl(),g=Hb(f);return e.sendRequest("channelOpen",r({url:f,sourceUrl:g}),!0).then((function(){y().fine("amp-viewer-integration","Channel has been opened!");Lb(a,e,b,d)}))}function Lb(a,b,c,d){b.setDefaultHandler((function(e,f,g){return c.receiveMessage(e,f,g)}));c.setMessageDeliverer(b.sendRequest.bind(b),d);Ra(a.win,"unload",a.Ja.bind(a,b));(c.hasCapability("swipe")||c.hasCapability("touch"))&&new yb(a.win,b);c.hasCapability("keyboard")&&new jb(a.win,b);c.hasCapability("focus-rect")&&new Sa(a.win,b);null!=a.ca&&a.ca.setupMessaging(b)}Ib.prototype.Ja=function(a){return a.sendRequest("unloaded",{},!0)};(new Ib).init()}});//# sourceMappingURL=amp-viewer-integration-0.1.js.map